(self.webpackChunkismile_electron=self.webpackChunkismile_electron||[]).push([[746],{8295:Ds=>{"use strict";var Y={};function ge(){try{return new window.XMLHttpRequest}catch{}}Y._getBinaryFromXHR=function(D){return D.response||D.responseText};var k=typeof window<"u"&&window.ActiveXObject?function(){return ge()||function j(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch{}}()}:ge;Y.getBinaryContent=function(D,T){var F,X,Q,W;T||(T={}),"function"==typeof T?(W=T,T={}):"function"==typeof T.callback&&(W=T.callback),!W&&typeof Promise<"u"?F=new Promise(function(E,H){X=E,Q=H}):(X=function(E){W(null,E)},Q=function(E){W(E,null)});try{var Z=k();Z.open("GET",D,!0),"responseType"in Z&&(Z.responseType="arraybuffer"),Z.overrideMimeType&&Z.overrideMimeType("text/plain; charset=x-user-defined"),Z.onreadystatechange=function(E){if(4===Z.readyState)if(200===Z.status||0===Z.status)try{X(Y._getBinaryFromXHR(Z))}catch(H){Q(new Error(H))}else Q(new Error("Ajax error for "+D+" : "+this.status+" "+this.statusText))},T.progress&&(Z.onprogress=function(E){T.progress({path:D,originalEvent:E,percent:E.loaded/E.total*100,loaded:E.loaded,total:E.total})}),Z.send()}catch(E){Q(new Error(E),null)}return F},Ds.exports=Y},7586:Ds=>{Ds.exports=function Y(ge,j,k){function D(X,Q){if(!j[X]){if(!ge[X]){if(T)return T(X,!0);var Z=new Error("Cannot find module '"+X+"'");throw Z.code="MODULE_NOT_FOUND",Z}var E=j[X]={exports:{}};ge[X][0].call(E.exports,function(H){return D(ge[X][1][H]||H)},E,E.exports,Y,ge,j,k)}return j[X].exports}for(var T=void 0,F=0;F<k.length;F++)D(k[F]);return D}({1:[function(Y,ge,j){"use strict";var k=Y("./utils"),D=Y("./support"),T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j.encode=function(F){for(var X,Q,W,E,H,C,z=[],I=0,G=F.length,$=G,ne="string"!==k.getTypeOf(F);I<F.length;)$=G-I,W=ne?(X=F[I++],Q=I<G?F[I++]:0,I<G?F[I++]:0):(X=F.charCodeAt(I++),Q=I<G?F.charCodeAt(I++):0,I<G?F.charCodeAt(I++):0),E=(3&X)<<4|Q>>4,H=1<$?(15&Q)<<2|W>>6:64,C=2<$?63&W:64,z.push(T.charAt(X>>2)+T.charAt(E)+T.charAt(H)+T.charAt(C));return z.join("")},j.decode=function(F){var X,Q,W,Z,E,H,C=0,z=0,I="data:";if(F.substr(0,I.length)===I)throw new Error("Invalid base64 input, it looks like a data url.");var G,$=3*(F=F.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(F.charAt(F.length-1)===T.charAt(64)&&$--,F.charAt(F.length-2)===T.charAt(64)&&$--,$%1!=0)throw new Error("Invalid base64 input, bad content length.");for(G=D.uint8array?new Uint8Array(0|$):new Array(0|$);C<F.length;)X=T.indexOf(F.charAt(C++))<<2|(Z=T.indexOf(F.charAt(C++)))>>4,Q=(15&Z)<<4|(E=T.indexOf(F.charAt(C++)))>>2,W=(3&E)<<6|(H=T.indexOf(F.charAt(C++))),G[z++]=X,64!==E&&(G[z++]=Q),64!==H&&(G[z++]=W);return G}},{"./support":30,"./utils":32}],2:[function(Y,ge,j){"use strict";var k=Y("./external"),D=Y("./stream/DataWorker"),T=Y("./stream/Crc32Probe"),F=Y("./stream/DataLengthProbe");function X(Q,W,Z,E,H){this.compressedSize=Q,this.uncompressedSize=W,this.crc32=Z,this.compression=E,this.compressedContent=H}X.prototype={getContentWorker:function(){var Q=new D(k.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new F("data_length")),W=this;return Q.on("end",function(){if(this.streamInfo.data_length!==W.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),Q},getCompressedWorker:function(){return new D(k.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},X.createWorkerFrom=function(Q,W,Z){return Q.pipe(new T).pipe(new F("uncompressedSize")).pipe(W.compressWorker(Z)).pipe(new F("compressedSize")).withStreamInfo("compression",W)},ge.exports=X},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(Y,ge,j){"use strict";var k=Y("./stream/GenericWorker");j.STORE={magic:"\0\0",compressWorker:function(){return new k("STORE compression")},uncompressWorker:function(){return new k("STORE decompression")}},j.DEFLATE=Y("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(Y,ge,j){"use strict";var k=Y("./utils"),D=function(){for(var T,F=[],X=0;X<256;X++){T=X;for(var Q=0;Q<8;Q++)T=1&T?3988292384^T>>>1:T>>>1;F[X]=T}return F}();ge.exports=function(T,F){return void 0!==T&&T.length?"string"!==k.getTypeOf(T)?function(X,Q,W,Z){var E=D,H=0+W;X^=-1;for(var C=0;C<H;C++)X=X>>>8^E[255&(X^Q[C])];return-1^X}(0|F,T,T.length):function(X,Q,W,Z){var E=D,H=0+W;X^=-1;for(var C=0;C<H;C++)X=X>>>8^E[255&(X^Q.charCodeAt(C))];return-1^X}(0|F,T,T.length):0}},{"./utils":32}],5:[function(Y,ge,j){"use strict";j.base64=!1,j.binary=!1,j.dir=!1,j.createFolders=!0,j.date=null,j.compression=null,j.compressionOptions=null,j.comment=null,j.unixPermissions=null,j.dosPermissions=null},{}],6:[function(Y,ge,j){"use strict";var k;k=typeof Promise<"u"?Promise:Y("lie"),ge.exports={Promise:k}},{lie:37}],7:[function(Y,ge,j){"use strict";var k=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",D=Y("pako"),T=Y("./utils"),F=Y("./stream/GenericWorker"),X=k?"uint8array":"array";function Q(W,Z){F.call(this,"FlateWorker/"+W),this._pako=null,this._pakoAction=W,this._pakoOptions=Z,this.meta={}}j.magic="\b\0",T.inherits(Q,F),Q.prototype.processChunk=function(W){this.meta=W.meta,null===this._pako&&this._createPako(),this._pako.push(T.transformTo(X,W.data),!1)},Q.prototype.flush=function(){F.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},Q.prototype.cleanUp=function(){F.prototype.cleanUp.call(this),this._pako=null},Q.prototype._createPako=function(){this._pako=new D[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var W=this;this._pako.onData=function(Z){W.push({data:Z,meta:W.meta})}},j.compressWorker=function(W){return new Q("Deflate",W)},j.uncompressWorker=function(){return new Q("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(Y,ge,j){"use strict";function k(E,H){var C,z="";for(C=0;C<H;C++)z+=String.fromCharCode(255&E),E>>>=8;return z}function D(E,H,C,z,I,G){var $,ne,re=E.file,Ce=E.compression,Se=G!==X.utf8encode,Fe=T.transformTo("string",G(re.name)),ve=T.transformTo("string",X.utf8encode(re.name)),He=re.comment,yt=T.transformTo("string",G(He)),q=T.transformTo("string",X.utf8encode(He)),Me=ve.length!==re.name.length,w=q.length!==He.length,Ee="",Pt="",ze="",Lt=re.dir,Ne=re.date,Tt={crc32:0,compressedSize:0,uncompressedSize:0};H&&!C||(Tt.crc32=E.crc32,Tt.compressedSize=E.compressedSize,Tt.uncompressedSize=E.uncompressedSize);var pe=0;H&&(pe|=8),Se||!Me&&!w||(pe|=2048);var Ze,pn,he=0,vt=0;Lt&&(he|=16),"UNIX"===I?(vt=798,he|=(pn=Ze=re.unixPermissions,Ze||(pn=Lt?16893:33204),(65535&pn)<<16)):(vt=20,he|=function(Ze){return 63&(Ze||0)}(re.dosPermissions)),$=Ne.getUTCHours(),$<<=6,$|=Ne.getUTCMinutes(),$<<=5,$|=Ne.getUTCSeconds()/2,ne=Ne.getUTCFullYear()-1980,ne<<=4,ne|=Ne.getUTCMonth()+1,ne<<=5,ne|=Ne.getUTCDate(),Me&&(Pt=k(1,1)+k(Q(Fe),4)+ve,Ee+="up"+k(Pt.length,2)+Pt),w&&(ze=k(1,1)+k(Q(yt),4)+q,Ee+="uc"+k(ze.length,2)+ze);var et="";return et+="\n\0",et+=k(pe,2),et+=Ce.magic,et+=k($,2),et+=k(ne,2),et+=k(Tt.crc32,4),et+=k(Tt.compressedSize,4),et+=k(Tt.uncompressedSize,4),et+=k(Fe.length,2),et+=k(Ee.length,2),{fileRecord:W.LOCAL_FILE_HEADER+et+Fe+Ee,dirRecord:W.CENTRAL_FILE_HEADER+k(vt,2)+et+k(yt.length,2)+"\0\0\0\0"+k(he,4)+k(z,4)+Fe+Ee+yt}}var T=Y("../utils"),F=Y("../stream/GenericWorker"),X=Y("../utf8"),Q=Y("../crc32"),W=Y("../signature");function Z(E,H,C,z){F.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=H,this.zipPlatform=C,this.encodeFileName=z,this.streamFiles=E,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}T.inherits(Z,F),Z.prototype.push=function(E){var H=E.meta.percent||0,C=this.entriesCount,z=this._sources.length;this.accumulate?this.contentBuffer.push(E):(this.bytesWritten+=E.data.length,F.prototype.push.call(this,{data:E.data,meta:{currentFile:this.currentFile,percent:C?(H+100*(C-z-1))/C:100}}))},Z.prototype.openedSource=function(E){this.currentSourceOffset=this.bytesWritten,this.currentFile=E.file.name;var H=this.streamFiles&&!E.file.dir;if(H){var C=D(E,H,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:C.fileRecord,meta:{percent:0}})}else this.accumulate=!0},Z.prototype.closedSource=function(E){this.accumulate=!1;var z,H=this.streamFiles&&!E.file.dir,C=D(E,H,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(C.dirRecord),H)this.push({data:(z=E,W.DATA_DESCRIPTOR+k(z.crc32,4)+k(z.compressedSize,4)+k(z.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:C.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},Z.prototype.flush=function(){for(var E=this.bytesWritten,H=0;H<this.dirRecords.length;H++)this.push({data:this.dirRecords[H],meta:{percent:100}});var I,G,$,Ce,z=(I=this.dirRecords.length,G=this.bytesWritten-E,$=E,Ce=T.transformTo("string",(0,this.encodeFileName)(this.zipComment)),W.CENTRAL_DIRECTORY_END+"\0\0\0\0"+k(I,2)+k(I,2)+k(G,4)+k($,4)+k(Ce.length,2)+Ce);this.push({data:z,meta:{percent:100}})},Z.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},Z.prototype.registerPrevious=function(E){this._sources.push(E);var H=this;return E.on("data",function(C){H.processChunk(C)}),E.on("end",function(){H.closedSource(H.previous.streamInfo),H._sources.length?H.prepareNextSource():H.end()}),E.on("error",function(C){H.error(C)}),this},Z.prototype.resume=function(){return!!F.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},Z.prototype.error=function(E){var H=this._sources;if(!F.prototype.error.call(this,E))return!1;for(var C=0;C<H.length;C++)try{H[C].error(E)}catch{}return!0},Z.prototype.lock=function(){F.prototype.lock.call(this);for(var E=this._sources,H=0;H<E.length;H++)E[H].lock()},ge.exports=Z},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(Y,ge,j){"use strict";var k=Y("../compressions"),D=Y("./ZipFileWorker");j.generateWorker=function(T,F,X){var Q=new D(F.streamFiles,X,F.platform,F.encodeFileName),W=0;try{T.forEach(function(Z,E){W++;var H=function(G,$){var ne=G||$,re=k[ne];if(!re)throw new Error(ne+" is not a valid compression method !");return re}(E.options.compression,F.compression),z=E.dir,I=E.date;E._compressWorker(H,E.options.compressionOptions||F.compressionOptions||{}).withStreamInfo("file",{name:Z,dir:z,date:I,comment:E.comment||"",unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions}).pipe(Q)}),Q.entriesCount=W}catch(Z){Q.error(Z)}return Q}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(Y,ge,j){"use strict";function k(){if(!(this instanceof k))return new k;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var D=new k;for(var T in this)"function"!=typeof this[T]&&(D[T]=this[T]);return D}}(k.prototype=Y("./object")).loadAsync=Y("./load"),k.support=Y("./support"),k.defaults=Y("./defaults"),k.version="3.10.1",k.loadAsync=function(D,T){return(new k).loadAsync(D,T)},k.external=Y("./external"),ge.exports=k},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(Y,ge,j){"use strict";var k=Y("./utils"),D=Y("./external"),T=Y("./utf8"),F=Y("./zipEntries"),X=Y("./stream/Crc32Probe"),Q=Y("./nodejsUtils");function W(Z){return new D.Promise(function(E,H){var C=Z.decompressed.getContentWorker().pipe(new X);C.on("error",function(z){H(z)}).on("end",function(){C.streamInfo.crc32!==Z.decompressed.crc32?H(new Error("Corrupted zip : CRC32 mismatch")):E()}).resume()})}ge.exports=function(Z,E){var H=this;return E=k.extend(E||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:T.utf8decode}),Q.isNode&&Q.isStream(Z)?D.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):k.prepareContent("the loaded zip file",Z,!0,E.optimizedBinaryString,E.base64).then(function(C){var z=new F(E);return z.load(C),z}).then(function(C){var z=[D.Promise.resolve(C)],I=C.files;if(E.checkCRC32)for(var G=0;G<I.length;G++)z.push(W(I[G]));return D.Promise.all(z)}).then(function(C){for(var z=C.shift(),I=z.files,G=0;G<I.length;G++){var $=I[G],ne=$.fileNameStr,re=k.resolve($.fileNameStr);H.file(re,$.decompressed,{binary:!0,optimizedBinaryString:!0,date:$.date,dir:$.dir,comment:$.fileCommentStr.length?$.fileCommentStr:null,unixPermissions:$.unixPermissions,dosPermissions:$.dosPermissions,createFolders:E.createFolders}),$.dir||(H.file(re).unsafeOriginalName=ne)}return z.zipComment.length&&(H.comment=z.zipComment),H})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(Y,ge,j){"use strict";var k=Y("../utils"),D=Y("../stream/GenericWorker");function T(F,X){D.call(this,"Nodejs stream input adapter for "+F),this._upstreamEnded=!1,this._bindStream(X)}k.inherits(T,D),T.prototype._bindStream=function(F){var X=this;(this._stream=F).pause(),F.on("data",function(Q){X.push({data:Q,meta:{percent:0}})}).on("error",function(Q){X.isPaused?this.generatedError=Q:X.error(Q)}).on("end",function(){X.isPaused?X._upstreamEnded=!0:X.end()})},T.prototype.pause=function(){return!!D.prototype.pause.call(this)&&(this._stream.pause(),!0)},T.prototype.resume=function(){return!!D.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},ge.exports=T},{"../stream/GenericWorker":28,"../utils":32}],13:[function(Y,ge,j){"use strict";var k=Y("readable-stream").Readable;function D(T,F,X){k.call(this,F),this._helper=T;var Q=this;T.on("data",function(W,Z){Q.push(W)||Q._helper.pause(),X&&X(Z)}).on("error",function(W){Q.emit("error",W)}).on("end",function(){Q.push(null)})}Y("../utils").inherits(D,k),D.prototype._read=function(){this._helper.resume()},ge.exports=D},{"../utils":32,"readable-stream":16}],14:[function(Y,ge,j){"use strict";ge.exports={isNode:typeof Buffer<"u",newBufferFrom:function(k,D){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(k,D);if("number"==typeof k)throw new Error('The "data" argument must not be a number');return new Buffer(k,D)},allocBuffer:function(k){if(Buffer.alloc)return Buffer.alloc(k);var D=new Buffer(k);return D.fill(0),D},isBuffer:function(k){return Buffer.isBuffer(k)},isStream:function(k){return k&&"function"==typeof k.on&&"function"==typeof k.pause&&"function"==typeof k.resume}}},{}],15:[function(Y,ge,j){"use strict";function k(re,Ce,Se){var Fe,ve=T.getTypeOf(Ce),He=T.extend(Se||{},Q);He.date=He.date||new Date,null!==He.compression&&(He.compression=He.compression.toUpperCase()),"string"==typeof He.unixPermissions&&(He.unixPermissions=parseInt(He.unixPermissions,8)),He.unixPermissions&&16384&He.unixPermissions&&(He.dir=!0),He.dosPermissions&&16&He.dosPermissions&&(He.dir=!0),He.dir&&(re=I(re)),He.createFolders&&(Fe=z(re))&&G.call(this,Fe,!0),Se&&void 0!==Se.binary||(He.binary=!("string"===ve&&!1===He.binary&&!1===He.base64)),(Ce instanceof W&&0===Ce.uncompressedSize||He.dir||!Ce||0===Ce.length)&&(He.base64=!1,He.binary=!0,Ce="",He.compression="STORE",ve="string");var q;q=Ce instanceof W||Ce instanceof F?Ce:H.isNode&&H.isStream(Ce)?new C(re,Ce):T.prepareContent(re,Ce,He.binary,He.optimizedBinaryString,He.base64);var Me=new Z(re,q,He);this.files[re]=Me}var D=Y("./utf8"),T=Y("./utils"),F=Y("./stream/GenericWorker"),X=Y("./stream/StreamHelper"),Q=Y("./defaults"),W=Y("./compressedObject"),Z=Y("./zipObject"),E=Y("./generate"),H=Y("./nodejsUtils"),C=Y("./nodejs/NodejsStreamInputAdapter"),z=function(re){"/"===re.slice(-1)&&(re=re.substring(0,re.length-1));var Ce=re.lastIndexOf("/");return 0<Ce?re.substring(0,Ce):""},I=function(re){return"/"!==re.slice(-1)&&(re+="/"),re},G=function(re,Ce){return Ce=void 0!==Ce?Ce:Q.createFolders,re=I(re),this.files[re]||k.call(this,re,null,{dir:!0,createFolders:Ce}),this.files[re]};function $(re){return"[object RegExp]"===Object.prototype.toString.call(re)}var ne={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(re){var Ce,Se,Fe;for(Ce in this.files)Fe=this.files[Ce],(Se=Ce.slice(this.root.length,Ce.length))&&Ce.slice(0,this.root.length)===this.root&&re(Se,Fe)},filter:function(re){var Ce=[];return this.forEach(function(Se,Fe){re(Se,Fe)&&Ce.push(Fe)}),Ce},file:function(re,Ce,Se){if(1!==arguments.length)return k.call(this,re=this.root+re,Ce,Se),this;if($(re)){var Fe=re;return this.filter(function(He,yt){return!yt.dir&&Fe.test(He)})}var ve=this.files[this.root+re];return ve&&!ve.dir?ve:null},folder:function(re){if(!re)return this;if($(re))return this.filter(function(ve,He){return He.dir&&re.test(ve)});var Se=G.call(this,this.root+re),Fe=this.clone();return Fe.root=Se.name,Fe},remove:function(re){var Ce=this.files[re=this.root+re];if(Ce||("/"!==re.slice(-1)&&(re+="/"),Ce=this.files[re]),Ce&&!Ce.dir)delete this.files[re];else for(var Se=this.filter(function(ve,He){return He.name.slice(0,re.length)===re}),Fe=0;Fe<Se.length;Fe++)delete this.files[Se[Fe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(re){var Ce,Se={};try{if((Se=T.extend(re||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:D.utf8encode})).type=Se.type.toLowerCase(),Se.compression=Se.compression.toUpperCase(),"binarystring"===Se.type&&(Se.type="string"),!Se.type)throw new Error("No output type specified.");T.checkSupport(Se.type),"darwin"!==Se.platform&&"freebsd"!==Se.platform&&"linux"!==Se.platform&&"sunos"!==Se.platform||(Se.platform="UNIX"),"win32"===Se.platform&&(Se.platform="DOS"),Ce=E.generateWorker(this,Se,Se.comment||this.comment||"")}catch(ve){(Ce=new F("error")).error(ve)}return new X(Ce,Se.type||"string",Se.mimeType)},generateAsync:function(re,Ce){return this.generateInternalStream(re).accumulate(Ce)},generateNodeStream:function(re,Ce){return(re=re||{}).type||(re.type="nodebuffer"),this.generateInternalStream(re).toNodejsStream(Ce)}};ge.exports=ne},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(Y,ge,j){"use strict";ge.exports=Y("stream")},{stream:void 0}],17:[function(Y,ge,j){"use strict";var k=Y("./DataReader");function D(T){k.call(this,T);for(var F=0;F<this.data.length;F++)T[F]=255&T[F]}Y("../utils").inherits(D,k),D.prototype.byteAt=function(T){return this.data[this.zero+T]},D.prototype.lastIndexOfSignature=function(T){for(var F=T.charCodeAt(0),X=T.charCodeAt(1),Q=T.charCodeAt(2),W=T.charCodeAt(3),Z=this.length-4;0<=Z;--Z)if(this.data[Z]===F&&this.data[Z+1]===X&&this.data[Z+2]===Q&&this.data[Z+3]===W)return Z-this.zero;return-1},D.prototype.readAndCheckSignature=function(T){var F=T.charCodeAt(0),X=T.charCodeAt(1),Q=T.charCodeAt(2),W=T.charCodeAt(3),Z=this.readData(4);return F===Z[0]&&X===Z[1]&&Q===Z[2]&&W===Z[3]},D.prototype.readData=function(T){if(this.checkOffset(T),0===T)return[];var F=this.data.slice(this.zero+this.index,this.zero+this.index+T);return this.index+=T,F},ge.exports=D},{"../utils":32,"./DataReader":18}],18:[function(Y,ge,j){"use strict";var k=Y("../utils");function D(T){this.data=T,this.length=T.length,this.index=0,this.zero=0}D.prototype={checkOffset:function(T){this.checkIndex(this.index+T)},checkIndex:function(T){if(this.length<this.zero+T||T<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+T+"). Corrupted zip ?")},setIndex:function(T){this.checkIndex(T),this.index=T},skip:function(T){this.setIndex(this.index+T)},byteAt:function(){},readInt:function(T){var F,X=0;for(this.checkOffset(T),F=this.index+T-1;F>=this.index;F--)X=(X<<8)+this.byteAt(F);return this.index+=T,X},readString:function(T){return k.transformTo("string",this.readData(T))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var T=this.readInt(4);return new Date(Date.UTC(1980+(T>>25&127),(T>>21&15)-1,T>>16&31,T>>11&31,T>>5&63,(31&T)<<1))}},ge.exports=D},{"../utils":32}],19:[function(Y,ge,j){"use strict";var k=Y("./Uint8ArrayReader");function D(T){k.call(this,T)}Y("../utils").inherits(D,k),D.prototype.readData=function(T){this.checkOffset(T);var F=this.data.slice(this.zero+this.index,this.zero+this.index+T);return this.index+=T,F},ge.exports=D},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(Y,ge,j){"use strict";var k=Y("./DataReader");function D(T){k.call(this,T)}Y("../utils").inherits(D,k),D.prototype.byteAt=function(T){return this.data.charCodeAt(this.zero+T)},D.prototype.lastIndexOfSignature=function(T){return this.data.lastIndexOf(T)-this.zero},D.prototype.readAndCheckSignature=function(T){return T===this.readData(4)},D.prototype.readData=function(T){this.checkOffset(T);var F=this.data.slice(this.zero+this.index,this.zero+this.index+T);return this.index+=T,F},ge.exports=D},{"../utils":32,"./DataReader":18}],21:[function(Y,ge,j){"use strict";var k=Y("./ArrayReader");function D(T){k.call(this,T)}Y("../utils").inherits(D,k),D.prototype.readData=function(T){if(this.checkOffset(T),0===T)return new Uint8Array(0);var F=this.data.subarray(this.zero+this.index,this.zero+this.index+T);return this.index+=T,F},ge.exports=D},{"../utils":32,"./ArrayReader":17}],22:[function(Y,ge,j){"use strict";var k=Y("../utils"),D=Y("../support"),T=Y("./ArrayReader"),F=Y("./StringReader"),X=Y("./NodeBufferReader"),Q=Y("./Uint8ArrayReader");ge.exports=function(W){var Z=k.getTypeOf(W);return k.checkSupport(Z),"string"!==Z||D.uint8array?"nodebuffer"===Z?new X(W):D.uint8array?new Q(k.transformTo("uint8array",W)):new T(k.transformTo("array",W)):new F(W)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(Y,ge,j){"use strict";j.LOCAL_FILE_HEADER="PK\x03\x04",j.CENTRAL_FILE_HEADER="PK\x01\x02",j.CENTRAL_DIRECTORY_END="PK\x05\x06",j.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",j.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",j.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(Y,ge,j){"use strict";var k=Y("./GenericWorker"),D=Y("../utils");function T(F){k.call(this,"ConvertWorker to "+F),this.destType=F}D.inherits(T,k),T.prototype.processChunk=function(F){this.push({data:D.transformTo(this.destType,F.data),meta:F.meta})},ge.exports=T},{"../utils":32,"./GenericWorker":28}],25:[function(Y,ge,j){"use strict";var k=Y("./GenericWorker"),D=Y("../crc32");function T(){k.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Y("../utils").inherits(T,k),T.prototype.processChunk=function(F){this.streamInfo.crc32=D(F.data,this.streamInfo.crc32||0),this.push(F)},ge.exports=T},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(Y,ge,j){"use strict";var k=Y("../utils"),D=Y("./GenericWorker");function T(F){D.call(this,"DataLengthProbe for "+F),this.propName=F,this.withStreamInfo(F,0)}k.inherits(T,D),T.prototype.processChunk=function(F){F&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+F.data.length),D.prototype.processChunk.call(this,F)},ge.exports=T},{"../utils":32,"./GenericWorker":28}],27:[function(Y,ge,j){"use strict";var k=Y("../utils"),D=Y("./GenericWorker");function T(F){D.call(this,"DataWorker");var X=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,F.then(function(Q){X.dataIsReady=!0,X.data=Q,X.max=Q&&Q.length||0,X.type=k.getTypeOf(Q),X.isPaused||X._tickAndRepeat()},function(Q){X.error(Q)})}k.inherits(T,D),T.prototype.cleanUp=function(){D.prototype.cleanUp.call(this),this.data=null},T.prototype.resume=function(){return!!D.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,k.delay(this._tickAndRepeat,[],this)),!0)},T.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(k.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},T.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var F=null,X=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":F=this.data.substring(this.index,X);break;case"uint8array":F=this.data.subarray(this.index,X);break;case"array":case"nodebuffer":F=this.data.slice(this.index,X)}return this.index=X,this.push({data:F,meta:{percent:this.max?this.index/this.max*100:0}})},ge.exports=T},{"../utils":32,"./GenericWorker":28}],28:[function(Y,ge,j){"use strict";function k(D){this.name=D||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}k.prototype={push:function(D){this.emit("data",D)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(D){this.emit("error",D)}return!0},error:function(D){return!this.isFinished&&(this.isPaused?this.generatedError=D:(this.isFinished=!0,this.emit("error",D),this.previous&&this.previous.error(D),this.cleanUp()),!0)},on:function(D,T){return this._listeners[D].push(T),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(D,T){if(this._listeners[D])for(var F=0;F<this._listeners[D].length;F++)this._listeners[D][F].call(this,T)},pipe:function(D){return D.registerPrevious(this)},registerPrevious:function(D){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=D.streamInfo,this.mergeStreamInfo(),this.previous=D;var T=this;return D.on("data",function(F){T.processChunk(F)}),D.on("end",function(){T.end()}),D.on("error",function(F){T.error(F)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var D=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),D=!0),this.previous&&this.previous.resume(),!D},flush:function(){},processChunk:function(D){this.push(D)},withStreamInfo:function(D,T){return this.extraStreamInfo[D]=T,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var D in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,D)&&(this.streamInfo[D]=this.extraStreamInfo[D])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var D="Worker "+this.name;return this.previous?this.previous+" -> "+D:D}},ge.exports=k},{}],29:[function(Y,ge,j){"use strict";var k=Y("../utils"),D=Y("./ConvertWorker"),T=Y("./GenericWorker"),F=Y("../base64"),X=Y("../support"),Q=Y("../external"),W=null;if(X.nodestream)try{W=Y("../nodejs/NodejsStreamOutputAdapter")}catch{}function E(H,C,z){var I=C;switch(C){case"blob":case"arraybuffer":I="uint8array";break;case"base64":I="string"}try{this._internalType=I,this._outputType=C,this._mimeType=z,k.checkSupport(I),this._worker=H.pipe(new D(I)),H.lock()}catch(G){this._worker=new T("error"),this._worker.error(G)}}E.prototype={accumulate:function(H){return function Z(H,C){return new Q.Promise(function(z,I){var G=[],$=H._internalType,ne=H._outputType,re=H._mimeType;H.on("data",function(Ce,Se){G.push(Ce),C&&C(Se)}).on("error",function(Ce){G=[],I(Ce)}).on("end",function(){try{var Ce=function(Se,Fe,ve){switch(Se){case"blob":return k.newBlob(k.transformTo("arraybuffer",Fe),ve);case"base64":return F.encode(Fe);default:return k.transformTo(Se,Fe)}}(ne,function(Se,Fe){var ve,He=0,yt=null,q=0;for(ve=0;ve<Fe.length;ve++)q+=Fe[ve].length;switch(Se){case"string":return Fe.join("");case"array":return Array.prototype.concat.apply([],Fe);case"uint8array":for(yt=new Uint8Array(q),ve=0;ve<Fe.length;ve++)yt.set(Fe[ve],He),He+=Fe[ve].length;return yt;case"nodebuffer":return Buffer.concat(Fe);default:throw new Error("concat : unsupported type '"+Se+"'")}}($,G),re);z(Ce)}catch(Se){I(Se)}G=[]}).resume()})}(this,H)},on:function(H,C){var z=this;return this._worker.on(H,"data"===H?function(I){C.call(z,I.data,I.meta)}:function(){k.delay(C,arguments,z)}),this},resume:function(){return k.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(H){if(k.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new W(this,{objectMode:"nodebuffer"!==this._outputType},H)}},ge.exports=E},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(Y,ge,j){"use strict";if(j.base64=!0,j.array=!0,j.string=!0,j.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",j.nodebuffer=typeof Buffer<"u",j.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")j.blob=!1;else{var k=new ArrayBuffer(0);try{j.blob=0===new Blob([k],{type:"application/zip"}).size}catch{try{var D=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);D.append(k),j.blob=0===D.getBlob("application/zip").size}catch{j.blob=!1}}}try{j.nodestream=!!Y("readable-stream").Readable}catch{j.nodestream=!1}},{"readable-stream":16}],31:[function(Y,ge,j){"use strict";for(var k=Y("./utils"),D=Y("./support"),T=Y("./nodejsUtils"),F=Y("./stream/GenericWorker"),X=new Array(256),Q=0;Q<256;Q++)X[Q]=252<=Q?6:248<=Q?5:240<=Q?4:224<=Q?3:192<=Q?2:1;function W(){F.call(this,"utf-8 decode"),this.leftOver=null}function Z(){F.call(this,"utf-8 encode")}X[254]=X[254]=1,j.utf8encode=function(E){return D.nodebuffer?T.newBufferFrom(E,"utf-8"):function(H){var C,z,I,G,$,ne=H.length,re=0;for(G=0;G<ne;G++)55296==(64512&(z=H.charCodeAt(G)))&&G+1<ne&&56320==(64512&(I=H.charCodeAt(G+1)))&&(z=65536+(z-55296<<10)+(I-56320),G++),re+=z<128?1:z<2048?2:z<65536?3:4;for(C=D.uint8array?new Uint8Array(re):new Array(re),G=$=0;$<re;G++)55296==(64512&(z=H.charCodeAt(G)))&&G+1<ne&&56320==(64512&(I=H.charCodeAt(G+1)))&&(z=65536+(z-55296<<10)+(I-56320),G++),z<128?C[$++]=z:(z<2048?C[$++]=192|z>>>6:(z<65536?C[$++]=224|z>>>12:(C[$++]=240|z>>>18,C[$++]=128|z>>>12&63),C[$++]=128|z>>>6&63),C[$++]=128|63&z);return C}(E)},j.utf8decode=function(E){return D.nodebuffer?k.transformTo("nodebuffer",E).toString("utf-8"):function(H){var C,z,I,G,$=H.length,ne=new Array(2*$);for(C=z=0;C<$;)if((I=H[C++])<128)ne[z++]=I;else if(4<(G=X[I]))ne[z++]=65533,C+=G-1;else{for(I&=2===G?31:3===G?15:7;1<G&&C<$;)I=I<<6|63&H[C++],G--;1<G?ne[z++]=65533:I<65536?ne[z++]=I:(ne[z++]=55296|(I-=65536)>>10&1023,ne[z++]=56320|1023&I)}return ne.length!==z&&(ne.subarray?ne=ne.subarray(0,z):ne.length=z),k.applyFromCharCode(ne)}(E=k.transformTo(D.uint8array?"uint8array":"array",E))},k.inherits(W,F),W.prototype.processChunk=function(E){var H=k.transformTo(D.uint8array?"uint8array":"array",E.data);if(this.leftOver&&this.leftOver.length){if(D.uint8array){var C=H;(H=new Uint8Array(C.length+this.leftOver.length)).set(this.leftOver,0),H.set(C,this.leftOver.length)}else H=this.leftOver.concat(H);this.leftOver=null}var z=function(G,$){var ne;for(($=$||G.length)>G.length&&($=G.length),ne=$-1;0<=ne&&128==(192&G[ne]);)ne--;return ne<0||0===ne?$:ne+X[G[ne]]>$?ne:$}(H),I=H;z!==H.length&&(D.uint8array?(I=H.subarray(0,z),this.leftOver=H.subarray(z,H.length)):(I=H.slice(0,z),this.leftOver=H.slice(z,H.length))),this.push({data:j.utf8decode(I),meta:E.meta})},W.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:j.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},j.Utf8DecodeWorker=W,k.inherits(Z,F),Z.prototype.processChunk=function(E){this.push({data:j.utf8encode(E.data),meta:E.meta})},j.Utf8EncodeWorker=Z},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(Y,ge,j){"use strict";var k=Y("./support"),D=Y("./base64"),T=Y("./nodejsUtils"),F=Y("./external");function X(C){return C}function Q(C,z){for(var I=0;I<C.length;++I)z[I]=255&C.charCodeAt(I);return z}Y("setimmediate"),j.newBlob=function(C,z){j.checkSupport("blob");try{return new Blob([C],{type:z})}catch{try{var I=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return I.append(C),I.getBlob(z)}catch{throw new Error("Bug : can't construct the Blob.")}}};var W={stringifyByChunk:function(C,z,I){var G=[],$=0,ne=C.length;if(ne<=I)return String.fromCharCode.apply(null,C);for(;$<ne;)G.push(String.fromCharCode.apply(null,"array"===z||"nodebuffer"===z?C.slice($,Math.min($+I,ne)):C.subarray($,Math.min($+I,ne)))),$+=I;return G.join("")},stringifyByChar:function(C){for(var z="",I=0;I<C.length;I++)z+=String.fromCharCode(C[I]);return z},applyCanBeUsed:{uint8array:function(){try{return k.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch{return!1}}(),nodebuffer:function(){try{return k.nodebuffer&&1===String.fromCharCode.apply(null,T.allocBuffer(1)).length}catch{return!1}}()}};function Z(C){var z=65536,I=j.getTypeOf(C),G=!0;if("uint8array"===I?G=W.applyCanBeUsed.uint8array:"nodebuffer"===I&&(G=W.applyCanBeUsed.nodebuffer),G)for(;1<z;)try{return W.stringifyByChunk(C,I,z)}catch{z=Math.floor(z/2)}return W.stringifyByChar(C)}function E(C,z){for(var I=0;I<C.length;I++)z[I]=C[I];return z}j.applyFromCharCode=Z;var H={};H.string={string:X,array:function(C){return Q(C,new Array(C.length))},arraybuffer:function(C){return H.string.uint8array(C).buffer},uint8array:function(C){return Q(C,new Uint8Array(C.length))},nodebuffer:function(C){return Q(C,T.allocBuffer(C.length))}},H.array={string:Z,array:X,arraybuffer:function(C){return new Uint8Array(C).buffer},uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return T.newBufferFrom(C)}},H.arraybuffer={string:function(C){return Z(new Uint8Array(C))},array:function(C){return E(new Uint8Array(C),new Array(C.byteLength))},arraybuffer:X,uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return T.newBufferFrom(new Uint8Array(C))}},H.uint8array={string:Z,array:function(C){return E(C,new Array(C.length))},arraybuffer:function(C){return C.buffer},uint8array:X,nodebuffer:function(C){return T.newBufferFrom(C)}},H.nodebuffer={string:Z,array:function(C){return E(C,new Array(C.length))},arraybuffer:function(C){return H.nodebuffer.uint8array(C).buffer},uint8array:function(C){return E(C,new Uint8Array(C.length))},nodebuffer:X},j.transformTo=function(C,z){if(z=z||"",!C)return z;j.checkSupport(C);var I=j.getTypeOf(z);return H[I][C](z)},j.resolve=function(C){for(var z=C.split("/"),I=[],G=0;G<z.length;G++){var $=z[G];"."===$||""===$&&0!==G&&G!==z.length-1||(".."===$?I.pop():I.push($))}return I.join("/")},j.getTypeOf=function(C){return"string"==typeof C?"string":"[object Array]"===Object.prototype.toString.call(C)?"array":k.nodebuffer&&T.isBuffer(C)?"nodebuffer":k.uint8array&&C instanceof Uint8Array?"uint8array":k.arraybuffer&&C instanceof ArrayBuffer?"arraybuffer":void 0},j.checkSupport=function(C){if(!k[C.toLowerCase()])throw new Error(C+" is not supported by this platform")},j.MAX_VALUE_16BITS=65535,j.MAX_VALUE_32BITS=-1,j.pretty=function(C){var z,I,G="";for(I=0;I<(C||"").length;I++)G+="\\x"+((z=C.charCodeAt(I))<16?"0":"")+z.toString(16).toUpperCase();return G},j.delay=function(C,z,I){setImmediate(function(){C.apply(I||null,z||[])})},j.inherits=function(C,z){function I(){}I.prototype=z.prototype,C.prototype=new I},j.extend=function(){var C,z,I={};for(C=0;C<arguments.length;C++)for(z in arguments[C])Object.prototype.hasOwnProperty.call(arguments[C],z)&&void 0===I[z]&&(I[z]=arguments[C][z]);return I},j.prepareContent=function(C,z,I,G,$){return F.Promise.resolve(z).then(function(ne){return k.blob&&(ne instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ne)))&&typeof FileReader<"u"?new F.Promise(function(re,Ce){var Se=new FileReader;Se.onload=function(Fe){re(Fe.target.result)},Se.onerror=function(Fe){Ce(Fe.target.error)},Se.readAsArrayBuffer(ne)}):ne}).then(function(ne){var Ce,re=j.getTypeOf(ne);return re?("arraybuffer"===re?ne=j.transformTo("uint8array",ne):"string"===re&&($?ne=D.decode(ne):I&&!0!==G&&(ne=Q(Ce=ne,k.uint8array?new Uint8Array(Ce.length):new Array(Ce.length)))),ne):F.Promise.reject(new Error("Can't read the data of '"+C+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(Y,ge,j){"use strict";var k=Y("./reader/readerFor"),D=Y("./utils"),T=Y("./signature"),F=Y("./zipEntry"),X=Y("./support");function Q(W){this.files=[],this.loadOptions=W}Q.prototype={checkSignature:function(W){if(!this.reader.readAndCheckSignature(W)){this.reader.index-=4;var Z=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+D.pretty(Z)+", expected "+D.pretty(W)+")")}},isSignature:function(W,Z){var E=this.reader.index;this.reader.setIndex(W);var H=this.reader.readString(4)===Z;return this.reader.setIndex(E),H},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var W=this.reader.readData(this.zipCommentLength),E=D.transformTo(X.uint8array?"uint8array":"array",W);this.zipComment=this.loadOptions.decodeFileName(E)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var W,Z,E,H=this.zip64EndOfCentralSize-44;0<H;)W=this.reader.readInt(2),Z=this.reader.readInt(4),E=this.reader.readData(Z),this.zip64ExtensibleData[W]={id:W,length:Z,value:E}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var W,Z;for(W=0;W<this.files.length;W++)this.reader.setIndex((Z=this.files[W]).localHeaderOffset),this.checkSignature(T.LOCAL_FILE_HEADER),Z.readLocalPart(this.reader),Z.handleUTF8(),Z.processAttributes()},readCentralDir:function(){var W;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(T.CENTRAL_FILE_HEADER);)(W=new F({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(W);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var W=this.reader.lastIndexOfSignature(T.CENTRAL_DIRECTORY_END);if(W<0)throw this.isSignature(0,T.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(W);var Z=W;if(this.checkSignature(T.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===D.MAX_VALUE_16BITS||this.diskWithCentralDirStart===D.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===D.MAX_VALUE_16BITS||this.centralDirRecords===D.MAX_VALUE_16BITS||this.centralDirSize===D.MAX_VALUE_32BITS||this.centralDirOffset===D.MAX_VALUE_32BITS){if(this.zip64=!0,(W=this.reader.lastIndexOfSignature(T.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(W),this.checkSignature(T.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,T.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(T.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(T.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var E=this.centralDirOffset+this.centralDirSize;this.zip64&&(E+=20,E+=12+this.zip64EndOfCentralSize);var H=Z-E;if(0<H)this.isSignature(Z,T.CENTRAL_FILE_HEADER)||(this.reader.zero=H);else if(H<0)throw new Error("Corrupted zip: missing "+Math.abs(H)+" bytes.")},prepareReader:function(W){this.reader=k(W)},load:function(W){this.prepareReader(W),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},ge.exports=Q},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(Y,ge,j){"use strict";var k=Y("./reader/readerFor"),D=Y("./utils"),T=Y("./compressedObject"),F=Y("./crc32"),X=Y("./utf8"),Q=Y("./compressions"),W=Y("./support");function Z(E,H){this.options=E,this.loadOptions=H}Z.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(E){var H,C;if(E.skip(22),this.fileNameLength=E.readInt(2),C=E.readInt(2),this.fileName=E.readData(this.fileNameLength),E.skip(C),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(H=function(z){for(var I in Q)if(Object.prototype.hasOwnProperty.call(Q,I)&&Q[I].magic===z)return Q[I];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+D.pretty(this.compressionMethod)+" unknown (inner file : "+D.transformTo("string",this.fileName)+")");this.decompressed=new T(this.compressedSize,this.uncompressedSize,this.crc32,H,E.readData(this.compressedSize))},readCentralPart:function(E){this.versionMadeBy=E.readInt(2),E.skip(2),this.bitFlag=E.readInt(2),this.compressionMethod=E.readString(2),this.date=E.readDate(),this.crc32=E.readInt(4),this.compressedSize=E.readInt(4),this.uncompressedSize=E.readInt(4);var H=E.readInt(2);if(this.extraFieldsLength=E.readInt(2),this.fileCommentLength=E.readInt(2),this.diskNumberStart=E.readInt(2),this.internalFileAttributes=E.readInt(2),this.externalFileAttributes=E.readInt(4),this.localHeaderOffset=E.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");E.skip(H),this.readExtraFields(E),this.parseZIP64ExtraField(E),this.fileComment=E.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var E=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==E&&(this.dosPermissions=63&this.externalFileAttributes),3==E&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var E=k(this.extraFields[1].value);this.uncompressedSize===D.MAX_VALUE_32BITS&&(this.uncompressedSize=E.readInt(8)),this.compressedSize===D.MAX_VALUE_32BITS&&(this.compressedSize=E.readInt(8)),this.localHeaderOffset===D.MAX_VALUE_32BITS&&(this.localHeaderOffset=E.readInt(8)),this.diskNumberStart===D.MAX_VALUE_32BITS&&(this.diskNumberStart=E.readInt(4))}},readExtraFields:function(E){var H,C,z,I=E.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});E.index+4<I;)H=E.readInt(2),C=E.readInt(2),z=E.readData(C),this.extraFields[H]={id:H,length:C,value:z};E.setIndex(I)},handleUTF8:function(){var E=W.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=X.utf8decode(this.fileName),this.fileCommentStr=X.utf8decode(this.fileComment);else{var H=this.findExtraFieldUnicodePath();if(null!==H)this.fileNameStr=H;else{var C=D.transformTo(E,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(C)}var z=this.findExtraFieldUnicodeComment();if(null!==z)this.fileCommentStr=z;else{var I=D.transformTo(E,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(I)}}},findExtraFieldUnicodePath:function(){var E=this.extraFields[28789];if(E){var H=k(E.value);return 1!==H.readInt(1)||F(this.fileName)!==H.readInt(4)?null:X.utf8decode(H.readData(E.length-5))}return null},findExtraFieldUnicodeComment:function(){var E=this.extraFields[25461];if(E){var H=k(E.value);return 1!==H.readInt(1)||F(this.fileComment)!==H.readInt(4)?null:X.utf8decode(H.readData(E.length-5))}return null}},ge.exports=Z},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(Y,ge,j){"use strict";function k(H,C,z){this.name=H,this.dir=z.dir,this.date=z.date,this.comment=z.comment,this.unixPermissions=z.unixPermissions,this.dosPermissions=z.dosPermissions,this._data=C,this._dataBinary=z.binary,this.options={compression:z.compression,compressionOptions:z.compressionOptions}}var D=Y("./stream/StreamHelper"),T=Y("./stream/DataWorker"),F=Y("./utf8"),X=Y("./compressedObject"),Q=Y("./stream/GenericWorker");k.prototype={internalStream:function(H){var C=null,z="string";try{if(!H)throw new Error("No output type specified.");var I="string"===(z=H.toLowerCase())||"text"===z;"binarystring"!==z&&"text"!==z||(z="string"),C=this._decompressWorker();var G=!this._dataBinary;G&&!I&&(C=C.pipe(new F.Utf8EncodeWorker)),!G&&I&&(C=C.pipe(new F.Utf8DecodeWorker))}catch($){(C=new Q("error")).error($)}return new D(C,z,"")},async:function(H,C){return this.internalStream(H).accumulate(C)},nodeStream:function(H,C){return this.internalStream(H||"nodebuffer").toNodejsStream(C)},_compressWorker:function(H,C){if(this._data instanceof X&&this._data.compression.magic===H.magic)return this._data.getCompressedWorker();var z=this._decompressWorker();return this._dataBinary||(z=z.pipe(new F.Utf8EncodeWorker)),X.createWorkerFrom(z,H,C)},_decompressWorker:function(){return this._data instanceof X?this._data.getContentWorker():this._data instanceof Q?this._data:new T(this._data)}};for(var W=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Z=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},E=0;E<W.length;E++)k.prototype[W[E]]=Z;ge.exports=k},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(Y,ge,j){(function(k){"use strict";var D,T,F=k.MutationObserver||k.WebKitMutationObserver;if(F){var X=0,Q=new F(H),W=k.document.createTextNode("");Q.observe(W,{characterData:!0}),D=function(){W.data=X=++X%2}}else if(k.setImmediate||void 0===k.MessageChannel)D="document"in k&&"onreadystatechange"in k.document.createElement("script")?function(){var C=k.document.createElement("script");C.onreadystatechange=function(){H(),C.onreadystatechange=null,C.parentNode.removeChild(C),C=null},k.document.documentElement.appendChild(C)}:function(){setTimeout(H,0)};else{var Z=new k.MessageChannel;Z.port1.onmessage=H,D=function(){Z.port2.postMessage(0)}}var E=[];function H(){var C,z;T=!0;for(var I=E.length;I;){for(z=E,E=[],C=-1;++C<I;)z[C]();I=E.length}T=!1}ge.exports=function(C){1!==E.push(C)||T||D()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(Y,ge,j){"use strict";var k=Y("immediate");function D(){}var T={},F=["REJECTED"],X=["FULFILLED"],Q=["PENDING"];function W(I){if("function"!=typeof I)throw new TypeError("resolver must be a function");this.state=Q,this.queue=[],this.outcome=void 0,I!==D&&C(this,I)}function Z(I,G,$){this.promise=I,"function"==typeof G&&(this.onFulfilled=G,this.callFulfilled=this.otherCallFulfilled),"function"==typeof $&&(this.onRejected=$,this.callRejected=this.otherCallRejected)}function E(I,G,$){k(function(){var ne;try{ne=G($)}catch(re){return T.reject(I,re)}ne===I?T.reject(I,new TypeError("Cannot resolve promise with itself")):T.resolve(I,ne)})}function H(I){var G=I&&I.then;if(I&&("object"==typeof I||"function"==typeof I)&&"function"==typeof G)return function(){G.apply(I,arguments)}}function C(I,G){var $=!1;function ne(Se){$||($=!0,T.reject(I,Se))}function re(Se){$||($=!0,T.resolve(I,Se))}var Ce=z(function(){G(re,ne)});"error"===Ce.status&&ne(Ce.value)}function z(I,G){var $={};try{$.value=I(G),$.status="success"}catch(ne){$.status="error",$.value=ne}return $}(ge.exports=W).prototype.finally=function(I){if("function"!=typeof I)return this;var G=this.constructor;return this.then(function($){return G.resolve(I()).then(function(){return $})},function($){return G.resolve(I()).then(function(){throw $})})},W.prototype.catch=function(I){return this.then(null,I)},W.prototype.then=function(I,G){if("function"!=typeof I&&this.state===X||"function"!=typeof G&&this.state===F)return this;var $=new this.constructor(D);return this.state!==Q?E($,this.state===X?I:G,this.outcome):this.queue.push(new Z($,I,G)),$},Z.prototype.callFulfilled=function(I){T.resolve(this.promise,I)},Z.prototype.otherCallFulfilled=function(I){E(this.promise,this.onFulfilled,I)},Z.prototype.callRejected=function(I){T.reject(this.promise,I)},Z.prototype.otherCallRejected=function(I){E(this.promise,this.onRejected,I)},T.resolve=function(I,G){var $=z(H,G);if("error"===$.status)return T.reject(I,$.value);var ne=$.value;if(ne)C(I,ne);else{I.state=X,I.outcome=G;for(var re=-1,Ce=I.queue.length;++re<Ce;)I.queue[re].callFulfilled(G)}return I},T.reject=function(I,G){I.state=F,I.outcome=G;for(var $=-1,ne=I.queue.length;++$<ne;)I.queue[$].callRejected(G);return I},W.resolve=function(I){return I instanceof this?I:T.resolve(new this(D),I)},W.reject=function(I){var G=new this(D);return T.reject(G,I)},W.all=function(I){var G=this;if("[object Array]"!==Object.prototype.toString.call(I))return this.reject(new TypeError("must be an array"));var $=I.length,ne=!1;if(!$)return this.resolve([]);for(var re=new Array($),Ce=0,Se=-1,Fe=new this(D);++Se<$;)ve(I[Se],Se);return Fe;function ve(He,yt){G.resolve(He).then(function(q){re[yt]=q,++Ce!==$||ne||(ne=!0,T.resolve(Fe,re))},function(q){ne||(ne=!0,T.reject(Fe,q))})}},W.race=function(I){if("[object Array]"!==Object.prototype.toString.call(I))return this.reject(new TypeError("must be an array"));var $=I.length,ne=!1;if(!$)return this.resolve([]);for(var re=-1,Ce=new this(D);++re<$;)this.resolve(I[re]).then(function(Fe){ne||(ne=!0,T.resolve(Ce,Fe))},function(Fe){ne||(ne=!0,T.reject(Ce,Fe))});return Ce}},{immediate:36}],38:[function(Y,ge,j){"use strict";var k={};(0,Y("./lib/utils/common").assign)(k,Y("./lib/deflate"),Y("./lib/inflate"),Y("./lib/zlib/constants")),ge.exports=k},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(Y,ge,j){"use strict";var k=Y("./zlib/deflate"),D=Y("./utils/common"),T=Y("./utils/strings"),F=Y("./zlib/messages"),X=Y("./zlib/zstream"),Q=Object.prototype.toString;function C(I){if(!(this instanceof C))return new C(I);this.options=D.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},I||{});var G=this.options;G.raw&&0<G.windowBits?G.windowBits=-G.windowBits:G.gzip&&0<G.windowBits&&G.windowBits<16&&(G.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;var $=k.deflateInit2(this.strm,G.level,G.method,G.windowBits,G.memLevel,G.strategy);if(0!==$)throw new Error(F[$]);if(G.header&&k.deflateSetHeader(this.strm,G.header),G.dictionary){var ne;if(ne="string"==typeof G.dictionary?T.string2buf(G.dictionary):"[object ArrayBuffer]"===Q.call(G.dictionary)?new Uint8Array(G.dictionary):G.dictionary,0!==($=k.deflateSetDictionary(this.strm,ne)))throw new Error(F[$]);this._dict_set=!0}}function z(I,G){var $=new C(G);if($.push(I,!0),$.err)throw $.msg||F[$.err];return $.result}C.prototype.push=function(I,G){var $,ne,re=this.strm,Ce=this.options.chunkSize;if(this.ended)return!1;ne=G===~~G?G:!0===G?4:0,re.input="string"==typeof I?T.string2buf(I):"[object ArrayBuffer]"===Q.call(I)?new Uint8Array(I):I,re.next_in=0,re.avail_in=re.input.length;do{if(0===re.avail_out&&(re.output=new D.Buf8(Ce),re.next_out=0,re.avail_out=Ce),1!==($=k.deflate(re,ne))&&0!==$)return this.onEnd($),!(this.ended=!0);0!==re.avail_out&&(0!==re.avail_in||4!==ne&&2!==ne)||this.onData("string"===this.options.to?T.buf2binstring(D.shrinkBuf(re.output,re.next_out)):D.shrinkBuf(re.output,re.next_out))}while((0<re.avail_in||0===re.avail_out)&&1!==$);return 4===ne?($=k.deflateEnd(this.strm),this.onEnd($),this.ended=!0,0===$):2!==ne||(this.onEnd(0),!(re.avail_out=0))},C.prototype.onData=function(I){this.chunks.push(I)},C.prototype.onEnd=function(I){0===I&&(this.result="string"===this.options.to?this.chunks.join(""):D.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.msg=this.strm.msg},j.Deflate=C,j.deflate=z,j.deflateRaw=function(I,G){return(G=G||{}).raw=!0,z(I,G)},j.gzip=function(I,G){return(G=G||{}).gzip=!0,z(I,G)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(Y,ge,j){"use strict";var k=Y("./zlib/inflate"),D=Y("./utils/common"),T=Y("./utils/strings"),F=Y("./zlib/constants"),X=Y("./zlib/messages"),Q=Y("./zlib/zstream"),W=Y("./zlib/gzheader"),Z=Object.prototype.toString;function E(C){if(!(this instanceof E))return new E(C);this.options=D.assign({chunkSize:16384,windowBits:0,to:""},C||{});var z=this.options;z.raw&&0<=z.windowBits&&z.windowBits<16&&(z.windowBits=-z.windowBits,0===z.windowBits&&(z.windowBits=-15)),!(0<=z.windowBits&&z.windowBits<16)||C&&C.windowBits||(z.windowBits+=32),15<z.windowBits&&z.windowBits<48&&0==(15&z.windowBits)&&(z.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var I=k.inflateInit2(this.strm,z.windowBits);if(I!==F.Z_OK)throw new Error(X[I]);this.header=new W,k.inflateGetHeader(this.strm,this.header)}function H(C,z){var I=new E(z);if(I.push(C,!0),I.err)throw I.msg||X[I.err];return I.result}E.prototype.push=function(C,z){var I,G,$,ne,re,Ce,Se=this.strm,Fe=this.options.chunkSize,ve=this.options.dictionary,He=!1;if(this.ended)return!1;G=z===~~z?z:!0===z?F.Z_FINISH:F.Z_NO_FLUSH,Se.input="string"==typeof C?T.binstring2buf(C):"[object ArrayBuffer]"===Z.call(C)?new Uint8Array(C):C,Se.next_in=0,Se.avail_in=Se.input.length;do{if(0===Se.avail_out&&(Se.output=new D.Buf8(Fe),Se.next_out=0,Se.avail_out=Fe),(I=k.inflate(Se,F.Z_NO_FLUSH))===F.Z_NEED_DICT&&ve&&(Ce="string"==typeof ve?T.string2buf(ve):"[object ArrayBuffer]"===Z.call(ve)?new Uint8Array(ve):ve,I=k.inflateSetDictionary(this.strm,Ce)),I===F.Z_BUF_ERROR&&!0===He&&(I=F.Z_OK,He=!1),I!==F.Z_STREAM_END&&I!==F.Z_OK)return this.onEnd(I),!(this.ended=!0);Se.next_out&&(0!==Se.avail_out&&I!==F.Z_STREAM_END&&(0!==Se.avail_in||G!==F.Z_FINISH&&G!==F.Z_SYNC_FLUSH)||("string"===this.options.to?($=T.utf8border(Se.output,Se.next_out),ne=Se.next_out-$,re=T.buf2string(Se.output,$),Se.next_out=ne,Se.avail_out=Fe-ne,ne&&D.arraySet(Se.output,Se.output,$,ne,0),this.onData(re)):this.onData(D.shrinkBuf(Se.output,Se.next_out)))),0===Se.avail_in&&0===Se.avail_out&&(He=!0)}while((0<Se.avail_in||0===Se.avail_out)&&I!==F.Z_STREAM_END);return I===F.Z_STREAM_END&&(G=F.Z_FINISH),G===F.Z_FINISH?(I=k.inflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===F.Z_OK):G!==F.Z_SYNC_FLUSH||(this.onEnd(F.Z_OK),!(Se.avail_out=0))},E.prototype.onData=function(C){this.chunks.push(C)},E.prototype.onEnd=function(C){C===F.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):D.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},j.Inflate=E,j.inflate=H,j.inflateRaw=function(C,z){return(z=z||{}).raw=!0,H(C,z)},j.ungzip=H},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(Y,ge,j){"use strict";var k=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";j.assign=function(F){for(var X=Array.prototype.slice.call(arguments,1);X.length;){var Q=X.shift();if(Q){if("object"!=typeof Q)throw new TypeError(Q+"must be non-object");for(var W in Q)Q.hasOwnProperty(W)&&(F[W]=Q[W])}}return F},j.shrinkBuf=function(F,X){return F.length===X?F:F.subarray?F.subarray(0,X):(F.length=X,F)};var D={arraySet:function(F,X,Q,W,Z){if(X.subarray&&F.subarray)F.set(X.subarray(Q,Q+W),Z);else for(var E=0;E<W;E++)F[Z+E]=X[Q+E]},flattenChunks:function(F){var X,Q,W,Z,E,H;for(X=W=0,Q=F.length;X<Q;X++)W+=F[X].length;for(H=new Uint8Array(W),X=Z=0,Q=F.length;X<Q;X++)H.set(E=F[X],Z),Z+=E.length;return H}},T={arraySet:function(F,X,Q,W,Z){for(var E=0;E<W;E++)F[Z+E]=X[Q+E]},flattenChunks:function(F){return[].concat.apply([],F)}};j.setTyped=function(F){F?(j.Buf8=Uint8Array,j.Buf16=Uint16Array,j.Buf32=Int32Array,j.assign(j,D)):(j.Buf8=Array,j.Buf16=Array,j.Buf32=Array,j.assign(j,T))},j.setTyped(k)},{}],42:[function(Y,ge,j){"use strict";var k=Y("./common"),D=!0,T=!0;try{String.fromCharCode.apply(null,[0])}catch{D=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{T=!1}for(var F=new k.Buf8(256),X=0;X<256;X++)F[X]=252<=X?6:248<=X?5:240<=X?4:224<=X?3:192<=X?2:1;function Q(W,Z){if(Z<65537&&(W.subarray&&T||!W.subarray&&D))return String.fromCharCode.apply(null,k.shrinkBuf(W,Z));for(var E="",H=0;H<Z;H++)E+=String.fromCharCode(W[H]);return E}F[254]=F[254]=1,j.string2buf=function(W){var Z,E,H,C,z,I=W.length,G=0;for(C=0;C<I;C++)55296==(64512&(E=W.charCodeAt(C)))&&C+1<I&&56320==(64512&(H=W.charCodeAt(C+1)))&&(E=65536+(E-55296<<10)+(H-56320),C++),G+=E<128?1:E<2048?2:E<65536?3:4;for(Z=new k.Buf8(G),C=z=0;z<G;C++)55296==(64512&(E=W.charCodeAt(C)))&&C+1<I&&56320==(64512&(H=W.charCodeAt(C+1)))&&(E=65536+(E-55296<<10)+(H-56320),C++),E<128?Z[z++]=E:(E<2048?Z[z++]=192|E>>>6:(E<65536?Z[z++]=224|E>>>12:(Z[z++]=240|E>>>18,Z[z++]=128|E>>>12&63),Z[z++]=128|E>>>6&63),Z[z++]=128|63&E);return Z},j.buf2binstring=function(W){return Q(W,W.length)},j.binstring2buf=function(W){for(var Z=new k.Buf8(W.length),E=0,H=Z.length;E<H;E++)Z[E]=W.charCodeAt(E);return Z},j.buf2string=function(W,Z){var E,H,C,z,I=Z||W.length,G=new Array(2*I);for(E=H=0;E<I;)if((C=W[E++])<128)G[H++]=C;else if(4<(z=F[C]))G[H++]=65533,E+=z-1;else{for(C&=2===z?31:3===z?15:7;1<z&&E<I;)C=C<<6|63&W[E++],z--;1<z?G[H++]=65533:C<65536?G[H++]=C:(G[H++]=55296|(C-=65536)>>10&1023,G[H++]=56320|1023&C)}return Q(G,H)},j.utf8border=function(W,Z){var E;for((Z=Z||W.length)>W.length&&(Z=W.length),E=Z-1;0<=E&&128==(192&W[E]);)E--;return E<0||0===E?Z:E+F[W[E]]>Z?E:Z}},{"./common":41}],43:[function(Y,ge,j){"use strict";ge.exports=function(k,D,T,F){for(var X=65535&k|0,Q=k>>>16&65535|0,W=0;0!==T;){for(T-=W=2e3<T?2e3:T;Q=Q+(X=X+D[F++]|0)|0,--W;);X%=65521,Q%=65521}return X|Q<<16|0}},{}],44:[function(Y,ge,j){"use strict";ge.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(Y,ge,j){"use strict";var k=function(){for(var D,T=[],F=0;F<256;F++){D=F;for(var X=0;X<8;X++)D=1&D?3988292384^D>>>1:D>>>1;T[F]=D}return T}();ge.exports=function(D,T,F,X){var Q=k,W=X+F;D^=-1;for(var Z=X;Z<W;Z++)D=D>>>8^Q[255&(D^T[Z])];return-1^D}},{}],46:[function(Y,ge,j){"use strict";var k,D=Y("../utils/common"),T=Y("./trees"),F=Y("./adler32"),X=Y("./crc32"),Q=Y("./messages"),H=-2,He=258,yt=262;function Lt(x,Te){return x.msg=Q[Te],Te}function Ne(x){return(x<<1)-(4<x?9:0)}function Tt(x){for(var Te=x.length;0<=--Te;)x[Te]=0}function pe(x){var Te=x.state,me=Te.pending;me>x.avail_out&&(me=x.avail_out),0!==me&&(D.arraySet(x.output,Te.pending_buf,Te.pending_out,me,x.next_out),x.next_out+=me,Te.pending_out+=me,x.total_out+=me,x.avail_out-=me,Te.pending-=me,0===Te.pending&&(Te.pending_out=0))}function he(x,Te){T._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,Te),x.block_start=x.strstart,pe(x.strm)}function vt(x,Te){x.pending_buf[x.pending++]=Te}function et(x,Te){x.pending_buf[x.pending++]=Te>>>8&255,x.pending_buf[x.pending++]=255&Te}function Ze(x,Te){var me,U,O=x.max_chain_length,ee=x.strstart,Le=x.prev_length,Pe=x.nice_match,oe=x.strstart>x.w_size-yt?x.strstart-(x.w_size-yt):0,Ue=x.window,tt=x.w_mask,Ge=x.prev,_t=x.strstart+He,Gt=Ue[ee+Le-1],Rt=Ue[ee+Le];x.prev_length>=x.good_match&&(O>>=2),Pe>x.lookahead&&(Pe=x.lookahead);do{if(Ue[(me=Te)+Le]===Rt&&Ue[me+Le-1]===Gt&&Ue[me]===Ue[ee]&&Ue[++me]===Ue[ee+1]){ee+=2,me++;do{}while(Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&Ue[++ee]===Ue[++me]&&ee<_t);if(U=He-(_t-ee),ee=_t-He,Le<U){if(x.match_start=Te,Pe<=(Le=U))break;Gt=Ue[ee+Le-1],Rt=Ue[ee+Le]}}}while((Te=Ge[Te&tt])>oe&&0!=--O);return Le<=x.lookahead?Le:x.lookahead}function en(x){var Te,me,U,O,ee,Le,Pe,oe,Ue,tt,Ge=x.w_size;do{if(O=x.window_size-x.lookahead-x.strstart,x.strstart>=Ge+(Ge-yt)){for(D.arraySet(x.window,x.window,Ge,Ge,0),x.match_start-=Ge,x.strstart-=Ge,x.block_start-=Ge,Te=me=x.hash_size;U=x.head[--Te],x.head[Te]=Ge<=U?U-Ge:0,--me;);for(Te=me=Ge;U=x.prev[--Te],x.prev[Te]=Ge<=U?U-Ge:0,--me;);O+=Ge}if(0===x.strm.avail_in)break;if(Pe=x.window,oe=x.strstart+x.lookahead,tt=void 0,(Ue=O)<(tt=(Le=x.strm).avail_in)&&(tt=Ue),me=0===tt?0:(Le.avail_in-=tt,D.arraySet(Pe,Le.input,Le.next_in,tt,oe),1===Le.state.wrap?Le.adler=F(Le.adler,Pe,tt,oe):2===Le.state.wrap&&(Le.adler=X(Le.adler,Pe,tt,oe)),Le.next_in+=tt,Le.total_in+=tt,tt),x.lookahead+=me,x.lookahead+x.insert>=3)for(x.ins_h=x.window[ee=x.strstart-x.insert],x.ins_h=(x.ins_h<<x.hash_shift^x.window[ee+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[ee+3-1])&x.hash_mask,x.prev[ee&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=ee,ee++,x.insert--,!(x.lookahead+x.insert<3)););}while(x.lookahead<yt&&0!==x.strm.avail_in)}function pn(x,Te){for(var me,U;;){if(x.lookahead<yt){if(en(x),x.lookahead<yt&&0===Te)return 1;if(0===x.lookahead)break}if(me=0,x.lookahead>=3&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+3-1])&x.hash_mask,me=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),0!==me&&x.strstart-me<=x.w_size-yt&&(x.match_length=Ze(x,me)),x.match_length>=3)if(U=T._tr_tally(x,x.strstart-x.match_start,x.match_length-3),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=3){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+3-1])&x.hash_mask,me=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,0!=--x.match_length;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else U=T._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(U&&(he(x,!1),0===x.strm.avail_out))return 1}return x.insert=x.strstart<2?x.strstart:2,4===Te?(he(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(he(x,!1),0===x.strm.avail_out)?1:2}function zt(x,Te){for(var me,U,O;;){if(x.lookahead<yt){if(en(x),x.lookahead<yt&&0===Te)return 1;if(0===x.lookahead)break}if(me=0,x.lookahead>=3&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+3-1])&x.hash_mask,me=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=2,0!==me&&x.prev_length<x.max_lazy_match&&x.strstart-me<=x.w_size-yt&&(x.match_length=Ze(x,me),x.match_length<=5&&(1===x.strategy||3===x.match_length&&4096<x.strstart-x.match_start)&&(x.match_length=2)),x.prev_length>=3&&x.match_length<=x.prev_length){for(O=x.strstart+x.lookahead-3,U=T._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-3),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=O&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+3-1])&x.hash_mask,me=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),0!=--x.prev_length;);if(x.match_available=0,x.match_length=2,x.strstart++,U&&(he(x,!1),0===x.strm.avail_out))return 1}else if(x.match_available){if((U=T._tr_tally(x,0,x.window[x.strstart-1]))&&he(x,!1),x.strstart++,x.lookahead--,0===x.strm.avail_out)return 1}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(U=T._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<2?x.strstart:2,4===Te?(he(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(he(x,!1),0===x.strm.avail_out)?1:2}function Nt(x,Te,me,U,O){this.good_length=x,this.max_lazy=Te,this.nice_length=me,this.max_chain=U,this.func=O}function cn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new D.Buf16(1146),this.dyn_dtree=new D.Buf16(122),this.bl_tree=new D.Buf16(78),Tt(this.dyn_ltree),Tt(this.dyn_dtree),Tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new D.Buf16(16),this.heap=new D.Buf16(573),Tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new D.Buf16(573),Tt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function tn(x){var Te;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=2,(Te=x.state).pending=0,Te.pending_out=0,Te.wrap<0&&(Te.wrap=-Te.wrap),Te.status=Te.wrap?42:113,x.adler=2===Te.wrap?0:1,Te.last_flush=0,T._tr_init(Te),0):Lt(x,H)}function Wn(x){var me,Te=tn(x);return 0===Te&&((me=x.state).window_size=2*me.w_size,Tt(me.head),me.max_lazy_match=k[me.level].max_lazy,me.good_match=k[me.level].good_length,me.nice_match=k[me.level].nice_length,me.max_chain_length=k[me.level].max_chain,me.strstart=0,me.block_start=0,me.lookahead=0,me.insert=0,me.match_length=me.prev_length=2,me.match_available=0,me.ins_h=0),Te}function On(x,Te,me,U,O,ee){if(!x)return H;var Le=1;if(-1===Te&&(Te=6),U<0?(Le=0,U=-U):15<U&&(Le=2,U-=16),O<1||9<O||8!==me||U<8||15<U||Te<0||9<Te||ee<0||4<ee)return Lt(x,H);8===U&&(U=9);var Pe=new cn;return(x.state=Pe).strm=x,Pe.wrap=Le,Pe.gzhead=null,Pe.w_bits=U,Pe.w_size=1<<Pe.w_bits,Pe.w_mask=Pe.w_size-1,Pe.hash_bits=O+7,Pe.hash_size=1<<Pe.hash_bits,Pe.hash_mask=Pe.hash_size-1,Pe.hash_shift=~~((Pe.hash_bits+3-1)/3),Pe.window=new D.Buf8(2*Pe.w_size),Pe.head=new D.Buf16(Pe.hash_size),Pe.prev=new D.Buf16(Pe.w_size),Pe.lit_bufsize=1<<O+6,Pe.pending_buf_size=4*Pe.lit_bufsize,Pe.pending_buf=new D.Buf8(Pe.pending_buf_size),Pe.d_buf=1*Pe.lit_bufsize,Pe.l_buf=3*Pe.lit_bufsize,Pe.level=Te,Pe.strategy=ee,Pe.method=me,Wn(x)}k=[new Nt(0,0,0,0,function(x,Te){var me=65535;for(me>x.pending_buf_size-5&&(me=x.pending_buf_size-5);;){if(x.lookahead<=1){if(en(x),0===x.lookahead&&0===Te)return 1;if(0===x.lookahead)break}x.strstart+=x.lookahead,x.lookahead=0;var U=x.block_start+me;if((0===x.strstart||x.strstart>=U)&&(x.lookahead=x.strstart-U,x.strstart=U,he(x,!1),0===x.strm.avail_out)||x.strstart-x.block_start>=x.w_size-yt&&(he(x,!1),0===x.strm.avail_out))return 1}return x.insert=0,4===Te?(he(x,!0),0===x.strm.avail_out?3:4):(x.strstart>x.block_start&&he(x,!1),1)}),new Nt(4,4,8,4,pn),new Nt(4,5,16,8,pn),new Nt(4,6,32,32,pn),new Nt(4,4,16,16,zt),new Nt(8,16,32,32,zt),new Nt(8,16,128,128,zt),new Nt(8,32,128,256,zt),new Nt(32,128,258,1024,zt),new Nt(32,258,258,4096,zt)],j.deflateInit=function(x,Te){return On(x,Te,8,15,8,0)},j.deflateInit2=On,j.deflateReset=Wn,j.deflateResetKeep=tn,j.deflateSetHeader=function(x,Te){return x&&x.state?2!==x.state.wrap?H:(x.state.gzhead=Te,0):H},j.deflate=function(x,Te){var me,U,O,ee;if(!x||!x.state||5<Te||Te<0)return x?Lt(x,H):H;if(U=x.state,!x.output||!x.input&&0!==x.avail_in||666===U.status&&4!==Te)return Lt(x,0===x.avail_out?-5:H);if(U.strm=x,me=U.last_flush,U.last_flush=Te,42===U.status)if(2===U.wrap)x.adler=0,vt(U,31),vt(U,139),vt(U,8),U.gzhead?(vt(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),vt(U,255&U.gzhead.time),vt(U,U.gzhead.time>>8&255),vt(U,U.gzhead.time>>16&255),vt(U,U.gzhead.time>>24&255),vt(U,9===U.level?2:2<=U.strategy||U.level<2?4:0),vt(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(vt(U,255&U.gzhead.extra.length),vt(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(x.adler=X(x.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(vt(U,0),vt(U,0),vt(U,0),vt(U,0),vt(U,0),vt(U,9===U.level?2:2<=U.strategy||U.level<2?4:0),vt(U,3),U.status=113);else{var Le=8+(U.w_bits-8<<4)<<8;Le|=(2<=U.strategy||U.level<2?0:U.level<6?1:6===U.level?2:3)<<6,0!==U.strstart&&(Le|=32),Le+=31-Le%31,U.status=113,et(U,Le),0!==U.strstart&&(et(U,x.adler>>>16),et(U,65535&x.adler)),x.adler=1}if(69===U.status)if(U.gzhead.extra){for(O=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),pe(x),O=U.pending,U.pending!==U.pending_buf_size));)vt(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(73===U.status)if(U.gzhead.name){O=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),pe(x),O=U.pending,U.pending===U.pending_buf_size)){ee=1;break}ee=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,vt(U,ee)}while(0!==ee);U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),0===ee&&(U.gzindex=0,U.status=91)}else U.status=91;if(91===U.status)if(U.gzhead.comment){O=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),pe(x),O=U.pending,U.pending===U.pending_buf_size)){ee=1;break}ee=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,vt(U,ee)}while(0!==ee);U.gzhead.hcrc&&U.pending>O&&(x.adler=X(x.adler,U.pending_buf,U.pending-O,O)),0===ee&&(U.status=103)}else U.status=103;if(103===U.status&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&pe(x),U.pending+2<=U.pending_buf_size&&(vt(U,255&x.adler),vt(U,x.adler>>8&255),x.adler=0,U.status=113)):U.status=113),0!==U.pending){if(pe(x),0===x.avail_out)return U.last_flush=-1,0}else if(0===x.avail_in&&Ne(Te)<=Ne(me)&&4!==Te)return Lt(x,-5);if(666===U.status&&0!==x.avail_in)return Lt(x,-5);if(0!==x.avail_in||0!==U.lookahead||0!==Te&&666!==U.status){var Pe=2===U.strategy?function(oe,Ue){for(var tt;;){if(0===oe.lookahead&&(en(oe),0===oe.lookahead)){if(0===Ue)return 1;break}if(oe.match_length=0,tt=T._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++,tt&&(he(oe,!1),0===oe.strm.avail_out))return 1}return oe.insert=0,4===Ue?(he(oe,!0),0===oe.strm.avail_out?3:4):oe.last_lit&&(he(oe,!1),0===oe.strm.avail_out)?1:2}(U,Te):3===U.strategy?function(oe,Ue){for(var tt,Ge,_t,Gt,Rt=oe.window;;){if(oe.lookahead<=He){if(en(oe),oe.lookahead<=He&&0===Ue)return 1;if(0===oe.lookahead)break}if(oe.match_length=0,oe.lookahead>=3&&0<oe.strstart&&(Ge=Rt[_t=oe.strstart-1])===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]){Gt=oe.strstart+He;do{}while(Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&Ge===Rt[++_t]&&_t<Gt);oe.match_length=He-(Gt-_t),oe.match_length>oe.lookahead&&(oe.match_length=oe.lookahead)}if(oe.match_length>=3?(tt=T._tr_tally(oe,1,oe.match_length-3),oe.lookahead-=oe.match_length,oe.strstart+=oe.match_length,oe.match_length=0):(tt=T._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++),tt&&(he(oe,!1),0===oe.strm.avail_out))return 1}return oe.insert=0,4===Ue?(he(oe,!0),0===oe.strm.avail_out?3:4):oe.last_lit&&(he(oe,!1),0===oe.strm.avail_out)?1:2}(U,Te):k[U.level].func(U,Te);if(3!==Pe&&4!==Pe||(U.status=666),1===Pe||3===Pe)return 0===x.avail_out&&(U.last_flush=-1),0;if(2===Pe&&(1===Te?T._tr_align(U):5!==Te&&(T._tr_stored_block(U,0,0,!1),3===Te&&(Tt(U.head),0===U.lookahead&&(U.strstart=0,U.block_start=0,U.insert=0))),pe(x),0===x.avail_out))return U.last_flush=-1,0}return 4!==Te?0:U.wrap<=0?1:(2===U.wrap?(vt(U,255&x.adler),vt(U,x.adler>>8&255),vt(U,x.adler>>16&255),vt(U,x.adler>>24&255),vt(U,255&x.total_in),vt(U,x.total_in>>8&255),vt(U,x.total_in>>16&255),vt(U,x.total_in>>24&255)):(et(U,x.adler>>>16),et(U,65535&x.adler)),pe(x),0<U.wrap&&(U.wrap=-U.wrap),0!==U.pending?0:1)},j.deflateEnd=function(x){var Te;return x&&x.state?42!==(Te=x.state.status)&&69!==Te&&73!==Te&&91!==Te&&103!==Te&&113!==Te&&666!==Te?Lt(x,H):(x.state=null,113===Te?Lt(x,-3):0):H},j.deflateSetDictionary=function(x,Te){var me,U,O,ee,Le,Pe,oe,Ue,tt=Te.length;if(!x||!x.state||2===(ee=(me=x.state).wrap)||1===ee&&42!==me.status||me.lookahead)return H;for(1===ee&&(x.adler=F(x.adler,Te,tt,0)),me.wrap=0,tt>=me.w_size&&(0===ee&&(Tt(me.head),me.strstart=0,me.block_start=0,me.insert=0),Ue=new D.Buf8(me.w_size),D.arraySet(Ue,Te,tt-me.w_size,me.w_size,0),Te=Ue,tt=me.w_size),Le=x.avail_in,Pe=x.next_in,oe=x.input,x.avail_in=tt,x.next_in=0,x.input=Te,en(me);me.lookahead>=3;){for(U=me.strstart,O=me.lookahead-2;me.ins_h=(me.ins_h<<me.hash_shift^me.window[U+3-1])&me.hash_mask,me.prev[U&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=U,U++,--O;);me.strstart=U,me.lookahead=2,en(me)}return me.strstart+=me.lookahead,me.block_start=me.strstart,me.insert=me.lookahead,me.lookahead=0,me.match_length=me.prev_length=2,me.match_available=0,x.next_in=Pe,x.input=oe,x.avail_in=Le,me.wrap=ee,0},j.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(Y,ge,j){"use strict";ge.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(Y,ge,j){"use strict";ge.exports=function(k,D){var T,F,X,Q,W,Z,E,H,C,z,I,G,$,ne,re,Ce,Se,Fe,ve,He,yt,q,Me,w,Ee;w=k.input,X=(F=k.next_in)+(k.avail_in-5),Ee=k.output,W=(Q=k.next_out)-(D-k.avail_out),Z=Q+(k.avail_out-257),E=(T=k.state).dmax,H=T.wsize,C=T.whave,z=T.wnext,I=T.window,G=T.hold,$=T.bits,ne=T.lencode,re=T.distcode,Ce=(1<<T.lenbits)-1,Se=(1<<T.distbits)-1;e:do{$<15&&(G+=w[F++]<<$,G+=w[F++]<<($+=8),$+=8),Fe=ne[G&Ce];t:for(;;){if(G>>>=ve=Fe>>>24,$-=ve,0==(ve=Fe>>>16&255))Ee[Q++]=65535&Fe;else{if(!(16&ve)){if(0==(64&ve)){Fe=ne[(65535&Fe)+(G&(1<<ve)-1)];continue t}if(32&ve){T.mode=12;break e}k.msg="invalid literal/length code",T.mode=30;break e}He=65535&Fe,(ve&=15)&&($<ve&&(G+=w[F++]<<$,$+=8),He+=G&(1<<ve)-1,G>>>=ve,$-=ve),$<15&&(G+=w[F++]<<$,G+=w[F++]<<($+=8),$+=8),Fe=re[G&Se];n:for(;;){if(G>>>=ve=Fe>>>24,$-=ve,!(16&(ve=Fe>>>16&255))){if(0==(64&ve)){Fe=re[(65535&Fe)+(G&(1<<ve)-1)];continue n}k.msg="invalid distance code",T.mode=30;break e}if(yt=65535&Fe,$<(ve&=15)&&(G+=w[F++]<<$,($+=8)<ve&&(G+=w[F++]<<$,$+=8)),E<(yt+=G&(1<<ve)-1)){k.msg="invalid distance too far back",T.mode=30;break e}if(G>>>=ve,$-=ve,(ve=Q-W)<yt){if(C<(ve=yt-ve)&&T.sane){k.msg="invalid distance too far back",T.mode=30;break e}if(Me=I,(q=0)===z){if(q+=H-ve,ve<He){for(He-=ve;Ee[Q++]=I[q++],--ve;);q=Q-yt,Me=Ee}}else if(z<ve){if(q+=H+z-ve,(ve-=z)<He){for(He-=ve;Ee[Q++]=I[q++],--ve;);if(q=0,z<He){for(He-=ve=z;Ee[Q++]=I[q++],--ve;);q=Q-yt,Me=Ee}}}else if(q+=z-ve,ve<He){for(He-=ve;Ee[Q++]=I[q++],--ve;);q=Q-yt,Me=Ee}for(;2<He;)Ee[Q++]=Me[q++],Ee[Q++]=Me[q++],Ee[Q++]=Me[q++],He-=3;He&&(Ee[Q++]=Me[q++],1<He&&(Ee[Q++]=Me[q++]))}else{for(q=Q-yt;Ee[Q++]=Ee[q++],Ee[Q++]=Ee[q++],Ee[Q++]=Ee[q++],2<(He-=3););He&&(Ee[Q++]=Ee[q++],1<He&&(Ee[Q++]=Ee[q++]))}break}}break}}while(F<X&&Q<Z);F-=He=$>>3,G&=(1<<($-=He<<3))-1,k.next_in=F,k.next_out=Q,k.avail_in=F<X?X-F+5:5-(F-X),k.avail_out=Q<Z?Z-Q+257:257-(Q-Z),T.hold=G,T.bits=$}},{}],49:[function(Y,ge,j){"use strict";var k=Y("../utils/common"),D=Y("./adler32"),T=Y("./crc32"),F=Y("./inffast"),X=Y("./inftrees"),E=-2;function I(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function G(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new k.Buf16(320),this.work=new k.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function $(q){var Me;return q&&q.state?(q.total_in=q.total_out=(Me=q.state).total=0,q.msg="",Me.wrap&&(q.adler=1&Me.wrap),Me.mode=1,Me.last=0,Me.havedict=0,Me.dmax=32768,Me.head=null,Me.hold=0,Me.bits=0,Me.lencode=Me.lendyn=new k.Buf32(852),Me.distcode=Me.distdyn=new k.Buf32(592),Me.sane=1,Me.back=-1,0):E}function ne(q){var Me;return q&&q.state?((Me=q.state).wsize=0,Me.whave=0,Me.wnext=0,$(q)):E}function re(q,Me){var w,Ee;return q&&q.state?(Ee=q.state,Me<0?(w=0,Me=-Me):(w=1+(Me>>4),Me<48&&(Me&=15)),Me&&(Me<8||15<Me)?E:(null!==Ee.window&&Ee.wbits!==Me&&(Ee.window=null),Ee.wrap=w,Ee.wbits=Me,ne(q))):E}function Ce(q,Me){var w,Ee;return q?(Ee=new G,(q.state=Ee).window=null,0!==(w=re(q,Me))&&(q.state=null),w):E}var Se,Fe,ve=!0;function He(q){if(ve){var Me;for(Se=new k.Buf32(512),Fe=new k.Buf32(32),Me=0;Me<144;)q.lens[Me++]=8;for(;Me<256;)q.lens[Me++]=9;for(;Me<280;)q.lens[Me++]=7;for(;Me<288;)q.lens[Me++]=8;for(X(1,q.lens,0,288,Se,0,q.work,{bits:9}),Me=0;Me<32;)q.lens[Me++]=5;X(2,q.lens,0,32,Fe,0,q.work,{bits:5}),ve=!1}q.lencode=Se,q.lenbits=9,q.distcode=Fe,q.distbits=5}function yt(q,Me,w,Ee){var Pt,ze=q.state;return null===ze.window&&(ze.wsize=1<<ze.wbits,ze.wnext=0,ze.whave=0,ze.window=new k.Buf8(ze.wsize)),Ee>=ze.wsize?(k.arraySet(ze.window,Me,w-ze.wsize,ze.wsize,0),ze.wnext=0,ze.whave=ze.wsize):(Ee<(Pt=ze.wsize-ze.wnext)&&(Pt=Ee),k.arraySet(ze.window,Me,w-Ee,Pt,ze.wnext),(Ee-=Pt)?(k.arraySet(ze.window,Me,w-Ee,Ee,0),ze.wnext=Ee,ze.whave=ze.wsize):(ze.wnext+=Pt,ze.wnext===ze.wsize&&(ze.wnext=0),ze.whave<ze.wsize&&(ze.whave+=Pt))),0}j.inflateReset=ne,j.inflateReset2=re,j.inflateResetKeep=$,j.inflateInit=function(q){return Ce(q,15)},j.inflateInit2=Ce,j.inflate=function(q,Me){var w,Ee,Pt,ze,Lt,Ne,Tt,pe,he,vt,et,Ze,en,pn,zt,Nt,cn,tn,Wn,On,x,Te,me,U,O=0,ee=new k.Buf8(4),Le=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return E;12===(w=q.state).mode&&(w.mode=13),Lt=q.next_out,Pt=q.output,ze=q.next_in,Ee=q.input,pe=w.hold,he=w.bits,vt=Ne=q.avail_in,et=Tt=q.avail_out,Te=0;e:for(;;)switch(w.mode){case 1:if(0===w.wrap){w.mode=13;break}for(;he<16;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(2&w.wrap&&35615===pe){ee[w.check=0]=255&pe,ee[1]=pe>>>8&255,w.check=T(w.check,ee,2,0),he=pe=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&pe)<<8)+(pe>>8))%31){q.msg="incorrect header check",w.mode=30;break}if(8!=(15&pe)){q.msg="unknown compression method",w.mode=30;break}if(he-=4,x=8+(15&(pe>>>=4)),0===w.wbits)w.wbits=x;else if(x>w.wbits){q.msg="invalid window size",w.mode=30;break}w.dmax=1<<x,q.adler=w.check=1,w.mode=512&pe?10:12,he=pe=0;break;case 2:for(;he<16;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(w.flags=pe,8!=(255&w.flags)){q.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){q.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=pe>>8&1),512&w.flags&&(ee[0]=255&pe,ee[1]=pe>>>8&255,w.check=T(w.check,ee,2,0)),he=pe=0,w.mode=3;case 3:for(;he<32;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.head&&(w.head.time=pe),512&w.flags&&(ee[0]=255&pe,ee[1]=pe>>>8&255,ee[2]=pe>>>16&255,ee[3]=pe>>>24&255,w.check=T(w.check,ee,4,0)),he=pe=0,w.mode=4;case 4:for(;he<16;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.head&&(w.head.xflags=255&pe,w.head.os=pe>>8),512&w.flags&&(ee[0]=255&pe,ee[1]=pe>>>8&255,w.check=T(w.check,ee,2,0)),he=pe=0,w.mode=5;case 5:if(1024&w.flags){for(;he<16;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.length=pe,w.head&&(w.head.extra_len=pe),512&w.flags&&(ee[0]=255&pe,ee[1]=pe>>>8&255,w.check=T(w.check,ee,2,0)),he=pe=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(Ne<(Ze=w.length)&&(Ze=Ne),Ze&&(w.head&&(x=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),k.arraySet(w.head.extra,Ee,ze,Ze,x)),512&w.flags&&(w.check=T(w.check,Ee,Ze,ze)),Ne-=Ze,ze+=Ze,w.length-=Ze),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(0===Ne)break e;for(Ze=0;x=Ee[ze+Ze++],w.head&&x&&w.length<65536&&(w.head.name+=String.fromCharCode(x)),x&&Ze<Ne;);if(512&w.flags&&(w.check=T(w.check,Ee,Ze,ze)),Ne-=Ze,ze+=Ze,x)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(0===Ne)break e;for(Ze=0;x=Ee[ze+Ze++],w.head&&x&&w.length<65536&&(w.head.comment+=String.fromCharCode(x)),x&&Ze<Ne;);if(512&w.flags&&(w.check=T(w.check,Ee,Ze,ze)),Ne-=Ze,ze+=Ze,x)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;he<16;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(pe!==(65535&w.check)){q.msg="header crc mismatch",w.mode=30;break}he=pe=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),q.adler=w.check=0,w.mode=12;break;case 10:for(;he<32;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}q.adler=w.check=I(pe),he=pe=0,w.mode=11;case 11:if(0===w.havedict)return q.next_out=Lt,q.avail_out=Tt,q.next_in=ze,q.avail_in=Ne,w.hold=pe,w.bits=he,2;q.adler=w.check=1,w.mode=12;case 12:if(5===Me||6===Me)break e;case 13:if(w.last){pe>>>=7&he,he-=7&he,w.mode=27;break}for(;he<3;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}switch(w.last=1&pe,he-=1,3&(pe>>>=1)){case 0:w.mode=14;break;case 1:if(He(w),w.mode=20,6!==Me)break;pe>>>=2,he-=2;break e;case 2:w.mode=17;break;case 3:q.msg="invalid block type",w.mode=30}pe>>>=2,he-=2;break;case 14:for(pe>>>=7&he,he-=7&he;he<32;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if((65535&pe)!=(pe>>>16^65535)){q.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&pe,he=pe=0,w.mode=15,6===Me)break e;case 15:w.mode=16;case 16:if(Ze=w.length){if(Ne<Ze&&(Ze=Ne),Tt<Ze&&(Ze=Tt),0===Ze)break e;k.arraySet(Pt,Ee,ze,Ze,Lt),Ne-=Ze,ze+=Ze,Tt-=Ze,Lt+=Ze,w.length-=Ze;break}w.mode=12;break;case 17:for(;he<14;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(w.nlen=257+(31&pe),he-=5,w.ndist=1+(31&(pe>>>=5)),he-=5,w.ncode=4+(15&(pe>>>=5)),pe>>>=4,he-=4,286<w.nlen||30<w.ndist){q.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;he<3;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.lens[Le[w.have++]]=7&pe,pe>>>=3,he-=3}for(;w.have<19;)w.lens[Le[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Te=X(0,w.lens,0,19,w.lencode,0,w.work,me={bits:w.lenbits}),w.lenbits=me.bits,Te){q.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;Nt=(O=w.lencode[pe&(1<<w.lenbits)-1])>>>16&255,cn=65535&O,!((zt=O>>>24)<=he);){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(cn<16)pe>>>=zt,he-=zt,w.lens[w.have++]=cn;else{if(16===cn){for(U=zt+2;he<U;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(pe>>>=zt,he-=zt,0===w.have){q.msg="invalid bit length repeat",w.mode=30;break}x=w.lens[w.have-1],Ze=3+(3&pe),pe>>>=2,he-=2}else if(17===cn){for(U=zt+3;he<U;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}he-=zt,x=0,Ze=3+(7&(pe>>>=zt)),pe>>>=3,he-=3}else{for(U=zt+7;he<U;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}he-=zt,x=0,Ze=11+(127&(pe>>>=zt)),pe>>>=7,he-=7}if(w.have+Ze>w.nlen+w.ndist){q.msg="invalid bit length repeat",w.mode=30;break}for(;Ze--;)w.lens[w.have++]=x}}if(30===w.mode)break;if(0===w.lens[256]){q.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,Te=X(1,w.lens,0,w.nlen,w.lencode,0,w.work,me={bits:w.lenbits}),w.lenbits=me.bits,Te){q.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,Te=X(2,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,me={bits:w.distbits}),w.distbits=me.bits,Te){q.msg="invalid distances set",w.mode=30;break}if(w.mode=20,6===Me)break e;case 20:w.mode=21;case 21:if(6<=Ne&&258<=Tt){q.next_out=Lt,q.avail_out=Tt,q.next_in=ze,q.avail_in=Ne,w.hold=pe,w.bits=he,F(q,et),Lt=q.next_out,Pt=q.output,Tt=q.avail_out,ze=q.next_in,Ee=q.input,Ne=q.avail_in,pe=w.hold,he=w.bits,12===w.mode&&(w.back=-1);break}for(w.back=0;Nt=(O=w.lencode[pe&(1<<w.lenbits)-1])>>>16&255,cn=65535&O,!((zt=O>>>24)<=he);){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(Nt&&0==(240&Nt)){for(tn=zt,Wn=Nt,On=cn;Nt=(O=w.lencode[On+((pe&(1<<tn+Wn)-1)>>tn)])>>>16&255,cn=65535&O,!(tn+(zt=O>>>24)<=he);){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}pe>>>=tn,he-=tn,w.back+=tn}if(pe>>>=zt,he-=zt,w.back+=zt,w.length=cn,0===Nt){w.mode=26;break}if(32&Nt){w.back=-1,w.mode=12;break}if(64&Nt){q.msg="invalid literal/length code",w.mode=30;break}w.extra=15&Nt,w.mode=22;case 22:if(w.extra){for(U=w.extra;he<U;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.length+=pe&(1<<w.extra)-1,pe>>>=w.extra,he-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;Nt=(O=w.distcode[pe&(1<<w.distbits)-1])>>>16&255,cn=65535&O,!((zt=O>>>24)<=he);){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(0==(240&Nt)){for(tn=zt,Wn=Nt,On=cn;Nt=(O=w.distcode[On+((pe&(1<<tn+Wn)-1)>>tn)])>>>16&255,cn=65535&O,!(tn+(zt=O>>>24)<=he);){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}pe>>>=tn,he-=tn,w.back+=tn}if(pe>>>=zt,he-=zt,w.back+=zt,64&Nt){q.msg="invalid distance code",w.mode=30;break}w.offset=cn,w.extra=15&Nt,w.mode=24;case 24:if(w.extra){for(U=w.extra;he<U;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}w.offset+=pe&(1<<w.extra)-1,pe>>>=w.extra,he-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){q.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(0===Tt)break e;if(w.offset>(Ze=et-Tt)){if((Ze=w.offset-Ze)>w.whave&&w.sane){q.msg="invalid distance too far back",w.mode=30;break}en=Ze>w.wnext?w.wsize-(Ze-=w.wnext):w.wnext-Ze,Ze>w.length&&(Ze=w.length),pn=w.window}else pn=Pt,en=Lt-w.offset,Ze=w.length;for(Tt<Ze&&(Ze=Tt),Tt-=Ze,w.length-=Ze;Pt[Lt++]=pn[en++],--Ze;);0===w.length&&(w.mode=21);break;case 26:if(0===Tt)break e;Pt[Lt++]=w.length,Tt--,w.mode=21;break;case 27:if(w.wrap){for(;he<32;){if(0===Ne)break e;Ne--,pe|=Ee[ze++]<<he,he+=8}if(q.total_out+=et-=Tt,w.total+=et,et&&(q.adler=w.check=w.flags?T(w.check,Pt,et,Lt-et):D(w.check,Pt,et,Lt-et)),et=Tt,(w.flags?pe:I(pe))!==w.check){q.msg="incorrect data check",w.mode=30;break}he=pe=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;he<32;){if(0===Ne)break e;Ne--,pe+=Ee[ze++]<<he,he+=8}if(pe!==(4294967295&w.total)){q.msg="incorrect length check",w.mode=30;break}he=pe=0}w.mode=29;case 29:Te=1;break e;case 30:Te=-3;break e;case 31:return-4;default:return E}return q.next_out=Lt,q.avail_out=Tt,q.next_in=ze,q.avail_in=Ne,w.hold=pe,w.bits=he,(w.wsize||et!==q.avail_out&&w.mode<30&&(w.mode<27||4!==Me))&&yt(q,q.output,q.next_out,et-q.avail_out)?(w.mode=31,-4):(et-=q.avail_out,q.total_in+=vt-=q.avail_in,q.total_out+=et,w.total+=et,w.wrap&&et&&(q.adler=w.check=w.flags?T(w.check,Pt,et,q.next_out-et):D(w.check,Pt,et,q.next_out-et)),q.data_type=w.bits+(w.last?64:0)+(12===w.mode?128:0)+(20===w.mode||15===w.mode?256:0),(0==vt&&0===et||4===Me)&&0===Te&&(Te=-5),Te)},j.inflateEnd=function(q){if(!q||!q.state)return E;var Me=q.state;return Me.window&&(Me.window=null),q.state=null,0},j.inflateGetHeader=function(q,Me){var w;return q&&q.state?0==(2&(w=q.state).wrap)?E:((w.head=Me).done=!1,0):E},j.inflateSetDictionary=function(q,Me){var w,Ee=Me.length;return q&&q.state?0!==(w=q.state).wrap&&11!==w.mode?E:11===w.mode&&D(1,Me,Ee,0)!==w.check?-3:yt(q,Me,Ee,Ee)?(w.mode=31,-4):(w.havedict=1,0):E},j.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(Y,ge,j){"use strict";var k=Y("../utils/common"),D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],T=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],X=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];ge.exports=function(Q,W,Z,E,H,C,z,I){var G,$,ne,re,Ce,Se,Fe,ve,He,yt=I.bits,q=0,Me=0,w=0,Ee=0,Pt=0,ze=0,Lt=0,Ne=0,Tt=0,pe=0,he=null,vt=0,et=new k.Buf16(16),Ze=new k.Buf16(16),en=null,pn=0;for(q=0;q<=15;q++)et[q]=0;for(Me=0;Me<E;Me++)et[W[Z+Me]]++;for(Pt=yt,Ee=15;1<=Ee&&0===et[Ee];Ee--);if(Ee<Pt&&(Pt=Ee),0===Ee)return H[C++]=20971520,H[C++]=20971520,I.bits=1,0;for(w=1;w<Ee&&0===et[w];w++);for(Pt<w&&(Pt=w),q=Ne=1;q<=15;q++)if(Ne<<=1,(Ne-=et[q])<0)return-1;if(0<Ne&&(0===Q||1!==Ee))return-1;for(Ze[1]=0,q=1;q<15;q++)Ze[q+1]=Ze[q]+et[q];for(Me=0;Me<E;Me++)0!==W[Z+Me]&&(z[Ze[W[Z+Me]]++]=Me);if(Se=0===Q?(he=en=z,19):1===Q?(he=D,vt-=257,en=T,pn-=257,256):(he=F,en=X,-1),q=w,Ce=C,Lt=Me=pe=0,ne=-1,re=(Tt=1<<(ze=Pt))-1,1===Q&&852<Tt||2===Q&&592<Tt)return 1;for(;;){for(Fe=q-Lt,He=z[Me]<Se?(ve=0,z[Me]):z[Me]>Se?(ve=en[pn+z[Me]],he[vt+z[Me]]):(ve=96,0),G=1<<q-Lt,w=$=1<<ze;H[Ce+(pe>>Lt)+($-=G)]=Fe<<24|ve<<16|He|0,0!==$;);for(G=1<<q-1;pe&G;)G>>=1;if(0!==G?(pe&=G-1,pe+=G):pe=0,Me++,0==--et[q]){if(q===Ee)break;q=W[Z+z[Me]]}if(Pt<q&&(pe&re)!==ne){for(0===Lt&&(Lt=Pt),Ce+=w,Ne=1<<(ze=q-Lt);ze+Lt<Ee&&!((Ne-=et[ze+Lt])<=0);)ze++,Ne<<=1;if(Tt+=1<<ze,1===Q&&852<Tt||2===Q&&592<Tt)return 1;H[ne=pe&re]=Pt<<24|ze<<16|Ce-C|0}}return 0!==pe&&(H[Ce+pe]=q-Lt<<24|64<<16|0),I.bits=Pt,0}},{"../utils/common":41}],51:[function(Y,ge,j){"use strict";ge.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(Y,ge,j){"use strict";var k=Y("../utils/common");function F(O){for(var ee=O.length;0<=--ee;)O[ee]=0}var W=256,Z=286,E=30,z=15,Se=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Fe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ve=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],He=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],yt=new Array(576);F(yt);var q=new Array(60);F(q);var Me=new Array(512);F(Me);var w=new Array(256);F(w);var Ee=new Array(29);F(Ee);var Pt,ze,Lt,Ne=new Array(E);function Tt(O,ee,Le,Pe,oe){this.static_tree=O,this.extra_bits=ee,this.extra_base=Le,this.elems=Pe,this.max_length=oe,this.has_stree=O&&O.length}function pe(O,ee){this.dyn_tree=O,this.max_code=0,this.stat_desc=ee}function he(O){return O<256?Me[O]:Me[256+(O>>>7)]}function vt(O,ee){O.pending_buf[O.pending++]=255&ee,O.pending_buf[O.pending++]=ee>>>8&255}function et(O,ee,Le){O.bi_valid>16-Le?(O.bi_buf|=ee<<O.bi_valid&65535,vt(O,O.bi_buf),O.bi_buf=ee>>16-O.bi_valid,O.bi_valid+=Le-16):(O.bi_buf|=ee<<O.bi_valid&65535,O.bi_valid+=Le)}function Ze(O,ee,Le){et(O,Le[2*ee],Le[2*ee+1])}function en(O,ee){for(var Le=0;Le|=1&O,O>>>=1,Le<<=1,0<--ee;);return Le>>>1}function pn(O,ee,Le){var Pe,oe,Ue=new Array(16),tt=0;for(Pe=1;Pe<=z;Pe++)Ue[Pe]=tt=tt+Le[Pe-1]<<1;for(oe=0;oe<=ee;oe++){var Ge=O[2*oe+1];0!==Ge&&(O[2*oe]=en(Ue[Ge]++,Ge))}}function zt(O){var ee;for(ee=0;ee<Z;ee++)O.dyn_ltree[2*ee]=0;for(ee=0;ee<E;ee++)O.dyn_dtree[2*ee]=0;for(ee=0;ee<19;ee++)O.bl_tree[2*ee]=0;O.dyn_ltree[512]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}function Nt(O){8<O.bi_valid?vt(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}function cn(O,ee,Le,Pe){var oe=2*ee,Ue=2*Le;return O[oe]<O[Ue]||O[oe]===O[Ue]&&Pe[ee]<=Pe[Le]}function tn(O,ee,Le){for(var Pe=O.heap[Le],oe=Le<<1;oe<=O.heap_len&&(oe<O.heap_len&&cn(ee,O.heap[oe+1],O.heap[oe],O.depth)&&oe++,!cn(ee,Pe,O.heap[oe],O.depth));)O.heap[Le]=O.heap[oe],Le=oe,oe<<=1;O.heap[Le]=Pe}function Wn(O,ee,Le){var Pe,oe,Ue,tt,Ge=0;if(0!==O.last_lit)for(;Pe=O.pending_buf[O.d_buf+2*Ge]<<8|O.pending_buf[O.d_buf+2*Ge+1],oe=O.pending_buf[O.l_buf+Ge],Ge++,0===Pe?Ze(O,oe,ee):(Ze(O,(Ue=w[oe])+W+1,ee),0!==(tt=Se[Ue])&&et(O,oe-=Ee[Ue],tt),Ze(O,Ue=he(--Pe),Le),0!==(tt=Fe[Ue])&&et(O,Pe-=Ne[Ue],tt)),Ge<O.last_lit;);Ze(O,256,ee)}function On(O,ee){var Le,Pe,oe,Ue=ee.dyn_tree,tt=ee.stat_desc.static_tree,Ge=ee.stat_desc.has_stree,_t=ee.stat_desc.elems,Gt=-1;for(O.heap_len=0,O.heap_max=573,Le=0;Le<_t;Le++)0!==Ue[2*Le]?(O.heap[++O.heap_len]=Gt=Le,O.depth[Le]=0):Ue[2*Le+1]=0;for(;O.heap_len<2;)Ue[2*(oe=O.heap[++O.heap_len]=Gt<2?++Gt:0)]=1,O.depth[oe]=0,O.opt_len--,Ge&&(O.static_len-=tt[2*oe+1]);for(ee.max_code=Gt,Le=O.heap_len>>1;1<=Le;Le--)tn(O,Ue,Le);for(oe=_t;Le=O.heap[1],O.heap[1]=O.heap[O.heap_len--],tn(O,Ue,1),Pe=O.heap[1],O.heap[--O.heap_max]=Le,O.heap[--O.heap_max]=Pe,Ue[2*oe]=Ue[2*Le]+Ue[2*Pe],O.depth[oe]=(O.depth[Le]>=O.depth[Pe]?O.depth[Le]:O.depth[Pe])+1,Ue[2*Le+1]=Ue[2*Pe+1]=oe,O.heap[1]=oe++,tn(O,Ue,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(Rt,mn){var ii,Dn,jn,Xt,hi,un,Bn=mn.dyn_tree,rn=mn.max_code,Qr=mn.stat_desc.static_tree,Fl=mn.stat_desc.has_stree,$r=mn.stat_desc.extra_bits,ia=mn.stat_desc.extra_base,Qt=mn.stat_desc.max_length,Wi=0;for(Xt=0;Xt<=z;Xt++)Rt.bl_count[Xt]=0;for(Bn[2*Rt.heap[Rt.heap_max]+1]=0,ii=Rt.heap_max+1;ii<573;ii++)Qt<(Xt=Bn[2*Bn[2*(Dn=Rt.heap[ii])+1]+1]+1)&&(Xt=Qt,Wi++),Bn[2*Dn+1]=Xt,rn<Dn||(Rt.bl_count[Xt]++,hi=0,ia<=Dn&&(hi=$r[Dn-ia]),Rt.opt_len+=(un=Bn[2*Dn])*(Xt+hi),Fl&&(Rt.static_len+=un*(Qr[2*Dn+1]+hi)));if(0!==Wi){do{for(Xt=Qt-1;0===Rt.bl_count[Xt];)Xt--;Rt.bl_count[Xt]--,Rt.bl_count[Xt+1]+=2,Rt.bl_count[Qt]--,Wi-=2}while(0<Wi);for(Xt=Qt;0!==Xt;Xt--)for(Dn=Rt.bl_count[Xt];0!==Dn;)rn<(jn=Rt.heap[--ii])||(Bn[2*jn+1]!==Xt&&(Rt.opt_len+=(Xt-Bn[2*jn+1])*Bn[2*jn],Bn[2*jn+1]=Xt),Dn--)}}(O,ee),pn(Ue,Gt,O.bl_count)}function x(O,ee,Le){var Pe,oe,Ue=-1,tt=ee[1],Ge=0,_t=7,Gt=4;for(0===tt&&(_t=138,Gt=3),ee[2*(Le+1)+1]=65535,Pe=0;Pe<=Le;Pe++)oe=tt,tt=ee[2*(Pe+1)+1],++Ge<_t&&oe===tt||(Ge<Gt?O.bl_tree[2*oe]+=Ge:0!==oe?(oe!==Ue&&O.bl_tree[2*oe]++,O.bl_tree[32]++):Ge<=10?O.bl_tree[34]++:O.bl_tree[36]++,Ue=oe,Gt=(Ge=0)===tt?(_t=138,3):oe===tt?(_t=6,3):(_t=7,4))}function Te(O,ee,Le){var Pe,oe,Ue=-1,tt=ee[1],Ge=0,_t=7,Gt=4;for(0===tt&&(_t=138,Gt=3),Pe=0;Pe<=Le;Pe++)if(oe=tt,tt=ee[2*(Pe+1)+1],!(++Ge<_t&&oe===tt)){if(Ge<Gt)for(;Ze(O,oe,O.bl_tree),0!=--Ge;);else 0!==oe?(oe!==Ue&&(Ze(O,oe,O.bl_tree),Ge--),Ze(O,16,O.bl_tree),et(O,Ge-3,2)):Ge<=10?(Ze(O,17,O.bl_tree),et(O,Ge-3,3)):(Ze(O,18,O.bl_tree),et(O,Ge-11,7));Ue=oe,Gt=(Ge=0)===tt?(_t=138,3):oe===tt?(_t=6,3):(_t=7,4)}}F(Ne);var me=!1;function U(O,ee,Le,Pe){var oe,Ue,tt;et(O,0+(Pe?1:0),3),Ue=ee,tt=Le,Nt(oe=O),vt(oe,tt),vt(oe,~tt),k.arraySet(oe.pending_buf,oe.window,Ue,tt,oe.pending),oe.pending+=tt}j._tr_init=function(O){me||(function(){var ee,Le,Pe,oe,Ue,tt=new Array(16);for(oe=Pe=0;oe<28;oe++)for(Ee[oe]=Pe,ee=0;ee<1<<Se[oe];ee++)w[Pe++]=oe;for(w[Pe-1]=oe,oe=Ue=0;oe<16;oe++)for(Ne[oe]=Ue,ee=0;ee<1<<Fe[oe];ee++)Me[Ue++]=oe;for(Ue>>=7;oe<E;oe++)for(Ne[oe]=Ue<<7,ee=0;ee<1<<Fe[oe]-7;ee++)Me[256+Ue++]=oe;for(Le=0;Le<=z;Le++)tt[Le]=0;for(ee=0;ee<=143;)yt[2*ee+1]=8,ee++,tt[8]++;for(;ee<=255;)yt[2*ee+1]=9,ee++,tt[9]++;for(;ee<=279;)yt[2*ee+1]=7,ee++,tt[7]++;for(;ee<=287;)yt[2*ee+1]=8,ee++,tt[8]++;for(pn(yt,287,tt),ee=0;ee<E;ee++)q[2*ee+1]=5,q[2*ee]=en(ee,5);Pt=new Tt(yt,Se,257,Z,z),ze=new Tt(q,Fe,0,E,z),Lt=new Tt(new Array(0),ve,0,19,7)}(),me=!0),O.l_desc=new pe(O.dyn_ltree,Pt),O.d_desc=new pe(O.dyn_dtree,ze),O.bl_desc=new pe(O.bl_tree,Lt),O.bi_buf=0,O.bi_valid=0,zt(O)},j._tr_stored_block=U,j._tr_flush_block=function(O,ee,Le,Pe){var oe,Ue,tt=0;0<O.level?(2===O.strm.data_type&&(O.strm.data_type=function(Ge){var _t,Gt=4093624447;for(_t=0;_t<=31;_t++,Gt>>>=1)if(1&Gt&&0!==Ge.dyn_ltree[2*_t])return 0;if(0!==Ge.dyn_ltree[18]||0!==Ge.dyn_ltree[20]||0!==Ge.dyn_ltree[26])return 1;for(_t=32;_t<W;_t++)if(0!==Ge.dyn_ltree[2*_t])return 1;return 0}(O)),On(O,O.l_desc),On(O,O.d_desc),tt=function(Ge){var _t;for(x(Ge,Ge.dyn_ltree,Ge.l_desc.max_code),x(Ge,Ge.dyn_dtree,Ge.d_desc.max_code),On(Ge,Ge.bl_desc),_t=18;3<=_t&&0===Ge.bl_tree[2*He[_t]+1];_t--);return Ge.opt_len+=3*(_t+1)+5+5+4,_t}(O),(Ue=O.static_len+3+7>>>3)<=(oe=O.opt_len+3+7>>>3)&&(oe=Ue)):oe=Ue=Le+5,Le+4<=oe&&-1!==ee?U(O,ee,Le,Pe):4===O.strategy||Ue===oe?(et(O,2+(Pe?1:0),3),Wn(O,yt,q)):(et(O,4+(Pe?1:0),3),function(Ge,_t,Gt,Rt){var mn;for(et(Ge,_t-257,5),et(Ge,Gt-1,5),et(Ge,Rt-4,4),mn=0;mn<Rt;mn++)et(Ge,Ge.bl_tree[2*He[mn]+1],3);Te(Ge,Ge.dyn_ltree,_t-1),Te(Ge,Ge.dyn_dtree,Gt-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,tt+1),Wn(O,O.dyn_ltree,O.dyn_dtree)),zt(O),Pe&&Nt(O)},j._tr_tally=function(O,ee,Le){return O.pending_buf[O.d_buf+2*O.last_lit]=ee>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&ee,O.pending_buf[O.l_buf+O.last_lit]=255&Le,O.last_lit++,0===ee?O.dyn_ltree[2*Le]++:(O.matches++,ee--,O.dyn_ltree[2*(w[Le]+W+1)]++,O.dyn_dtree[2*he(ee)]++),O.last_lit===O.lit_bufsize-1},j._tr_align=function(O){var ee;et(O,2,3),Ze(O,256,yt),16===(ee=O).bi_valid?(vt(ee,ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0):8<=ee.bi_valid&&(ee.pending_buf[ee.pending++]=255&ee.bi_buf,ee.bi_buf>>=8,ee.bi_valid-=8)}},{"../utils/common":41}],53:[function(Y,ge,j){"use strict";ge.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(Y,ge,j){(function(k){!function(D,T){"use strict";if(!D.setImmediate){var F,X,Q,W,Z=1,E={},H=!1,C=D.document,z=Object.getPrototypeOf&&Object.getPrototypeOf(D);z=z&&z.setTimeout?z:D,F="[object process]"==={}.toString.call(D.process)?function(ne){process.nextTick(function(){G(ne)})}:function(){if(D.postMessage&&!D.importScripts){var ne=!0,re=D.onmessage;return D.onmessage=function(){ne=!1},D.postMessage("","*"),D.onmessage=re,ne}}()?(W="setImmediate$"+Math.random()+"$",D.addEventListener?D.addEventListener("message",$,!1):D.attachEvent("onmessage",$),function(ne){D.postMessage(W+ne,"*")}):D.MessageChannel?((Q=new MessageChannel).port1.onmessage=function(ne){G(ne.data)},function(ne){Q.port2.postMessage(ne)}):C&&"onreadystatechange"in C.createElement("script")?(X=C.documentElement,function(ne){var re=C.createElement("script");re.onreadystatechange=function(){G(ne),re.onreadystatechange=null,X.removeChild(re),re=null},X.appendChild(re)}):function(ne){setTimeout(G,0,ne)},z.setImmediate=function(ne){"function"!=typeof ne&&(ne=new Function(""+ne));for(var re=new Array(arguments.length-1),Ce=0;Ce<re.length;Ce++)re[Ce]=arguments[Ce+1];return E[Z]={callback:ne,args:re},F(Z),Z++},z.clearImmediate=I}function I(ne){delete E[ne]}function G(ne){if(H)setTimeout(G,0,ne);else{var re=E[ne];if(re){H=!0;try{!function(Ce){var Se=Ce.callback,Fe=Ce.args;switch(Fe.length){case 0:Se();break;case 1:Se(Fe[0]);break;case 2:Se(Fe[0],Fe[1]);break;case 3:Se(Fe[0],Fe[1],Fe[2]);break;default:Se.apply(undefined,Fe)}}(re)}finally{I(ne),H=!1}}}}function $(ne){ne.source===D&&"string"==typeof ne.data&&0===ne.data.indexOf(W)&&G(+ne.data.slice(W.length))}}(typeof self>"u"?void 0===k?this:k:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)},6746:(Ds,Y,ge)=>{"use strict";ge.r(Y),ge.d(Y,{PreviewPageModule:()=>cx});var j=ge(8692),k=ge(36);function D(s,e,t,n,i,r,a){try{var l=s[r](a),c=l.value}catch(u){return void t(u)}l.done?e(c):Promise.resolve(c).then(n,i)}function T(s){return function(){var e=this,t=arguments;return new Promise(function(n,i){var r=s.apply(e,t);function a(c){D(r,n,i,a,l,"next",c)}function l(c){D(r,n,i,a,l,"throw",c)}a(void 0)})}}const w=100,un=1001,rn=1003,Qt=1006,cr=1009,bi=1015,ur=1016,Kr=1020,Mi=1022,Nn=1023,hr=1026,es=1027,dr=2400,fr=2401,Un=3e3,ts=35044,ns=35048;class Si{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const r=i.indexOf(t);-1!==r&&i.splice(r,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const n=this._listeners[e.type];if(void 0!==n){e.target=this;const i=n.slice(0);for(let r=0,a=i.length;r<a;r++)i[r].call(this,e);e.target=null}}}const wn=[];for(let s=0;s<256;s++)wn[s]=(s<16?"0":"")+s.toString(16);const Zi=Math.PI/180,is=180/Math.PI;function Hn(){const s=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(wn[255&s]+wn[s>>8&255]+wn[s>>16&255]+wn[s>>24&255]+"-"+wn[255&e]+wn[e>>8&255]+"-"+wn[e>>16&15|64]+wn[e>>24&255]+"-"+wn[63&t|128]+wn[t>>8&255]+"-"+wn[t>>16&255]+wn[t>>24&255]+wn[255&n]+wn[n>>8&255]+wn[n>>16&255]+wn[n>>24&255]).toUpperCase()}function bn(s,e,t){return Math.max(e,Math.min(t,s))}function rs(s,e,t){return(1-t)*s+t*e}function ua(s){return 0==(s&s-1)&&0!==s}function $l(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}class Ie{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Ie.prototype.isVector2=!0;class gn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,a,l,c,u){const h=this.elements;return h[0]=e,h[1]=i,h[2]=l,h[3]=t,h[4]=r,h[5]=c,h[6]=n,h[7]=a,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],l=n[3],c=n[6],u=n[1],h=n[4],d=n[7],f=n[2],p=n[5],m=n[8],v=i[0],y=i[3],_=i[6],g=i[1],b=i[4],M=i[7],A=i[2],B=i[5],S=i[8];return r[0]=a*v+l*g+c*A,r[3]=a*y+l*b+c*B,r[6]=a*_+l*M+c*S,r[1]=u*v+h*g+d*A,r[4]=u*y+h*b+d*B,r[7]=u*_+h*M+d*S,r[2]=f*v+p*g+m*A,r[5]=f*y+p*b+m*B,r[8]=f*_+p*M+m*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return t*a*h-t*l*u-n*r*h+n*l*c+i*r*u-i*a*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=h*a-l*u,f=l*c-h*r,p=u*r-a*c,m=t*d+n*f+i*p;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return e[0]=d*v,e[1]=(i*u-h*n)*v,e[2]=(l*n-i*a)*v,e[3]=f*v,e[4]=(h*t-i*c)*v,e[5]=(i*r-l*t)*v,e[6]=p*v,e[7]=(n*c-u*t)*v,e[8]=(a*t-n*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,l){const c=Math.cos(r),u=Math.sin(r);return this.set(n*c,n*u,-n*(c*a+u*l)+a+e,-i*u,i*c,-i*(-u*a+c*l)+l+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],l=i[6],c=i[1],u=i[4],h=i[7];return i[0]=t*r+n*c,i[3]=t*a+n*u,i[6]=t*l+n*h,i[1]=-n*r+t*c,i[4]=-n*a+t*u,i[7]=-n*l+t*h,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let mr;gn.prototype.isMatrix3=!0;class gr{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===mr&&(mr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),mr.width=e.width,mr.height=e.height;const n=mr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=mr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Kd=0;class _n extends Si{constructor(e=_n.DEFAULT_IMAGE,t=_n.DEFAULT_MAPPING,n=un,i=un,r=Qt,a=1008,l=Nn,c=cr,u=1,h=Un){super(),Object.defineProperty(this,"id",{value:Kd++}),this.uuid=Hn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Ie(0,0),this.repeat=new Ie(1,1),this.center=new Ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Hn()),!t&&void 0===e.images[i.uuid]){let r;if(Array.isArray(i)){r=[];for(let a=0,l=i.length;a<l;a++)r.push(ha(i[a].isDataTexture?i[a].image:i[a]))}else r=ha(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case un:e.x=e.x<0?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case un:e.y=e.y<0?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function ha(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?gr.getDataURL(s):s.data?{data:Array.prototype.slice.call(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}_n.DEFAULT_IMAGE=void 0,_n.DEFAULT_MAPPING=300,_n.prototype.isTexture=!0;class Zt{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const c=e.elements,u=c[0],h=c[4],d=c[8],f=c[1],p=c[5],m=c[9],v=c[2],y=c[6],_=c[10];if(Math.abs(h-f)<.01&&Math.abs(d-v)<.01&&Math.abs(m-y)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+v)<.1&&Math.abs(m+y)<.1&&Math.abs(u+p+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(u+1)/2,M=(p+1)/2,A=(_+1)/2,B=(h+f)/4,S=(d+v)/4,V=(m+y)/4;return b>M&&b>A?b<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(b),i=B/n,r=S/n):M>A?M<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(M),n=B/i,r=V/i):A<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(A),n=S/r,i=V/r),this.set(n,i,r,t),this}let g=Math.sqrt((y-m)*(y-m)+(d-v)*(d-v)+(f-h)*(f-h));return Math.abs(g)<.001&&(g=1),this.x=(y-m)/g,this.y=(d-v)/g,this.z=(f-h)/g,this.w=Math.acos((u+p+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Zt.prototype.isVector4=!0;class ri extends Si{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Zt(0,0,e,t),this.scissorTest=!1,this.viewport=new Zt(0,0,e,t),this.texture=new _n(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Qt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}ri.prototype.isWebGLRenderTarget=!0,class ef extends ri{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class Kl extends ri{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Kl.prototype.isWebGLMultisampleRenderTarget=!0;class vn{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,a,l){let c=n[i+0],u=n[i+1],h=n[i+2],d=n[i+3];const f=r[a+0],p=r[a+1],m=r[a+2],v=r[a+3];if(0===l)return e[t+0]=c,e[t+1]=u,e[t+2]=h,void(e[t+3]=d);if(1===l)return e[t+0]=f,e[t+1]=p,e[t+2]=m,void(e[t+3]=v);if(d!==v||c!==f||u!==p||h!==m){let y=1-l;const _=c*f+u*p+h*m+d*v,g=_>=0?1:-1,b=1-_*_;if(b>Number.EPSILON){const A=Math.sqrt(b),B=Math.atan2(A,_*g);y=Math.sin(y*B)/A,l=Math.sin(l*B)/A}const M=l*g;if(c=c*y+f*M,u=u*y+p*M,h=h*y+m*M,d=d*y+v*M,y===1-l){const A=1/Math.sqrt(c*c+u*u+h*h+d*d);c*=A,u*=A,h*=A,d*=A}}e[t]=c,e[t+1]=u,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,i,r,a){const l=n[i],c=n[i+1],u=n[i+2],h=n[i+3],d=r[a],f=r[a+1],p=r[a+2],m=r[a+3];return e[t]=l*m+h*d+c*p-u*f,e[t+1]=c*m+h*f+u*d-l*p,e[t+2]=u*m+h*p+l*f-c*d,e[t+3]=h*m-l*d-c*f-u*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,a=e._order,l=Math.cos,c=Math.sin,u=l(n/2),h=l(i/2),d=l(r/2),f=c(n/2),p=c(i/2),m=c(r/2);switch(a){case"XYZ":this._x=f*h*d+u*p*m,this._y=u*p*d-f*h*m,this._z=u*h*m+f*p*d,this._w=u*h*d-f*p*m;break;case"YXZ":this._x=f*h*d+u*p*m,this._y=u*p*d-f*h*m,this._z=u*h*m-f*p*d,this._w=u*h*d+f*p*m;break;case"ZXY":this._x=f*h*d-u*p*m,this._y=u*p*d+f*h*m,this._z=u*h*m+f*p*d,this._w=u*h*d-f*p*m;break;case"ZYX":this._x=f*h*d-u*p*m,this._y=u*p*d+f*h*m,this._z=u*h*m-f*p*d,this._w=u*h*d+f*p*m;break;case"YZX":this._x=f*h*d+u*p*m,this._y=u*p*d+f*h*m,this._z=u*h*m-f*p*d,this._w=u*h*d-f*p*m;break;case"XZY":this._x=f*h*d-u*p*m,this._y=u*p*d-f*h*m,this._z=u*h*m+f*p*d,this._w=u*h*d+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],l=t[5],c=t[9],u=t[2],h=t[6],d=t[10],f=n+l+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-c)*p,this._y=(r-u)*p,this._z=(a-i)*p}else if(n>l&&n>d){const p=2*Math.sqrt(1+n-l-d);this._w=(h-c)/p,this._x=.25*p,this._y=(i+a)/p,this._z=(r+u)/p}else if(l>d){const p=2*Math.sqrt(1+l-n-d);this._w=(r-u)/p,this._x=(i+a)/p,this._y=.25*p,this._z=(c+h)/p}else{const p=2*Math.sqrt(1+d-n-l);this._w=(a-i)/p,this._x=(r+u)/p,this._y=(c+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(bn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,l=t._x,c=t._y,u=t._z,h=t._w;return this._x=n*h+a*l+i*u-r*c,this._y=i*h+a*c+r*l-n*u,this._z=r*h+a*u+n*c-i*l,this._w=a*h-n*l-i*c-r*u,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let l=a*e._w+n*e._x+i*e._y+r*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const c=1-l*l;if(c<=Number.EPSILON){const p=1-t;return this._w=p*a+t*this._w,this._x=p*n+t*this._x,this._y=p*i+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(c),h=Math.atan2(u,l),d=Math.sin((1-t)*h)/u,f=Math.sin(t*h)/u;return this._w=a*d+this._w*f,this._x=n*d+this._x*f,this._y=i*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}vn.prototype.isQuaternion=!0;class P{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ec.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ec.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,l=e.z,c=e.w,u=c*t+a*i-l*n,h=c*n+l*t-r*i,d=c*i+r*n-a*t,f=-r*t-a*n-l*i;return this.x=u*c+f*-r+h*-l-d*-a,this.y=h*c+f*-a+d*-r-u*-l,this.z=d*c+f*-l+u*-a-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,l=t.y,c=t.z;return this.x=i*c-r*l,this.y=r*a-n*c,this.z=n*l-i*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return da.copy(this).projectOnVector(e),this.sub(da)}reflect(e){return this.sub(da.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(bn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}P.prototype.isVector3=!0;const da=new P,ec=new vn;class Pn{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,l=-1/0;for(let c=0,u=e.length;c<u;c+=3){const h=e[c],d=e[c+1],f=e[c+2];h<t&&(t=h),d<n&&(n=d),f<i&&(i=f),h>r&&(r=h),d>a&&(a=d),f>l&&(l=f)}return this.min.set(t,n,i),this.max.set(r,a,l),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,l=-1/0;for(let c=0,u=e.count;c<u;c++){const h=e.getX(c),d=e.getY(c),f=e.getZ(c);h<t&&(t=h),d<n&&(n=d),f<i&&(i=f),h>r&&(r=h),d>a&&(a=d),f>l&&(l=f)}return this.min.set(t,n,i),this.max.set(r,a,l),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ss.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),fa.copy(t.boundingBox),fa.applyMatrix4(e.matrixWorld),this.union(fa));const n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ss),ss.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(os),Gs.subVectors(this.max,os),_r.subVectors(e.a,os),vr.subVectors(e.b,os),yr.subVectors(e.c,os),Ti.subVectors(vr,_r),Ai.subVectors(yr,vr),qi.subVectors(_r,yr);let t=[0,-Ti.z,Ti.y,0,-Ai.z,Ai.y,0,-qi.z,qi.y,Ti.z,0,-Ti.x,Ai.z,0,-Ai.x,qi.z,0,-qi.x,-Ti.y,Ti.x,0,-Ai.y,Ai.x,0,-qi.y,qi.x,0];return!(!pa(t,_r,vr,yr,Gs)||(t=[1,0,0,0,1,0,0,0,1],!pa(t,_r,vr,yr,Gs)))&&(Vs.crossVectors(Ti,Ai),t=[Vs.x,Vs.y,Vs.z],pa(t,_r,vr,yr,Gs))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ss.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ss).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(di[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),di[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),di[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),di[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),di[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),di[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),di[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),di[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(di)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Pn.prototype.isBox3=!0;const di=[new P,new P,new P,new P,new P,new P,new P,new P],ss=new P,fa=new Pn,_r=new P,vr=new P,yr=new P,Ti=new P,Ai=new P,qi=new P,os=new P,Gs=new P,Vs=new P,Ji=new P;function pa(s,e,t,n,i){for(let r=0,a=s.length-3;r<=a;r+=3){Ji.fromArray(s,r);const l=i.x*Math.abs(Ji.x)+i.y*Math.abs(Ji.y)+i.z*Math.abs(Ji.z),c=e.dot(Ji),u=t.dot(Ji),h=n.dot(Ji);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>l)return!1}return!0}const tf=new Pn,tc=new P,ma=new P,ga=new P;class Xi{constructor(e=new P,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):tf.setFromPoints(e).getCenter(n);let i=0;for(let r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){ga.subVectors(e,this.center);const t=ga.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(ga.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return ma.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(tc.copy(e.center).add(ma)),this.expandByPoint(tc.copy(e.center).sub(ma)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const fi=new P,_a=new P,Ws=new P,Ei=new P,va=new P,Zs=new P,ya=new P;class Yi{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,fi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=fi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(fi.copy(this.direction).multiplyScalar(t).add(this.origin),fi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){_a.copy(e).add(t).multiplyScalar(.5),Ws.copy(t).sub(e).normalize(),Ei.copy(this.origin).sub(_a);const r=.5*e.distanceTo(t),a=-this.direction.dot(Ws),l=Ei.dot(this.direction),c=-Ei.dot(Ws),u=Ei.lengthSq(),h=Math.abs(1-a*a);let d,f,p,m;if(h>0)if(d=a*c-l,f=a*l-c,m=r*h,d>=0)if(f>=-m)if(f<=m){const v=1/h;d*=v,f*=v,p=d*(d+a*f+2*l)+f*(a*d+f+2*c)+u}else f=r,d=Math.max(0,-(a*f+l)),p=-d*d+f*(f+2*c)+u;else f=-r,d=Math.max(0,-(a*f+l)),p=-d*d+f*(f+2*c)+u;else f<=-m?(d=Math.max(0,-(-a*r+l)),f=d>0?-r:Math.min(Math.max(-r,-c),r),p=-d*d+f*(f+2*c)+u):f<=m?(d=0,f=Math.min(Math.max(-r,-c),r),p=f*(f+2*c)+u):(d=Math.max(0,-(a*r+l)),f=d>0?r:Math.min(Math.max(-r,-c),r),p=-d*d+f*(f+2*c)+u);else f=a>0?-r:r,d=Math.max(0,-(a*f+l)),p=-d*d+f*(f+2*c)+u;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(Ws).multiplyScalar(f).add(_a),p}intersectSphere(e,t){fi.subVectors(e.center,this.origin);const n=fi.dot(this.direction),i=fi.dot(fi)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),l=n-a,c=n+a;return l<0&&c<0?null:this.at(l<0?c:l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,l,c;const u=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return u>=0?(n=(e.min.x-f.x)*u,i=(e.max.x-f.x)*u):(n=(e.max.x-f.x)*u,i=(e.min.x-f.x)*u),h>=0?(r=(e.min.y-f.y)*h,a=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,a=(e.min.y-f.y)*h),n>a||r>i||((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),d>=0?(l=(e.min.z-f.z)*d,c=(e.max.z-f.z)*d):(l=(e.max.z-f.z)*d,c=(e.min.z-f.z)*d),n>c||l>i)||((l>n||n!=n)&&(n=l),(c<i||i!=i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return null!==this.intersectBox(e,fi)}intersectTriangle(e,t,n,i,r){va.subVectors(t,e),Zs.subVectors(n,e),ya.crossVectors(va,Zs);let l,a=this.direction.dot(ya);if(a>0){if(i)return null;l=1}else{if(!(a<0))return null;l=-1,a=-a}Ei.subVectors(this.origin,e);const c=l*this.direction.dot(Zs.crossVectors(Ei,Zs));if(c<0)return null;const u=l*this.direction.dot(va.cross(Ei));if(u<0||c+u>a)return null;const h=-l*Ei.dot(ya);return h<0?null:this.at(h/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class dt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,a,l,c,u,h,d,f,p,m,v,y){const _=this.elements;return _[0]=e,_[4]=t,_[8]=n,_[12]=i,_[1]=r,_[5]=a,_[9]=l,_[13]=c,_[2]=u,_[6]=h,_[10]=d,_[14]=f,_[3]=p,_[7]=m,_[11]=v,_[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new dt).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/xr.setFromMatrixColumn(e,0).length(),r=1/xr.setFromMatrixColumn(e,1).length(),a=1/xr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i),h=Math.cos(r),d=Math.sin(r);if("XYZ"===e.order){const f=a*h,p=a*d,m=l*h,v=l*d;t[0]=c*h,t[4]=-c*d,t[8]=u,t[1]=p+m*u,t[5]=f-v*u,t[9]=-l*c,t[2]=v-f*u,t[6]=m+p*u,t[10]=a*c}else if("YXZ"===e.order){const f=c*h,p=c*d,m=u*h,v=u*d;t[0]=f+v*l,t[4]=m*l-p,t[8]=a*u,t[1]=a*d,t[5]=a*h,t[9]=-l,t[2]=p*l-m,t[6]=v+f*l,t[10]=a*c}else if("ZXY"===e.order){const f=c*h,p=c*d,m=u*h,v=u*d;t[0]=f-v*l,t[4]=-a*d,t[8]=m+p*l,t[1]=p+m*l,t[5]=a*h,t[9]=v-f*l,t[2]=-a*u,t[6]=l,t[10]=a*c}else if("ZYX"===e.order){const f=a*h,p=a*d,m=l*h,v=l*d;t[0]=c*h,t[4]=m*u-p,t[8]=f*u+v,t[1]=c*d,t[5]=v*u+f,t[9]=p*u-m,t[2]=-u,t[6]=l*c,t[10]=a*c}else if("YZX"===e.order){const f=a*c,p=a*u,m=l*c,v=l*u;t[0]=c*h,t[4]=v-f*d,t[8]=m*d+p,t[1]=d,t[5]=a*h,t[9]=-l*h,t[2]=-u*h,t[6]=p*d+m,t[10]=f-v*d}else if("XZY"===e.order){const f=a*c,p=a*u,m=l*c,v=l*u;t[0]=c*h,t[4]=-d,t[8]=u*h,t[1]=f*d+v,t[5]=a*h,t[9]=p*d-m,t[2]=m*d-p,t[6]=l*h,t[10]=v*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nf,e,rf)}lookAt(e,t,n){const i=this.elements;return Gn.subVectors(e,t),0===Gn.lengthSq()&&(Gn.z=1),Gn.normalize(),Ci.crossVectors(n,Gn),0===Ci.lengthSq()&&(1===Math.abs(n.z)?Gn.x+=1e-4:Gn.z+=1e-4,Gn.normalize(),Ci.crossVectors(n,Gn)),Ci.normalize(),qs.crossVectors(Gn,Ci),i[0]=Ci.x,i[4]=qs.x,i[8]=Gn.x,i[1]=Ci.y,i[5]=qs.y,i[9]=Gn.y,i[2]=Ci.z,i[6]=qs.z,i[10]=Gn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],l=n[4],c=n[8],u=n[12],h=n[1],d=n[5],f=n[9],p=n[13],m=n[2],v=n[6],y=n[10],_=n[14],g=n[3],b=n[7],M=n[11],A=n[15],B=i[0],S=i[4],V=i[8],ae=i[12],K=i[1],J=i[5],Ae=i[9],le=i[13],ce=i[2],_e=i[6],fe=i[10],we=i[14],Ve=i[3],at=i[7],ut=i[11],$e=i[15];return r[0]=a*B+l*K+c*ce+u*Ve,r[4]=a*S+l*J+c*_e+u*at,r[8]=a*V+l*Ae+c*fe+u*ut,r[12]=a*ae+l*le+c*we+u*$e,r[1]=h*B+d*K+f*ce+p*Ve,r[5]=h*S+d*J+f*_e+p*at,r[9]=h*V+d*Ae+f*fe+p*ut,r[13]=h*ae+d*le+f*we+p*$e,r[2]=m*B+v*K+y*ce+_*Ve,r[6]=m*S+v*J+y*_e+_*at,r[10]=m*V+v*Ae+y*fe+_*ut,r[14]=m*ae+v*le+y*we+_*$e,r[3]=g*B+b*K+M*ce+A*Ve,r[7]=g*S+b*J+M*_e+A*at,r[11]=g*V+b*Ae+M*fe+A*ut,r[15]=g*ae+b*le+M*we+A*$e,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],l=e[5],c=e[9],u=e[13],h=e[2],d=e[6],f=e[10],p=e[14];return e[3]*(+r*c*d-i*u*d-r*l*f+n*u*f+i*l*p-n*c*p)+e[7]*(+t*c*p-t*u*f+r*a*f-i*a*p+i*u*h-r*c*h)+e[11]*(+t*u*d-t*l*p-r*a*d+n*a*p+r*l*h-n*u*h)+e[15]*(-i*l*h-t*c*d+t*l*f+i*a*d-n*a*f+n*c*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],y=e[14],_=e[15],g=d*y*u-v*f*u+v*c*p-l*y*p-d*c*_+l*f*_,b=m*f*u-h*y*u-m*c*p+a*y*p+h*c*_-a*f*_,M=h*v*u-m*d*u+m*l*p-a*v*p-h*l*_+a*d*_,A=m*d*c-h*v*c-m*l*f+a*v*f+h*l*y-a*d*y,B=t*g+n*b+i*M+r*A;if(0===B)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/B;return e[0]=g*S,e[1]=(v*f*r-d*y*r-v*i*p+n*y*p+d*i*_-n*f*_)*S,e[2]=(l*y*r-v*c*r+v*i*u-n*y*u-l*i*_+n*c*_)*S,e[3]=(d*c*r-l*f*r-d*i*u+n*f*u+l*i*p-n*c*p)*S,e[4]=b*S,e[5]=(h*y*r-m*f*r+m*i*p-t*y*p-h*i*_+t*f*_)*S,e[6]=(m*c*r-a*y*r-m*i*u+t*y*u+a*i*_-t*c*_)*S,e[7]=(a*f*r-h*c*r+h*i*u-t*f*u-a*i*p+t*c*p)*S,e[8]=M*S,e[9]=(m*d*r-h*v*r-m*n*p+t*v*p+h*n*_-t*d*_)*S,e[10]=(a*v*r-m*l*r+m*n*u-t*v*u-a*n*_+t*l*_)*S,e[11]=(h*l*r-a*d*r-h*n*u+t*d*u+a*n*p-t*l*p)*S,e[12]=A*S,e[13]=(h*v*i-m*d*i+m*n*f-t*v*f-h*n*y+t*d*y)*S,e[14]=(m*l*i-a*v*i-m*n*c+t*v*c+a*n*y-t*l*y)*S,e[15]=(a*d*i-h*l*i+h*n*c-t*d*c-a*n*f+t*l*f)*S,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,l=e.y,c=e.z,u=r*a,h=r*l;return this.set(u*a+n,u*l-i*c,u*c+i*l,0,u*l+i*c,h*l+n,h*c-i*a,0,u*c-i*l,h*c+i*a,r*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,l=t._z,c=t._w,u=r+r,h=a+a,d=l+l,f=r*u,p=r*h,m=r*d,v=a*h,y=a*d,_=l*d,g=c*u,b=c*h,M=c*d,A=n.x,B=n.y,S=n.z;return i[0]=(1-(v+_))*A,i[1]=(p+M)*A,i[2]=(m-b)*A,i[3]=0,i[4]=(p-M)*B,i[5]=(1-(f+_))*B,i[6]=(y+g)*B,i[7]=0,i[8]=(m+b)*S,i[9]=(y-g)*S,i[10]=(1-(f+v))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=xr.set(i[0],i[1],i[2]).length();const a=xr.set(i[4],i[5],i[6]).length(),l=xr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Qn.copy(this);const u=1/r,h=1/a,d=1/l;return Qn.elements[0]*=u,Qn.elements[1]*=u,Qn.elements[2]*=u,Qn.elements[4]*=h,Qn.elements[5]*=h,Qn.elements[6]*=h,Qn.elements[8]*=d,Qn.elements[9]*=d,Qn.elements[10]*=d,t.setFromRotationMatrix(Qn),n.x=r,n.y=a,n.z=l,this}makePerspective(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const l=this.elements,u=2*r/(n-i),h=(t+e)/(t-e),d=(n+i)/(n-i),f=-(a+r)/(a-r),p=-2*a*r/(a-r);return l[0]=2*r/(t-e),l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,a){const l=this.elements,c=1/(t-e),u=1/(n-i),h=1/(a-r),d=(t+e)*c,f=(n+i)*u,p=(a+r)*h;return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=-2*h,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}dt.prototype.isMatrix4=!0;const xr=new P,Qn=new dt,nf=new P(0,0,0),rf=new P(1,1,1),Ci=new P,qs=new P,Gn=new P,nc=new dt,ic=new vn;class wr{constructor(e=0,t=0,n=0,i=wr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],l=i[8],c=i[1],u=i[5],h=i[9],d=i[2],f=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(bn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-bn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(bn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-bn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(bn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-bn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return nc.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nc,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ic.setFromEuler(this),this.setFromQuaternion(ic,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new P(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}wr.prototype.isEuler=!0,wr.DefaultOrder="XYZ",wr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class rc{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let sf=0;const sc=new P,br=new vn,pi=new dt,Js=new P,as=new P,of=new P,af=new vn,oc=new P(1,0,0),ac=new P(0,1,0),lc=new P(0,0,1),lf={type:"added"},cc={type:"removed"};class Ht extends Si{constructor(){super(),Object.defineProperty(this,"id",{value:sf++}),this.uuid=Hn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ht.DefaultUp.clone();const e=new P,t=new wr,n=new vn,i=new P(1,1,1);t._onChange(function r(){n.setFromEuler(t,!1)}),n._onChange(function a(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new dt},normalMatrix:{value:new gn}}),this.matrix=new dt,this.matrixWorld=new dt,this.matrixAutoUpdate=Ht.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new rc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return br.setFromAxisAngle(e,t),this.quaternion.multiply(br),this}rotateOnWorldAxis(e,t){return br.setFromAxisAngle(e,t),this.quaternion.premultiply(br),this}rotateX(e){return this.rotateOnAxis(oc,e)}rotateY(e){return this.rotateOnAxis(ac,e)}rotateZ(e){return this.rotateOnAxis(lc,e)}translateOnAxis(e,t){return sc.copy(e).applyQuaternion(this.quaternion),this.position.add(sc.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(oc,e)}translateY(e){return this.translateOnAxis(ac,e)}translateZ(e){return this.translateOnAxis(lc,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(pi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Js.copy(e):Js.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),as.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pi.lookAt(as,Js,this.up):pi.lookAt(Js,as,this.up),this.quaternion.setFromRotationMatrix(pi),i&&(pi.extractRotation(i.matrixWorld),br.setFromRotationMatrix(pi),this.quaternion.premultiply(br.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(lf)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(cc)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(cc)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),pi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),pi.multiply(e.parent.matrixWorld)),e.applyMatrix4(pi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(as,e,of),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(as,af,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(l,c){return void 0===l[c.uuid]&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const c=l.shapes;if(Array.isArray(c))for(let u=0,h=c.length;u<h;u++)r(e.shapes,c[u]);else r(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(r(e.materials,this.material[c]));i.material=l}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++)i.animations.push(r(e.animations,this.animations[l]))}if(t){const l=a(e.geometries),c=a(e.materials),u=a(e.textures),h=a(e.images),d=a(e.shapes),f=a(e.skeletons),p=a(e.animations);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),h.length>0&&(n.images=h),d.length>0&&(n.shapes=d),f.length>0&&(n.skeletons=f),p.length>0&&(n.animations=p)}return n.object=i,n;function a(l){const c=[];for(const u in l){const h=l[u];delete h.metadata,c.push(h)}return c}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++)this.add(e.children[n].clone());return this}}Ht.DefaultUp=new P(0,1,0),Ht.DefaultMatrixAutoUpdate=!0,Ht.prototype.isObject3D=!0;const $n=new P,mi=new P,xa=new P,gi=new P,Mr=new P,Sr=new P,uc=new P,wa=new P,ba=new P,Ma=new P;class hn{constructor(e=new P,t=new P,n=new P){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),$n.subVectors(e,t),i.cross($n);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){$n.subVectors(i,t),mi.subVectors(n,t),xa.subVectors(e,t);const a=$n.dot($n),l=$n.dot(mi),c=$n.dot(xa),u=mi.dot(mi),h=mi.dot(xa),d=a*u-l*l;if(0===d)return r.set(-2,-1,-1);const f=1/d,p=(u*c-l*h)*f,m=(a*h-l*c)*f;return r.set(1-p-m,m,p)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,gi),gi.x>=0&&gi.y>=0&&gi.x+gi.y<=1}static getUV(e,t,n,i,r,a,l,c){return this.getBarycoord(e,t,n,i,gi),c.set(0,0),c.addScaledVector(r,gi.x),c.addScaledVector(a,gi.y),c.addScaledVector(l,gi.z),c}static isFrontFacing(e,t,n,i){return $n.subVectors(n,t),mi.subVectors(e,t),$n.cross(mi).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $n.subVectors(this.c,this.b),mi.subVectors(this.a,this.b),.5*$n.cross(mi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return hn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return hn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return hn.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return hn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return hn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,l;Mr.subVectors(i,n),Sr.subVectors(r,n),wa.subVectors(e,n);const c=Mr.dot(wa),u=Sr.dot(wa);if(c<=0&&u<=0)return t.copy(n);ba.subVectors(e,i);const h=Mr.dot(ba),d=Sr.dot(ba);if(h>=0&&d<=h)return t.copy(i);const f=c*d-h*u;if(f<=0&&c>=0&&h<=0)return a=c/(c-h),t.copy(n).addScaledVector(Mr,a);Ma.subVectors(e,r);const p=Mr.dot(Ma),m=Sr.dot(Ma);if(m>=0&&p<=m)return t.copy(r);const v=p*u-c*m;if(v<=0&&u>=0&&m<=0)return l=u/(u-m),t.copy(n).addScaledVector(Sr,l);const y=h*m-p*d;if(y<=0&&d-h>=0&&p-m>=0)return uc.subVectors(r,i),l=(d-h)/(d-h+(p-m)),t.copy(i).addScaledVector(uc,l);const _=1/(y+v+f);return a=v*_,l=f*_,t.copy(n).addScaledVector(Mr,a).addScaledVector(Sr,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let cf=0;class Mn extends Si{constructor(){super(),Object.defineProperty(this,"id",{value:cf++}),this.uuid=Hn(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=Nn,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=w,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(r){const a=[];for(const l in r){const c=r[l];delete c.metadata,a.push(c)}return a}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Nn&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Mn.prototype.isMaterial=!0;const hc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Kn={h:0,s:0,l:0},Xs={h:0,s:0,l:0};function Sa(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+6*(e-s)*t:t<.5?e:t<2/3?s+6*(e-s)*(2/3-t):s}function Ta(s){return s<.04045?.0773993808*s:Math.pow(.9478672986*s+.0521327014,2.4)}function Aa(s){return s<.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}let Ke=(()=>{class s{constructor(t,n,i){return void 0===n&&void 0===i?this.set(t):this.setRGB(t,n,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,n,i){return this.r=t,this.g=n,this.b=i,this}setHSL(t,n,i){if(t=function ca(s,e){return(s%e+e)%e}(t,1),n=bn(n,0,1),i=bn(i,0,1),0===n)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+n):i+n-i*n,a=2*i-r;this.r=Sa(a,r,t+1/3),this.g=Sa(a,r,t),this.b=Sa(a,r,t-1/3)}return this}setStyle(t){function n(r){void 0!==r&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let r;const l=i[2];switch(i[1]){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const c=parseFloat(r[1])/360,u=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return n(r[4]),this.setHSL(c,u,h)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=i[1],a=r.length;if(3===a)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(6===a)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const n=hc[t.toLowerCase()];return void 0!==n?this.setHex(n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,n=2){return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}copyLinearToGamma(t,n=2){const i=n>0?1/n:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Ta(t.r),this.g=Ta(t.g),this.b=Ta(t.b),this}copyLinearToSRGB(t){return this.r=Aa(t.r),this.g=Aa(t.g),this.b=Aa(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const n=this.r,i=this.g,r=this.b,a=Math.max(n,i,r),l=Math.min(n,i,r);let c,u;const h=(l+a)/2;if(l===a)c=0,u=0;else{const d=a-l;switch(u=h<=.5?d/(a+l):d/(2-a-l),a){case n:c=(i-r)/d+(i<r?6:0);break;case i:c=(r-n)/d+2;break;case r:c=(n-i)/d+4}c/=6}return t.h=c,t.s=u,t.l=h,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,n,i){return this.getHSL(Kn),Kn.h+=t,Kn.s+=n,Kn.l+=i,this.setHSL(Kn.h,Kn.s,Kn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,i){return this.r=t.r+(n.r-t.r)*i,this.g=t.g+(n.g-t.g)*i,this.b=t.b+(n.b-t.b)*i,this}lerpHSL(t,n){this.getHSL(Kn),t.getHSL(Xs);const i=rs(Kn.h,Xs.h,n),r=rs(Kn.s,Xs.s,n),a=rs(Kn.l,Xs.l,n);return this.setHSL(i,r,a),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return s.NAMES=hc,s})();Ke.prototype.isColor=!0,Ke.prototype.r=1,Ke.prototype.g=1,Ke.prototype.b=1;class Pi extends Mn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ke(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Pi.prototype.isMeshBasicMaterial=!0;const Yt=new P,Ys=new Ie;class Vt{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=ts,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Ke),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Ie),t[n++]=a.x,t[n++]=a.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new P),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Zt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ys.fromBufferAttribute(this,t),Ys.applyMatrix3(e),this.setXY(t,Ys.x,Ys.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Yt.fromBufferAttribute(this,t),Yt.applyMatrix3(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Yt.x=this.getX(t),Yt.y=this.getY(t),Yt.z=this.getZ(t),Yt.applyMatrix4(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Yt.x=this.getX(t),Yt.y=this.getY(t),Yt.z=this.getZ(t),Yt.applyNormalMatrix(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Yt.x=this.getX(t),Yt.y=this.getY(t),Yt.z=this.getZ(t),Yt.transformDirection(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ts&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}Vt.prototype.isBufferAttribute=!0;class Ea extends Vt{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Ca extends Vt{constructor(e,t,n){super(new Uint32Array(e),t,n)}}(class mf extends Vt{constructor(e,t,n){super(new Uint16Array(e),t,n)}}).prototype.isFloat16BufferAttribute=!0;class ct extends Vt{constructor(e,t,n){super(new Float32Array(e),t,n)}}function dc(s){if(0===s.length)return-1/0;let e=s[0];for(let t=1,n=s.length;t<n;++t)s[t]>e&&(e=s[t]);return e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let vf=0;const Zn=new dt,Pa=new Ht,Ar=new P,Vn=new Pn,ls=new Pn,yn=new P;class xt extends Si{constructor(){super(),Object.defineProperty(this,"id",{value:vf++}),this.uuid=Hn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(dc(e)>65535?Ca:Ea)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const r=(new gn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zn.makeRotationFromQuaternion(e),this.applyMatrix4(Zn),this}rotateX(e){return Zn.makeRotationX(e),this.applyMatrix4(Zn),this}rotateY(e){return Zn.makeRotationY(e),this.applyMatrix4(Zn),this}rotateZ(e){return Zn.makeRotationZ(e),this.applyMatrix4(Zn),this}translate(e,t,n){return Zn.makeTranslation(e,t,n),this.applyMatrix4(Zn),this}scale(e,t,n){return Zn.makeScale(e,t,n),this.applyMatrix4(Zn),this}lookAt(e){return Pa.lookAt(e),Pa.updateMatrix(),this.applyMatrix4(Pa.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ar).negate(),this.translate(Ar.x,Ar.y,Ar.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ct(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Pn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++)Vn.setFromBufferAttribute(t[n]),this.morphTargetsRelative?(yn.addVectors(this.boundingBox.min,Vn.min),this.boundingBox.expandByPoint(yn),yn.addVectors(this.boundingBox.max,Vn.max),this.boundingBox.expandByPoint(yn)):(this.boundingBox.expandByPoint(Vn.min),this.boundingBox.expandByPoint(Vn.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Xi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new P,1/0);if(e){const n=this.boundingSphere.center;if(Vn.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++)ls.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(yn.addVectors(Vn.min,ls.min),Vn.expandByPoint(yn),yn.addVectors(Vn.max,ls.max),Vn.expandByPoint(yn)):(Vn.expandByPoint(ls.min),Vn.expandByPoint(ls.max));Vn.getCenter(n);let i=0;for(let r=0,a=e.count;r<a;r++)yn.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(yn));if(t)for(let r=0,a=t.length;r<a;r++){const l=t[r],c=this.morphTargetsRelative;for(let u=0,h=l.count;u<h;u++)yn.fromBufferAttribute(l,u),c&&(Ar.fromBufferAttribute(e,u),yn.add(Ar)),i=Math.max(i,n.distanceToSquared(yn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,l=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Vt(new Float32Array(4*l),4));const c=t.tangent.array,u=[],h=[];for(let K=0;K<l;K++)u[K]=new P,h[K]=new P;const d=new P,f=new P,p=new P,m=new Ie,v=new Ie,y=new Ie,_=new P,g=new P;function b(K,J,Ae){d.fromArray(i,3*K),f.fromArray(i,3*J),p.fromArray(i,3*Ae),m.fromArray(a,2*K),v.fromArray(a,2*J),y.fromArray(a,2*Ae),f.sub(d),p.sub(d),v.sub(m),y.sub(m);const le=1/(v.x*y.y-y.x*v.y);!isFinite(le)||(_.copy(f).multiplyScalar(y.y).addScaledVector(p,-v.y).multiplyScalar(le),g.copy(p).multiplyScalar(v.x).addScaledVector(f,-y.x).multiplyScalar(le),u[K].add(_),u[J].add(_),u[Ae].add(_),h[K].add(g),h[J].add(g),h[Ae].add(g))}let M=this.groups;0===M.length&&(M=[{start:0,count:n.length}]);for(let K=0,J=M.length;K<J;++K){const Ae=M[K],le=Ae.start;for(let _e=le,fe=le+Ae.count;_e<fe;_e+=3)b(n[_e+0],n[_e+1],n[_e+2])}const A=new P,B=new P,S=new P,V=new P;function ae(K){S.fromArray(r,3*K),V.copy(S);const J=u[K];A.copy(J),A.sub(S.multiplyScalar(S.dot(J))).normalize(),B.crossVectors(V,J);const le=B.dot(h[K])<0?-1:1;c[4*K]=A.x,c[4*K+1]=A.y,c[4*K+2]=A.z,c[4*K+3]=le}for(let K=0,J=M.length;K<J;++K){const Ae=M[K],le=Ae.start;for(let _e=le,fe=le+Ae.count;_e<fe;_e+=3)ae(n[_e+0]),ae(n[_e+1]),ae(n[_e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Vt(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let f=0,p=n.count;f<p;f++)n.setXYZ(f,0,0,0);const i=new P,r=new P,a=new P,l=new P,c=new P,u=new P,h=new P,d=new P;if(e)for(let f=0,p=e.count;f<p;f+=3){const m=e.getX(f+0),v=e.getX(f+1),y=e.getX(f+2);i.fromBufferAttribute(t,m),r.fromBufferAttribute(t,v),a.fromBufferAttribute(t,y),h.subVectors(a,r),d.subVectors(i,r),h.cross(d),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,v),u.fromBufferAttribute(n,y),l.add(h),c.add(h),u.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z),n.setXYZ(y,u.x,u.y,u.z)}else for(let f=0,p=t.count;f<p;f+=3)i.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),h.subVectors(a,r),d.subVectors(i,r),h.cross(d),n.setXYZ(f+0,h.x,h.y,h.z),n.setXYZ(f+1,h.x,h.y,h.z),n.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const a=n[i].array,l=e.attributes[i],c=l.array,u=l.itemSize*t,h=Math.min(c.length,a.length-u);for(let d=0,f=u;d<h;d++,f++)a[f]=c[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)yn.fromBufferAttribute(e,t),yn.normalize(),e.setXYZ(t,yn.x,yn.y,yn.z)}toNonIndexed(){function e(l,c){const u=l.array,h=l.itemSize,d=l.normalized,f=new u.constructor(c.length*h);let p=0,m=0;for(let v=0,y=c.length;v<y;v++){p=l.isInterleavedBufferAttribute?c[v]*l.data.stride+l.offset:c[v]*h;for(let _=0;_<h;_++)f[m++]=u[p++]}return new Vt(f,h,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new xt,n=this.index.array,i=this.attributes;for(const l in i){const u=e(i[l],n);t.setAttribute(l,u)}const r=this.morphAttributes;for(const l in r){const c=[],u=r[l];for(let h=0,d=u.length;h<d;h++){const p=e(u[h],n);c.push(p)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const u=a[l];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const u in c)void 0!==c[u]&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n)e.data.attributes[c]=n[c].toJSON(e.data);const i={};let r=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],h=[];for(let d=0,f=u.length;d<f;d++)h.push(u[d].toJSON(e.data));h.length>0&&(i[c]=h,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return(new xt).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const u in i)this.setAttribute(u,i[u].clone(t));const r=e.morphAttributes;for(const u in r){const h=[],d=r[u];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,h=a.length;u<h;u++){const d=a[u];this.addGroup(d.start,d.count,d.materialIndex)}const l=e.boundingBox;null!==l&&(this.boundingBox=l.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}xt.prototype.isBufferGeometry=!0;const fc=new dt,Er=new Yi,La=new Xi,Li=new P,Ii=new P,Ri=new P,Ia=new P,Ra=new P,Oa=new P,js=new P,Qs=new P,$s=new P,Ks=new Ie,eo=new Ie,to=new Ie,Da=new P,no=new P;class $t extends Ht{constructor(e=new xt,t=new Pi){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i||(null===n.boundingSphere&&n.computeBoundingSphere(),La.copy(n.boundingSphere),La.applyMatrix4(r),!1===e.ray.intersectsSphere(La))||(fc.copy(r).invert(),Er.copy(e.ray).applyMatrix4(fc),null!==n.boundingBox&&!1===Er.intersectsBox(n.boundingBox)))return;let a;if(n.isBufferGeometry){const l=n.index,c=n.attributes.position,u=n.morphAttributes.position,h=n.morphTargetsRelative,d=n.attributes.uv,f=n.attributes.uv2,p=n.groups,m=n.drawRange;if(null!==l)if(Array.isArray(i))for(let v=0,y=p.length;v<y;v++){const _=p[v],g=i[_.materialIndex];for(let A=Math.max(_.start,m.start),B=Math.min(_.start+_.count,m.start+m.count);A<B;A+=3){const S=l.getX(A),V=l.getX(A+1),ae=l.getX(A+2);a=io(this,g,e,Er,c,u,h,d,f,S,V,ae),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=_.materialIndex,t.push(a))}}else for(let _=Math.max(0,m.start),g=Math.min(l.count,m.start+m.count);_<g;_+=3){const b=l.getX(_),M=l.getX(_+1),A=l.getX(_+2);a=io(this,i,e,Er,c,u,h,d,f,b,M,A),a&&(a.faceIndex=Math.floor(_/3),t.push(a))}else if(void 0!==c)if(Array.isArray(i))for(let v=0,y=p.length;v<y;v++){const _=p[v],g=i[_.materialIndex];for(let A=Math.max(_.start,m.start),B=Math.min(_.start+_.count,m.start+m.count);A<B;A+=3)a=io(this,g,e,Er,c,u,h,d,f,A,A+1,A+2),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=_.materialIndex,t.push(a))}else for(let _=Math.max(0,m.start),g=Math.min(c.count,m.start+m.count);_<g;_+=3)a=io(this,i,e,Er,c,u,h,d,f,_,_+1,_+2),a&&(a.faceIndex=Math.floor(_/3),t.push(a))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function io(s,e,t,n,i,r,a,l,c,u,h,d){Li.fromBufferAttribute(i,u),Ii.fromBufferAttribute(i,h),Ri.fromBufferAttribute(i,d);const f=s.morphTargetInfluences;if(r&&f){js.set(0,0,0),Qs.set(0,0,0),$s.set(0,0,0);for(let m=0,v=r.length;m<v;m++){const y=f[m],_=r[m];0!==y&&(Ia.fromBufferAttribute(_,u),Ra.fromBufferAttribute(_,h),Oa.fromBufferAttribute(_,d),a?(js.addScaledVector(Ia,y),Qs.addScaledVector(Ra,y),$s.addScaledVector(Oa,y)):(js.addScaledVector(Ia.sub(Li),y),Qs.addScaledVector(Ra.sub(Ii),y),$s.addScaledVector(Oa.sub(Ri),y)))}Li.add(js),Ii.add(Qs),Ri.add($s)}s.isSkinnedMesh&&(s.boneTransform(u,Li),s.boneTransform(h,Ii),s.boneTransform(d,Ri));const p=function yf(s,e,t,n,i,r,a,l){let c;if(c=1===e.side?n.intersectTriangle(a,r,i,!0,l):n.intersectTriangle(i,r,a,2!==e.side,l),null===c)return null;no.copy(l),no.applyMatrix4(s.matrixWorld);const u=t.ray.origin.distanceTo(no);return u<t.near||u>t.far?null:{distance:u,point:no.clone(),object:s}}(s,e,t,n,Li,Ii,Ri,Da);if(p){l&&(Ks.fromBufferAttribute(l,u),eo.fromBufferAttribute(l,h),to.fromBufferAttribute(l,d),p.uv=hn.getUV(Da,Li,Ii,Ri,Ks,eo,to,new Ie)),c&&(Ks.fromBufferAttribute(c,u),eo.fromBufferAttribute(c,h),to.fromBufferAttribute(c,d),p.uv2=hn.getUV(Da,Li,Ii,Ri,Ks,eo,to,new Ie));const m={a:u,b:h,c:d,normal:new P,materialIndex:0};hn.getNormal(Li,Ii,Ri,m.normal),p.face=m}return p}$t.prototype.isMesh=!0;class ji extends xt{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const l=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const c=[],u=[],h=[],d=[];let f=0,p=0;function m(v,y,_,g,b,M,A,B,S,V,ae){const K=M/S,J=A/V,Ae=M/2,le=A/2,ce=B/2,_e=S+1,fe=V+1;let we=0,Ve=0;const at=new P;for(let ut=0;ut<fe;ut++){const $e=ut*J-le;for(let wt=0;wt<_e;wt++)at[v]=(wt*K-Ae)*g,at[y]=$e*b,at[_]=ce,u.push(at.x,at.y,at.z),at[v]=0,at[y]=0,at[_]=B>0?1:-1,h.push(at.x,at.y,at.z),d.push(wt/S),d.push(1-ut/V),we+=1}for(let ut=0;ut<V;ut++)for(let $e=0;$e<S;$e++){const Oe=f+$e+_e*(ut+1),Je=f+($e+1)+_e*(ut+1),Xe=f+($e+1)+_e*ut;c.push(f+$e+_e*ut,Oe,Xe),c.push(Oe,Je,Xe),Ve+=6}l.addGroup(p,Ve,ae),p+=Ve,f+=we}m("z","y","x",-1,-1,n,t,e,a,r,0),m("z","y","x",1,-1,n,t,-e,a,r,1),m("x","z","y",1,1,e,n,t,i,a,2),m("x","z","y",1,-1,e,n,-t,i,a,3),m("x","y","z",1,-1,e,t,n,i,r,4),m("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(c),this.setAttribute("position",new ct(u,3)),this.setAttribute("normal",new ct(h,3)),this.setAttribute("uv",new ct(d,2))}static fromJSON(e){return new ji(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Cr(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const i=s[t][n];e[t][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.clone():Array.isArray(i)?i.slice():i}}return e}function Ln(s){const e={};for(let t=0;t<s.length;t++){const n=Cr(s[t]);for(const i in n)e[i]=n[i]}return e}const xf={clone:Cr,merge:Ln};class Oi extends Mn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Cr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;t.uniforms[i]=a&&a.isTexture?{type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?{type:"c",value:a.getHex()}:a&&a.isVector2?{type:"v2",value:a.toArray()}:a&&a.isVector3?{type:"v3",value:a.toArray()}:a&&a.isVector4?{type:"v4",value:a.toArray()}:a&&a.isMatrix3?{type:"m3",value:a.toArray()}:a&&a.isMatrix4?{type:"m4",value:a.toArray()}:{value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Oi.prototype.isShaderMaterial=!0;class ro extends Ht{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new dt,this.projectionMatrix=new dt,this.projectionMatrixInverse=new dt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}ro.prototype.isCamera=!0;class Sn extends ro{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*is*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Zi*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*is*Math.atan(Math.tan(.5*Zi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Zi*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const c=a.fullWidth,u=a.fullHeight;r+=a.offsetX*i/c,t-=a.offsetY*n/u,i*=a.width/c,n*=a.height/u}const l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Sn.prototype.isPerspectiveCamera=!0;class Fa extends Ht{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Sn(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new P(1,0,0)),this.add(i);const r=new Sn(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new P(-1,0,0)),this.add(r);const a=new Sn(90,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new P(0,1,0)),this.add(a);const l=new Sn(90,1,e,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new P(0,-1,0)),this.add(l);const c=new Sn(90,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new P(0,0,1)),this.add(c);const u=new Sn(90,1,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new P(0,0,-1)),this.add(u)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,a,l,c,u]=this.children,h=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,l),e.setRenderTarget(n,4),e.render(t,c),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(d),e.xr.enabled=h}}class cs extends _n{constructor(e,t,n,i,r,a,l,c,u,h){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,i,r,a,l=void 0!==l?l:Mi,c,u,h),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}cs.prototype.isCubeTexture=!0;class ka extends ri{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),this.texture=new cs(void 0,(t=t||{}).mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Qt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Nn,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n_uniforms={tEquirect:{value:null}},n_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new ji(5,5,5),r=new Oi({name:"CubemapFromEquirect",uniforms:Cr(n_uniforms),vertexShader:n_vertexShader,fragmentShader:n_fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const a=new $t(i,r),l=t.minFilter;return 1008===t.minFilter&&(t.minFilter=Qt),new Fa(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}ka.prototype.isWebGLCubeRenderTarget=!0;const za=new P,Mf=new P,Sf=new gn;class _i{constructor(e=new P(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=za.subVectors(n,t).cross(Mf.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(za),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Sf.getNormalMatrix(e),i=this.coplanarPoint(za).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}_i.prototype.isPlane=!0;const Ir=new Xi,so=new P;class us{constructor(e=new _i,t=new _i,n=new _i,i=new _i,r=new _i,a=new _i){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(i),l[4].copy(r),l[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],f=n[8],p=n[9],m=n[10],v=n[11],y=n[12],_=n[13],g=n[14],b=n[15];return t[0].setComponents(l-i,d-c,v-f,b-y).normalize(),t[1].setComponents(l+i,d+c,v+f,b+y).normalize(),t[2].setComponents(l+r,d+u,v+p,b+_).normalize(),t[3].setComponents(l-r,d-u,v-p,b-_).normalize(),t[4].setComponents(l-a,d-h,v-m,b-g).normalize(),t[5].setComponents(l+a,d+h,v+m,b+g).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ir.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ir)}intersectsSprite(e){return Ir.center.set(0,0,0),Ir.radius=.7071067811865476,Ir.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ir)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(so.x=i.normal.x>0?e.max.x:e.min.x,so.y=i.normal.y>0?e.max.y:e.min.y,so.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(so)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function pc(){let s=null,e=!1,t=null,n=null;function i(r,a){t(r,a),n=s.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==t&&(n=s.requestAnimationFrame(i),e=!0)},stop:function(){s.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function Tf(s,e){const t=e.isWebGL2,n=new WeakMap;return{get:function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)},remove:function l(u){u.isInterleavedBufferAttribute&&(u=u.data);const h=n.get(u);h&&(s.deleteBuffer(h.buffer),n.delete(u))},update:function c(u,h){if(u.isGLBufferAttribute){const f=n.get(u);return void((!f||f.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version}))}u.isInterleavedBufferAttribute&&(u=u.data);const d=n.get(u);void 0===d?n.set(u,function i(u,h){const d=u.array,f=u.usage,p=s.createBuffer();s.bindBuffer(h,p),s.bufferData(h,d,f),u.onUploadCallback();let m=5126;return d instanceof Float32Array?m=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?u.isFloat16BufferAttribute?t?m=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):m=5123:d instanceof Int16Array?m=5122:d instanceof Uint32Array?m=5125:d instanceof Int32Array?m=5124:d instanceof Int8Array?m=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(m=5121),{buffer:p,type:m,bytesPerElement:d.BYTES_PER_ELEMENT,version:u.version}}(u,h)):d.version<u.version&&(function r(u,h,d){const f=h.array,p=h.updateRange;s.bindBuffer(d,u),-1===p.count?s.bufferSubData(d,0,f):(t?s.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):s.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1)}(d.buffer,u,h),d.version=u.version)}}}class hs extends xt{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,l=Math.floor(n),c=Math.floor(i),u=l+1,h=c+1,d=e/l,f=t/c,p=[],m=[],v=[],y=[];for(let _=0;_<h;_++){const g=_*f-a;for(let b=0;b<u;b++)m.push(b*d-r,-g,0),v.push(0,0,1),y.push(b/l),y.push(1-_/c)}for(let _=0;_<c;_++)for(let g=0;g<l;g++){const M=g+u*(_+1),A=g+1+u*(_+1),B=g+1+u*_;p.push(g+u*_,M,B),p.push(M,A,B)}this.setIndex(p),this.setAttribute("position",new ct(m,3)),this.setAttribute("normal",new ct(v,3)),this.setAttribute("uv",new ct(y,2))}static fromJSON(e){return new hs(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ft={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in GeometricContext geometry ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},qe={common:{diffuse:{value:new Ke(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new gn},uv2Transform:{value:new gn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ie(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ke(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ke(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}},sprite:{diffuse:{value:new Ke(16777215)},opacity:{value:1},center:{value:new Ie(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}}},si={basic:{uniforms:Ln([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:Ln([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.fog,qe.lights,{emissive:{value:new Ke(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:Ln([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new Ke(0)},specular:{value:new Ke(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:Ln([qe.common,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.roughnessmap,qe.metalnessmap,qe.fog,qe.lights,{emissive:{value:new Ke(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},toon:{uniforms:Ln([qe.common,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.gradientmap,qe.fog,qe.lights,{emissive:{value:new Ke(0)}}]),vertexShader:Ft.meshtoon_vert,fragmentShader:Ft.meshtoon_frag},matcap:{uniforms:Ln([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:Ln([qe.points,qe.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:Ln([qe.common,qe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:Ln([qe.common,qe.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:Ln([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.meshnormal_vert,fragmentShader:Ft.meshnormal_frag},sprite:{uniforms:Ln([qe.sprite,qe.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new gn},t2D:{value:null}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},cube:{uniforms:Ln([qe.envmap,{opacity:{value:1}}]),vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:Ln([qe.common,qe.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:Ln([qe.lights,qe.fog,{color:{value:new Ke(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};function $m(s,e,t,n,i){const r=new Ke(0);let l,c,a=0,u=null,h=0,d=null;function p(m,v){t.buffers.color.setClear(m.r,m.g,m.b,v,i)}return{getClearColor:function(){return r},setClearColor:function(m,v=1){r.set(m),a=v,p(r,a)},getClearAlpha:function(){return a},setClearAlpha:function(m){a=m,p(r,a)},render:function f(m,v){let y=!1,_=!0===v.isScene?v.background:null;_&&_.isTexture&&(_=e.get(_));const g=s.xr,b=g.getSession&&g.getSession();b&&"additive"===b.environmentBlendMode&&(_=null),null===_?p(r,a):_&&_.isColor&&(p(_,1),y=!0),(s.autoClear||y)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),_&&(_.isCubeTexture||306===_.mapping)?(void 0===c&&(c=new $t(new ji(1,1,1),new Oi({name:"BackgroundCubeMaterial",uniforms:Cr(si.cube.uniforms),vertexShader:si.cube.vertexShader,fragmentShader:si.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(M,A,B){this.matrixWorld.copyPosition(B.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,(u!==_||h!==_.version||d!==s.toneMapping)&&(c.material.needsUpdate=!0,u=_,h=_.version,d=s.toneMapping),m.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new $t(new hs(2,2),new Oi({name:"BackgroundMaterial",uniforms:Cr(si.background.uniforms),vertexShader:si.background.vertexShader,fragmentShader:si.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),(u!==_||h!==_.version||d!==s.toneMapping)&&(l.material.needsUpdate=!0,u=_,h=_.version,d=s.toneMapping),m.unshift(l,l.geometry,l.material,0,0,null))}}}function Km(s,e,t,n){const i=s.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==r,l={},c=v(null);let u=c;function f(le){return n.isWebGL2?s.bindVertexArray(le):r.bindVertexArrayOES(le)}function p(le){return n.isWebGL2?s.deleteVertexArray(le):r.deleteVertexArrayOES(le)}function v(le){const ce=[],_e=[],fe=[];for(let we=0;we<i;we++)ce[we]=0,_e[we]=0,fe[we]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ce,enabledAttributes:_e,attributeDivisors:fe,object:le,attributes:{},index:null}}function g(){const le=u.newAttributes;for(let ce=0,_e=le.length;ce<_e;ce++)le[ce]=0}function b(le){M(le,0)}function M(le,ce){const fe=u.enabledAttributes,we=u.attributeDivisors;u.newAttributes[le]=1,0===fe[le]&&(s.enableVertexAttribArray(le),fe[le]=1),we[le]!==ce&&((n.isWebGL2?s:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](le,ce),we[le]=ce)}function A(){const le=u.newAttributes,ce=u.enabledAttributes;for(let _e=0,fe=ce.length;_e<fe;_e++)ce[_e]!==le[_e]&&(s.disableVertexAttribArray(_e),ce[_e]=0)}function B(le,ce,_e,fe,we,Ve){!0!==n.isWebGL2||5124!==_e&&5125!==_e?s.vertexAttribPointer(le,ce,_e,fe,we,Ve):s.vertexAttribIPointer(le,ce,_e,we,Ve)}function J(){Ae(),u!==c&&(u=c,f(u.object))}function Ae(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function h(le,ce,_e,fe,we){let Ve=!1;if(a){const at=function m(le,ce,_e){const fe=!0===_e.wireframe;let we=l[le.id];void 0===we&&(we={},l[le.id]=we);let Ve=we[ce.id];void 0===Ve&&(Ve={},we[ce.id]=Ve);let at=Ve[fe];return void 0===at&&(at=v(function d(){return n.isWebGL2?s.createVertexArray():r.createVertexArrayOES()}()),Ve[fe]=at),at}(fe,_e,ce);u!==at&&(u=at,f(u.object)),Ve=function y(le,ce){const _e=u.attributes,fe=le.attributes;let we=0;for(const Ve in fe){const at=_e[Ve],ut=fe[Ve];if(void 0===at||at.attribute!==ut||at.data!==ut.data)return!0;we++}return u.attributesNum!==we||u.index!==ce}(fe,we),Ve&&function _(le,ce){const _e={},fe=le.attributes;let we=0;for(const Ve in fe){const at=fe[Ve],ut={};ut.attribute=at,at.data&&(ut.data=at.data),_e[Ve]=ut,we++}u.attributes=_e,u.attributesNum=we,u.index=ce}(fe,we)}else{const at=!0===ce.wireframe;(u.geometry!==fe.id||u.program!==_e.id||u.wireframe!==at)&&(u.geometry=fe.id,u.program=_e.id,u.wireframe=at,Ve=!0)}!0===le.isInstancedMesh&&(Ve=!0),null!==we&&t.update(we,34963),Ve&&(function S(le,ce,_e,fe){if(!1===n.isWebGL2&&(le.isInstancedMesh||fe.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;g();const we=fe.attributes,Ve=_e.getAttributes(),at=ce.defaultAttributeValues;for(const ut in Ve){const $e=Ve[ut];if($e.location>=0){let wt=we[ut];if(void 0===wt&&("instanceMatrix"===ut&&le.instanceMatrix&&(wt=le.instanceMatrix),"instanceColor"===ut&&le.instanceColor&&(wt=le.instanceColor)),void 0!==wt){const Oe=wt.normalized,Je=wt.itemSize,Xe=t.get(wt);if(void 0===Xe)continue;const ue=Xe.buffer,lt=Xe.type,ft=Xe.bytesPerElement;if(wt.isInterleavedBufferAttribute){const nt=wt.data,it=nt.stride,At=wt.offset;if(nt&&nt.isInstancedInterleavedBuffer){for(let xe=0;xe<$e.locationSize;xe++)M($e.location+xe,nt.meshPerAttribute);!0!==le.isInstancedMesh&&void 0===fe._maxInstanceCount&&(fe._maxInstanceCount=nt.meshPerAttribute*nt.count)}else for(let xe=0;xe<$e.locationSize;xe++)b($e.location+xe);s.bindBuffer(34962,ue);for(let xe=0;xe<$e.locationSize;xe++)B($e.location+xe,Je/$e.locationSize,lt,Oe,it*ft,(At+Je/$e.locationSize*xe)*ft)}else{if(wt.isInstancedBufferAttribute){for(let nt=0;nt<$e.locationSize;nt++)M($e.location+nt,wt.meshPerAttribute);!0!==le.isInstancedMesh&&void 0===fe._maxInstanceCount&&(fe._maxInstanceCount=wt.meshPerAttribute*wt.count)}else for(let nt=0;nt<$e.locationSize;nt++)b($e.location+nt);s.bindBuffer(34962,ue);for(let nt=0;nt<$e.locationSize;nt++)B($e.location+nt,Je/$e.locationSize,lt,Oe,Je*ft,Je/$e.locationSize*nt*ft)}}else if(void 0!==at){const Oe=at[ut];if(void 0!==Oe)switch(Oe.length){case 2:s.vertexAttrib2fv($e.location,Oe);break;case 3:s.vertexAttrib3fv($e.location,Oe);break;case 4:s.vertexAttrib4fv($e.location,Oe);break;default:s.vertexAttrib1fv($e.location,Oe)}}}}A()}(le,ce,_e,fe),null!==we&&s.bindBuffer(34963,t.get(we).buffer))},reset:J,resetDefaultState:Ae,dispose:function V(){J();for(const le in l){const ce=l[le];for(const _e in ce){const fe=ce[_e];for(const we in fe)p(fe[we].object),delete fe[we];delete ce[_e]}delete l[le]}},releaseStatesOfGeometry:function ae(le){if(void 0===l[le.id])return;const ce=l[le.id];for(const _e in ce){const fe=ce[_e];for(const we in fe)p(fe[we].object),delete fe[we];delete ce[_e]}delete l[le.id]},releaseStatesOfProgram:function K(le){for(const ce in l){const _e=l[ce];if(void 0===_e[le.id])continue;const fe=_e[le.id];for(const we in fe)p(fe[we].object),delete fe[we];delete _e[le.id]}},initAttributes:g,enableAttribute:b,disableUnusedAttributes:A}}function eg(s,e,t,n){const i=n.isWebGL2;let r;this.setMode=function a(u){r=u},this.render=function l(u,h){s.drawArrays(r,u,h),t.update(h,r,1)},this.renderInstances=function c(u,h,d){if(0===d)return;let f,p;if(i)f=s,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",null===f)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");f[p](r,u,h,d),t.update(h,r,d)}}function tg(s,e,t){let n;function r(S){if("highp"===S){if(s.getShaderPrecisionFormat(35633,36338).precision>0&&s.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";S="mediump"}return"mediump"===S&&s.getShaderPrecisionFormat(35633,36337).precision>0&&s.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&s instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&s instanceof WebGL2ComputeRenderingContext;let l=void 0!==t.precision?t.precision:"highp";const c=r(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const u=a||e.has("WEBGL_draw_buffers"),h=!0===t.logarithmicDepthBuffer,d=s.getParameter(34930),f=s.getParameter(35660),p=s.getParameter(3379),m=s.getParameter(34076),v=s.getParameter(34921),y=s.getParameter(36347),_=s.getParameter(36348),g=s.getParameter(36349),b=f>0,M=a||e.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function i(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const S=e.get("EXT_texture_filter_anisotropic");n=s.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:l,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:y,maxVaryings:_,maxFragmentUniforms:g,vertexTextures:b,floatFragmentTextures:M,floatVertexTextures:b&&M,maxSamples:a?s.getParameter(36183):0}}function ng(s){const e=this;let t=null,n=0,i=!1,r=!1;const a=new _i,l=new gn,c={value:null,needsUpdate:!1};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(d,f,p,m){const v=null!==d?d.length:0;let y=null;if(0!==v){if(y=c.value,!0!==m||null===y){const _=p+4*v,g=f.matrixWorldInverse;l.getNormalMatrix(g),(null===y||y.length<_)&&(y=new Float32Array(_));for(let b=0,M=p;b!==v;++b,M+=4)a.copy(d[b]).applyMatrix4(g,l),a.normal.toArray(y,M),y[M+3]=a.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,y}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,p){const m=0!==d.length||f||0!==n||i;return i=f,t=h(d,p,0),n=d.length,m},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,u()},this.setState=function(d,f,p){const m=d.clippingPlanes,v=d.clipIntersection,y=d.clipShadows,_=s.get(d);if(!i||null===m||0===m.length||r&&!y)r?h(null):u();else{const g=r?0:n,b=4*g;let M=_.clippingState||null;c.value=M,M=h(m,f,b,p);for(let A=0;A!==b;++A)M[A]=t[A];_.clippingState=M,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=g}}}function ig(s){let e=new WeakMap;function t(a,l){return 303===l?a.mapping=301:304===l&&(a.mapping=302),a}function i(a){const l=a.target;l.removeEventListener("dispose",i);const c=e.get(l);void 0!==c&&(e.delete(l),c.dispose())}return{get:function n(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){const l=a.mapping;if(303===l||304===l){if(e.has(a))return t(e.get(a).texture,a.mapping);{const c=a.image;if(c&&c.height>0){const u=s.getRenderTarget(),h=new ka(c.height/2);return h.fromEquirectangularTexture(s,a),e.set(a,h),s.setRenderTarget(u),a.addEventListener("dispose",i),t(h.texture,a.mapping)}return null}}}return a},dispose:function r(){e=new WeakMap}}}si.physical={uniforms:Ln([si.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ie(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new Ke(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Ke(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Ke(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag};class ds extends ro{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,l=i+t,c=i-t;if(null!==this.view&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=u*this.view.offsetX,a=r+u*this.view.width,l-=h*this.view.offsetY,c=l-h*this.view.height}this.projectionMatrix.makeOrthographic(r,a,l,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}ds.prototype.isOrthographicCamera=!0;class fs extends Oi{constructor(e){super(e),this.type="RawShaderMaterial"}}fs.prototype.isRawShaderMaterial=!0;const oi=Math.pow(2,8),mc=[.125,.215,.35,.446,.526,.582],gc=5+mc.length,ai={[Un]:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Ba=new ds,{_lodPlanes:ps,_sizeLods:_c,_sigmas:oo}=og(),vc=new Ke;let Na=null;const Qi=(1+Math.sqrt(5))/2,Dr=1/Qi,yc=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Qi,Dr),new P(0,Qi,-Dr),new P(Dr,0,Qi),new P(-Dr,0,Qi),new P(Qi,Dr,0),new P(-Qi,Dr,0)];class rg{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function ag(s){const e=new Float32Array(s),t=new P(0,1,0);return new fs({name:"SphericalGaussianBlur",defines:{n:s},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:ai[Un]},outputEncoding:{value:ai[Un]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Na=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=bc(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=wc(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<ps.length;e++)ps[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Na),e.scissorTest=!1,ao(e,0,0,e.width,e.height)}_fromTexture(e){Na=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:rn,minFilter:rn,generateMipmaps:!1,type:cr,format:1023,encoding:(s=e,void 0===s||s.type!==cr||s.encoding!==Un&&3001!==s.encoding&&3007!==s.encoding?3002:e.encoding),depthBuffer:!1},n=xc(t);var s;return n.depthBuffer=!e,this._pingPongRenderTarget=xc(t),n}_compileMaterial(e){const t=new $t(ps[0],e);this._renderer.compile(t,Ba)}_sceneToCubeUV(e,t,n,i){const l=new Sn(90,1,t,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.outputEncoding,p=h.toneMapping;h.getClearColor(vc),h.toneMapping=0,h.outputEncoding=Un,h.autoClear=!1;const m=new Pi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),v=new $t(new ji,m);let y=!1;const _=e.background;_?_.isColor&&(m.color.copy(_),e.background=null,y=!0):(m.color.copy(vc),y=!0);for(let g=0;g<6;g++){const b=g%3;0==b?(l.up.set(0,c[g],0),l.lookAt(u[g],0,0)):1==b?(l.up.set(0,0,c[g]),l.lookAt(0,u[g],0)):(l.up.set(0,c[g],0),l.lookAt(0,0,u[g])),ao(i,b*oi,g>2?oi:0,oi,oi),h.setRenderTarget(i),y&&h.render(v,l),h.render(e,l)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=p,h.outputEncoding=f,h.autoClear=d,e.background=_}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=bc()):null==this._equirectShader&&(this._equirectShader=wc());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new $t(ps[0],i),a=i.uniforms;a.envMap.value=e,e.isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),a.inputEncoding.value=ai[e.encoding],a.outputEncoding.value=ai[t.texture.encoding],ao(t,0,0,3*oi,2*oi),n.setRenderTarget(t),n.render(r,Ba)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<gc;i++){const r=Math.sqrt(oo[i]*oo[i]-oo[i-1]*oo[i-1]);this._blur(e,i-1,i,r,yc[(i-1)%yc.length])}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,l){const c=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new $t(ps[i],u),f=u.uniforms,p=_c[n]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/39,v=r/m,y=isFinite(r)?1+Math.floor(3*v):20;y>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to 20`);const _=[];let g=0;for(let B=0;B<20;++B){const S=B/v,V=Math.exp(-S*S/2);_.push(V),0==B?g+=V:B<y&&(g+=2*V)}for(let B=0;B<_.length;B++)_[B]=_[B]/g;f.envMap.value=e.texture,f.samples.value=y,f.weights.value=_,f.latitudinal.value="latitudinal"===a,l&&(f.poleAxis.value=l),f.dTheta.value=m,f.mipInt.value=8-n,f.inputEncoding.value=ai[e.texture.encoding],f.outputEncoding.value=ai[e.texture.encoding];const b=_c[i];ao(t,3*Math.max(0,oi-2*b),(0===i?0:2*oi)+2*b*(i>4?i-8+4:0),3*b,2*b),c.setRenderTarget(t),c.render(d,Ba)}}function og(){const s=[],e=[],t=[];let n=8;for(let i=0;i<gc;i++){const r=Math.pow(2,n);e.push(r);let a=1/r;i>4?a=mc[i-8+4-1]:0==i&&(a=0),t.push(a);const l=1/(r-1),c=-l/2,u=1+l/2,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,f=6,p=3,m=2,v=1,y=new Float32Array(p*f*d),_=new Float32Array(m*f*d),g=new Float32Array(v*f*d);for(let M=0;M<d;M++){const A=M%3*2/3-1,B=M>2?0:-1;y.set([A,B,0,A+2/3,B,0,A+2/3,B+1,0,A,B,0,A+2/3,B+1,0,A,B+1,0],p*f*M),_.set(h,m*f*M),g.set([M,M,M,M,M,M],v*f*M)}const b=new xt;b.setAttribute("position",new Vt(y,p)),b.setAttribute("uv",new Vt(_,m)),b.setAttribute("faceIndex",new Vt(g,v)),s.push(b),n>4&&n--}return{_lodPlanes:s,_sizeLods:e,_sigmas:t}}function xc(s){const e=new ri(3*oi,3*oi,s);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function ao(s,e,t,n,i){s.viewport.set(e,t,n,i),s.scissor.set(e,t,n,i)}function wc(){const s=new Ie(1,1);return new fs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:s},inputEncoding:{value:ai[Un]},outputEncoding:{value:ai[Un]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function bc(){return new fs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ai[Un]},outputEncoding:{value:ai[Un]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function lg(s){let e=new WeakMap,t=null;function r(l){const c=l.target;c.removeEventListener("dispose",r);const u=e.get(c);void 0!==u&&(e.delete(c),u.dispose())}return{get:function n(l){if(l&&l.isTexture&&!1===l.isRenderTargetTexture){const c=l.mapping,u=303===c||304===c,h=301===c||302===c;if(u||h){if(e.has(l))return e.get(l).texture;{const d=l.image;if(u&&d&&d.height>0||h&&d&&function i(l){let c=0;for(let h=0;h<6;h++)void 0!==l[h]&&c++;return 6===c}(d)){const f=s.getRenderTarget();null===t&&(t=new rg(s));const p=u?t.fromEquirectangular(l):t.fromCubemap(l);return e.set(l,p),s.setRenderTarget(f),l.addEventListener("dispose",r),p.texture}return null}}}return l},dispose:function a(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function cg(s){const e={};function t(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=s.getExtension(n)}return e[n]=i,i}return{has:function(n){return null!==t(n)},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){const i=t(n);return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function ug(s,e,t,n){const i={},r=new WeakMap;function a(d){const f=d.target;null!==f.index&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);f.removeEventListener("dispose",a),delete i[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),n.releaseStatesOfGeometry(f),!0===f.isInstancedBufferGeometry&&delete f._maxInstanceCount,t.memory.geometries--}function u(d){const f=[],p=d.index,m=d.attributes.position;let v=0;if(null!==p){const g=p.array;v=p.version;for(let b=0,M=g.length;b<M;b+=3){const A=g[b+0],B=g[b+1],S=g[b+2];f.push(A,B,B,S,S,A)}}else{v=m.version;for(let b=0,M=m.array.length/3-1;b<M;b+=3){const A=b+0,B=b+1,S=b+2;f.push(A,B,B,S,S,A)}}const y=new(dc(f)>65535?Ca:Ea)(f,1);y.version=v;const _=r.get(d);_&&e.remove(_),r.set(d,y)}return{get:function l(d,f){return!0===i[f.id]||(f.addEventListener("dispose",a),i[f.id]=!0,t.memory.geometries++),f},update:function c(d){const f=d.attributes;for(const m in f)e.update(f[m],34962);const p=d.morphAttributes;for(const m in p){const v=p[m];for(let y=0,_=v.length;y<_;y++)e.update(v[y],34962)}},getWireframeAttribute:function h(d){const f=r.get(d);if(f){const p=d.index;null!==p&&f.version<p.version&&u(d)}else u(d);return r.get(d)}}}function hg(s,e,t,n){const i=n.isWebGL2;let r,l,c;this.setMode=function a(f){r=f},this.setIndex=function u(f){l=f.type,c=f.bytesPerElement},this.render=function h(f,p){s.drawElements(r,p,l,f*c),t.update(p,r,1)},this.renderInstances=function d(f,p,m){if(0===m)return;let v,y;if(i)v=s,y="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",null===v)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");v[y](r,p,l,f*c,m),t.update(p,r,m)}}function dg(s){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function n(r,a,l){switch(t.calls++,a){case 4:t.triangles+=l*(r/3);break;case 1:t.lines+=l*(r/2);break;case 3:t.lines+=l*(r-1);break;case 2:t.lines+=l*r;break;case 0:t.points+=l*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a)}}}}function fg(s,e){return s[0]-e[0]}function pg(s,e){return Math.abs(e[1])-Math.abs(s[1])}function mg(s){const e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];return{update:function i(r,a,l,c){const u=r.morphTargetInfluences,h=void 0===u?0:u.length;let d=e[a.id];if(void 0===d||d.length!==h){d=[];for(let y=0;y<h;y++)d[y]=[y,0];e[a.id]=d}for(let y=0;y<h;y++){const _=d[y];_[0]=y,_[1]=u[y]}d.sort(pg);for(let y=0;y<8;y++)y<h&&d[y][1]?(n[y][0]=d[y][0],n[y][1]=d[y][1]):(n[y][0]=Number.MAX_SAFE_INTEGER,n[y][1]=0);n.sort(fg);const f=a.morphAttributes.position,p=a.morphAttributes.normal;let m=0;for(let y=0;y<8;y++){const _=n[y],g=_[0],b=_[1];g!==Number.MAX_SAFE_INTEGER&&b?(f&&a.getAttribute("morphTarget"+y)!==f[g]&&a.setAttribute("morphTarget"+y,f[g]),p&&a.getAttribute("morphNormal"+y)!==p[g]&&a.setAttribute("morphNormal"+y,p[g]),t[y]=b,m+=b):(f&&!0===a.hasAttribute("morphTarget"+y)&&a.deleteAttribute("morphTarget"+y),p&&!0===a.hasAttribute("morphNormal"+y)&&a.deleteAttribute("morphNormal"+y),t[y]=0)}const v=a.morphTargetsRelative?1:1-m;c.getUniforms().setValue(s,"morphTargetBaseInfluence",v),c.getUniforms().setValue(s,"morphTargetInfluences",t)}}}function gg(s,e,t,n){let i=new WeakMap;function l(c){const u=c.target;u.removeEventListener("dispose",l),t.remove(u.instanceMatrix),null!==u.instanceColor&&t.remove(u.instanceColor)}return{update:function r(c){const u=n.render.frame,d=e.get(c,c.geometry);return i.get(d)!==u&&(e.update(d),i.set(d,u)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",l)&&c.addEventListener("dispose",l),t.update(c.instanceMatrix,34962),null!==c.instanceColor&&t.update(c.instanceColor,34962)),d},dispose:function a(){i=new WeakMap}}}class Mc extends _n{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=rn,this.minFilter=rn,this.wrapR=un,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Mc.prototype.isDataTexture2DArray=!0;class Sc extends _n{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=rn,this.minFilter=rn,this.wrapR=un,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Sc.prototype.isDataTexture3D=!0;const Tc=new _n,_g=new Mc,vg=new Sc,Ac=new cs,Ec=[],Cc=[],Pc=new Float32Array(16),Lc=new Float32Array(9),Ic=new Float32Array(4);function Fr(s,e,t){const n=s[0];if(n<=0||n>0)return s;const i=e*t;let r=Ec[i];if(void 0===r&&(r=new Float32Array(i),Ec[i]=r),0!==e){n.toArray(r,0);for(let a=1,l=0;a!==e;++a)l+=t,s[a].toArray(r,l)}return r}function Fn(s,e){if(s.length!==e.length)return!1;for(let t=0,n=s.length;t<n;t++)if(s[t]!==e[t])return!1;return!0}function In(s,e){for(let t=0,n=e.length;t<n;t++)s[t]=e[t]}function Rc(s,e){let t=Cc[e];void 0===t&&(t=new Int32Array(e),Cc[e]=t);for(let n=0;n!==e;++n)t[n]=s.allocateTextureUnit();return t}function yg(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function xg(s,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Fn(t,e))return;s.uniform2fv(this.addr,e),In(t,e)}}function wg(s,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Fn(t,e))return;s.uniform3fv(this.addr,e),In(t,e)}}function bg(s,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Fn(t,e))return;s.uniform4fv(this.addr,e),In(t,e)}}function Mg(s,e){const t=this.cache,n=e.elements;if(void 0===n){if(Fn(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),In(t,e)}else{if(Fn(t,n))return;Ic.set(n),s.uniformMatrix2fv(this.addr,!1,Ic),In(t,n)}}function Sg(s,e){const t=this.cache,n=e.elements;if(void 0===n){if(Fn(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),In(t,e)}else{if(Fn(t,n))return;Lc.set(n),s.uniformMatrix3fv(this.addr,!1,Lc),In(t,n)}}function Tg(s,e){const t=this.cache,n=e.elements;if(void 0===n){if(Fn(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),In(t,e)}else{if(Fn(t,n))return;Pc.set(n),s.uniformMatrix4fv(this.addr,!1,Pc),In(t,n)}}function Ag(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function Eg(s,e){const t=this.cache;Fn(t,e)||(s.uniform2iv(this.addr,e),In(t,e))}function Cg(s,e){const t=this.cache;Fn(t,e)||(s.uniform3iv(this.addr,e),In(t,e))}function Pg(s,e){const t=this.cache;Fn(t,e)||(s.uniform4iv(this.addr,e),In(t,e))}function Lg(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function Ig(s,e){const t=this.cache;Fn(t,e)||(s.uniform2uiv(this.addr,e),In(t,e))}function Rg(s,e){const t=this.cache;Fn(t,e)||(s.uniform3uiv(this.addr,e),In(t,e))}function Og(s,e){const t=this.cache;Fn(t,e)||(s.uniform4uiv(this.addr,e),In(t,e))}function Dg(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||Tc,i)}function Fg(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||vg,i)}function kg(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||Ac,i)}function zg(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||_g,i)}function Ng(s,e){s.uniform1fv(this.addr,e)}function Ug(s,e){const t=Fr(e,this.size,2);s.uniform2fv(this.addr,t)}function Hg(s,e){const t=Fr(e,this.size,3);s.uniform3fv(this.addr,t)}function Gg(s,e){const t=Fr(e,this.size,4);s.uniform4fv(this.addr,t)}function Vg(s,e){const t=Fr(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function Wg(s,e){const t=Fr(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function Zg(s,e){const t=Fr(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function qg(s,e){s.uniform1iv(this.addr,e)}function Jg(s,e){s.uniform2iv(this.addr,e)}function Xg(s,e){s.uniform3iv(this.addr,e)}function Yg(s,e){s.uniform4iv(this.addr,e)}function jg(s,e){s.uniform1uiv(this.addr,e)}function Qg(s,e){s.uniform2uiv(this.addr,e)}function $g(s,e){s.uniform3uiv(this.addr,e)}function Kg(s,e){s.uniform4uiv(this.addr,e)}function e_(s,e,t){const n=e.length,i=Rc(t,n);s.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||Tc,i[r])}function t_(s,e,t){const n=e.length,i=Rc(t,n);s.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||Ac,i[r])}function i_(s,e,t){this.id=s,this.addr=t,this.cache=[],this.setValue=function Bg(s){switch(s){case 5126:return yg;case 35664:return xg;case 35665:return wg;case 35666:return bg;case 35674:return Mg;case 35675:return Sg;case 35676:return Tg;case 5124:case 35670:return Ag;case 35667:case 35671:return Eg;case 35668:case 35672:return Cg;case 35669:case 35673:return Pg;case 5125:return Lg;case 36294:return Ig;case 36295:return Rg;case 36296:return Og;case 35678:case 36198:case 36298:case 36306:case 35682:return Dg;case 35679:case 36299:case 36307:return Fg;case 35680:case 36300:case 36308:case 36293:return kg;case 36289:case 36303:case 36311:case 36292:return zg}}(e.type)}function Oc(s,e,t){this.id=s,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function n_(s){switch(s){case 5126:return Ng;case 35664:return Ug;case 35665:return Hg;case 35666:return Gg;case 35674:return Vg;case 35675:return Wg;case 35676:return Zg;case 5124:case 35670:return qg;case 35667:case 35671:return Jg;case 35668:case 35672:return Xg;case 35669:case 35673:return Yg;case 5125:return jg;case 36294:return Qg;case 36295:return $g;case 36296:return Kg;case 35678:case 36198:case 36298:case 36306:case 35682:return e_;case 35680:case 36300:case 36308:case 36293:return t_}}(e.type)}function Dc(s){this.id=s,this.seq=[],this.map={}}Oc.prototype.updateCache=function(s){const e=this.cache;s instanceof Float32Array&&e.length!==s.length&&(this.cache=new Float32Array(s.length)),In(e,s)},Dc.prototype.setValue=function(s,e,t){const n=this.seq;for(let i=0,r=n.length;i!==r;++i){const a=n[i];a.setValue(s,e[a.id],t)}};const Ga=/(\w+)(\])?(\[|\.)?/g;function Fc(s,e){s.seq.push(e),s.map[e.id]=e}function r_(s,e,t){const n=s.name,i=n.length;for(Ga.lastIndex=0;;){const r=Ga.exec(n),a=Ga.lastIndex;let l=r[1];const u=r[3];if("]"===r[2]&&(l|=0),void 0===u||"["===u&&a+2===i){Fc(t,void 0===u?new i_(l,s,e):new Oc(l,s,e));break}{let d=t.map[l];void 0===d&&(d=new Dc(l),Fc(t,d)),t=d}}}function Fi(s,e){this.seq=[],this.map={};const t=s.getProgramParameter(e,35718);for(let n=0;n<t;++n){const i=s.getActiveUniform(e,n);r_(i,s.getUniformLocation(e,i.name),this)}}function kc(s,e,t){const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),n}Fi.prototype.setValue=function(s,e,t,n){const i=this.map[e];void 0!==i&&i.setValue(s,t,n)},Fi.prototype.setOptional=function(s,e,t){const n=e[t];void 0!==n&&this.setValue(s,t,n)},Fi.upload=function(s,e,t,n){for(let i=0,r=e.length;i!==r;++i){const a=e[i],l=t[a.id];!1!==l.needsUpdate&&a.setValue(s,l.value,n)}},Fi.seqWithValue=function(s,e){const t=[];for(let n=0,i=s.length;n!==i;++n){const r=s[n];r.id in e&&t.push(r)}return t};let s_=0;function zc(s){switch(s){case Un:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",s),["Linear","( value )"]}}function Bc(s,e,t){const n=s.getShaderParameter(e,35713),i=s.getShaderInfoLog(e).trim();return n&&""===i?"":t.toUpperCase()+"\n\n"+i+"\n\n"+function o_(s){const e=s.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(s.getShaderSource(e))}function kr(s,e){const t=zc(e);return"vec4 "+s+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function a_(s,e){const t=zc(e);return"vec4 "+s+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function l_(s,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function ms(s){return""!==s}function Nc(s,e){return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Uc(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const d_=/^[ \t]*#include +<([\w\d./]+)>/gm;function Va(s){return s.replace(d_,f_)}function f_(s,e){const t=Ft[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return Va(t)}const p_=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,m_=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Hc(s){return s.replace(m_,Gc).replace(p_,g_)}function g_(s,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Gc(0,e,t,n)}function Gc(s,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function Vc(s){let e="precision "+s.precision+" float;\nprecision "+s.precision+" int;";return"highp"===s.precision?e+="\n#define HIGH_PRECISION":"mediump"===s.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===s.precision&&(e+="\n#define LOW_PRECISION"),e}function w_(s,e,t,n){const i=s.getContext(),r=t.defines;let a=t.vertexShader,l=t.fragmentShader;const c=function __(s){let e="SHADOWMAP_TYPE_BASIC";return 1===s.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===s.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===s.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),u=function v_(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),h=function y_(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(t),d=function x_(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),f=s.gammaFactor>0?s.gammaFactor:1,p=t.isWebGL2?"":function c_(s){return[s.extensionDerivatives||s.envMapCubeUV||s.bumpMap||s.tangentSpaceNormalMap||s.clearcoatNormalMap||s.flatShading||"physical"===s.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ms).join("\n")}(t),m=function u_(s){const e=[];for(const t in s){const n=s[t];!1!==n&&e.push("#define "+t+" "+n)}return e.join("\n")}(r),v=i.createProgram();let y,_,g=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(y=[m].filter(ms).join("\n"),y.length>0&&(y+="\n"),_=[p,m].filter(ms).join("\n"),_.length>0&&(_+="\n")):(y=[Vc(t),"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ms).join("\n"),_=[p,Vc(t),"#define SHADER_NAME "+t.shaderName,m,"#define GAMMA_FACTOR "+f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheenTint?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Ft.tonemapping_pars_fragment:"",0!==t.toneMapping?l_("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===Mi?"#define OPAQUE":"",Ft.encodings_pars_fragment,t.map?kr("mapTexelToLinear",t.mapEncoding):"",t.matcap?kr("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?kr("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?kr("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularTintMap?kr("specularTintMapTexelToLinear",t.specularTintMapEncoding):"",t.lightMap?kr("lightMapTexelToLinear",t.lightMapEncoding):"",a_("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(ms).join("\n")),a=Va(a),a=Nc(a,t),a=Uc(a,t),l=Va(l),l=Nc(l,t),l=Uc(l,t),a=Hc(a),l=Hc(l),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(g="#version 300 es\n",y=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,_=["#define varying in","300 es"===t.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const M=g+_+l,A=kc(i,35633,g+y+a),B=kc(i,35632,M);if(i.attachShader(v,A),i.attachShader(v,B),void 0!==t.index0AttributeName?i.bindAttribLocation(v,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),s.debug.checkShaderErrors){const ae=i.getProgramInfoLog(v).trim(),K=i.getShaderInfoLog(A).trim(),J=i.getShaderInfoLog(B).trim();let Ae=!0,le=!0;if(!1===i.getProgramParameter(v,35714)){Ae=!1;const ce=Bc(i,A,"vertex"),_e=Bc(i,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+ae+"\n"+ce+"\n"+_e)}else""!==ae?console.warn("THREE.WebGLProgram: Program Info Log:",ae):(""===K||""===J)&&(le=!1);le&&(this.diagnostics={runnable:Ae,programLog:ae,vertexShader:{log:K,prefix:y},fragmentShader:{log:J,prefix:_}})}let S,V;return i.deleteShader(A),i.deleteShader(B),this.getUniforms=function(){return void 0===S&&(S=new Fi(i,v)),S},this.getAttributes=function(){return void 0===V&&(V=function h_(s,e){const t={},n=s.getProgramParameter(e,35721);for(let i=0;i<n;i++){const r=s.getActiveAttrib(e,i),a=r.name;let l=1;35674===r.type&&(l=2),35675===r.type&&(l=3),35676===r.type&&(l=4),t[a]={type:r.type,location:s.getAttribLocation(e,a),locationSize:l}}return t}(i,v)),V},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.name=t.shaderName,this.id=s_++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=A,this.fragmentShader=B,this}function b_(s,e,t,n,i,r,a){const l=[],c=i.isWebGL2,u=i.logarithmicDepthBuffer,h=i.floatVertexTextures,d=i.maxVertexUniforms,f=i.vertexTextures;let p=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function _(S){let V;return S&&S.isTexture?V=S.encoding:S&&S.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),V=S.texture.encoding):V=Un,V}return{getParameters:function g(S,V,ae,K,J){const Ae=K.fog,ce=(S.isMeshStandardMaterial?t:e).get(S.envMap||(S.isMeshStandardMaterial?K.environment:null)),_e=m[S.type],fe=J.isSkinnedMesh?function y(S){const ae=S.skeleton.bones;if(h)return 1024;{const J=Math.floor((d-20)/4),Ae=Math.min(J,ae.length);return Ae<ae.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ae.length+" bones. This GPU supports "+Ae+"."),0):Ae}}(J):0;let we,Ve;if(null!==S.precision&&(p=i.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead.")),_e){const Oe=si[_e];we=Oe.vertexShader,Ve=Oe.fragmentShader}else we=S.vertexShader,Ve=S.fragmentShader;const at=s.getRenderTarget(),ut=S.alphaTest>0,$e=S.clearcoat>0;return{isWebGL2:c,shaderID:_e,shaderName:S.type,vertexShader:we,fragmentShader:Ve,defines:S.defines,isRawShaderMaterial:!0===S.isRawShaderMaterial,glslVersion:S.glslVersion,precision:p,instancing:!0===J.isInstancedMesh,instancingColor:!0===J.isInstancedMesh&&null!==J.instanceColor,supportsVertexTextures:f,outputEncoding:null!==at?_(at.texture):s.outputEncoding,map:!!S.map,mapEncoding:_(S.map),matcap:!!S.matcap,matcapEncoding:_(S.matcap),envMap:!!ce,envMapMode:ce&&ce.mapping,envMapEncoding:_(ce),envMapCubeUV:!!ce&&(306===ce.mapping||307===ce.mapping),lightMap:!!S.lightMap,lightMapEncoding:_(S.lightMap),aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,emissiveMapEncoding:_(S.emissiveMap),bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:1===S.normalMapType,tangentSpaceNormalMap:0===S.normalMapType,clearcoat:$e,clearcoatMap:$e&&!!S.clearcoatMap,clearcoatRoughnessMap:$e&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:$e&&!!S.clearcoatNormalMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularTintMap:!!S.specularTintMap,specularTintMapEncoding:_(S.specularTintMap),alphaMap:!!S.alphaMap,alphaTest:ut,gradientMap:!!S.gradientMap,sheenTint:!!S.sheenTint&&(S.sheenTint.r>0||S.sheenTint.g>0||S.sheenTint.b>0),transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!J.geometry&&!!J.geometry.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:!0===S.vertexColors&&!!J.geometry&&!!J.geometry.attributes.color&&4===J.geometry.attributes.color.itemSize,vertexUvs:!!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatMap||S.clearcoatRoughnessMap||S.clearcoatNormalMap||S.displacementMap||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularTintMap),uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.transmission>0||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularTintMap||!S.displacementMap),fog:!!Ae,useFog:S.fog,fogExp2:Ae&&Ae.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===J.isSkinnedMesh&&fe>0,maxBones:fe,useVertexTexture:h,morphTargets:!!J.geometry&&!!J.geometry.morphAttributes.position,morphNormals:!!J.geometry&&!!J.geometry.morphAttributes.normal,numDirLights:V.directional.length,numPointLights:V.point.length,numSpotLights:V.spot.length,numRectAreaLights:V.rectArea.length,numHemiLights:V.hemi.length,numDirLightShadows:V.directionalShadowMap.length,numPointLightShadows:V.pointShadowMap.length,numSpotLightShadows:V.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:S.format,dithering:S.dithering,shadowMapEnabled:s.shadowMap.enabled&&ae.length>0,shadowMapType:s.shadowMap.type,toneMapping:S.toneMapped?s.toneMapping:0,physicallyCorrectLights:s.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:2===S.side,flipSided:1===S.side,depthPacking:void 0!==S.depthPacking&&S.depthPacking,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}},getProgramCacheKey:function b(S){const V=[];if(S.shaderID?V.push(S.shaderID):(V.push(S.fragmentShader),V.push(S.vertexShader)),void 0!==S.defines)for(const ae in S.defines)V.push(ae),V.push(S.defines[ae]);if(!1===S.isRawShaderMaterial){for(let ae=0;ae<v.length;ae++)V.push(S[v[ae]]);V.push(s.outputEncoding),V.push(s.gammaFactor)}return V.push(S.customProgramCacheKey),V.join()},getUniforms:function M(S){const V=m[S.type];let ae;return ae=V?xf.clone(si[V].uniforms):S.uniforms,ae},acquireProgram:function A(S,V){let ae;for(let K=0,J=l.length;K<J;K++){const Ae=l[K];if(Ae.cacheKey===V){ae=Ae,++ae.usedTimes;break}}return void 0===ae&&(ae=new w_(s,V,S,r),l.push(ae)),ae},releaseProgram:function B(S){if(0==--S.usedTimes){const V=l.indexOf(S);l[V]=l[l.length-1],l.pop(),S.destroy()}},programs:l}}function M_(){let s=new WeakMap;return{get:function e(r){let a=s.get(r);return void 0===a&&(a={},s.set(r,a)),a},remove:function t(r){s.delete(r)},update:function n(r,a,l){s.get(r)[a]=l},dispose:function i(){s=new WeakMap}}}function S_(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.program!==e.program?s.program.id-e.program.id:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function Wc(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function Zc(s){const e=[];let t=0;const n=[],i=[],r=[],a={id:-1};function c(p,m,v,y,_,g){let b=e[t];const M=s.get(v);return void 0===b?(b={id:p.id,object:p,geometry:m,material:v,program:M.program||a,groupOrder:y,renderOrder:p.renderOrder,z:_,group:g},e[t]=b):(b.id=p.id,b.object=p,b.geometry=m,b.material=v,b.program=M.program||a,b.groupOrder=y,b.renderOrder=p.renderOrder,b.z=_,b.group=g),t++,b}return{opaque:n,transmissive:i,transparent:r,init:function l(){t=0,n.length=0,i.length=0,r.length=0},push:function u(p,m,v,y,_,g){const b=c(p,m,v,y,_,g);v.transmission>0?i.push(b):!0===v.transparent?r.push(b):n.push(b)},unshift:function h(p,m,v,y,_,g){const b=c(p,m,v,y,_,g);v.transmission>0?i.unshift(b):!0===v.transparent?r.unshift(b):n.unshift(b)},finish:function f(){for(let p=t,m=e.length;p<m;p++){const v=e[p];if(null===v.id)break;v.id=null,v.object=null,v.geometry=null,v.material=null,v.program=null,v.group=null}},sort:function d(p,m){n.length>1&&n.sort(p||S_),i.length>1&&i.sort(m||Wc),r.length>1&&r.sort(m||Wc)}}}function T_(s){let e=new WeakMap;return{get:function t(i,r){let a;return!1===e.has(i)?(a=new Zc(s),e.set(i,[a])):r>=e.get(i).length?(a=new Zc(s),e.get(i).push(a)):a=e.get(i)[r],a},dispose:function n(){e=new WeakMap}}}function A_(){const s={};return{get:function(e){if(void 0!==s[e.id])return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new P,color:new Ke};break;case"SpotLight":t={position:new P,direction:new P,color:new Ke,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new P,color:new Ke,distance:0,decay:0};break;case"HemisphereLight":t={direction:new P,skyColor:new Ke,groundColor:new Ke};break;case"RectAreaLight":t={color:new Ke,position:new P,halfWidth:new P,halfHeight:new P}}return s[e.id]=t,t}}}let C_=0;function P_(s,e){return(e.castShadow?1:0)-(s.castShadow?1:0)}function L_(s,e){const t=new A_,n=function E_(){const s={};return{get:function(e){if(void 0!==s[e.id])return s[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ie};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ie,shadowCameraNear:1,shadowCameraFar:1e3}}return s[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let h=0;h<9;h++)i.probe.push(new P);const r=new P,a=new dt,l=new dt;return{setup:function c(h,d){let f=0,p=0,m=0;for(let ae=0;ae<9;ae++)i.probe[ae].set(0,0,0);let v=0,y=0,_=0,g=0,b=0,M=0,A=0,B=0;h.sort(P_);const S=!0!==d?Math.PI:1;for(let ae=0,K=h.length;ae<K;ae++){const J=h[ae],Ae=J.color,le=J.intensity,ce=J.distance,_e=J.shadow&&J.shadow.map?J.shadow.map.texture:null;if(J.isAmbientLight)f+=Ae.r*le*S,p+=Ae.g*le*S,m+=Ae.b*le*S;else if(J.isLightProbe)for(let fe=0;fe<9;fe++)i.probe[fe].addScaledVector(J.sh.coefficients[fe],le);else if(J.isDirectionalLight){const fe=t.get(J);if(fe.color.copy(J.color).multiplyScalar(J.intensity*S),J.castShadow){const we=J.shadow,Ve=n.get(J);Ve.shadowBias=we.bias,Ve.shadowNormalBias=we.normalBias,Ve.shadowRadius=we.radius,Ve.shadowMapSize=we.mapSize,i.directionalShadow[v]=Ve,i.directionalShadowMap[v]=_e,i.directionalShadowMatrix[v]=J.shadow.matrix,M++}i.directional[v]=fe,v++}else if(J.isSpotLight){const fe=t.get(J);if(fe.position.setFromMatrixPosition(J.matrixWorld),fe.color.copy(Ae).multiplyScalar(le*S),fe.distance=ce,fe.coneCos=Math.cos(J.angle),fe.penumbraCos=Math.cos(J.angle*(1-J.penumbra)),fe.decay=J.decay,J.castShadow){const we=J.shadow,Ve=n.get(J);Ve.shadowBias=we.bias,Ve.shadowNormalBias=we.normalBias,Ve.shadowRadius=we.radius,Ve.shadowMapSize=we.mapSize,i.spotShadow[_]=Ve,i.spotShadowMap[_]=_e,i.spotShadowMatrix[_]=J.shadow.matrix,B++}i.spot[_]=fe,_++}else if(J.isRectAreaLight){const fe=t.get(J);fe.color.copy(Ae).multiplyScalar(le),fe.halfWidth.set(.5*J.width,0,0),fe.halfHeight.set(0,.5*J.height,0),i.rectArea[g]=fe,g++}else if(J.isPointLight){const fe=t.get(J);if(fe.color.copy(J.color).multiplyScalar(J.intensity*S),fe.distance=J.distance,fe.decay=J.decay,J.castShadow){const we=J.shadow,Ve=n.get(J);Ve.shadowBias=we.bias,Ve.shadowNormalBias=we.normalBias,Ve.shadowRadius=we.radius,Ve.shadowMapSize=we.mapSize,Ve.shadowCameraNear=we.camera.near,Ve.shadowCameraFar=we.camera.far,i.pointShadow[y]=Ve,i.pointShadowMap[y]=_e,i.pointShadowMatrix[y]=J.shadow.matrix,A++}i.point[y]=fe,y++}else if(J.isHemisphereLight){const fe=t.get(J);fe.skyColor.copy(J.color).multiplyScalar(le*S),fe.groundColor.copy(J.groundColor).multiplyScalar(le*S),i.hemi[b]=fe,b++}}g>0&&(e.isWebGL2||!0===s.has("OES_texture_float_linear")?(i.rectAreaLTC1=qe.LTC_FLOAT_1,i.rectAreaLTC2=qe.LTC_FLOAT_2):!0===s.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=qe.LTC_HALF_1,i.rectAreaLTC2=qe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=f,i.ambient[1]=p,i.ambient[2]=m;const V=i.hash;(V.directionalLength!==v||V.pointLength!==y||V.spotLength!==_||V.rectAreaLength!==g||V.hemiLength!==b||V.numDirectionalShadows!==M||V.numPointShadows!==A||V.numSpotShadows!==B)&&(i.directional.length=v,i.spot.length=_,i.rectArea.length=g,i.point.length=y,i.hemi.length=b,i.directionalShadow.length=M,i.directionalShadowMap.length=M,i.pointShadow.length=A,i.pointShadowMap.length=A,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=M,i.pointShadowMatrix.length=A,i.spotShadowMatrix.length=B,V.directionalLength=v,V.pointLength=y,V.spotLength=_,V.rectAreaLength=g,V.hemiLength=b,V.numDirectionalShadows=M,V.numPointShadows=A,V.numSpotShadows=B,i.version=C_++)},setupView:function u(h,d){let f=0,p=0,m=0,v=0,y=0;const _=d.matrixWorldInverse;for(let g=0,b=h.length;g<b;g++){const M=h[g];if(M.isDirectionalLight){const A=i.directional[f];A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(_),f++}else if(M.isSpotLight){const A=i.spot[m];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(_),A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(_),m++}else if(M.isRectAreaLight){const A=i.rectArea[v];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(_),l.identity(),a.copy(M.matrixWorld),a.premultiply(_),l.extractRotation(a),A.halfWidth.set(.5*M.width,0,0),A.halfHeight.set(0,.5*M.height,0),A.halfWidth.applyMatrix4(l),A.halfHeight.applyMatrix4(l),v++}else if(M.isPointLight){const A=i.point[p];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(_),p++}else if(M.isHemisphereLight){const A=i.hemi[y];A.direction.setFromMatrixPosition(M.matrixWorld),A.direction.transformDirection(_),A.direction.normalize(),y++}}},state:i}}function qc(s,e){const t=new L_(s,e),n=[],i=[];return{init:function r(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:function c(d){t.setup(n,d)},setupLightsView:function u(d){t.setupView(n,d)},pushLight:function a(d){n.push(d)},pushShadow:function l(d){i.push(d)}}}function I_(s,e){let t=new WeakMap;return{get:function n(r,a=0){let l;return!1===t.has(r)?(l=new qc(s,e),t.set(r,[l])):a>=t.get(r).length?(l=new qc(s,e),t.get(r).push(l)):l=t.get(r)[a],l},dispose:function i(){t=new WeakMap}}}class Wa extends Mn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Wa.prototype.isMeshDepthMaterial=!0;class Za extends Mn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new P,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Jc(s,e,t){let n=new us;const i=new Ie,r=new Ie,a=new Zt,l=new Wa({depthPacking:3201}),c=new Za,u={},h=t.maxTextureSize,d={0:1,1:0,2:2},f=new Oi({uniforms:{shadow_pass:{value:null},resolution:{value:new Ie},radius:{value:4},samples:{value:8}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const m=new xt;m.setAttribute("position",new Vt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new $t(m,f),y=this;function _(M,A){const B=e.update(v);f.uniforms.shadow_pass.value=M.map.texture,f.uniforms.resolution.value=M.mapSize,f.uniforms.radius.value=M.radius,f.uniforms.samples.value=M.blurSamples,s.setRenderTarget(M.mapPass),s.clear(),s.renderBufferDirect(A,null,B,f,v,null),p.uniforms.shadow_pass.value=M.mapPass.texture,p.uniforms.resolution.value=M.mapSize,p.uniforms.radius.value=M.radius,p.uniforms.samples.value=M.blurSamples,s.setRenderTarget(M.map),s.clear(),s.renderBufferDirect(A,null,B,p,v,null)}function g(M,A,B,S,V,ae,K){let J=null;const Ae=!0===S.isPointLight?M.customDistanceMaterial:M.customDepthMaterial;if(J=void 0!==Ae?Ae:!0===S.isPointLight?c:l,s.localClippingEnabled&&!0===B.clipShadows&&0!==B.clippingPlanes.length||B.displacementMap&&0!==B.displacementScale||B.alphaMap&&B.alphaTest>0){const le=J.uuid,ce=B.uuid;let _e=u[le];void 0===_e&&(_e={},u[le]=_e);let fe=_e[ce];void 0===fe&&(fe=J.clone(),_e[ce]=fe),J=fe}return J.visible=B.visible,J.wireframe=B.wireframe,J.side=3===K?null!==B.shadowSide?B.shadowSide:B.side:null!==B.shadowSide?B.shadowSide:d[B.side],J.alphaMap=B.alphaMap,J.alphaTest=B.alphaTest,J.clipShadows=B.clipShadows,J.clippingPlanes=B.clippingPlanes,J.clipIntersection=B.clipIntersection,J.displacementMap=B.displacementMap,J.displacementScale=B.displacementScale,J.displacementBias=B.displacementBias,J.wireframeLinewidth=B.wireframeLinewidth,J.linewidth=B.linewidth,!0===S.isPointLight&&!0===J.isMeshDistanceMaterial&&(J.referencePosition.setFromMatrixPosition(S.matrixWorld),J.nearDistance=V,J.farDistance=ae),J}function b(M,A,B,S,V){if(!1===M.visible)return;if(M.layers.test(A.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&3===V)&&(!M.frustumCulled||n.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,M.matrixWorld);const J=e.update(M),Ae=M.material;if(Array.isArray(Ae)){const le=J.groups;for(let ce=0,_e=le.length;ce<_e;ce++){const fe=le[ce],we=Ae[fe.materialIndex];if(we&&we.visible){const Ve=g(M,0,we,S,B.near,B.far,V);s.renderBufferDirect(B,null,J,Ve,M,fe)}}}else if(Ae.visible){const le=g(M,0,Ae,S,B.near,B.far,V);s.renderBufferDirect(B,null,J,le,M,null)}}const K=M.children;for(let J=0,Ae=K.length;J<Ae;J++)b(K[J],A,B,S,V)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(M,A,B){if(!1===y.enabled||!1===y.autoUpdate&&!1===y.needsUpdate||0===M.length)return;const S=s.getRenderTarget(),V=s.getActiveCubeFace(),ae=s.getActiveMipmapLevel(),K=s.state;K.setBlending(0),K.buffers.color.setClear(1,1,1,1),K.buffers.depth.setTest(!0),K.setScissorTest(!1);for(let J=0,Ae=M.length;J<Ae;J++){const le=M[J],ce=le.shadow;if(void 0===ce){console.warn("THREE.WebGLShadowMap:",le,"has no shadow.");continue}if(!1===ce.autoUpdate&&!1===ce.needsUpdate)continue;i.copy(ce.mapSize);const _e=ce.getFrameExtents();if(i.multiply(_e),r.copy(ce.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(r.x=Math.floor(h/_e.x),i.x=r.x*_e.x,ce.mapSize.x=r.x),i.y>h&&(r.y=Math.floor(h/_e.y),i.y=r.y*_e.y,ce.mapSize.y=r.y)),null===ce.map&&!ce.isPointLightShadow&&3===this.type){const we={minFilter:Qt,magFilter:Qt,format:Nn};ce.map=new ri(i.x,i.y,we),ce.map.texture.name=le.name+".shadowMap",ce.mapPass=new ri(i.x,i.y,we),ce.camera.updateProjectionMatrix()}null===ce.map&&(ce.map=new ri(i.x,i.y,{minFilter:rn,magFilter:rn,format:Nn}),ce.map.texture.name=le.name+".shadowMap",ce.camera.updateProjectionMatrix()),s.setRenderTarget(ce.map),s.clear();const fe=ce.getViewportCount();for(let we=0;we<fe;we++){const Ve=ce.getViewport(we);a.set(r.x*Ve.x,r.y*Ve.y,r.x*Ve.z,r.y*Ve.w),K.viewport(a),ce.updateMatrices(le,we),n=ce.getFrustum(),b(A,B,ce.camera,le,this.type)}!ce.isPointLightShadow&&3===this.type&&_(ce,B),ce.needsUpdate=!1}y.needsUpdate=!1,s.setRenderTarget(S,V,ae)}}function D_(s,e,t){const n=t.isWebGL2,l=new function i(){let te=!1;const Qe=new Zt;let Re=null;const rt=new Zt(0,0,0,0);return{setMask:function(ht){Re!==ht&&!te&&(s.colorMask(ht,ht,ht,ht),Re=ht)},setLocked:function(ht){te=ht},setClear:function(ht,Ot,ie,ot,Jt){!0===Jt&&(ht*=ot,Ot*=ot,ie*=ot),Qe.set(ht,Ot,ie,ot),!1===rt.equals(Qe)&&(s.clearColor(ht,Ot,ie,ot),rt.copy(Qe))},reset:function(){te=!1,Re=null,rt.set(-1,0,0,0)}}},c=new function r(){let te=!1,Qe=null,Re=null,rt=null;return{setTest:function(ht){ht?Je(2929):Xe(2929)},setMask:function(ht){Qe!==ht&&!te&&(s.depthMask(ht),Qe=ht)},setFunc:function(ht){if(Re!==ht){if(ht)switch(ht){case 0:s.depthFunc(512);break;case 1:s.depthFunc(519);break;case 2:s.depthFunc(513);break;case 3:default:s.depthFunc(515);break;case 4:s.depthFunc(514);break;case 5:s.depthFunc(518);break;case 6:s.depthFunc(516);break;case 7:s.depthFunc(517)}else s.depthFunc(515);Re=ht}},setLocked:function(ht){te=ht},setClear:function(ht){rt!==ht&&(s.clearDepth(ht),rt=ht)},reset:function(){te=!1,Qe=null,Re=null,rt=null}}},u=new function a(){let te=!1,Qe=null,Re=null,rt=null,ht=null,Ot=null,ie=null,ot=null,Jt=null;return{setTest:function(Dt){te||(Dt?Je(2960):Xe(2960))},setMask:function(Dt){Qe!==Dt&&!te&&(s.stencilMask(Dt),Qe=Dt)},setFunc:function(Dt,ln,Rn){(Re!==Dt||rt!==ln||ht!==Rn)&&(s.stencilFunc(Dt,ln,Rn),Re=Dt,rt=ln,ht=Rn)},setOp:function(Dt,ln,Rn){(Ot!==Dt||ie!==ln||ot!==Rn)&&(s.stencilOp(Dt,ln,Rn),Ot=Dt,ie=ln,ot=Rn)},setLocked:function(Dt){te=Dt},setClear:function(Dt){Jt!==Dt&&(s.clearStencil(Dt),Jt=Dt)},reset:function(){te=!1,Qe=null,Re=null,rt=null,ht=null,Ot=null,ie=null,ot=null,Jt=null}}};let h={},d=null,f={},p=null,m=!1,v=null,y=null,_=null,g=null,b=null,M=null,A=null,B=!1,S=null,V=null,ae=null,K=null,J=null;const Ae=s.getParameter(35661);let le=!1,ce=0;const _e=s.getParameter(7938);-1!==_e.indexOf("WebGL")?(ce=parseFloat(/^WebGL (\d)/.exec(_e)[1]),le=ce>=1):-1!==_e.indexOf("OpenGL ES")&&(ce=parseFloat(/^OpenGL ES (\d)/.exec(_e)[1]),le=ce>=2);let fe=null,we={};const Ve=s.getParameter(3088),at=s.getParameter(2978),ut=(new Zt).fromArray(Ve),$e=(new Zt).fromArray(at);function wt(te,Qe,Re){const rt=new Uint8Array(4),ht=s.createTexture();s.bindTexture(te,ht),s.texParameteri(te,10241,9728),s.texParameteri(te,10240,9728);for(let Ot=0;Ot<Re;Ot++)s.texImage2D(Qe+Ot,0,6408,1,1,0,6408,5121,rt);return ht}const Oe={};function Je(te){!0!==h[te]&&(s.enable(te),h[te]=!0)}function Xe(te){!1!==h[te]&&(s.disable(te),h[te]=!1)}Oe[3553]=wt(3553,3553,1),Oe[34067]=wt(34067,34069,6),l.setClear(0,0,0,1),c.setClear(1),u.setClear(0),Je(2929),c.setFunc(3),ke(!1),We(1),Je(2884),At(0);const nt={[w]:32774,101:32778,102:32779};if(n)nt[103]=32775,nt[104]=32776;else{const te=e.get("EXT_blend_minmax");null!==te&&(nt[103]=te.MIN_EXT,nt[104]=te.MAX_EXT)}const it={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function At(te,Qe,Re,rt,ht,Ot,ie,ot){if(0!==te){if(!1===m&&(Je(3042),m=!0),5===te)ht=ht||Qe,Ot=Ot||Re,ie=ie||rt,(Qe!==y||ht!==b)&&(s.blendEquationSeparate(nt[Qe],nt[ht]),y=Qe,b=ht),(Re!==_||rt!==g||Ot!==M||ie!==A)&&(s.blendFuncSeparate(it[Re],it[rt],it[Ot],it[ie]),_=Re,g=rt,M=Ot,A=ie),v=te,B=null;else if(te!==v||ot!==B){if((y!==w||b!==w)&&(s.blendEquation(32774),y=w,b=w),ot)switch(te){case 1:s.blendFuncSeparate(1,771,1,771);break;case 2:s.blendFunc(1,1);break;case 3:s.blendFuncSeparate(0,0,769,771);break;case 4:s.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",te)}else switch(te){case 1:s.blendFuncSeparate(770,771,1,771);break;case 2:s.blendFunc(770,1);break;case 3:s.blendFunc(0,769);break;case 4:s.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",te)}_=null,g=null,M=null,A=null,v=te,B=ot}}else!0===m&&(Xe(3042),m=!1)}function ke(te){S!==te&&(s.frontFace(te?2304:2305),S=te)}function We(te){0!==te?(Je(2884),te!==V&&s.cullFace(1===te?1029:2===te?1028:1032)):Xe(2884),V=te}function Ye(te,Qe,Re){te?(Je(32823),(K!==Qe||J!==Re)&&(s.polygonOffset(Qe,Re),K=Qe,J=Re)):Xe(32823)}function R(te){void 0===te&&(te=33984+Ae-1),fe!==te&&(s.activeTexture(te),fe=te)}return{buffers:{color:l,depth:c,stencil:u},enable:Je,disable:Xe,bindFramebuffer:function lt(te,Qe){return null===Qe&&null!==d&&(Qe=d),f[te]!==Qe&&(s.bindFramebuffer(te,Qe),f[te]=Qe,n&&(36009===te&&(f[36160]=Qe),36160===te&&(f[36009]=Qe)),!0)},bindXRFramebuffer:function ue(te){te!==d&&(s.bindFramebuffer(36160,te),d=te)},useProgram:function ft(te){return p!==te&&(s.useProgram(te),p=te,!0)},setBlending:At,setMaterial:function xe(te,Qe){2===te.side?Xe(2884):Je(2884);let Re=1===te.side;Qe&&(Re=!Re),ke(Re),1===te.blending&&!1===te.transparent?At(0):At(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.premultipliedAlpha),c.setFunc(te.depthFunc),c.setTest(te.depthTest),c.setMask(te.depthWrite),l.setMask(te.colorWrite);const rt=te.stencilWrite;u.setTest(rt),rt&&(u.setMask(te.stencilWriteMask),u.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),u.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),Ye(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),!0===te.alphaToCoverage?Je(32926):Xe(32926)},setFlipSided:ke,setCullFace:We,setLineWidth:function mt(te){te!==ae&&(le&&s.lineWidth(te),ae=te)},setPolygonOffset:Ye,setScissorTest:function N(te){te?Je(3089):Xe(3089)},activeTexture:R,bindTexture:function be(te,Qe){null===fe&&R();let Re=we[fe];void 0===Re&&(Re={type:void 0,texture:void 0},we[fe]=Re),(Re.type!==te||Re.texture!==Qe)&&(s.bindTexture(te,Qe||Oe[te]),Re.type=te,Re.texture=Qe)},unbindTexture:function De(){const te=we[fe];void 0!==te&&void 0!==te.type&&(s.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)},compressedTexImage2D:function je(){try{s.compressedTexImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},texImage2D:function st(){try{s.texImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},texImage3D:function bt(){try{s.texImage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},scissor:function gt(te){!1===ut.equals(te)&&(s.scissor(te.x,te.y,te.z,te.w),ut.copy(te))},viewport:function Et(te){!1===$e.equals(te)&&(s.viewport(te.x,te.y,te.z,te.w),$e.copy(te))},reset:function pt(){s.disable(3042),s.disable(2884),s.disable(2929),s.disable(32823),s.disable(3089),s.disable(2960),s.disable(32926),s.blendEquation(32774),s.blendFunc(1,0),s.blendFuncSeparate(1,0,1,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(513),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(519,0,4294967295),s.stencilOp(7680,7680,7680),s.clearStencil(0),s.cullFace(1029),s.frontFace(2305),s.polygonOffset(0,0),s.activeTexture(33984),s.bindFramebuffer(36160,null),!0===n&&(s.bindFramebuffer(36009,null),s.bindFramebuffer(36008,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),h={},fe=null,we={},d=null,f={},p=null,m=!1,v=null,y=null,_=null,g=null,b=null,M=null,A=null,B=!1,S=null,V=null,ae=null,K=null,J=null,ut.set(0,0,s.canvas.width,s.canvas.height),$e.set(0,0,s.canvas.width,s.canvas.height),l.reset(),c.reset(),u.reset()}}}function F_(s,e,t,n,i,r,a){const l=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,h=i.maxTextureSize,d=i.maxSamples,f=new WeakMap;let p,m=!1;try{m=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(N,R){return m?new OffscreenCanvas(N,R):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(N,R,be,De){let je=1;if((N.width>De||N.height>De)&&(je=De/Math.max(N.width,N.height)),je<1||!0===R){if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap){const st=R?$l:Math.floor,bt=st(je*N.width),gt=st(je*N.height);void 0===p&&(p=v(bt,gt));const Et=be?v(bt,gt):p;return Et.width=bt,Et.height=gt,Et.getContext("2d").drawImage(N,0,0,bt,gt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+N.width+"x"+N.height+") to ("+bt+"x"+gt+")."),Et}return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+N.width+"x"+N.height+")."),N}return N}function _(N){return ua(N.width)&&ua(N.height)}function b(N,R){return N.generateMipmaps&&R&&N.minFilter!==rn&&N.minFilter!==Qt}function M(N,R,be,De,je=1){s.generateMipmap(N),n.get(R).__maxMipLevel=Math.log2(Math.max(be,De,je))}function A(N,R,be){if(!1===l)return R;if(null!==N){if(void 0!==s[N])return s[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let De=R;return 6403===R&&(5126===be&&(De=33326),5131===be&&(De=33325),5121===be&&(De=33321)),6407===R&&(5126===be&&(De=34837),5131===be&&(De=34843),5121===be&&(De=32849)),6408===R&&(5126===be&&(De=34836),5131===be&&(De=34842),5121===be&&(De=32856)),(33325===De||33326===De||34842===De||34836===De)&&e.get("EXT_color_buffer_float"),De}function B(N){return N===rn||1004===N||1005===N?9728:9729}function S(N){const R=N.target;R.removeEventListener("dispose",S),function ae(N){const R=n.get(N);void 0!==R.__webglInit&&(s.deleteTexture(R.__webglTexture),n.remove(N))}(R),R.isVideoTexture&&f.delete(R),a.memory.textures--}function V(N){const R=N.target;R.removeEventListener("dispose",V),function K(N){const R=N.texture,be=n.get(N),De=n.get(R);if(N){if(void 0!==De.__webglTexture&&(s.deleteTexture(De.__webglTexture),a.memory.textures--),N.depthTexture&&N.depthTexture.dispose(),N.isWebGLCubeRenderTarget)for(let je=0;je<6;je++)s.deleteFramebuffer(be.__webglFramebuffer[je]),be.__webglDepthbuffer&&s.deleteRenderbuffer(be.__webglDepthbuffer[je]);else s.deleteFramebuffer(be.__webglFramebuffer),be.__webglDepthbuffer&&s.deleteRenderbuffer(be.__webglDepthbuffer),be.__webglMultisampledFramebuffer&&s.deleteFramebuffer(be.__webglMultisampledFramebuffer),be.__webglColorRenderbuffer&&s.deleteRenderbuffer(be.__webglColorRenderbuffer),be.__webglDepthRenderbuffer&&s.deleteRenderbuffer(be.__webglDepthRenderbuffer);if(N.isWebGLMultipleRenderTargets)for(let je=0,st=R.length;je<st;je++){const bt=n.get(R[je]);bt.__webglTexture&&(s.deleteTexture(bt.__webglTexture),a.memory.textures--),n.remove(R[je])}n.remove(R),n.remove(N)}}(R)}let J=0;function ce(N,R){const be=n.get(N);if(N.isVideoTexture&&function xe(N){const R=a.render.frame;f.get(N)!==R&&(f.set(N,R),N.update())}(N),N.version>0&&be.__version!==N.version){const De=N.image;if(void 0===De)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==De.complete)return void wt(be,N,R);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+R),t.bindTexture(3553,be.__webglTexture)}function we(N,R){const be=n.get(N);N.version>0&&be.__version!==N.version?function Oe(N,R,be){if(6!==R.image.length)return;$e(N,R),t.activeTexture(33984+be),t.bindTexture(34067,N.__webglTexture),s.pixelStorei(37440,R.flipY),s.pixelStorei(37441,R.premultiplyAlpha),s.pixelStorei(3317,R.unpackAlignment),s.pixelStorei(37443,0);const De=R&&(R.isCompressedTexture||R.image[0].isCompressedTexture),je=R.image[0]&&R.image[0].isDataTexture,st=[];for(let Re=0;Re<6;Re++)st[Re]=De||je?je?R.image[Re].image:R.image[Re]:y(R.image[Re],!1,!0,u);const bt=st[0],gt=_(bt)||l,Et=r.convert(R.format),pt=r.convert(R.type),te=A(R.internalFormat,Et,pt);let Qe;if(ut(34067,R,gt),De){for(let Re=0;Re<6;Re++){Qe=st[Re].mipmaps;for(let rt=0;rt<Qe.length;rt++){const ht=Qe[rt];R.format!==Nn&&R.format!==Mi?null!==Et?t.compressedTexImage2D(34069+Re,rt,te,ht.width,ht.height,0,ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+Re,rt,te,ht.width,ht.height,0,Et,pt,ht.data)}}N.__maxMipLevel=Qe.length-1}else{Qe=R.mipmaps;for(let Re=0;Re<6;Re++)if(je){t.texImage2D(34069+Re,0,te,st[Re].width,st[Re].height,0,Et,pt,st[Re].data);for(let rt=0;rt<Qe.length;rt++){const Ot=Qe[rt].image[Re].image;t.texImage2D(34069+Re,rt+1,te,Ot.width,Ot.height,0,Et,pt,Ot.data)}}else{t.texImage2D(34069+Re,0,te,Et,pt,st[Re]);for(let rt=0;rt<Qe.length;rt++)t.texImage2D(34069+Re,rt+1,te,Et,pt,Qe[rt].image[Re])}N.__maxMipLevel=Qe.length}b(R,gt)&&M(34067,R,bt.width,bt.height),N.__version=R.version,R.onUpdate&&R.onUpdate(R)}(be,N,R):(t.activeTexture(33984+R),t.bindTexture(34067,be.__webglTexture))}const Ve={1e3:10497,[un]:33071,1002:33648},at={[rn]:9728,1004:9984,1005:9986,[Qt]:9729,1007:9985,1008:9987};function ut(N,R,be){if(be?(s.texParameteri(N,10242,Ve[R.wrapS]),s.texParameteri(N,10243,Ve[R.wrapT]),(32879===N||35866===N)&&s.texParameteri(N,32882,Ve[R.wrapR]),s.texParameteri(N,10240,at[R.magFilter]),s.texParameteri(N,10241,at[R.minFilter])):(s.texParameteri(N,10242,33071),s.texParameteri(N,10243,33071),(32879===N||35866===N)&&s.texParameteri(N,32882,33071),(R.wrapS!==un||R.wrapT!==un)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(N,10240,B(R.magFilter)),s.texParameteri(N,10241,B(R.minFilter)),R.minFilter!==rn&&R.minFilter!==Qt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const De=e.get("EXT_texture_filter_anisotropic");if(R.type===bi&&!1===e.has("OES_texture_float_linear")||!1===l&&R.type===ur&&!1===e.has("OES_texture_half_float_linear"))return;(R.anisotropy>1||n.get(R).__currentAnisotropy)&&(s.texParameterf(N,De.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R.anisotropy,i.getMaxAnisotropy())),n.get(R).__currentAnisotropy=R.anisotropy)}}function $e(N,R){void 0===N.__webglInit&&(N.__webglInit=!0,R.addEventListener("dispose",S),N.__webglTexture=s.createTexture(),a.memory.textures++)}function wt(N,R,be){let De=3553;R.isDataTexture2DArray&&(De=35866),R.isDataTexture3D&&(De=32879),$e(N,R),t.activeTexture(33984+be),t.bindTexture(De,N.__webglTexture),s.pixelStorei(37440,R.flipY),s.pixelStorei(37441,R.premultiplyAlpha),s.pixelStorei(3317,R.unpackAlignment),s.pixelStorei(37443,0);const je=function g(N){return!l&&(N.wrapS!==un||N.wrapT!==un||N.minFilter!==rn&&N.minFilter!==Qt)}(R)&&!1===_(R.image),st=y(R.image,je,!1,h),bt=_(st)||l,gt=r.convert(R.format);let te,Et=r.convert(R.type),pt=A(R.internalFormat,gt,Et);ut(De,R,bt);const Qe=R.mipmaps;if(R.isDepthTexture)pt=6402,l?pt=R.type===bi?36012:1014===R.type?33190:R.type===Kr?35056:33189:R.type===bi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),R.format===hr&&6402===pt&&1012!==R.type&&1014!==R.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),R.type=1012,Et=r.convert(R.type)),R.format===es&&6402===pt&&(pt=34041,R.type!==Kr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),R.type=Kr,Et=r.convert(R.type))),t.texImage2D(3553,0,pt,st.width,st.height,0,gt,Et,null);else if(R.isDataTexture)if(Qe.length>0&&bt){for(let Re=0,rt=Qe.length;Re<rt;Re++)te=Qe[Re],t.texImage2D(3553,Re,pt,te.width,te.height,0,gt,Et,te.data);R.generateMipmaps=!1,N.__maxMipLevel=Qe.length-1}else t.texImage2D(3553,0,pt,st.width,st.height,0,gt,Et,st.data),N.__maxMipLevel=0;else if(R.isCompressedTexture){for(let Re=0,rt=Qe.length;Re<rt;Re++)te=Qe[Re],R.format!==Nn&&R.format!==Mi?null!==gt?t.compressedTexImage2D(3553,Re,pt,te.width,te.height,0,te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,Re,pt,te.width,te.height,0,gt,Et,te.data);N.__maxMipLevel=Qe.length-1}else if(R.isDataTexture2DArray)t.texImage3D(35866,0,pt,st.width,st.height,st.depth,0,gt,Et,st.data),N.__maxMipLevel=0;else if(R.isDataTexture3D)t.texImage3D(32879,0,pt,st.width,st.height,st.depth,0,gt,Et,st.data),N.__maxMipLevel=0;else if(Qe.length>0&&bt){for(let Re=0,rt=Qe.length;Re<rt;Re++)te=Qe[Re],t.texImage2D(3553,Re,pt,gt,Et,te);R.generateMipmaps=!1,N.__maxMipLevel=Qe.length-1}else t.texImage2D(3553,0,pt,gt,Et,st),N.__maxMipLevel=0;b(R,bt)&&M(De,R,st.width,st.height),N.__version=R.version,R.onUpdate&&R.onUpdate(R)}function Je(N,R,be,De,je){const st=r.convert(be.format),bt=r.convert(be.type),gt=A(be.internalFormat,st,bt);32879===je||35866===je?t.texImage3D(je,0,gt,R.width,R.height,R.depth,0,st,bt,null):t.texImage2D(je,0,gt,R.width,R.height,0,st,bt,null),t.bindFramebuffer(36160,N),s.framebufferTexture2D(36160,De,je,n.get(be).__webglTexture,0),t.bindFramebuffer(36160,null)}function Xe(N,R,be){if(s.bindRenderbuffer(36161,N),R.depthBuffer&&!R.stencilBuffer){let De=33189;if(be){const je=R.depthTexture;je&&je.isDepthTexture&&(je.type===bi?De=36012:1014===je.type&&(De=33190));const st=At(R);s.renderbufferStorageMultisample(36161,st,De,R.width,R.height)}else s.renderbufferStorage(36161,De,R.width,R.height);s.framebufferRenderbuffer(36160,36096,36161,N)}else if(R.depthBuffer&&R.stencilBuffer){if(be){const De=At(R);s.renderbufferStorageMultisample(36161,De,35056,R.width,R.height)}else s.renderbufferStorage(36161,34041,R.width,R.height);s.framebufferRenderbuffer(36160,33306,36161,N)}else{const De=!0===R.isWebGLMultipleRenderTargets?R.texture[0]:R.texture,je=r.convert(De.format),st=r.convert(De.type),bt=A(De.internalFormat,je,st);if(be){const gt=At(R);s.renderbufferStorageMultisample(36161,gt,bt,R.width,R.height)}else s.renderbufferStorage(36161,bt,R.width,R.height)}s.bindRenderbuffer(36161,null)}function At(N){return l&&N.isWebGLMultisampleRenderTarget?Math.min(d,N.samples):0}let ke=!1,We=!1;this.allocateTextureUnit=function le(){const N=J;return N>=c&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+c),J+=1,N},this.resetTextureUnits=function Ae(){J=0},this.setTexture2D=ce,this.setTexture2DArray=function _e(N,R){const be=n.get(N);N.version>0&&be.__version!==N.version?wt(be,N,R):(t.activeTexture(33984+R),t.bindTexture(35866,be.__webglTexture))},this.setTexture3D=function fe(N,R){const be=n.get(N);N.version>0&&be.__version!==N.version?wt(be,N,R):(t.activeTexture(33984+R),t.bindTexture(32879,be.__webglTexture))},this.setTextureCube=we,this.setupRenderTarget=function ft(N){const R=N.texture,be=n.get(N),De=n.get(R);N.addEventListener("dispose",V),!0!==N.isWebGLMultipleRenderTargets&&(De.__webglTexture=s.createTexture(),De.__version=R.version,a.memory.textures++);const je=!0===N.isWebGLCubeRenderTarget,st=!0===N.isWebGLMultipleRenderTargets,bt=!0===N.isWebGLMultisampleRenderTarget,gt=R.isDataTexture3D||R.isDataTexture2DArray,Et=_(N)||l;if(l&&R.format===Mi&&(R.type===bi||R.type===ur)&&(R.format=Nn,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),je){be.__webglFramebuffer=[];for(let pt=0;pt<6;pt++)be.__webglFramebuffer[pt]=s.createFramebuffer()}else if(be.__webglFramebuffer=s.createFramebuffer(),st)if(i.drawBuffers){const pt=N.texture;for(let te=0,Qe=pt.length;te<Qe;te++){const Re=n.get(pt[te]);void 0===Re.__webglTexture&&(Re.__webglTexture=s.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(bt)if(l){be.__webglMultisampledFramebuffer=s.createFramebuffer(),be.__webglColorRenderbuffer=s.createRenderbuffer(),s.bindRenderbuffer(36161,be.__webglColorRenderbuffer);const pt=r.convert(R.format),te=r.convert(R.type),Qe=A(R.internalFormat,pt,te),Re=At(N);s.renderbufferStorageMultisample(36161,Re,Qe,N.width,N.height),t.bindFramebuffer(36160,be.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(36160,36064,36161,be.__webglColorRenderbuffer),s.bindRenderbuffer(36161,null),N.depthBuffer&&(be.__webglDepthRenderbuffer=s.createRenderbuffer(),Xe(be.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(je){t.bindTexture(34067,De.__webglTexture),ut(34067,R,Et);for(let pt=0;pt<6;pt++)Je(be.__webglFramebuffer[pt],N,R,36064,34069+pt);b(R,Et)&&M(34067,R,N.width,N.height),t.unbindTexture()}else if(st){const pt=N.texture;for(let te=0,Qe=pt.length;te<Qe;te++){const Re=pt[te],rt=n.get(Re);t.bindTexture(3553,rt.__webglTexture),ut(3553,Re,Et),Je(be.__webglFramebuffer,N,Re,36064+te,3553),b(Re,Et)&&M(3553,Re,N.width,N.height)}t.unbindTexture()}else{let pt=3553;gt&&(l?pt=R.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(pt,De.__webglTexture),ut(pt,R,Et),Je(be.__webglFramebuffer,N,R,36064,pt),b(R,Et)&&M(pt,R,N.width,N.height,N.depth),t.unbindTexture()}N.depthBuffer&&function lt(N){const R=n.get(N),be=!0===N.isWebGLCubeRenderTarget;if(N.depthTexture){if(be)throw new Error("target.depthTexture not supported in Cube render targets");!function ue(N,R){if(R&&R.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,N),!R.depthTexture||!R.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(R.depthTexture).__webglTexture||R.depthTexture.image.width!==R.width||R.depthTexture.image.height!==R.height)&&(R.depthTexture.image.width=R.width,R.depthTexture.image.height=R.height,R.depthTexture.needsUpdate=!0),ce(R.depthTexture,0);const De=n.get(R.depthTexture).__webglTexture;if(R.depthTexture.format===hr)s.framebufferTexture2D(36160,36096,3553,De,0);else{if(R.depthTexture.format!==es)throw new Error("Unknown depthTexture format");s.framebufferTexture2D(36160,33306,3553,De,0)}}(R.__webglFramebuffer,N)}else if(be){R.__webglDepthbuffer=[];for(let De=0;De<6;De++)t.bindFramebuffer(36160,R.__webglFramebuffer[De]),R.__webglDepthbuffer[De]=s.createRenderbuffer(),Xe(R.__webglDepthbuffer[De],N,!1)}else t.bindFramebuffer(36160,R.__webglFramebuffer),R.__webglDepthbuffer=s.createRenderbuffer(),Xe(R.__webglDepthbuffer,N,!1);t.bindFramebuffer(36160,null)}(N)},this.updateRenderTargetMipmap=function nt(N){const R=_(N)||l,be=!0===N.isWebGLMultipleRenderTargets?N.texture:[N.texture];for(let De=0,je=be.length;De<je;De++){const st=be[De];if(b(st,R)){const bt=N.isWebGLCubeRenderTarget?34067:3553,gt=n.get(st).__webglTexture;t.bindTexture(bt,gt),M(bt,st,N.width,N.height),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function it(N){if(N.isWebGLMultisampleRenderTarget)if(l){const R=N.width,be=N.height;let De=16384;N.depthBuffer&&(De|=256),N.stencilBuffer&&(De|=1024);const je=n.get(N);t.bindFramebuffer(36008,je.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,je.__webglFramebuffer),s.blitFramebuffer(0,0,R,be,0,0,R,be,De,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,je.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function mt(N,R){N&&N.isWebGLRenderTarget&&(!1===ke&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ke=!0),N=N.texture),ce(N,R)},this.safeSetTextureCube=function Ye(N,R){N&&N.isWebGLCubeRenderTarget&&(!1===We&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),We=!0),N=N.texture),we(N,R)}}function k_(s,e,t){const n=t.isWebGL2;return{convert:function i(r){let a;if(r===cr)return 5121;if(1017===r)return 32819;if(1018===r)return 32820;if(1019===r)return 33635;if(1010===r)return 5120;if(1011===r)return 5122;if(1012===r)return 5123;if(1013===r)return 5124;if(1014===r)return 5125;if(r===bi)return 5126;if(r===ur)return n?5131:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===r)return 6406;if(r===Mi)return 6407;if(r===Nn)return 6408;if(1024===r)return 6409;if(1025===r)return 6410;if(r===hr)return 6402;if(r===es)return 34041;if(1028===r)return 6403;if(1029===r)return 36244;if(1030===r)return 33319;if(1031===r)return 33320;if(1032===r)return 36248;if(1033===r)return 36249;if(33776===r||33777===r||33778===r||33779===r){if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===r)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===r)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===r||37496===r)&&(a=e.get("WEBGL_compressed_texture_etc"),null!==a)){if(37492===r)return a.COMPRESSED_RGB8_ETC2;if(37496===r)return a.COMPRESSED_RGBA8_ETC2_EAC}return 37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r||37840===r||37841===r||37842===r||37843===r||37844===r||37845===r||37846===r||37847===r||37848===r||37849===r||37850===r||37851===r||37852===r||37853===r?(a=e.get("WEBGL_compressed_texture_astc"),null!==a?r:null):36492===r?(a=e.get("EXT_texture_compression_bptc"),null!==a?r:null):r===Kr?n?34042:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}Za.prototype.isMeshDistanceMaterial=!0;class Xc extends Sn{constructor(e=[]){super(),this.cameras=e}}Xc.prototype.isArrayCamera=!0;class vi extends Ht{constructor(){super(),this.type="Group"}}vi.prototype.isGroup=!0;const z_={type:"move"};class qa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new vi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new vi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new vi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const l=this._targetRay,c=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==l&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(z_))),u&&e.hand){a=!0;for(const v of e.hand.values()){const y=t.getJointPose(v,n);if(void 0===u.joints[v.jointName]){const g=new vi;g.matrixAutoUpdate=!1,g.visible=!1,u.joints[v.jointName]=g,u.add(g)}const _=u.joints[v.jointName];null!==y&&(_.matrix.fromArray(y.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=y.radius),_.visible=null!==y}const f=u.joints["index-finger-tip"].position.distanceTo(u.joints["thumb-tip"].position),p=.02,m=.005;u.inputState.pinching&&f>p+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&f<=p-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1));return null!==l&&(l.visible=null!==i),null!==c&&(c.visible=null!==r),null!==u&&(u.visible=null!==a),this}}class B_ extends Si{constructor(e,t){super();const n=this,i=e.state;let r=null,a=1,l=null,c="local-floor",u=null,h=null,d=null,f=null,p=null,m=!1,v=null,y=null,_=null,g=null,b=null,M=null;const A=[],B=new Map,S=new Sn;S.layers.enable(1),S.viewport=new Zt;const V=new Sn;V.layers.enable(2),V.viewport=new Zt;const ae=[S,V],K=new Xc;K.layers.enable(1),K.layers.enable(2);let J=null,Ae=null;function le(Oe){const Je=B.get(Oe.inputSource);Je&&Je.dispatchEvent({type:Oe.type,data:Oe.inputSource})}function ce(){B.forEach(function(Oe,Je){Oe.disconnect(Je)}),B.clear(),J=null,Ae=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),d&&t.deleteFramebuffer(d),v&&t.deleteFramebuffer(v),y&&t.deleteRenderbuffer(y),_&&t.deleteRenderbuffer(_),d=null,v=null,y=null,_=null,p=null,f=null,h=null,r=null,wt.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function _e(Oe){const Je=r.inputSources;for(let Xe=0;Xe<A.length;Xe++)B.set(Je[Xe],A[Xe]);for(let Xe=0;Xe<Oe.removed.length;Xe++){const ue=Oe.removed[Xe],lt=B.get(ue);lt&&(lt.dispatchEvent({type:"disconnected",data:ue}),B.delete(ue))}for(let Xe=0;Xe<Oe.added.length;Xe++){const ue=Oe.added[Xe],lt=B.get(ue);lt&&lt.dispatchEvent({type:"connected",data:ue})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Oe){let Je=A[Oe];return void 0===Je&&(Je=new qa,A[Oe]=Je),Je.getTargetRaySpace()},this.getControllerGrip=function(Oe){let Je=A[Oe];return void 0===Je&&(Je=new qa,A[Oe]=Je),Je.getGripSpace()},this.getHand=function(Oe){let Je=A[Oe];return void 0===Je&&(Je=new qa,A[Oe]=Je),Je.getHandSpace()},this.setFramebufferScaleFactor=function(Oe){a=Oe,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Oe){c=Oe,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getBaseLayer=function(){return null!==f?f:p},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=function(){var Oe=T(function*(Je){if(r=Je,null!==r){r.addEventListener("select",le),r.addEventListener("selectstart",le),r.addEventListener("selectend",le),r.addEventListener("squeeze",le),r.addEventListener("squeezestart",le),r.addEventListener("squeezeend",le),r.addEventListener("end",ce),r.addEventListener("inputsourceschange",_e);const Xe=t.getContextAttributes();if(!0!==Xe.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers)p=new XRWebGLLayer(r,t,{antialias:Xe.antialias,alpha:Xe.alpha,depth:Xe.depth,stencil:Xe.stencil,framebufferScaleFactor:a}),r.updateRenderState({baseLayer:p});else if(t instanceof WebGLRenderingContext)p=new XRWebGLLayer(r,t,{antialias:!0,alpha:Xe.alpha,depth:Xe.depth,stencil:Xe.stencil,framebufferScaleFactor:a}),r.updateRenderState({layers:[p]});else{m=Xe.antialias;let ue=null;Xe.depth&&(M=256,Xe.stencil&&(M|=1024),b=Xe.stencil?33306:36096,ue=Xe.stencil?35056:33190);const lt={colorFormat:Xe.alpha?32856:32849,depthFormat:ue,scaleFactor:a};h=new XRWebGLBinding(r,t),f=h.createProjectionLayer(lt),d=t.createFramebuffer(),r.updateRenderState({layers:[f]}),m&&(v=t.createFramebuffer(),y=t.createRenderbuffer(),t.bindRenderbuffer(36161,y),t.renderbufferStorageMultisample(36161,4,32856,f.textureWidth,f.textureHeight),i.bindFramebuffer(36160,v),t.framebufferRenderbuffer(36160,36064,36161,y),t.bindRenderbuffer(36161,null),null!==ue&&(_=t.createRenderbuffer(),t.bindRenderbuffer(36161,_),t.renderbufferStorageMultisample(36161,4,ue,f.textureWidth,f.textureHeight),t.framebufferRenderbuffer(36160,b,36161,_),t.bindRenderbuffer(36161,null)),i.bindFramebuffer(36160,null))}l=yield r.requestReferenceSpace(c),wt.setContext(r),wt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}});return function(Je){return Oe.apply(this,arguments)}}();const fe=new P,we=new P;function at(Oe,Je){null===Je?Oe.matrixWorld.copy(Oe.matrix):Oe.matrixWorld.multiplyMatrices(Je.matrixWorld,Oe.matrix),Oe.matrixWorldInverse.copy(Oe.matrixWorld).invert()}this.updateCamera=function(Oe){if(null===r)return;K.near=V.near=S.near=Oe.near,K.far=V.far=S.far=Oe.far,(J!==K.near||Ae!==K.far)&&(r.updateRenderState({depthNear:K.near,depthFar:K.far}),J=K.near,Ae=K.far);const Je=Oe.parent,Xe=K.cameras;at(K,Je);for(let lt=0;lt<Xe.length;lt++)at(Xe[lt],Je);K.matrixWorld.decompose(K.position,K.quaternion,K.scale),Oe.position.copy(K.position),Oe.quaternion.copy(K.quaternion),Oe.scale.copy(K.scale),Oe.matrix.copy(K.matrix),Oe.matrixWorld.copy(K.matrixWorld);const ue=Oe.children;for(let lt=0,ft=ue.length;lt<ft;lt++)ue[lt].updateMatrixWorld(!0);2===Xe.length?function Ve(Oe,Je,Xe){fe.setFromMatrixPosition(Je.matrixWorld),we.setFromMatrixPosition(Xe.matrixWorld);const ue=fe.distanceTo(we),lt=Je.projectionMatrix.elements,ft=Xe.projectionMatrix.elements,nt=lt[14]/(lt[10]-1),it=lt[14]/(lt[10]+1),At=(lt[9]+1)/lt[5],xe=(lt[9]-1)/lt[5],ke=(lt[8]-1)/lt[0],We=(ft[8]+1)/ft[0],mt=nt*ke,Ye=nt*We,N=ue/(-ke+We),R=N*-ke;Je.matrixWorld.decompose(Oe.position,Oe.quaternion,Oe.scale),Oe.translateX(R),Oe.translateZ(N),Oe.matrixWorld.compose(Oe.position,Oe.quaternion,Oe.scale),Oe.matrixWorldInverse.copy(Oe.matrixWorld).invert();const be=nt+N,De=it+N;Oe.projectionMatrix.makePerspective(mt-R,Ye+(ue-R),At*it/De*be,xe*it/De*be,be,De)}(K,S,V):K.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return K},this.getFoveation=function(){return null!==f?f.fixedFoveation:null!==p?p.fixedFoveation:void 0},this.setFoveation=function(Oe){null!==f&&(f.fixedFoveation=Oe),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=Oe)};let ut=null;const wt=new pc;wt.setAnimationLoop(function $e(Oe,Je){if(u=Je.getViewerPose(l),g=Je,null!==u){const ue=u.views;null!==p&&i.bindXRFramebuffer(p.framebuffer);let lt=!1;ue.length!==K.cameras.length&&(K.cameras.length=0,lt=!0);for(let ft=0;ft<ue.length;ft++){const nt=ue[ft];let it=null;if(null!==p)it=p.getViewport(nt);else{const xe=h.getViewSubImage(f,nt);i.bindXRFramebuffer(d),void 0!==xe.depthStencilTexture&&t.framebufferTexture2D(36160,b,3553,xe.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,xe.colorTexture,0),it=xe.viewport}const At=ae[ft];At.matrix.fromArray(nt.transform.matrix),At.projectionMatrix.fromArray(nt.projectionMatrix),At.viewport.set(it.x,it.y,it.width,it.height),0===ft&&K.matrix.copy(At.matrix),!0===lt&&K.cameras.push(At)}m&&(i.bindXRFramebuffer(v),null!==M&&t.clear(M))}const Xe=r.inputSources;for(let ue=0;ue<A.length;ue++)A[ue].update(Xe[ue],Je,l);if(ut&&ut(Oe,Je),m){const ue=f.textureWidth,lt=f.textureHeight;i.bindFramebuffer(36008,v),i.bindFramebuffer(36009,d),t.invalidateFramebuffer(36008,[b]),t.invalidateFramebuffer(36009,[b]),t.blitFramebuffer(0,0,ue,lt,0,0,ue,lt,16384,9728),t.invalidateFramebuffer(36008,[36064]),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),i.bindFramebuffer(36160,v)}g=null}),this.setAnimationLoop=function(Oe){ut=Oe},this.dispose=function(){}}}function N_(s){function n(_,g){_.opacity.value=g.opacity,g.color&&_.diffuse.value.copy(g.color),g.emissive&&_.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap),g.specularMap&&(_.specularMap.value=g.specularMap),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest);const b=s.get(g).envMap;if(b){_.envMap.value=b,_.flipEnvMap.value=b.isCubeTexture&&!1===b.isRenderTargetTexture?-1:1,_.reflectivity.value=g.reflectivity,_.ior.value=g.ior,_.refractionRatio.value=g.refractionRatio;const B=s.get(b).__maxMipLevel;void 0!==B&&(_.maxMipLevel.value=B)}let M,A;g.lightMap&&(_.lightMap.value=g.lightMap,_.lightMapIntensity.value=g.lightMapIntensity),g.aoMap&&(_.aoMap.value=g.aoMap,_.aoMapIntensity.value=g.aoMapIntensity),g.map?M=g.map:g.specularMap?M=g.specularMap:g.displacementMap?M=g.displacementMap:g.normalMap?M=g.normalMap:g.bumpMap?M=g.bumpMap:g.roughnessMap?M=g.roughnessMap:g.metalnessMap?M=g.metalnessMap:g.alphaMap?M=g.alphaMap:g.emissiveMap?M=g.emissiveMap:g.clearcoatMap?M=g.clearcoatMap:g.clearcoatNormalMap?M=g.clearcoatNormalMap:g.clearcoatRoughnessMap?M=g.clearcoatRoughnessMap:g.specularIntensityMap?M=g.specularIntensityMap:g.specularTintMap?M=g.specularTintMap:g.transmissionMap?M=g.transmissionMap:g.thicknessMap&&(M=g.thicknessMap),void 0!==M&&(M.isWebGLRenderTarget&&(M=M.texture),!0===M.matrixAutoUpdate&&M.updateMatrix(),_.uvTransform.value.copy(M.matrix)),g.aoMap?A=g.aoMap:g.lightMap&&(A=g.lightMap),void 0!==A&&(A.isWebGLRenderTarget&&(A=A.texture),!0===A.matrixAutoUpdate&&A.updateMatrix(),_.uv2Transform.value.copy(A.matrix))}function d(_,g){_.roughness.value=g.roughness,_.metalness.value=g.metalness,g.roughnessMap&&(_.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(_.metalnessMap.value=g.metalnessMap),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),s.get(g).envMap&&(_.envMapIntensity.value=g.envMapIntensity)}return{refreshFogUniforms:function e(_,g){_.fogColor.value.copy(g.color),g.isFog?(_.fogNear.value=g.near,_.fogFar.value=g.far):g.isFogExp2&&(_.fogDensity.value=g.density)},refreshMaterialUniforms:function t(_,g,b,M,A){g.isMeshBasicMaterial?n(_,g):g.isMeshLambertMaterial?(n(_,g),function c(_,g){g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap)}(_,g)):g.isMeshToonMaterial?(n(_,g),function h(_,g){g.gradientMap&&(_.gradientMap.value=g.gradientMap),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}(_,g)):g.isMeshPhongMaterial?(n(_,g),function u(_,g){_.specular.value.copy(g.specular),_.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}(_,g)):g.isMeshStandardMaterial?(n(_,g),g.isMeshPhysicalMaterial?function f(_,g,b){d(_,g),_.ior.value=g.ior,g.sheenTint&&_.sheenTint.value.copy(g.sheenTint),g.clearcoat>0&&(_.clearcoat.value=g.clearcoat,_.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(_.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),_.clearcoatNormalMap.value=g.clearcoatNormalMap,1===g.side&&_.clearcoatNormalScale.value.negate())),g.transmission>0&&(_.transmission.value=g.transmission,_.transmissionSamplerMap.value=b.texture,_.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(_.transmissionMap.value=g.transmissionMap),_.thickness.value=g.thickness,g.thicknessMap&&(_.thicknessMap.value=g.thicknessMap),_.attenuationDistance.value=g.attenuationDistance,_.attenuationTint.value.copy(g.attenuationTint)),_.specularIntensity.value=g.specularIntensity,_.specularTint.value.copy(g.specularTint),g.specularIntensityMap&&(_.specularIntensityMap.value=g.specularIntensityMap),g.specularTintMap&&(_.specularTintMap.value=g.specularTintMap)}(_,g,A):d(_,g)):g.isMeshMatcapMaterial?(n(_,g),function p(_,g){g.matcap&&(_.matcap.value=g.matcap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}(_,g)):g.isMeshDepthMaterial?(n(_,g),function m(_,g){g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}(_,g)):g.isMeshDistanceMaterial?(n(_,g),function v(_,g){g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),_.referencePosition.value.copy(g.referencePosition),_.nearDistance.value=g.nearDistance,_.farDistance.value=g.farDistance}(_,g)):g.isMeshNormalMaterial?(n(_,g),function y(_,g){g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}(_,g)):g.isLineBasicMaterial?(function i(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity}(_,g),g.isLineDashedMaterial&&function r(_,g){_.dashSize.value=g.dashSize,_.totalSize.value=g.dashSize+g.gapSize,_.scale.value=g.scale}(_,g)):g.isPointsMaterial?function a(_,g,b,M){let A;_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.size.value=g.size*b,_.scale.value=.5*M,g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest),g.map?A=g.map:g.alphaMap&&(A=g.alphaMap),void 0!==A&&(!0===A.matrixAutoUpdate&&A.updateMatrix(),_.uvTransform.value.copy(A.matrix))}(_,g,b,M):g.isSpriteMaterial?function l(_,g){let b;_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.rotation.value=g.rotation,g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest),g.map?b=g.map:g.alphaMap&&(b=g.alphaMap),void 0!==b&&(!0===b.matrixAutoUpdate&&b.updateMatrix(),_.uvTransform.value.copy(b.matrix))}(_,g):g.isShadowMaterial?(_.color.value.copy(g.color),_.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function qt(s={}){const e=void 0!==s.canvas?s.canvas:function U_(){const s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return s.style.display="block",s}(),t=void 0!==s.context?s.context:null,n=void 0!==s.alpha&&s.alpha,i=void 0===s.depth||s.depth,r=void 0===s.stencil||s.stencil,a=void 0!==s.antialias&&s.antialias,l=void 0===s.premultipliedAlpha||s.premultipliedAlpha,c=void 0!==s.preserveDrawingBuffer&&s.preserveDrawingBuffer,u=void 0!==s.powerPreference?s.powerPreference:"default",h=void 0!==s.failIfMajorPerformanceCaveat&&s.failIfMajorPerformanceCaveat;let d=null,f=null;const p=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Un,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let y=!1,_=0,g=0,b=null,M=-1,A=null;const B=new Zt,S=new Zt;let V=null,ae=e.width,K=e.height,J=1,Ae=null,le=null;const ce=new Zt(0,0,ae,K),_e=new Zt(0,0,ae,K);let fe=!1;const we=[],Ve=new us;let at=!1,ut=!1,$e=null;const wt=new dt,Oe=new P,Je={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Xe(){return null===b?J:1}let ft,nt,it,At,xe,ke,We,mt,Ye,N,R,be,De,je,st,bt,gt,Et,pt,te,Qe,Re,rt,ue=t;function lt(L,de){for(let se=0;se<L.length;se++){const Be=e.getContext(L[se],de);if(null!==Be)return Be}return null}try{const L={alpha:n,depth:i,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",ie,!1),e.addEventListener("webglcontextrestored",ot,!1),null===ue){const de=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&de.shift(),ue=lt(de,L),null===ue)throw lt(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(L){throw console.error("THREE.WebGLRenderer: "+L.message),L}function ht(){ft=new cg(ue),nt=new tg(ue,ft,s),ft.init(nt),Re=new k_(ue,ft,nt),it=new D_(ue,ft,nt),we[0]=1029,At=new dg(ue),xe=new M_,ke=new F_(ue,ft,it,xe,nt,Re,At),We=new ig(v),mt=new lg(v),Ye=new Tf(ue,nt),rt=new Km(ue,ft,Ye,nt),N=new ug(ue,Ye,At,rt),R=new gg(ue,N,Ye,At),pt=new mg(ue),bt=new ng(xe),be=new b_(v,We,mt,ft,nt,rt,bt),De=new N_(xe),je=new T_(xe),st=new I_(ft,nt),Et=new $m(v,We,it,R,l),gt=new Jc(v,R,nt),te=new eg(ue,ft,At,nt),Qe=new hg(ue,ft,At,nt),At.programs=be.programs,v.capabilities=nt,v.extensions=ft,v.properties=xe,v.renderLists=je,v.shadowMap=gt,v.state=it,v.info=At}ht();const Ot=new B_(v,ue);function ie(L){L.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const L=At.autoReset,de=gt.enabled,se=gt.autoUpdate,ye=gt.needsUpdate,Be=gt.type;ht(),At.autoReset=L,gt.enabled=de,gt.autoUpdate=se,gt.needsUpdate=ye,gt.type=Be}function Jt(L){const de=L.target;de.removeEventListener("dispose",Jt),function Dt(L){(function ln(L){const de=xe.get(L).programs;void 0!==de&&de.forEach(function(se){be.releaseProgram(se)})})(L),xe.remove(L)}(de)}this.xr=Ot,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const L=ft.get("WEBGL_lose_context");L&&L.loseContext()},this.forceContextRestore=function(){const L=ft.get("WEBGL_lose_context");L&&L.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(L){void 0!==L&&(J=L,this.setSize(ae,K,!1))},this.getSize=function(L){return L.set(ae,K)},this.setSize=function(L,de,se){Ot.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ae=L,K=de,e.width=Math.floor(L*J),e.height=Math.floor(de*J),!1!==se&&(e.style.width=L+"px",e.style.height=de+"px"),this.setViewport(0,0,L,de))},this.getDrawingBufferSize=function(L){return L.set(ae*J,K*J).floor()},this.setDrawingBufferSize=function(L,de,se){ae=L,K=de,J=se,e.width=Math.floor(L*se),e.height=Math.floor(de*se),this.setViewport(0,0,L,de)},this.getCurrentViewport=function(L){return L.copy(B)},this.getViewport=function(L){return L.copy(ce)},this.setViewport=function(L,de,se,ye){L.isVector4?ce.set(L.x,L.y,L.z,L.w):ce.set(L,de,se,ye),it.viewport(B.copy(ce).multiplyScalar(J).floor())},this.getScissor=function(L){return L.copy(_e)},this.setScissor=function(L,de,se,ye){L.isVector4?_e.set(L.x,L.y,L.z,L.w):_e.set(L,de,se,ye),it.scissor(S.copy(_e).multiplyScalar(J).floor())},this.getScissorTest=function(){return fe},this.setScissorTest=function(L){it.setScissorTest(fe=L)},this.setOpaqueSort=function(L){Ae=L},this.setTransparentSort=function(L){le=L},this.getClearColor=function(L){return L.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(L,de,se){let ye=0;(void 0===L||L)&&(ye|=16384),(void 0===de||de)&&(ye|=256),(void 0===se||se)&&(ye|=1024),ue.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ie,!1),e.removeEventListener("webglcontextrestored",ot,!1),je.dispose(),st.dispose(),xe.dispose(),We.dispose(),mt.dispose(),R.dispose(),rt.dispose(),Ot.dispose(),Ot.removeEventListener("sessionstart",Xn),Ot.removeEventListener("sessionend",Yn),$e&&($e.dispose(),$e=null),sr.stop()},this.renderBufferImmediate=function(L,de){rt.initAttributes();const se=xe.get(L);L.hasPositions&&!se.position&&(se.position=ue.createBuffer()),L.hasNormals&&!se.normal&&(se.normal=ue.createBuffer()),L.hasUvs&&!se.uv&&(se.uv=ue.createBuffer()),L.hasColors&&!se.color&&(se.color=ue.createBuffer());const ye=de.getAttributes();L.hasPositions&&(ue.bindBuffer(34962,se.position),ue.bufferData(34962,L.positionArray,35048),rt.enableAttribute(ye.position.location),ue.vertexAttribPointer(ye.position.location,3,5126,!1,0,0)),L.hasNormals&&(ue.bindBuffer(34962,se.normal),ue.bufferData(34962,L.normalArray,35048),rt.enableAttribute(ye.normal.location),ue.vertexAttribPointer(ye.normal.location,3,5126,!1,0,0)),L.hasUvs&&(ue.bindBuffer(34962,se.uv),ue.bufferData(34962,L.uvArray,35048),rt.enableAttribute(ye.uv.location),ue.vertexAttribPointer(ye.uv.location,2,5126,!1,0,0)),L.hasColors&&(ue.bindBuffer(34962,se.color),ue.bufferData(34962,L.colorArray,35048),rt.enableAttribute(ye.color.location),ue.vertexAttribPointer(ye.color.location,3,5126,!1,0,0)),rt.disableUnusedAttributes(),ue.drawArrays(4,0,L.count),L.count=0},this.renderBufferDirect=function(L,de,se,ye,Be,It){null===de&&(de=Je);const St=Be.isMesh&&Be.matrixWorld.determinant()<0,Mt=Bh(L,de,ye,Be);it.setMaterial(ye,St);let kt=se.index;const Wt=se.attributes.position;if(null===kt){if(void 0===Wt||0===Wt.count)return}else if(0===kt.count)return;let Bt=1;!0===ye.wireframe&&(kt=N.getWireframeAttribute(se),Bt=2),(void 0!==se.morphAttributes.position||void 0!==se.morphAttributes.normal)&&pt.update(Be,se,ye,Mt),rt.setup(Be,ye,Mt,se,kt);let Ut,Ct=te;null!==kt&&(Ut=Ye.get(kt),Ct=Qe,Ct.setIndex(Ut));const or=null!==kt?kt.count:Wt.count,fn=se.drawRange.start*Bt,Gi=se.drawRange.count*Bt,ni=null!==It?It.start*Bt:0,ar=null!==It?It.count*Bt:1/0,Vi=Math.max(fn,ni),xn=Math.min(or,fn+Gi,ni+ar)-1,ui=Math.max(0,xn-Vi+1);if(0!==ui){if(Be.isMesh)!0===ye.wireframe?(it.setLineWidth(ye.wireframeLinewidth*Xe()),Ct.setMode(1)):Ct.setMode(4);else if(Be.isLine){let Cn=ye.linewidth;void 0===Cn&&(Cn=1),it.setLineWidth(Cn*Xe()),Ct.setMode(Be.isLineSegments?1:Be.isLineLoop?2:3)}else Be.isPoints?Ct.setMode(0):Be.isSprite&&Ct.setMode(4);if(Be.isInstancedMesh)Ct.renderInstances(Vi,ui,Be.count);else if(se.isInstancedBufferGeometry){const Cn=Math.min(se.instanceCount,se._maxInstanceCount);Ct.renderInstances(Vi,ui,Cn)}else Ct.render(Vi,ui)}},this.compile=function(L,de){f=st.get(L),f.init(),m.push(f),L.traverseVisible(function(se){se.isLight&&se.layers.test(de.layers)&&(f.pushLight(se),se.castShadow&&f.pushShadow(se))}),f.setupLights(v.physicallyCorrectLights),L.traverse(function(se){const ye=se.material;if(ye)if(Array.isArray(ye))for(let Be=0;Be<ye.length;Be++)Dl(ye[Be],L,se);else Dl(ye,L,se)}),m.pop(),f=null};let Hi=null;function Xn(){sr.stop()}function Yn(){sr.start()}const sr=new pc;function Fh(L,de,se,ye){if(!1===L.visible)return;if(L.layers.test(de.layers))if(L.isGroup)se=L.renderOrder;else if(L.isLOD)!0===L.autoUpdate&&L.update(de);else if(L.isLight)f.pushLight(L),L.castShadow&&f.pushShadow(L);else if(L.isSprite){if(!L.frustumCulled||Ve.intersectsSprite(L)){ye&&Oe.setFromMatrixPosition(L.matrixWorld).applyMatrix4(wt);const St=R.update(L),Mt=L.material;Mt.visible&&d.push(L,St,Mt,se,Oe.z,null)}}else if(L.isImmediateRenderObject)ye&&Oe.setFromMatrixPosition(L.matrixWorld).applyMatrix4(wt),d.push(L,null,L.material,se,Oe.z,null);else if((L.isMesh||L.isLine||L.isPoints)&&(L.isSkinnedMesh&&L.skeleton.frame!==At.render.frame&&(L.skeleton.update(),L.skeleton.frame=At.render.frame),!L.frustumCulled||Ve.intersectsObject(L))){ye&&Oe.setFromMatrixPosition(L.matrixWorld).applyMatrix4(wt);const St=R.update(L),Mt=L.material;if(Array.isArray(Mt)){const kt=St.groups;for(let Wt=0,Bt=kt.length;Wt<Bt;Wt++){const Ut=kt[Wt],Ct=Mt[Ut.materialIndex];Ct&&Ct.visible&&d.push(L,St,Ct,se,Oe.z,Ut)}}else Mt.visible&&d.push(L,St,Mt,se,Oe.z,null)}const It=L.children;for(let St=0,Mt=It.length;St<Mt;St++)Fh(It[St],de,se,ye)}function kh(L,de,se,ye){const Be=L.opaque,It=L.transmissive,St=L.transparent;f.setupLightsView(se),It.length>0&&function ux(L,de,se){null===$e&&($e=new(!0===a&&!0===nt.isWebGL2?Kl:ri)(1024,1024,{generateMipmaps:!0,type:null!==Re.convert(ur)?ur:cr,minFilter:1008,magFilter:rn,wrapS:un,wrapT:un}));const ye=v.getRenderTarget();v.setRenderTarget($e),v.clear();const Be=v.toneMapping;v.toneMapping=0,na(L,de,se),v.toneMapping=Be,ke.updateMultisampleRenderTarget($e),ke.updateRenderTargetMipmap($e),v.setRenderTarget(ye)}(Be,de,se),ye&&it.viewport(B.copy(ye)),Be.length>0&&na(Be,de,se),It.length>0&&na(It,de,se),St.length>0&&na(St,de,se)}function na(L,de,se){const ye=!0===de.isScene?de.overrideMaterial:null;for(let Be=0,It=L.length;Be<It;Be++){const St=L[Be],Mt=St.object,kt=St.geometry,Wt=null===ye?St.material:ye,Bt=St.group;Mt.layers.test(se.layers)&&hx(Mt,de,se,kt,Wt,Bt)}}function hx(L,de,se,ye,Be,It){if(L.onBeforeRender(v,de,se,ye,Be,It),L.modelViewMatrix.multiplyMatrices(se.matrixWorldInverse,L.matrixWorld),L.normalMatrix.getNormalMatrix(L.modelViewMatrix),L.isImmediateRenderObject){const St=Bh(se,de,Be,L);it.setMaterial(Be),rt.reset(),function Rn(L,de){L.render(function(se){v.renderBufferImmediate(se,de)})}(L,St)}else!0===Be.transparent&&2===Be.side?(Be.side=1,Be.needsUpdate=!0,v.renderBufferDirect(se,de,ye,Be,L,It),Be.side=0,Be.needsUpdate=!0,v.renderBufferDirect(se,de,ye,Be,L,It),Be.side=2):v.renderBufferDirect(se,de,ye,Be,L,It);L.onAfterRender(v,de,se,ye,Be,It)}function Dl(L,de,se){!0!==de.isScene&&(de=Je);const ye=xe.get(L),Be=f.state.lights,St=Be.state.version,Mt=be.getParameters(L,Be.state,f.state.shadowsArray,de,se),kt=be.getProgramCacheKey(Mt);let Wt=ye.programs;ye.environment=L.isMeshStandardMaterial?de.environment:null,ye.fog=de.fog,ye.envMap=(L.isMeshStandardMaterial?mt:We).get(L.envMap||ye.environment),void 0===Wt&&(L.addEventListener("dispose",Jt),Wt=new Map,ye.programs=Wt);let Bt=Wt.get(kt);if(void 0!==Bt){if(ye.currentProgram===Bt&&ye.lightsStateVersion===St)return zh(L,Mt),Bt}else Mt.uniforms=be.getUniforms(L),L.onBuild(Mt,v),L.onBeforeCompile(Mt,v),Bt=be.acquireProgram(Mt,kt),Wt.set(kt,Bt),ye.uniforms=Mt.uniforms;const Ut=ye.uniforms;(!L.isShaderMaterial&&!L.isRawShaderMaterial||!0===L.clipping)&&(Ut.clippingPlanes=bt.uniform),zh(L,Mt),ye.needsLights=function fx(L){return L.isMeshLambertMaterial||L.isMeshToonMaterial||L.isMeshPhongMaterial||L.isMeshStandardMaterial||L.isShadowMaterial||L.isShaderMaterial&&!0===L.lights}(L),ye.lightsStateVersion=St,ye.needsLights&&(Ut.ambientLightColor.value=Be.state.ambient,Ut.lightProbe.value=Be.state.probe,Ut.directionalLights.value=Be.state.directional,Ut.directionalLightShadows.value=Be.state.directionalShadow,Ut.spotLights.value=Be.state.spot,Ut.spotLightShadows.value=Be.state.spotShadow,Ut.rectAreaLights.value=Be.state.rectArea,Ut.ltc_1.value=Be.state.rectAreaLTC1,Ut.ltc_2.value=Be.state.rectAreaLTC2,Ut.pointLights.value=Be.state.point,Ut.pointLightShadows.value=Be.state.pointShadow,Ut.hemisphereLights.value=Be.state.hemi,Ut.directionalShadowMap.value=Be.state.directionalShadowMap,Ut.directionalShadowMatrix.value=Be.state.directionalShadowMatrix,Ut.spotShadowMap.value=Be.state.spotShadowMap,Ut.spotShadowMatrix.value=Be.state.spotShadowMatrix,Ut.pointShadowMap.value=Be.state.pointShadowMap,Ut.pointShadowMatrix.value=Be.state.pointShadowMatrix);const Ct=Bt.getUniforms(),or=Fi.seqWithValue(Ct.seq,Ut);return ye.currentProgram=Bt,ye.uniformsList=or,Bt}function zh(L,de){const se=xe.get(L);se.outputEncoding=de.outputEncoding,se.instancing=de.instancing,se.skinning=de.skinning,se.morphTargets=de.morphTargets,se.morphNormals=de.morphNormals,se.numClippingPlanes=de.numClippingPlanes,se.numIntersection=de.numClipIntersection,se.vertexAlphas=de.vertexAlphas,se.vertexTangents=de.vertexTangents}function Bh(L,de,se,ye){!0!==de.isScene&&(de=Je),ke.resetTextureUnits();const Be=de.fog,St=null===b?v.outputEncoding:b.texture.encoding,Mt=(se.isMeshStandardMaterial?mt:We).get(se.envMap||(se.isMeshStandardMaterial?de.environment:null)),kt=!0===se.vertexColors&&!!ye.geometry&&!!ye.geometry.attributes.color&&4===ye.geometry.attributes.color.itemSize,Wt=!!ye.geometry&&!!ye.geometry.attributes.tangent,Bt=!!ye.geometry&&!!ye.geometry.morphAttributes.position,Ut=!!ye.geometry&&!!ye.geometry.morphAttributes.normal,Ct=xe.get(se),or=f.state.lights;!0!==at||!0!==ut&&L===A||bt.setState(se,L,L===A&&se.id===M);let fn=!1;se.version===Ct.__version?(Ct.needsLights&&Ct.lightsStateVersion!==or.state.version||Ct.outputEncoding!==St||ye.isInstancedMesh&&!1===Ct.instancing||!ye.isInstancedMesh&&!0===Ct.instancing||ye.isSkinnedMesh&&!1===Ct.skinning||!ye.isSkinnedMesh&&!0===Ct.skinning||Ct.envMap!==Mt||se.fog&&Ct.fog!==Be||void 0!==Ct.numClippingPlanes&&(Ct.numClippingPlanes!==bt.numPlanes||Ct.numIntersection!==bt.numIntersection)||Ct.vertexAlphas!==kt||Ct.vertexTangents!==Wt||Ct.morphTargets!==Bt||Ct.morphNormals!==Ut)&&(fn=!0):(fn=!0,Ct.__version=se.version);let Gi=Ct.currentProgram;!0===fn&&(Gi=Dl(se,de,ye));let ni=!1,ar=!1,Vi=!1;const xn=Gi.getUniforms(),ui=Ct.uniforms;if(it.useProgram(Gi.program)&&(ni=!0,ar=!0,Vi=!0),se.id!==M&&(M=se.id,ar=!0),ni||A!==L){if(xn.setValue(ue,"projectionMatrix",L.projectionMatrix),nt.logarithmicDepthBuffer&&xn.setValue(ue,"logDepthBufFC",2/(Math.log(L.far+1)/Math.LN2)),A!==L&&(A=L,ar=!0,Vi=!0),se.isShaderMaterial||se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshStandardMaterial||se.envMap){const Cn=xn.map.cameraPosition;void 0!==Cn&&Cn.setValue(ue,Oe.setFromMatrixPosition(L.matrixWorld))}(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial)&&xn.setValue(ue,"isOrthographic",!0===L.isOrthographicCamera),(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial||se.isShadowMaterial||ye.isSkinnedMesh)&&xn.setValue(ue,"viewMatrix",L.matrixWorldInverse)}if(ye.isSkinnedMesh){xn.setOptional(ue,ye,"bindMatrix"),xn.setOptional(ue,ye,"bindMatrixInverse");const Cn=ye.skeleton;Cn&&(nt.floatVertexTextures?(null===Cn.boneTexture&&Cn.computeBoneTexture(),xn.setValue(ue,"boneTexture",Cn.boneTexture,ke),xn.setValue(ue,"boneTextureSize",Cn.boneTextureSize)):xn.setOptional(ue,Cn,"boneMatrices"))}return(ar||Ct.receiveShadow!==ye.receiveShadow)&&(Ct.receiveShadow=ye.receiveShadow,xn.setValue(ue,"receiveShadow",ye.receiveShadow)),ar&&(xn.setValue(ue,"toneMappingExposure",v.toneMappingExposure),Ct.needsLights&&function dx(L,de){L.ambientLightColor.needsUpdate=de,L.lightProbe.needsUpdate=de,L.directionalLights.needsUpdate=de,L.directionalLightShadows.needsUpdate=de,L.pointLights.needsUpdate=de,L.pointLightShadows.needsUpdate=de,L.spotLights.needsUpdate=de,L.spotLightShadows.needsUpdate=de,L.rectAreaLights.needsUpdate=de,L.hemisphereLights.needsUpdate=de}(ui,Vi),Be&&se.fog&&De.refreshFogUniforms(ui,Be),De.refreshMaterialUniforms(ui,se,J,K,$e),Fi.upload(ue,Ct.uniformsList,ui,ke)),se.isShaderMaterial&&!0===se.uniformsNeedUpdate&&(Fi.upload(ue,Ct.uniformsList,ui,ke),se.uniformsNeedUpdate=!1),se.isSpriteMaterial&&xn.setValue(ue,"center",ye.center),xn.setValue(ue,"modelViewMatrix",ye.modelViewMatrix),xn.setValue(ue,"normalMatrix",ye.normalMatrix),xn.setValue(ue,"modelMatrix",ye.matrixWorld),Gi}sr.setAnimationLoop(function ta(L){Hi&&Hi(L)}),typeof window<"u"&&sr.setContext(window),this.setAnimationLoop=function(L){Hi=L,Ot.setAnimationLoop(L),null===L?sr.stop():sr.start()},Ot.addEventListener("sessionstart",Xn),Ot.addEventListener("sessionend",Yn),this.render=function(L,de){if(void 0===de||!0===de.isCamera){if(!0!==y){if(!0===L.autoUpdate&&L.updateMatrixWorld(),null===de.parent&&de.updateMatrixWorld(),!0===Ot.enabled&&!0===Ot.isPresenting&&(!0===Ot.cameraAutoUpdate&&Ot.updateCamera(de),de=Ot.getCamera()),!0===L.isScene&&L.onBeforeRender(v,L,de,b),f=st.get(L,m.length),f.init(),m.push(f),wt.multiplyMatrices(de.projectionMatrix,de.matrixWorldInverse),Ve.setFromProjectionMatrix(wt),ut=this.localClippingEnabled,at=bt.init(this.clippingPlanes,ut,de),d=je.get(L,p.length),d.init(),p.push(d),Fh(L,de,0,v.sortObjects),d.finish(),!0===v.sortObjects&&d.sort(Ae,le),!0===at&&bt.beginShadows(),gt.render(f.state.shadowsArray,L,de),!0===at&&bt.endShadows(),!0===this.info.autoReset&&this.info.reset(),Et.render(d,L),f.setupLights(v.physicallyCorrectLights),de.isArrayCamera){const ye=de.cameras;for(let Be=0,It=ye.length;Be<It;Be++){const St=ye[Be];kh(d,L,St,St.viewport)}}else kh(d,L,de);null!==b&&(ke.updateMultisampleRenderTarget(b),ke.updateRenderTargetMipmap(b)),!0===L.isScene&&L.onAfterRender(v,L,de),it.buffers.depth.setTest(!0),it.buffers.depth.setMask(!0),it.buffers.color.setMask(!0),it.setPolygonOffset(!1),rt.resetDefaultState(),M=-1,A=null,m.pop(),f=m.length>0?m[m.length-1]:null,p.pop(),d=p.length>0?p[p.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return b},this.setRenderTarget=function(L,de=0,se=0){b=L,_=de,g=se,L&&void 0===xe.get(L).__webglFramebuffer&&ke.setupRenderTarget(L);let ye=null,Be=!1,It=!1;if(L){const Mt=L.texture;(Mt.isDataTexture3D||Mt.isDataTexture2DArray)&&(It=!0);const kt=xe.get(L).__webglFramebuffer;L.isWebGLCubeRenderTarget?(ye=kt[de],Be=!0):ye=L.isWebGLMultisampleRenderTarget?xe.get(L).__webglMultisampledFramebuffer:kt,B.copy(L.viewport),S.copy(L.scissor),V=L.scissorTest}else B.copy(ce).multiplyScalar(J).floor(),S.copy(_e).multiplyScalar(J).floor(),V=fe;if(it.bindFramebuffer(36160,ye)&&nt.drawBuffers){let Mt=!1;if(L)if(L.isWebGLMultipleRenderTargets){const kt=L.texture;if(we.length!==kt.length||36064!==we[0]){for(let Wt=0,Bt=kt.length;Wt<Bt;Wt++)we[Wt]=36064+Wt;we.length=kt.length,Mt=!0}}else(1!==we.length||36064!==we[0])&&(we[0]=36064,we.length=1,Mt=!0);else(1!==we.length||1029!==we[0])&&(we[0]=1029,we.length=1,Mt=!0);Mt&&(nt.isWebGL2?ue.drawBuffers(we):ft.get("WEBGL_draw_buffers").drawBuffersWEBGL(we))}if(it.viewport(B),it.scissor(S),it.setScissorTest(V),Be){const Mt=xe.get(L.texture);ue.framebufferTexture2D(36160,36064,34069+de,Mt.__webglTexture,se)}else if(It){const Mt=xe.get(L.texture);ue.framebufferTextureLayer(36160,36064,Mt.__webglTexture,se||0,de||0)}M=-1},this.readRenderTargetPixels=function(L,de,se,ye,Be,It,St){if(!L||!L.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Mt=xe.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&void 0!==St&&(Mt=Mt[St]),Mt){it.bindFramebuffer(36160,Mt);try{const kt=L.texture,Wt=kt.format,Bt=kt.type;if(Wt!==Nn&&Re.convert(Wt)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Ut=Bt===ur&&(ft.has("EXT_color_buffer_half_float")||nt.isWebGL2&&ft.has("EXT_color_buffer_float"));if(!(Bt===cr||Re.convert(Bt)===ue.getParameter(35738)||Bt===bi&&(nt.isWebGL2||ft.has("OES_texture_float")||ft.has("WEBGL_color_buffer_float"))||Ut))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?de>=0&&de<=L.width-ye&&se>=0&&se<=L.height-Be&&ue.readPixels(de,se,ye,Be,Re.convert(Wt),Re.convert(Bt),It):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const kt=null!==b?xe.get(b).__webglFramebuffer:null;it.bindFramebuffer(36160,kt)}}},this.copyFramebufferToTexture=function(L,de,se=0){const ye=Math.pow(2,-se),Be=Math.floor(de.image.width*ye),It=Math.floor(de.image.height*ye);let St=Re.convert(de.format);nt.isWebGL2&&(6407===St&&(St=32849),6408===St&&(St=32856)),ke.setTexture2D(de,0),ue.copyTexImage2D(3553,se,St,L.x,L.y,Be,It,0),it.unbindTexture()},this.copyTextureToTexture=function(L,de,se,ye=0){const Be=de.image.width,It=de.image.height,St=Re.convert(se.format),Mt=Re.convert(se.type);ke.setTexture2D(se,0),ue.pixelStorei(37440,se.flipY),ue.pixelStorei(37441,se.premultiplyAlpha),ue.pixelStorei(3317,se.unpackAlignment),de.isDataTexture?ue.texSubImage2D(3553,ye,L.x,L.y,Be,It,St,Mt,de.image.data):de.isCompressedTexture?ue.compressedTexSubImage2D(3553,ye,L.x,L.y,de.mipmaps[0].width,de.mipmaps[0].height,St,de.mipmaps[0].data):ue.texSubImage2D(3553,ye,L.x,L.y,St,Mt,de.image),0===ye&&se.generateMipmaps&&ue.generateMipmap(3553),it.unbindTexture()},this.copyTextureToTexture3D=function(L,de,se,ye,Be=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const It=L.max.x-L.min.x+1,St=L.max.y-L.min.y+1,Mt=L.max.z-L.min.z+1,kt=Re.convert(ye.format),Wt=Re.convert(ye.type);let Bt;if(ye.isDataTexture3D)ke.setTexture3D(ye,0),Bt=32879;else{if(!ye.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ke.setTexture2DArray(ye,0),Bt=35866}ue.pixelStorei(37440,ye.flipY),ue.pixelStorei(37441,ye.premultiplyAlpha),ue.pixelStorei(3317,ye.unpackAlignment);const Ut=ue.getParameter(3314),Ct=ue.getParameter(32878),or=ue.getParameter(3316),fn=ue.getParameter(3315),Gi=ue.getParameter(32877),ni=se.isCompressedTexture?se.mipmaps[0]:se.image;ue.pixelStorei(3314,ni.width),ue.pixelStorei(32878,ni.height),ue.pixelStorei(3316,L.min.x),ue.pixelStorei(3315,L.min.y),ue.pixelStorei(32877,L.min.z),se.isDataTexture||se.isDataTexture3D?ue.texSubImage3D(Bt,Be,de.x,de.y,de.z,It,St,Mt,kt,Wt,ni.data):se.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(Bt,Be,de.x,de.y,de.z,It,St,Mt,kt,ni.data)):ue.texSubImage3D(Bt,Be,de.x,de.y,de.z,It,St,Mt,kt,Wt,ni),ue.pixelStorei(3314,Ut),ue.pixelStorei(32878,Ct),ue.pixelStorei(3316,or),ue.pixelStorei(3315,fn),ue.pixelStorei(32877,Gi),0===Be&&ye.generateMipmaps&&ue.generateMipmap(Bt),it.unbindTexture()},this.initTexture=function(L){ke.setTexture2D(L,0),it.unbindTexture()},this.resetState=function(){_=0,g=0,b=null,it.reset(),rt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class H_ extends qt{}).prototype.isWebGL1Renderer=!0;class lo{constructor(e,t=25e-5){this.name="",this.color=new Ke(e),this.density=t}clone(){return new lo(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}lo.prototype.isFogExp2=!0;class co{constructor(e,t=1,n=1e3){this.name="",this.color=new Ke(e),this.near=t,this.far=n}clone(){return new co(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}co.prototype.isFog=!0;class uo extends Ht{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}uo.prototype.isScene=!0;class zr{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ts,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Hn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Hn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Hn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}zr.prototype.isInterleavedBuffer=!0;const on=new P;class $i{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)on.x=this.getX(t),on.y=this.getY(t),on.z=this.getZ(t),on.applyMatrix4(e),this.setXYZ(t,on.x,on.y,on.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)on.x=this.getX(t),on.y=this.getY(t),on.z=this.getZ(t),on.applyNormalMatrix(e),this.setXYZ(t,on.x,on.y,on.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)on.x=this.getX(t),on.y=this.getY(t),on.z=this.getZ(t),on.transformDirection(e),this.setXYZ(t,on.x,on.y,on.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Vt(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new $i(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}$i.prototype.isInterleavedBufferAttribute=!0;class Ja extends Mn{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ke(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Br;Ja.prototype.isSpriteMaterial=!0;const gs=new P,Nr=new P,Ur=new P,Hr=new Ie,_s=new Ie,Yc=new dt,ho=new P,vs=new P,fo=new P,jc=new Ie,Xa=new Ie,Qc=new Ie;function po(s,e,t,n,i,r){Hr.subVectors(s,t).addScalar(.5).multiply(n),void 0!==i?(_s.x=r*Hr.x-i*Hr.y,_s.y=i*Hr.x+r*Hr.y):_s.copy(Hr),s.copy(e),s.x+=_s.x,s.y+=_s.y,s.applyMatrix4(Yc)}(class Ya extends Ht{constructor(e){if(super(),this.type="Sprite",void 0===Br){Br=new xt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new zr(t,5);Br.setIndex([0,1,2,0,2,3]),Br.setAttribute("position",new $i(n,3,0,!1)),Br.setAttribute("uv",new $i(n,2,3,!1))}this.geometry=Br,this.material=void 0!==e?e:new Ja,this.center=new Ie(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Nr.setFromMatrixScale(this.matrixWorld),Yc.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ur.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Nr.multiplyScalar(-Ur.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const a=this.center;po(ho.set(-.5,-.5,0),Ur,a,Nr,i,r),po(vs.set(.5,-.5,0),Ur,a,Nr,i,r),po(fo.set(.5,.5,0),Ur,a,Nr,i,r),jc.set(0,0),Xa.set(1,0),Qc.set(1,1);let l=e.ray.intersectTriangle(ho,vs,fo,!1,gs);if(null===l&&(po(vs.set(-.5,.5,0),Ur,a,Nr,i,r),Xa.set(0,1),l=e.ray.intersectTriangle(ho,fo,vs,!1,gs),null===l))return;const c=e.ray.origin.distanceTo(gs);c<e.near||c>e.far||t.push({distance:c,point:gs.clone(),uv:hn.getUV(gs,ho,vs,fo,jc,Xa,Qc,new Ie),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const Kc=new P,eu=new Zt,tu=new Zt,V_=new P,nu=new dt;class ja extends $t{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new dt,this.bindMatrixInverse=new dt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Zt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;eu.fromBufferAttribute(i.attributes.skinIndex,e),tu.fromBufferAttribute(i.attributes.skinWeight,e),Kc.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const a=tu.getComponent(r);if(0!==a){const l=eu.getComponent(r);nu.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(V_.copy(Kc).applyMatrix4(nu),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}ja.prototype.isSkinnedMesh=!0;(class Qa extends Ht{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class Gr extends _n{constructor(e=null,t=1,n=1,i,r,a,l,c,u=rn,h=rn,d,f){super(null,a,l,c,u,h,i,r,d,f),this.image={data:e,width:t,height:n},this.magFilter=u,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}).prototype.isDataTexture=!0;class Vr extends Vt{constructor(e,t,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Vr.prototype.isInstancedBufferAttribute=!0;const ru=new dt,su=new dt,go=[],ys=new $t;(class ou extends $t{constructor(e,t,n){super(e,t),this.instanceMatrix=new Vr(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(ys.geometry=this.geometry,ys.material=this.material,void 0!==ys.material)for(let r=0;r<i;r++){this.getMatrixAt(r,ru),su.multiplyMatrices(n,ru),ys.matrixWorld=su,ys.raycast(e,go);for(let a=0,l=go.length;a<l;a++){const c=go[a];c.instanceId=r,c.object=this,t.push(c)}go.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Vr(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class Tn extends Mn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ke(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Tn.prototype.isLineBasicMaterial=!0;const au=new P,lu=new P,cu=new dt,Ka=new Yi,_o=new Xi;class Ki extends Ht{constructor(e=new xt,t=new Tn){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)au.fromBufferAttribute(t,i-1),lu.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=au.distanceTo(lu);e.setAttribute("lineDistance",new ct(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),_o.copy(n.boundingSphere),_o.applyMatrix4(i),_o.radius+=r,!1===e.ray.intersectsSphere(_o))return;cu.copy(i).invert(),Ka.copy(e.ray).applyMatrix4(cu);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new P,h=new P,d=new P,f=new P,p=this.isLineSegments?2:1;if(n.isBufferGeometry){const m=n.index,y=n.attributes.position;if(null!==m)for(let b=Math.max(0,a.start),M=Math.min(m.count,a.start+a.count)-1;b<M;b+=p){const A=m.getX(b),B=m.getX(b+1);if(u.fromBufferAttribute(y,A),h.fromBufferAttribute(y,B),Ka.distanceSqToSegment(u,h,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const V=e.ray.origin.distanceTo(f);V<e.near||V>e.far||t.push({distance:V,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}else for(let b=Math.max(0,a.start),M=Math.min(y.count,a.start+a.count)-1;b<M;b+=p){if(u.fromBufferAttribute(y,b),h.fromBufferAttribute(y,b+1),Ka.distanceSqToSegment(u,h,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const B=e.ray.origin.distanceTo(f);B<e.near||B>e.far||t.push({distance:B,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ki.prototype.isLine=!0;const uu=new P,hu=new P;class ki extends Ki{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)uu.fromBufferAttribute(t,i),hu.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+uu.distanceTo(hu);e.setAttribute("lineDistance",new ct(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ki.prototype.isLineSegments=!0;(class du extends Ki{constructor(e,t){super(e,t),this.type="LineLoop"}}).prototype.isLineLoop=!0;class Wr extends Mn{constructor(e){super(),this.type="PointsMaterial",this.color=new Ke(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Wr.prototype.isPointsMaterial=!0;const fu=new dt,el=new Yi,vo=new Xi,yo=new P;function pu(s,e,t,n,i,r,a){const l=el.distanceSqToPoint(s);if(l<t){const c=new P;el.closestPointToPoint(s,c),c.applyMatrix4(n);const u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;r.push({distance:u,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,object:a})}}(class xo extends Ht{constructor(e=new xt,t=new Wr){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),vo.copy(n.boundingSphere),vo.applyMatrix4(i),vo.radius+=r,!1===e.ray.intersectsSphere(vo))return;fu.copy(i).invert(),el.copy(e.ray).applyMatrix4(fu);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l;if(n.isBufferGeometry){const u=n.index,d=n.attributes.position;if(null!==u)for(let m=Math.max(0,a.start),v=Math.min(u.count,a.start+a.count);m<v;m++){const y=u.getX(m);yo.fromBufferAttribute(d,y),pu(yo,y,c,i,e,t,this)}else for(let m=Math.max(0,a.start),v=Math.min(d.count,a.start+a.count);m<v;m++)yo.fromBufferAttribute(d,m),pu(yo,m,c,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class Z_ extends _n{constructor(e,t,n,i,r,a,l,c,u){super(e,t,n,i,r,a,l,c,u),this.format=void 0!==l?l:Mi,this.minFilter=void 0!==a?a:Qt,this.magFilter=void 0!==r?r:Qt,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0;(class mu extends _n{constructor(e,t,n,i,r,a,l,c,u,h,d,f){super(null,a,l,c,u,h,i,r,d,f),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class q_ extends _n{constructor(e,t,n,i,r,a,l,c,u){super(e,t,n,i,r,a,l,c,u),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,class J_ extends _n{constructor(e,t,n,i,r,a,l,c,u,h){if((h=void 0!==h?h:hr)!==hr&&h!==es)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&h===hr&&(n=1012),void 0===n&&h===es&&(n=Kr),super(null,i,r,a,l,c,h,n,u),this.image={width:e,height:t},this.magFilter=void 0!==l?l:rn,this.minFilter=void 0!==c?c:rn,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isDepthTexture=!0,new P,new P,new P,new hn;class qn{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let a;a=t||e*n[r-1];let u,l=0,c=r-1;for(;l<=c;)if(i=Math.floor(l+(c-l)/2),u=n[i]-a,u<0)l=i+1;else{if(!(u>0)){c=i;break}c=i-1}if(i=c,n[i]===a)return i/(r-1);const h=n[i];return(i+(a-h)/(n[i+1]-h))/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const a=this.getPoint(i),l=this.getPoint(r),c=t||(a.isVector2?new Ie:new P);return c.copy(l).sub(a).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new P,i=[],r=[],a=[],l=new P,c=new dt;for(let p=0;p<=e;p++)i[p]=this.getTangentAt(p/e,new P),i[p].normalize();r[0]=new P,a[0]=new P;let u=Number.MAX_VALUE;const h=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=u&&(u=h,n.set(1,0,0)),d<=u&&(u=d,n.set(0,1,0)),f<=u&&n.set(0,0,1),l.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],l),a[0].crossVectors(i[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),a[p]=a[p-1].clone(),l.crossVectors(i[p-1],i[p]),l.length()>Number.EPSILON){l.normalize();const m=Math.acos(bn(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(c.makeRotationAxis(l,m))}a[p].crossVectors(i[p],r[p])}if(!0===t){let p=Math.acos(bn(r[0].dot(r[e]),-1,1));p/=e,i[0].dot(l.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(c.makeRotationAxis(i[m],p*m)),a[m].crossVectors(i[m],r[m])}return{tangents:i,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Eo extends qn{constructor(e=0,t=0,n=1,i=1,r=0,a=2*Math.PI,l=!1,c=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=l,this.aRotation=c}getPoint(e,t){const n=t||new Ie,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0===this.aClockwise&&!a&&(r===i?r=-i:r-=i);const l=this.aStartAngle+e*r;let c=this.aX+this.xRadius*Math.cos(l),u=this.aY+this.yRadius*Math.sin(l);if(0!==this.aRotation){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=c-this.aX,p=u-this.aY;c=f*h-p*d+this.aX,u=f*d+p*h+this.aY}return n.set(c,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Eo.prototype.isEllipseCurve=!0;class _u extends Eo{constructor(e,t,n,i,r,a){super(e,t,n,n,i,r,a),this.type="ArcCurve"}}function nl(){let s=0,e=0,t=0,n=0;function i(r,a,l,c){s=r,e=l,t=-3*r+3*a-2*l-c,n=2*r-2*a+l+c}return{initCatmullRom:function(r,a,l,c,u){i(a,l,u*(l-r),u*(c-a))},initNonuniformCatmullRom:function(r,a,l,c,u,h,d){let f=(a-r)/u-(l-r)/(u+h)+(l-a)/h,p=(l-a)/h-(c-a)/(h+d)+(c-l)/d;f*=h,p*=h,i(a,l,f,p)},calc:function(r){const a=r*r;return s+e*r+t*a+n*(a*r)}}}_u.prototype.isArcCurve=!0;const Co=new P,il=new nl,rl=new nl,sl=new nl;class vu extends qn{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new P){const n=t,i=this.points,r=i.length,a=(r-(this.closed?0:1))*e;let u,h,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?u=i[(l-1)%r]:(Co.subVectors(i[0],i[1]).add(i[0]),u=Co);const d=i[l%r],f=i[(l+1)%r];if(this.closed||l+2<r?h=i[(l+2)%r]:(Co.subVectors(i[r-1],i[r-2]).add(i[r-1]),h=Co),"centripetal"===this.curveType||"chordal"===this.curveType){const p="chordal"===this.curveType?.5:.25;let m=Math.pow(u.distanceToSquared(d),p),v=Math.pow(d.distanceToSquared(f),p),y=Math.pow(f.distanceToSquared(h),p);v<1e-4&&(v=1),m<1e-4&&(m=v),y<1e-4&&(y=v),il.initNonuniformCatmullRom(u.x,d.x,f.x,h.x,m,v,y),rl.initNonuniformCatmullRom(u.y,d.y,f.y,h.y,m,v,y),sl.initNonuniformCatmullRom(u.z,d.z,f.z,h.z,m,v,y)}else"catmullrom"===this.curveType&&(il.initCatmullRom(u.x,d.x,f.x,h.x,this.tension),rl.initCatmullRom(u.y,d.y,f.y,h.y,this.tension),sl.initCatmullRom(u.z,d.z,f.z,h.z,this.tension));return n.set(il.calc(c),rl.calc(c),sl.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push((new P).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function yu(s,e,t,n,i){const r=.5*(n-e),a=.5*(i-t),l=s*s;return(2*t-2*n+r+a)*(s*l)+(-3*t+3*n-2*r-a)*l+r*s+t}function xs(s,e,t,n){return function X_(s,e){const t=1-s;return t*t*e}(s,e)+function Y_(s,e){return 2*(1-s)*s*e}(s,t)+function j_(s,e){return s*s*e}(s,n)}function ws(s,e,t,n,i){return function Q_(s,e){const t=1-s;return t*t*t*e}(s,e)+function $_(s,e){const t=1-s;return 3*t*t*s*e}(s,t)+function K_(s,e){return 3*(1-s)*s*s*e}(s,n)+function e0(s,e){return s*s*s*e}(s,i)}vu.prototype.isCatmullRomCurve3=!0;class ol extends qn{constructor(e=new Ie,t=new Ie,n=new Ie,i=new Ie){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Ie){const n=t,i=this.v0,r=this.v1,a=this.v2,l=this.v3;return n.set(ws(e,i.x,r.x,a.x,l.x),ws(e,i.y,r.y,a.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ol.prototype.isCubicBezierCurve=!0;class xu extends qn{constructor(e=new P,t=new P,n=new P,i=new P){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new P){const n=t,i=this.v0,r=this.v1,a=this.v2,l=this.v3;return n.set(ws(e,i.x,r.x,a.x,l.x),ws(e,i.y,r.y,a.y,l.y),ws(e,i.z,r.z,a.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}xu.prototype.isCubicBezierCurve3=!0;class Po extends qn{constructor(e=new Ie,t=new Ie){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ie){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Ie;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Po.prototype.isLineCurve=!0;class al extends qn{constructor(e=new Ie,t=new Ie,n=new Ie){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ie){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(xs(e,i.x,r.x,a.x),xs(e,i.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}al.prototype.isQuadraticBezierCurve=!0;class wu extends qn{constructor(e=new P,t=new P,n=new P){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new P){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(xs(e,i.x,r.x,a.x),xs(e,i.y,r.y,a.y),xs(e,i.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}wu.prototype.isQuadraticBezierCurve3=!0;class ll extends qn{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Ie){const n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),l=r-a,c=i[0===a?a:a-1],u=i[a],h=i[a>i.length-2?i.length-1:a+1],d=i[a>i.length-3?i.length-1:a+2];return n.set(yu(l,c.x,u.x,h.x,d.x),yu(l,c.y,u.y,h.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push((new Ie).fromArray(i))}return this}}ll.prototype.isSplineCurve=!0;var cl=Object.freeze({__proto__:null,ArcCurve:_u,CatmullRomCurve3:vu,CubicBezierCurve:ol,CubicBezierCurve3:xu,EllipseCurve:Eo,LineCurve:Po,LineCurve3:class t0 extends qn{constructor(e=new P,t=new P){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new P){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:al,QuadraticBezierCurve3:wu,SplineCurve:ll});function bu(s,e,t,n,i){let r,a;if(i===function v0(s,e,t,n){let i=0;for(let r=e,a=t-n;r<t;r+=n)i+=(s[a]-s[r])*(s[r+1]+s[a+1]),a=r;return i}(s,e,t,n)>0)for(r=e;r<t;r+=n)a=Tu(r,s[r],s[r+1],a);else for(r=t-n;r>=e;r-=n)a=Tu(r,s[r],s[r+1],a);return a&&Lo(a,a.next)&&(Ss(a),a=a.next),a}function Bi(s,e){if(!s)return s;e||(e=s);let n,t=s;do{if(n=!1,t.steiner||!Lo(t,t.next)&&0!==nn(t.prev,t,t.next))t=t.next;else{if(Ss(t),t=e=t.prev,t===t.next)break;n=!0}}while(n||t!==e);return e}function bs(s,e,t,n,i,r,a){if(!s)return;!a&&r&&function d0(s,e,t,n){let i=s;do{null===i.z&&(i.z=ul(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,function f0(s){let e,t,n,i,r,a,l,c,u=1;do{for(t=s,s=null,r=null,a=0;t;){for(a++,n=t,l=0,e=0;e<u&&(l++,n=n.nextZ,n);e++);for(c=u;l>0||c>0&&n;)0!==l&&(0===c||!n||t.z<=n.z)?(i=t,t=t.nextZ,l--):(i=n,n=n.nextZ,c--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;t=n}r.nextZ=null,u*=2}while(a>1)}(i)}(s,n,i,r);let c,u,l=s;for(;s.prev!==s.next;)if(c=s.prev,u=s.next,r?r0(s,n,i,r):i0(s))e.push(c.i/t),e.push(s.i/t),e.push(u.i/t),Ss(s),s=u.next,l=u.next;else if((s=u)===l){a?1===a?bs(s=s0(Bi(s),e,t),e,t,n,i,r,2):2===a&&o0(s,e,t,n,i,r):bs(Bi(s),e,t,n,i,r,1);break}}function i0(s){const e=s.prev,t=s,n=s.next;if(nn(e,t,n)>=0)return!1;let i=s.next.next;for(;i!==s.prev;){if(qr(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&nn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function r0(s,e,t,n){const i=s.prev,r=s,a=s.next;if(nn(i,r,a)>=0)return!1;const u=i.x>r.x?i.x>a.x?i.x:a.x:r.x>a.x?r.x:a.x,h=i.y>r.y?i.y>a.y?i.y:a.y:r.y>a.y?r.y:a.y,d=ul(i.x<r.x?i.x<a.x?i.x:a.x:r.x<a.x?r.x:a.x,i.y<r.y?i.y<a.y?i.y:a.y:r.y<a.y?r.y:a.y,e,t,n),f=ul(u,h,e,t,n);let p=s.prevZ,m=s.nextZ;for(;p&&p.z>=d&&m&&m.z<=f;){if(p!==s.prev&&p!==s.next&&qr(i.x,i.y,r.x,r.y,a.x,a.y,p.x,p.y)&&nn(p.prev,p,p.next)>=0||(p=p.prevZ,m!==s.prev&&m!==s.next&&qr(i.x,i.y,r.x,r.y,a.x,a.y,m.x,m.y)&&nn(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==s.prev&&p!==s.next&&qr(i.x,i.y,r.x,r.y,a.x,a.y,p.x,p.y)&&nn(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=f;){if(m!==s.prev&&m!==s.next&&qr(i.x,i.y,r.x,r.y,a.x,a.y,m.x,m.y)&&nn(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function s0(s,e,t){let n=s;do{const i=n.prev,r=n.next.next;!Lo(i,r)&&Mu(i,n,n.next,r)&&Ms(i,r)&&Ms(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),Ss(n),Ss(n.next),n=s=r),n=n.next}while(n!==s);return Bi(n)}function o0(s,e,t,n,i,r){let a=s;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&m0(a,l)){let c=Su(a,l);return a=Bi(a,a.next),c=Bi(c,c.next),bs(a,e,t,n,i,r),void bs(c,e,t,n,i,r)}l=l.next}a=a.next}while(a!==s)}function l0(s,e){return s.x-e.x}function c0(s,e){if(e=function u0(s,e){let t=e;const n=s.x,i=s.y;let a,r=-1/0;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const f=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=n&&f>r){if(r=f,f===n){if(i===t.y)return t;if(i===t.next.y)return t.next}a=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!a)return null;if(n===r)return a;const l=a,c=a.x,u=a.y;let d,h=1/0;t=a;do{n>=t.x&&t.x>=c&&n!==t.x&&qr(i<u?n:r,i,c,u,i<u?r:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),Ms(t,s)&&(d<h||d===h&&(t.x>a.x||t.x===a.x&&h0(a,t)))&&(a=t,h=d)),t=t.next}while(t!==l);return a}(s,e),e){const t=Su(e,s);Bi(e,e.next),Bi(t,t.next)}}function h0(s,e){return nn(s.prev,s,e.prev)<0&&nn(e.next,s,s.next)<0}function ul(s,e,t,n,i){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-t)*i)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p0(s){let e=s,t=s;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==s);return t}function qr(s,e,t,n,i,r,a,l){return(i-a)*(e-l)-(s-a)*(r-l)>=0&&(s-a)*(n-l)-(t-a)*(e-l)>=0&&(t-a)*(r-l)-(i-a)*(n-l)>=0}function m0(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function g0(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&Mu(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}(s,e)&&(Ms(s,e)&&Ms(e,s)&&function _0(s,e){let t=s,n=!1;const i=(s.x+e.x)/2,r=(s.y+e.y)/2;do{t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next}while(t!==s);return n}(s,e)&&(nn(s.prev,s,e.prev)||nn(s,e.prev,e))||Lo(s,e)&&nn(s.prev,s,s.next)>0&&nn(e.prev,e,e.next)>0)}function nn(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function Lo(s,e){return s.x===e.x&&s.y===e.y}function Mu(s,e,t,n){const i=Ro(nn(s,e,t)),r=Ro(nn(s,e,n)),a=Ro(nn(t,n,s)),l=Ro(nn(t,n,e));return!!(i!==r&&a!==l||0===i&&Io(s,t,e)||0===r&&Io(s,n,e)||0===a&&Io(t,s,n)||0===l&&Io(t,e,n))}function Io(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Ro(s){return s>0?1:s<0?-1:0}function Ms(s,e){return nn(s.prev,s,s.next)<0?nn(s,e,s.next)>=0&&nn(s,s.prev,e)>=0:nn(s,e,s.prev)<0||nn(s,s.next,e)<0}function Su(s,e){const t=new hl(s.i,s.x,s.y),n=new hl(e.i,e.x,e.y),i=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function Tu(s,e,t,n){const i=new hl(s,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ss(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function hl(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class yi{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return yi.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Au(e),Eu(n,e);let a=e.length;t.forEach(Au);for(let c=0;c<t.length;c++)i.push(a),a+=t[c].length,Eu(n,t[c]);const l=function(s,e,t=2){const n=e&&e.length,i=n?e[0]*t:s.length;let r=bu(s,0,i,t,!0);const a=[];if(!r||r.next===r.prev)return a;let l,c,u,h,d,f,p;if(n&&(r=function a0(s,e,t,n){const i=[];let r,a,l,c,u;for(r=0,a=e.length;r<a;r++)l=e[r]*n,c=r<a-1?e[r+1]*n:s.length,u=bu(s,l,c,n,!1),u===u.next&&(u.steiner=!0),i.push(p0(u));for(i.sort(l0),r=0;r<i.length;r++)c0(i[r],t),t=Bi(t,t.next);return t}(s,e,r,t)),s.length>80*t){l=u=s[0],c=h=s[1];for(let m=t;m<i;m+=t)d=s[m],f=s[m+1],d<l&&(l=d),f<c&&(c=f),d>u&&(u=d),f>h&&(h=f);p=Math.max(u-l,h-c),p=0!==p?1/p:0}return bs(r,a,t,l,c,p),a}(n,i);for(let c=0;c<l.length;c+=3)r.push(l.slice(c,c+3));return r}}function Au(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function Eu(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class xi extends xt{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let l=0,c=e.length;l<c;l++)a(e[l]);function a(l){const c=[],u=void 0!==t.curveSegments?t.curveSegments:12,h=void 0!==t.steps?t.steps:1;let d=void 0!==t.depth?t.depth:100,f=void 0===t.bevelEnabled||t.bevelEnabled,p=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:p-2,v=void 0!==t.bevelOffset?t.bevelOffset:0,y=void 0!==t.bevelSegments?t.bevelSegments:3;const _=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:y0;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let b,A,B,S,V,M=!1;_&&(b=_.getSpacedPoints(h),M=!0,f=!1,A=_.computeFrenetFrames(h,!1),B=new P,S=new P,V=new P),f||(y=0,p=0,m=0,v=0);const ae=l.extractPoints(u);let K=ae.shape;const J=ae.holes;if(!yi.isClockWise(K)){K=K.reverse();for(let xe=0,ke=J.length;xe<ke;xe++){const We=J[xe];yi.isClockWise(We)&&(J[xe]=We.reverse())}}const le=yi.triangulateShape(K,J),ce=K;for(let xe=0,ke=J.length;xe<ke;xe++)K=K.concat(J[xe]);function _e(xe,ke,We){return ke||console.error("THREE.ExtrudeGeometry: vec does not exist"),ke.clone().multiplyScalar(We).add(xe)}const fe=K.length,we=le.length;function Ve(xe,ke,We){let mt,Ye,N;const R=xe.x-ke.x,be=xe.y-ke.y,De=We.x-xe.x,je=We.y-xe.y,st=R*R+be*be;if(Math.abs(R*je-be*De)>Number.EPSILON){const gt=Math.sqrt(st),Et=Math.sqrt(De*De+je*je),pt=ke.x-be/gt,te=ke.y+R/gt,rt=((We.x-je/Et-pt)*je-(We.y+De/Et-te)*De)/(R*je-be*De);mt=pt+R*rt-xe.x,Ye=te+be*rt-xe.y;const ht=mt*mt+Ye*Ye;if(ht<=2)return new Ie(mt,Ye);N=Math.sqrt(ht/2)}else{let gt=!1;R>Number.EPSILON?De>Number.EPSILON&&(gt=!0):R<-Number.EPSILON?De<-Number.EPSILON&&(gt=!0):Math.sign(be)===Math.sign(je)&&(gt=!0),gt?(mt=-be,Ye=R,N=Math.sqrt(st)):(mt=R,Ye=be,N=Math.sqrt(st/2))}return new Ie(mt/N,Ye/N)}const at=[];for(let xe=0,ke=ce.length,We=ke-1,mt=xe+1;xe<ke;xe++,We++,mt++)We===ke&&(We=0),mt===ke&&(mt=0),at[xe]=Ve(ce[xe],ce[We],ce[mt]);const ut=[];let $e,wt=at.concat();for(let xe=0,ke=J.length;xe<ke;xe++){const We=J[xe];$e=[];for(let mt=0,Ye=We.length,N=Ye-1,R=mt+1;mt<Ye;mt++,N++,R++)N===Ye&&(N=0),R===Ye&&(R=0),$e[mt]=Ve(We[mt],We[N],We[R]);ut.push($e),wt=wt.concat($e)}for(let xe=0;xe<y;xe++){const ke=xe/y,We=p*Math.cos(ke*Math.PI/2),mt=m*Math.sin(ke*Math.PI/2)+v;for(let Ye=0,N=ce.length;Ye<N;Ye++){const R=_e(ce[Ye],at[Ye],mt);lt(R.x,R.y,-We)}for(let Ye=0,N=J.length;Ye<N;Ye++){const R=J[Ye];$e=ut[Ye];for(let be=0,De=R.length;be<De;be++){const je=_e(R[be],$e[be],mt);lt(je.x,je.y,-We)}}}const Oe=m+v;for(let xe=0;xe<fe;xe++){const ke=f?_e(K[xe],wt[xe],Oe):K[xe];M?(S.copy(A.normals[0]).multiplyScalar(ke.x),B.copy(A.binormals[0]).multiplyScalar(ke.y),V.copy(b[0]).add(S).add(B),lt(V.x,V.y,V.z)):lt(ke.x,ke.y,0)}for(let xe=1;xe<=h;xe++)for(let ke=0;ke<fe;ke++){const We=f?_e(K[ke],wt[ke],Oe):K[ke];M?(S.copy(A.normals[xe]).multiplyScalar(We.x),B.copy(A.binormals[xe]).multiplyScalar(We.y),V.copy(b[xe]).add(S).add(B),lt(V.x,V.y,V.z)):lt(We.x,We.y,d/h*xe)}for(let xe=y-1;xe>=0;xe--){const ke=xe/y,We=p*Math.cos(ke*Math.PI/2),mt=m*Math.sin(ke*Math.PI/2)+v;for(let Ye=0,N=ce.length;Ye<N;Ye++){const R=_e(ce[Ye],at[Ye],mt);lt(R.x,R.y,d+We)}for(let Ye=0,N=J.length;Ye<N;Ye++){const R=J[Ye];$e=ut[Ye];for(let be=0,De=R.length;be<De;be++){const je=_e(R[be],$e[be],mt);M?lt(je.x,je.y+b[h-1].y,b[h-1].x+We):lt(je.x,je.y,d+We)}}}function ue(xe,ke){let We=xe.length;for(;--We>=0;){const mt=We;let Ye=We-1;Ye<0&&(Ye=xe.length-1);for(let N=0,R=h+2*y;N<R;N++){const be=fe*N,De=fe*(N+1);nt(ke+mt+be,ke+Ye+be,ke+Ye+De,ke+mt+De)}}}function lt(xe,ke,We){c.push(xe),c.push(ke),c.push(We)}function ft(xe,ke,We){it(xe),it(ke),it(We);const mt=i.length/3,Ye=g.generateTopUV(n,i,mt-3,mt-2,mt-1);At(Ye[0]),At(Ye[1]),At(Ye[2])}function nt(xe,ke,We,mt){it(xe),it(ke),it(mt),it(ke),it(We),it(mt);const Ye=i.length/3,N=g.generateSideWallUV(n,i,Ye-6,Ye-3,Ye-2,Ye-1);At(N[0]),At(N[1]),At(N[3]),At(N[1]),At(N[2]),At(N[3])}function it(xe){i.push(c[3*xe+0]),i.push(c[3*xe+1]),i.push(c[3*xe+2])}function At(xe){r.push(xe.x),r.push(xe.y)}(function Je(){const xe=i.length/3;if(f){let ke=0,We=fe*ke;for(let mt=0;mt<we;mt++){const Ye=le[mt];ft(Ye[2]+We,Ye[1]+We,Ye[0]+We)}ke=h+2*y,We=fe*ke;for(let mt=0;mt<we;mt++){const Ye=le[mt];ft(Ye[0]+We,Ye[1]+We,Ye[2]+We)}}else{for(let ke=0;ke<we;ke++){const We=le[ke];ft(We[2],We[1],We[0])}for(let ke=0;ke<we;ke++){const We=le[ke];ft(We[0]+fe*h,We[1]+fe*h,We[2]+fe*h)}}n.addGroup(xe,i.length/3-xe,0)})(),function Xe(){const xe=i.length/3;let ke=0;ue(ce,ke),ke+=ce.length;for(let We=0,mt=J.length;We<mt;We++){const Ye=J[We];ue(Ye,ke),ke+=Ye.length}n.addGroup(xe,i.length/3-xe,1)}()}this.setAttribute("position",new ct(i,3)),this.setAttribute("uv",new ct(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function x0(s,e,t){if(t.shapes=[],Array.isArray(s))for(let n=0,i=s.length;n<i;n++)t.shapes.push(s[n].uuid);else t.shapes.push(s.uuid);return void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,a=e.shapes.length;r<a;r++)n.push(t[e.shapes[r]]);const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new cl[i.type]).fromJSON(i)),new xi(n,e.options)}}const y0={generateTopUV:function(s,e,t,n,i){const l=e[3*n],c=e[3*n+1],u=e[3*i],h=e[3*i+1];return[new Ie(e[3*t],e[3*t+1]),new Ie(l,c),new Ie(u,h)]},generateSideWallUV:function(s,e,t,n,i,r){const a=e[3*t],l=e[3*t+1],c=e[3*t+2],u=e[3*n],h=e[3*n+1],d=e[3*n+2],f=e[3*i],p=e[3*i+1],m=e[3*i+2],v=e[3*r],y=e[3*r+1],_=e[3*r+2];return Math.abs(l-h)<Math.abs(a-u)?[new Ie(a,1-c),new Ie(u,1-d),new Ie(f,1-m),new Ie(v,1-_)]:[new Ie(l,1-c),new Ie(h,1-d),new Ie(p,1-m),new Ie(y,1-_)]}};class As extends xt{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],a=[];let l=0,c=0;if(!1===Array.isArray(e))u(e);else for(let h=0;h<e.length;h++)u(e[h]),this.addGroup(l,c,h),l+=c,c=0;function u(h){const d=i.length/3,f=h.extractPoints(t);let p=f.shape;const m=f.holes;!1===yi.isClockWise(p)&&(p=p.reverse());for(let y=0,_=m.length;y<_;y++){const g=m[y];!0===yi.isClockWise(g)&&(m[y]=g.reverse())}const v=yi.triangulateShape(p,m);for(let y=0,_=m.length;y<_;y++)p=p.concat(m[y]);for(let y=0,_=p.length;y<_;y++){const g=p[y];i.push(g.x,g.y,0),r.push(0,0,1),a.push(g.x,g.y)}for(let y=0,_=v.length;y<_;y++){const g=v[y];n.push(g[0]+d,g[1]+d,g[2]+d),c+=3}}this.setIndex(n),this.setAttribute("position",new ct(i,3)),this.setAttribute("normal",new ct(r,3)),this.setAttribute("uv",new ct(a,2))}toJSON(){const e=super.toJSON();return function w0(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,n=s.length;t<n;t++)e.shapes.push(s[t].uuid);else e.shapes.push(s.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++)n.push(t[e.shapes[i]]);return new As(n,e.curveSegments)}}(class Ou extends Mn{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ke(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}).prototype.isShadowMaterial=!0;class dl extends Mn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ke(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}dl.prototype.isMeshStandardMaterial=!0;(class Du extends dl{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new Ke(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Ke(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Ke(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}).prototype.isMeshPhysicalMaterial=!0;class Cs extends Mn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ke(16777215),this.specular=new Ke(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Cs.prototype.isMeshPhongMaterial=!0;(class Fu extends Mn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ke(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshToonMaterial=!0;(class ku extends Mn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}).prototype.isMeshNormalMaterial=!0;(class zu extends Mn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ke(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshLambertMaterial=!0;(class Bu extends Mn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ke(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}).prototype.isMeshMatcapMaterial=!0;(class Nu extends Tn{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}).prototype.isLineDashedMaterial=!0;const Kt={arraySlice:function(s,e,t){return Kt.isTypedArray(s)?new s.constructor(s.subarray(e,void 0!==t?t:s.length)):s.slice(e,t)},convertArray:function(s,e,t){return!s||!t&&s.constructor===e?s:"number"==typeof e.BYTES_PER_ELEMENT?new e(s):Array.prototype.slice.call(s)},isTypedArray:function(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)},getKeyframeOrder:function(s){const t=s.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(function e(i,r){return s[i]-s[r]}),n},sortedArray:function(s,e,t){const n=s.length,i=new s.constructor(n);for(let r=0,a=0;a!==n;++r){const l=t[r]*e;for(let c=0;c!==e;++c)i[a++]=s[l+c]}return i},flattenJSON:function(s,e,t,n){let i=1,r=s[0];for(;void 0!==r&&void 0===r[n];)r=s[i++];if(void 0===r)return;let a=r[n];if(void 0!==a)if(Array.isArray(a))do{a=r[n],void 0!==a&&(e.push(r.time),t.push.apply(t,a)),r=s[i++]}while(void 0!==r);else if(void 0!==a.toArray)do{a=r[n],void 0!==a&&(e.push(r.time),a.toArray(t,t.length)),r=s[i++]}while(void 0!==r);else do{a=r[n],void 0!==a&&(e.push(r.time),t.push(a)),r=s[i++]}while(void 0!==r)},subclip:function(s,e,t,n,i=30){const r=s.clone();r.name=e;const a=[];for(let c=0;c<r.tracks.length;++c){const u=r.tracks[c],h=u.getValueSize(),d=[],f=[];for(let p=0;p<u.times.length;++p){const m=u.times[p]*i;if(!(m<t||m>=n)){d.push(u.times[p]);for(let v=0;v<h;++v)f.push(u.values[p*h+v])}}0!==d.length&&(u.times=Kt.convertArray(d,u.times.constructor),u.values=Kt.convertArray(f,u.values.constructor),a.push(u))}r.tracks=a;let l=1/0;for(let c=0;c<r.tracks.length;++c)l>r.tracks[c].times[0]&&(l=r.tracks[c].times[0]);for(let c=0;c<r.tracks.length;++c)r.tracks[c].shift(-1*l);return r.resetDuration(),r},makeClipAdditive:function(s,e=0,t=s,n=30){n<=0&&(n=30);const i=t.tracks.length,r=e/n;for(let a=0;a<i;++a){const l=t.tracks[a],c=l.ValueTypeName;if("bool"===c||"string"===c)continue;const u=s.tracks.find(function(_){return _.name===l.name&&_.ValueTypeName===c});if(void 0===u)continue;let h=0;const d=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let f=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const m=l.times.length-1;let v;if(r<=l.times[0])v=Kt.arraySlice(l.values,h,d-h);else if(r>=l.times[m]){const _=m*d+h;v=Kt.arraySlice(l.values,_,_+d-h)}else{const _=l.createInterpolant(),g=h,b=d-h;_.evaluate(r),v=Kt.arraySlice(_.resultBuffer,g,b)}"quaternion"===c&&(new vn).fromArray(v).normalize().conjugate().toArray(v);const y=u.times.length;for(let _=0;_<y;++_){const g=_*p+f;if("quaternion"===c)vn.multiplyQuaternionsFlat(u.values,g,v,0,u.values,g);else{const b=p-2*f;for(let M=0;M<b;++M)u.values[g+M]-=v[M]}}}return s.blendMode=2501,s}};class Ni{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let l=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===l)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}if(e>=r)break e;{const l=t[1];e<l&&(n=2,r=l);for(let c=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===c)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0}}for(;n<a;){const l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let a=0;a!==i;++a)t[a]=n[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Ni.prototype.beforeStart_=Ni.prototype.copySampleValue_,Ni.prototype.afterEnd_=Ni.prototype.copySampleValue_;class M0 extends Ni{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dr,endingEnd:dr}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,a=e+1,l=i[r],c=i[a];if(void 0===l)switch(this.getSettings_().endingStart){case fr:r=e,l=2*t-n;break;case 2402:r=i.length-2,l=t+i[r]-i[r+1];break;default:r=e,l=n}if(void 0===c)switch(this.getSettings_().endingEnd){case fr:a=e,c=2*n-t;break;case 2402:a=1,c=n+i[1]-i[0];break;default:a=e-1,c=t}const u=.5*(n-t),h=this.valueSize;this._weightPrev=u/(t-l),this._weightNext=u/(c-n),this._offsetPrev=r*h,this._offsetNext=a*h}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,u=c-l,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,m=(n-t)/(i-t),v=m*m,y=v*m,_=-f*y+2*f*v-f*m,g=(1+f)*y+(-1.5-2*f)*v+(-.5+f)*m+1,b=(-1-p)*y+(1.5+p)*v+.5*m,M=p*y-p*v;for(let A=0;A!==l;++A)r[A]=_*a[h+A]+g*a[u+A]+b*a[c+A]+M*a[d+A];return r}}class Uu extends Ni{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,u=c-l,h=(n-t)/(i-t),d=1-h;for(let f=0;f!==l;++f)r[f]=a[u+f]*d+a[c+f]*h;return r}}class S0 extends Ni{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class li{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Kt.convertArray(t,this.TimeBufferType),this.values=Kt.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Kt.convertArray(e.times,Array),values:Kt.convertArray(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new S0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Uu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new M0(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const l=this.getValueSize();this.times=Kt.arraySlice(n,r,a),this.values=Kt.arraySlice(this.values,r*l,a*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==r;l++){const c=n[l];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(null!==a&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,a),e=!1;break}a=c}if(void 0!==i&&Kt.isTypedArray(i))for(let l=0,c=i.length;l!==c;++l){const u=i[l];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,u),e=!1;break}}return e}optimize(){const e=Kt.arraySlice(this.times),t=Kt.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=e.length-1;let a=1;for(let l=1;l<r;++l){let c=!1;const u=e[l];if(u!==e[l+1]&&(1!==l||u!==e[0]))if(i)c=!0;else{const d=l*n,f=d-n,p=d+n;for(let m=0;m!==n;++m){const v=t[d+m];if(v!==t[f+m]||v!==t[p+m]){c=!0;break}}}if(c){if(l!==a){e[a]=e[l];const d=l*n,f=a*n;for(let p=0;p!==n;++p)t[f+p]=t[d+p]}++a}}if(r>0){e[a]=e[r];for(let l=r*n,c=a*n,u=0;u!==n;++u)t[c+u]=t[l+u];++a}return a!==e.length?(this.times=Kt.arraySlice(e,0,a),this.values=Kt.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=Kt.arraySlice(this.times,0),t=Kt.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}li.prototype.TimeBufferType=Float32Array,li.prototype.ValueBufferType=Float32Array,li.prototype.DefaultInterpolation=2301;class Jr extends li{}Jr.prototype.ValueTypeName="bool",Jr.prototype.ValueBufferType=Array,Jr.prototype.DefaultInterpolation=2300,Jr.prototype.InterpolantFactoryMethodLinear=void 0,Jr.prototype.InterpolantFactoryMethodSmooth=void 0;class Hu extends li{}Hu.prototype.ValueTypeName="color";class Uo extends li{}Uo.prototype.ValueTypeName="number";class T0 extends Ni{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=(n-t)/(i-t);let u=e*l;for(let h=u+l;u!==h;u+=4)vn.slerpFlat(r,0,a,u-l,a,u,c);return r}}class Ps extends li{InterpolantFactoryMethodLinear(e){return new T0(this.times,this.values,this.getValueSize(),e)}}Ps.prototype.ValueTypeName="quaternion",Ps.prototype.DefaultInterpolation=2301,Ps.prototype.InterpolantFactoryMethodSmooth=void 0;class Xr extends li{}Xr.prototype.ValueTypeName="string",Xr.prototype.ValueBufferType=Array,Xr.prototype.DefaultInterpolation=2300,Xr.prototype.InterpolantFactoryMethodLinear=void 0,Xr.prototype.InterpolantFactoryMethodSmooth=void 0;class Ho extends li{}Ho.prototype.ValueTypeName="vector";class Go{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Hn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,l=n.length;a!==l;++a)t.push(E0(n[a]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,a=n.length;r!==a;++r)t.push(li.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,a=[];for(let l=0;l<r;l++){let c=[],u=[];c.push((l+r-1)%r,l,(l+1)%r),u.push(0,1,0);const h=Kt.getKeyframeOrder(c);c=Kt.sortedArray(c,1,h),u=Kt.sortedArray(u,1,h),!i&&0===c[0]&&(c.push(r),u.push(u[0])),a.push(new Uo(".morphTargetInfluences["+t[l].name+"]",c,u).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const u=e[l],h=u.name.match(r);if(h&&h.length>1){const d=h[1];let f=i[d];f||(i[d]=f=[]),f.push(u)}}const a=[];for(const l in i)a.push(this.CreateFromMorphTargetSequence(l,i[l],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(d,f,p,m,v){if(0!==p.length){const y=[],_=[];Kt.flattenJSON(p,y,_,m),0!==y.length&&v.push(new d(f,y,_))}},i=[],r=e.name||"default",a=e.fps||30,l=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let d=0;d<u.length;d++){const f=u[d].keys;if(f&&0!==f.length)if(f[0].morphTargets){const p={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let v=0;v<f[m].morphTargets.length;v++)p[f[m].morphTargets[v]]=-1;for(const v in p){const y=[],_=[];for(let g=0;g!==f[m].morphTargets.length;++g){const b=f[m];y.push(b.time),_.push(b.morphTarget===v?1:0)}i.push(new Uo(".morphTargetInfluence["+v+"]",y,_))}c=p.length*(a||1)}else{const p=".bones["+t[d].name+"]";n(Ho,p+".position",f,"pos",i),n(Ps,p+".quaternion",f,"rot",i),n(Ho,p+".scale",f,"scl",i)}}return 0===i.length?null:new this(r,c,i,l)}resetDuration(){let t=0;for(let n=0,i=this.tracks.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function E0(s){if(void 0===s.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function A0(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Uo;case"vector":case"vector2":case"vector3":case"vector4":return Ho;case"color":return Hu;case"quaternion":return Ps;case"bool":case"boolean":return Jr;case"string":return Xr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}(s.type);if(void 0===s.times){const t=[],n=[];Kt.flattenJSON(s.keys,t,n,"value"),s.times=t,s.values=n}return void 0!==e.parse?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Yr={enabled:!1,files:{},add:function(s,e){!1!==this.enabled&&(this.files[s]=e)},get:function(s){if(!1!==this.enabled)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};const C0=new class Gu{constructor(e,t,n){const i=this;let c,r=!1,a=0,l=0;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(h){l++,!1===r&&void 0!==i.onStart&&i.onStart(h,a,l),r=!0},this.itemEnd=function(h){a++,void 0!==i.onProgress&&i.onProgress(h,a,l),a===l&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(h){void 0!==i.onError&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,d){return u.push(h,d),this},this.removeHandler=function(h){const d=u.indexOf(h);return-1!==d&&u.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=u.length;d<f;d+=2){const p=u[d],m=u[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return m}return null}}};class wi{constructor(e){this.manager=void 0!==e?e:C0,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ei={};class Jn extends wi{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Yr.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;if(void 0!==ei[e])return void ei[e].push({onLoad:t,onProgress:n,onError:i});const c=e.match(/^data:(.*?)(;base64)?,(.*)$/);let u;if(c){const h=c[1],d=!!c[2];let f=c[3];f=decodeURIComponent(f),d&&(f=atob(f));try{let p;const m=(this.responseType||"").toLowerCase();switch(m){case"arraybuffer":case"blob":const v=new Uint8Array(f.length);for(let _=0;_<f.length;_++)v[_]=f.charCodeAt(_);p="blob"===m?new Blob([v.buffer],{type:h}):v.buffer;break;case"document":p=(new DOMParser).parseFromString(f,h);break;case"json":p=JSON.parse(f);break;default:p=f}setTimeout(function(){t&&t(p),r.manager.itemEnd(e)},0)}catch(p){setTimeout(function(){i&&i(p),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{ei[e]=[],ei[e].push({onLoad:t,onProgress:n,onError:i}),u=new XMLHttpRequest,u.open("GET",e,!0),u.addEventListener("load",function(h){const d=this.response,f=ei[e];if(delete ei[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Yr.add(e,d);for(let p=0,m=f.length;p<m;p++){const v=f[p];v.onLoad&&v.onLoad(d)}r.manager.itemEnd(e)}else{for(let p=0,m=f.length;p<m;p++){const v=f[p];v.onError&&v.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),u.addEventListener("progress",function(h){const d=ei[e];for(let f=0,p=d.length;f<p;f++){const m=d[f];m.onProgress&&m.onProgress(h)}},!1),u.addEventListener("error",function(h){const d=ei[e];delete ei[e];for(let f=0,p=d.length;f<p;f++){const m=d[f];m.onError&&m.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),u.addEventListener("abort",function(h){const d=ei[e];delete ei[e];for(let f=0,p=d.length;f<p;f++){const m=d[f];m.onError&&m.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(u.responseType=this.responseType),void 0!==this.withCredentials&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const h in this.requestHeader)u.setRequestHeader(h,this.requestHeader[h]);u.send(null)}return r.manager.itemStart(e),u}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Vo extends wi{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Yr.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;const l=document.createElementNS("http://www.w3.org/1999/xhtml","img");function c(){l.removeEventListener("load",c,!1),l.removeEventListener("error",u,!1),Yr.add(e,this),t&&t(this),r.manager.itemEnd(e)}function u(h){l.removeEventListener("load",c,!1),l.removeEventListener("error",u,!1),i&&i(h),r.manager.itemError(e),r.manager.itemEnd(e)}return l.addEventListener("load",c,!1),l.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),r.manager.itemStart(e),l.src=e,l}}class P0 extends wi{constructor(e){super(e)}load(e,t,n,i){const r=new cs,a=new Vo(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(u){a.load(e[u],function(h){r.images[u]=h,l++,6===l&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let u=0;u<e.length;++u)c(u);return r}}class I0 extends wi{constructor(e){super(e)}load(e,t,n,i){const r=new _n,a=new Vo(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){r.image=l;const c=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=c?Mi:Nn,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}class R0 extends qn{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Po(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const r=n[i]-t,a=this.curves[i],l=a.getLength();return a.getPointAt(0===l?0:1-r/l)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const a=r[i],c=a.getPoints(a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e);for(let u=0;u<c.length;u++){const h=c[u];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push((new cl[i.type]).fromJSON(i))}return this}}class Wo extends R0{constructor(e){super(),this.type="Path",this.currentPoint=new Ie,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Po(this.currentPoint.clone(),new Ie(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new al(this.currentPoint.clone(),new Ie(e,t),new Ie(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,a){const l=new ol(this.currentPoint.clone(),new Ie(e,t),new Ie(n,i),new Ie(r,a));return this.curves.push(l),this.currentPoint.set(r,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new ll(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,a){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,n,i,r,a),this}absarc(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}ellipse(e,t,n,i,r,a,l,c){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,n,i,r,a,l,c),this}absellipse(e,t,n,i,r,a,l,c){const u=new Eo(e,t,n,i,r,a,l,c);if(this.curves.length>0){const d=u.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(u);const h=u.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class er extends Wo{constructor(e){super(e),this.uuid=Hn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push((new Wo).fromJSON(i))}return this}}class ci extends Ht{constructor(e,t=1){super(),this.type="Light",this.color=new Ke(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}ci.prototype.isLight=!0;(class Vu extends ci{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(Ht.DefaultUp),this.updateMatrix(),this.groundColor=new Ke(t)}copy(e){return ci.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const Wu=new dt,Zu=new P,qu=new P;class fl{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ie(512,512),this.map=null,this.mapPass=null,this.matrix=new dt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new us,this._frameExtents=new Ie(1,1),this._viewportCount=1,this._viewports=[new Zt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Zu.setFromMatrixPosition(e.matrixWorld),t.position.copy(Zu),qu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(qu),t.updateMatrixWorld(),Wu.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wu),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ju extends fl{constructor(){super(new Sn(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*is*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Ju.prototype.isSpotLightShadow=!0;(class Xu extends ci{constructor(e,t,n=0,i=Math.PI/3,r=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(Ht.DefaultUp),this.updateMatrix(),this.target=new Ht,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.shadow=new Ju}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isSpotLight=!0;const Yu=new dt,Ls=new P,pl=new P;class ju extends fl{constructor(){super(new Sn(90,1,.5,500)),this._frameExtents=new Ie(4,2),this._viewportCount=6,this._viewports=[new Zt(2,1,1,1),new Zt(0,1,1,1),new Zt(3,1,1,1),new Zt(1,1,1,1),new Zt(3,0,1,1),new Zt(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ls.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ls),pl.copy(n.position),pl.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(pl),n.updateMatrixWorld(),i.makeTranslation(-Ls.x,-Ls.y,-Ls.z),Yu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yu)}}ju.prototype.isPointLightShadow=!0;class ml extends ci{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new ju}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}ml.prototype.isPointLight=!0;class Qu extends fl{constructor(){super(new ds(-5,5,5,-5,.5,500))}}Qu.prototype.isDirectionalLightShadow=!0;(class $u extends ci{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Ht.DefaultUp),this.updateMatrix(),this.target=new Ht,this.shadow=new Qu}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isDirectionalLight=!0;class gl extends ci{constructor(e,t){super(e,t),this.type="AmbientLight"}}gl.prototype.isAmbientLight=!0;(class Ku extends ci{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class eh{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new P)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}eh.prototype.isSphericalHarmonics3=!0;class Zo extends ci{constructor(e=new eh,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Zo.prototype.isLightProbe=!0;(class th extends xt{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}).prototype.isInstancedBufferGeometry=!0,class k0 extends wi{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Yr.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;const l={};l.credentials="anonymous"===this.crossOrigin?"same-origin":"include",l.headers=this.requestHeader,fetch(e,l).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){Yr.add(e,c),t&&t(c),r.manager.itemEnd(e)}).catch(function(c){i&&i(c),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;let qo;class U0 extends wi{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new Jn(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);(void 0===qo&&(qo=new(window.AudioContext||window.webkitAudioContext)),qo).decodeAudioData(c,function(h){t(h)})}catch(c){i?i(c):console.error(c),r.manager.itemError(e)}},n,i)}}(class H0 extends Zo{constructor(e,t,n=1){super(void 0,n);const i=(new Ke).set(e),r=(new Ke).set(t),a=new P(i.r,i.g,i.b),l=new P(r.r,r.g,r.b),c=Math.sqrt(Math.PI),u=c*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(l).multiplyScalar(c),this.sh.coefficients[1].copy(a).sub(l).multiplyScalar(u)}}).prototype.isHemisphereLightProbe=!0,class G0 extends Zo{constructor(e,t=1){super(void 0,t);const n=(new Ke).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class X0{constructor(e,t,n){let i,r,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let l=0;l!==i;++l)n[r+l]=n[l];a=t}else a+=t,this._mixBufferRegion(n,r,0,t/a,i);this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1&&this._mixBufferRegion(n,i,t*this._origIndex,1-r,t),a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){l.setValue(n,i);break}}saveOriginalState(){const t=this.buffer,n=this.valueSize,i=n*this._origIndex;this.binding.getValue(t,i);for(let r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let a=0;a!==r;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){vn.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const a=this._workIndex*r;vn.multiplyQuaternionsFlat(e,a,e,t,e,n),vn.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,r){const a=1-i;for(let l=0;l!==r;++l){const c=t+l;e[c]=e[c]*a+e[n+l]*i}}_lerpAdditive(e,t,n,i,r){for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]+e[n+a]*i}}}const vl="\\[\\]\\.:\\/",Y0=new RegExp("["+vl+"]","g"),yl="[^"+vl+"]",j0="[^"+vl.replace("\\.","")+"]",Q0=/((?:WC+[\/:])*)/.source.replace("WC",yl),$0=/(WCOD+)?/.source.replace("WCOD",j0),K0=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",yl),ev=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",yl),tv=new RegExp("^"+Q0+$0+K0+ev+"$"),nv=["material","materials","bones"];class iv{constructor(e,t,n){const i=n||jt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}let jt=(()=>{class s{constructor(t,n,i){this.path=n,this.parsedPath=i||s.parseTrackName(n),this.node=s.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,n,i){return t&&t.isAnimationObjectGroup?new s.Composite(t,n,i):new s(t,n,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Y0,"")}static parseTrackName(t){const n=tv.exec(t);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const a=i.nodeName.substring(r+1);-1!==nv.indexOf(a)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=a)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,n){if(!n||""===n||"."===n||-1===n||n===t.name||n===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(n);if(void 0!==i)return i}if(t.children){const i=function(a){for(let l=0;l<a.length;l++){const c=a[l];if(c.name===n||c.uuid===n)return c;const u=i(c.children);if(u)return u}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,n){t[n]=this.targetObject[this.propertyName]}_getValue_array(t,n){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)t[n++]=i[r]}_getValue_arrayElement(t,n){t[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,n){this.resolvedProperty.toArray(t,n)}_setValue_direct(t,n){this.targetObject[this.propertyName]=t[n]}_setValue_direct_setNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,n){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=t[n++]}_setValue_array_setNeedsUpdate(t,n){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=t[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,n){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,n){this.resolvedProperty[this.propertyIndex]=t[n]}_setValue_arrayElement_setNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,n){this.resolvedProperty.fromArray(t,n)}_setValue_fromArray_setNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,n){this.bind(),this.getValue(t,n)}_setValue_unbound(t,n){this.bind(),this.setValue(t,n)}bind(){let t=this.node;const n=this.parsedPath,i=n.objectName,r=n.propertyName;let a=n.propertyIndex;if(t||(t=s.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let h=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===h){h=d;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==h){if(void 0===t[h])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[h]}}const l=t[r];if(void 0===l)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n.nodeName+"."+r+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}u=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(u=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return s.Composite=iv,s})();jt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},jt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},jt.prototype.GetterByBindingType=[jt.prototype._getValue_direct,jt.prototype._getValue_array,jt.prototype._getValue_arrayElement,jt.prototype._getValue_toArray],jt.prototype.SetterByBindingTypeAndVersioning=[[jt.prototype._setValue_direct,jt.prototype._setValue_direct_setNeedsUpdate,jt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[jt.prototype._setValue_array,jt.prototype._setValue_array_setNeedsUpdate,jt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[jt.prototype._setValue_arrayElement,jt.prototype._setValue_arrayElement_setNeedsUpdate,jt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[jt.prototype._setValue_fromArray,jt.prototype._setValue_fromArray_setNeedsUpdate,jt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class sv{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,a=r.length,l=new Array(a),c={endingStart:dr,endingEnd:dr};for(let u=0;u!==a;++u){const h=r[u].createInterpolant(null);l[u]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,r=e._clip.duration,l=i/r;e.warp(1,r/i,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,a=this.timeScale;let l=this._timeScaleInterpolant;null===l&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,u=l.sampleValues;return c[0]=r,c[1]=r+n,u[0]=e/a,u[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const c=(e-r)*n;if(c<0||0===n)return;this._startTime=null,t=n*c}t*=this._updateTimeScale(e);const a=this._updateTime(t),l=this._updateWeight(e);if(l>0){const c=this._interpolants,u=this._propertyBindings;if(2501===this.blendMode)for(let h=0,d=c.length;h!==d;++h)c[h].evaluate(a),u[h].accumulateAdditive(l);else for(let h=0,d=c.length;h!==d;++h)c[h].evaluate(a),u[h].accumulate(i,l)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const a=2202===n;if(0===e)return-1===r?i:a&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,r+=Math.abs(l);const c=this.repetitions-r;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===c){const u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(a&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=fr,i.endingEnd=fr):(i.endingStart=e?this.zeroSlopeAtStart?fr:dr:2402,i.endingEnd=t?this.zeroSlopeAtEnd?fr:dr:2402)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,c[0]=t,l[1]=r+e,c[1]=n,this}}(class ov extends Si{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,l=e._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let h=u[c];void 0===h&&(h={},u[c]=h);for(let d=0;d!==r;++d){const f=i[d],p=f.name;let m=h[p];if(void 0!==m)a[d]=m;else{if(m=a[d],void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,c,p));continue}m=new X0(jt.create(n,p,t&&t._propertyBindings[d].binding.parsedPath),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,c,p),a[d]=m}l[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,a=this._actionsByClip,l=a[r],c=l.knownActions,u=c[c.length-1],h=e._byClipCacheIndex;u._byClipCacheIndex=h,c[h]=u,c.pop(),e._byClipCacheIndex=null,delete l.actionByRoot[(e._localRoot||this._root).uuid],0===c.length&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,l=a[i],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete l[r],0===Object.keys(l).length&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Uu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let a="string"==typeof e?Go.findByName(i,e):e;const l=null!==a?a.uuid:e,c=this._actionsByClip[l];let u=null;if(void 0===n&&(n=null!==a?a.blendMode:2500),void 0!==c){const d=c.actionByRoot[r];if(void 0!==d&&d.blendMode===n)return d;u=c.knownActions[0],null===a&&(a=u._clip)}if(null===a)return null;const h=new sv(this,a,t,n);return this._bindAction(h,u),this._addInactiveAction(h,l,r),h}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?Go.findByName(n,e):e,l=this._actionsByClip[r?r.uuid:e];return void 0!==l&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let n=this._nActiveActions-1;n>=0;--n)e[n].stop();return this}update(e){const t=this._actions,n=this._nActiveActions,i=this.time+=e*=this.timeScale,r=Math.sign(e),a=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,r,a);const l=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)l[u].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const a=r.knownActions;for(let l=0,c=a.length;l!==c;++l){const u=a[l];this._deactivateAction(u);const h=u._cacheIndex,d=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const c=n[a].actionByRoot[t];void 0!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const a in r){const l=r[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class xl{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new xl(void 0===this.value.clone?this.value:this.value.clone())}}(class av extends zr{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}).prototype.isInstancedInterleavedBuffer=!0;class dh{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(bn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const fh=new Ie;class Is{constructor(e=new Ie(1/0,1/0),t=new Ie(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=fh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return fh.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Is.prototype.isBox2=!0,class uv extends Ht{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}.prototype.isImmediateRenderObject=!0;const Ui=new P,Xo=new dt,bl=new dt;function gh(s){const e=[];s&&s.isBone&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,gh(s.children[t]));return e}class Ml extends ki{constructor(e=10,t=10,n=4473924,i=8947848){n=new Ke(n),i=new Ke(i);const r=t/2,a=e/t,l=e/2,c=[],u=[];for(let f=0,p=0,m=-l;f<=t;f++,m+=a){c.push(-l,0,m,l,0,m),c.push(m,0,-l,m,0,l);const v=f===r?n:i;v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3}const h=new xt;h.setAttribute("position",new ct(c,3)),h.setAttribute("color",new ct(u,3)),super(h,new Tn({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const bh=new Float32Array(1);function gv(s,e=!1){const t=null!==s[0].index,n=new Set(Object.keys(s[0].attributes)),i=new Set(Object.keys(s[0].morphAttributes)),r={},a={},l=s[0].morphTargetsRelative,c=new xt;let u=0;for(let h=0;h<s.length;++h){const d=s[h];let f=0;if(t!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===r[p]&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(l!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[p]&&(a[p]=[]),a[p].push(d.morphAttributes[p])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(d.userData),e){let p;if(t)p=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;p=d.attributes.position.count}c.addGroup(u,p,h),u+=p}}if(t){let h=0;const d=[];for(let f=0;f<s.length;++f){const p=s[f].index;for(let m=0;m<p.count;++m)d.push(p.getX(m)+h);h+=s[f].attributes.position.count}c.setIndex(d)}for(const h in r){const d=Mh(r[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;c.setAttribute(h,d)}for(const h in a){const d=a[h][0].length;if(0===d)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[h]=[];for(let f=0;f<d;++f){const p=[];for(let v=0;v<a[h].length;++v)p.push(a[h][v][f]);const m=Mh(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;c.morphAttributes[h].push(m)}}return c}function Mh(s){let e,t,n,i=0;for(let l=0;l<s.length;++l){const c=s[l];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=c.array.constructor),e!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===t&&(t=c.itemSize),t!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=c.normalized),n!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=c.array.length}const r=new e(i);let a=0;for(let l=0;l<s.length;++l)r.set(s[l].array,a),a+=s[l].array.length;return new Vt(r,t,n)}new Int32Array(bh.buffer),qn.create=function(s,e){return console.log("THREE.Curve.create() has been deprecated"),s.prototype=Object.create(qn.prototype),s.prototype.constructor=s,s.prototype.getPoint=e,s},Wo.prototype.fromPoints=function(s){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(s)},Ml.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class hv extends ki{constructor(e){const t=gh(e),n=new xt,i=[],r=[],a=new Ke(0,0,1),l=new Ke(0,1,0);for(let u=0;u<t.length;u++){const h=t[u];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(a.r,a.g,a.b),r.push(l.r,l.g,l.b))}n.setAttribute("position",new ct(i,3)),n.setAttribute("color",new ct(r,3)),super(n,new Tn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");bl.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<t.length;r++){const l=t[r];l.parent&&l.parent.isBone&&(Xo.multiplyMatrices(bl,l.matrixWorld),Ui.setFromMatrixPosition(Xo),i.setXYZ(a,Ui.x,Ui.y,Ui.z),Xo.multiplyMatrices(bl,l.parent.matrixWorld),Ui.setFromMatrixPosition(Xo),i.setXYZ(a+1,Ui.x,Ui.y,Ui.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},wi.prototype.extractUrlBase=function(s){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class _l{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}.extractUrlBase(s)},wi.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Is.prototype.center=function(s){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(s)},Is.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Is.prototype.isIntersectionBox=function(s){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},Is.prototype.size=function(s){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(s)},Pn.prototype.center=function(s){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(s)},Pn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Pn.prototype.isIntersectionBox=function(s){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},Pn.prototype.isIntersectionSphere=function(s){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)},Pn.prototype.size=function(s){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(s)},Xi.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},us.prototype.setFromMatrix=function(s){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(s)},gn.prototype.flattenToArrayOffset=function(s,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,e)},gn.prototype.multiplyVector3=function(s){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),s.applyMatrix3(this)},gn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},gn.prototype.applyToBufferAttribute=function(s){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),s.applyMatrix3(this)},gn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},gn.prototype.getInverse=function(s){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(s).invert()},dt.prototype.extractPosition=function(s){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(s)},dt.prototype.flattenToArrayOffset=function(s,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,e)},dt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new P).setFromMatrixColumn(this,3)},dt.prototype.setRotationFromQuaternion=function(s){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(s)},dt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},dt.prototype.multiplyVector3=function(s){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},dt.prototype.multiplyVector4=function(s){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},dt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},dt.prototype.rotateAxis=function(s){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),s.transformDirection(this)},dt.prototype.crossVector=function(s){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},dt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},dt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},dt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},dt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},dt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},dt.prototype.applyToBufferAttribute=function(s){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},dt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},dt.prototype.makeFrustum=function(s,e,t,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(s,e,n,t,i,r)},dt.prototype.getInverse=function(s){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(s).invert()},_i.prototype.isIntersectionLine=function(s){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(s)},vn.prototype.multiplyVector3=function(s){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),s.applyQuaternion(this)},vn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Yi.prototype.isIntersectionBox=function(s){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},Yi.prototype.isIntersectionPlane=function(s){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(s)},Yi.prototype.isIntersectionSphere=function(s){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)},hn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},hn.prototype.barycoordFromPoint=function(s,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(s,e)},hn.prototype.midpoint=function(s){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(s)},hn.prototypenormal=function(s){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(s)},hn.prototype.plane=function(s){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(s)},hn.barycoordFromPoint=function(s,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),hn.getBarycoord(s,e,t,n,i)},hn.normal=function(s,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),hn.getNormal(s,e,t,n)},er.prototype.extractAllPoints=function(s){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(s)},er.prototype.extrude=function(s){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new xi(this,s)},er.prototype.makeGeometry=function(s){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new As(this,s)},Ie.prototype.fromAttribute=function(s,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,e,t)},Ie.prototype.distanceToManhattan=function(s){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(s)},Ie.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},P.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},P.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},P.prototype.getPositionFromMatrix=function(s){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(s)},P.prototype.getScaleFromMatrix=function(s){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(s)},P.prototype.getColumnFromMatrix=function(s,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,s)},P.prototype.applyProjection=function(s){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(s)},P.prototype.fromAttribute=function(s,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,e,t)},P.prototype.distanceToManhattan=function(s){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(s)},P.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Zt.prototype.fromAttribute=function(s,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(s,e,t)},Zt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ht.prototype.getChildByName=function(s){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(s)},Ht.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ht.prototype.translate=function(s,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,s)},Ht.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ht.prototype.applyMatrix=function(s){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(s)},Object.defineProperties(Ht.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(s){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=s}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),$t.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties($t.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ja.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Sn.prototype.setLens=function(s,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(s)},Object.defineProperties(ci.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(s){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=s}},shadowCameraLeft:{set:function(s){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=s}},shadowCameraRight:{set:function(s){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=s}},shadowCameraTop:{set:function(s){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=s}},shadowCameraBottom:{set:function(s){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=s}},shadowCameraNear:{set:function(s){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=s}},shadowCameraFar:{set:function(s){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=s}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(s){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=s}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(s){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=s}},shadowMapHeight:{set:function(s){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=s}}}),Object.defineProperties(Vt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ns},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ns)}}}),Vt.prototype.setDynamic=function(s){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===s?ns:ts),this},Vt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Vt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},xt.prototype.addIndex=function(s){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(s)},xt.prototype.addAttribute=function(s,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===s?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(s,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(s,new Vt(arguments[1],arguments[2])))},xt.prototype.addDrawCall=function(s,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(s,e)},xt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},xt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},xt.prototype.removeAttribute=function(s){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(s)},xt.prototype.applyMatrix=function(s){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(s)},Object.defineProperties(xt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),zr.prototype.setDynamic=function(s){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===s?ns:ts),this},zr.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},xi.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},xi.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},xi.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},uo.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},xl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Mn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ke}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(s){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===s}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(s){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=s}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Oi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(s){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=s}}}),qt.prototype.clearTarget=function(s,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(s),this.clear(e,t,n)},qt.prototype.animate=function(s){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(s)},qt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},qt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},qt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},qt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},qt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},qt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},qt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},qt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},qt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},qt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},qt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},qt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},qt.prototype.enableScissorTest=function(s){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(s)},qt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},qt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},qt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},qt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},qt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},qt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},qt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},qt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},qt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},qt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(qt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=s}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=s}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(s){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===s?3001:Un}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Jc.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ri.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=s}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=s}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=s}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=s}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(s){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=s}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(s){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=s}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(s){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=s}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(s){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=s}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(s){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=s}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(s){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=s}}}),class Z0 extends Ht{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(s){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new U0).load(s,function(n){e.setBuffer(n)}),this},Fa.prototype.updateCubeMap=function(s,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(s,e)},Fa.prototype.clear=function(s,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(s,e,t,n)},gr.crossOrigin=void 0,gr.loadTexture=function(s,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new I0;i.setCrossOrigin(this.crossOrigin);const r=i.load(s,t,void 0,n);return e&&(r.mapping=e),r},gr.loadTextureCube=function(s,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new P0;i.setCrossOrigin(this.crossOrigin);const r=i.load(s,t,void 0,n);return e&&(r.mapping=e),r},gr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},gr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"132"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="132");var An=ge(2340),dn=ge(8696),o=ge(4537),Tl=ge(3582),kn=ge(1782),Al=ge(1308);let _v=(()=>{class s{constructor(t){this.dataService=t,this.calendlyOBJ={statusCode:5,orderType:2}}onChangeStatusCalendly(){return this.dataService.post("/API/V1/Orders"+An.N.productionRoute+"/changeiSmileStatus",this.calendlyOBJ)}}return s.\u0275fac=function(t){return new(t||s)(o.LFG(Al.D))},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),vv=(()=>{class s{constructor(t,n,i,r,a,l){this.dialogRef=t,this.data=n,this.router=i,this.toastrService=r,this.translateService=a,this.calendlyService=l}ngOnInit(){Calendly.initInlineWidget({url:An.N.iSmileCalendlyURL,parentElement:document.getElementById("calendlyDiv"),appendTo:"body"})}onNoClick(){this.dialogRef.close()}onSubmitEvent(t){"calendly.event_scheduled"===t.data.event&&(this.calendlyService.calendlyOBJ.ismileOrderID=this.data.ismileOrderID,this.calendlyService.onChangeStatusCalendly().subscribe(n=>{},n=>{},()=>{this.toastrService.showSuccess(this.translateService.instant("Calendly"),this.translateService.instant("Event Scheduled Successfully")),this.router.navigate(["/orders/orders-list"])}))}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(dn.so),o.Y36(dn.WI),o.Y36(k.F0),o.Y36(Tl._),o.Y36(kn.sK),o.Y36(_v))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-request-fine-tuning-session-calendly"]],hostBindings:function(t,n){1&t&&o.NdJ("message",function(r){return n.onSubmitEvent(r)},!1,o.Jf7)},decls:8,vars:3,consts:[[1,"d-flex","justify-content-between","title"],["mat-dialog-title",""],["mat-dialog-close","",1,"fas","fa-solid","fa-times"],["data-auto-load","false",2,"min-width","320px","height","580px"],["id","calendlyDiv"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"div"),o.TgZ(2,"h2",1),o._uU(3),o.ALo(4,"translate"),o.qZA(),o._UZ(5,"i",2),o.qZA(),o.TgZ(6,"mat-dialog-content",3),o._UZ(7,"div",4),o.qZA()),2&t&&(o.xp6(3),o.Oqu(o.lcZ(4,1,"Calendly")))},dependencies:[dn.ZT,dn.uh,dn.xY,kn.X$],styles:["#calendlyDiv[_ngcontent-%COMP%]{height:100%}h2[_ngcontent-%COMP%]{margin-bottom:0!important}[_nghost-%COMP%]     .mat-dialog-content{overflow:unset;max-height:75vh!important;height:75vh!important}.title[_ngcontent-%COMP%]{padding:24px;align-items:center;background-color:#f0f7f9}.title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.7rem;font-weight:600}"]}),s})();var ti=ge(8673),El=ge(4083),jr=ge(5732);let Sh=(()=>{class s{constructor(t,n,i){this.http=t,this.cookies=n,this.dataService=i,this.cpToken=this.cookies.get("userToken")}getPatientSTL(t,n){return this.dataService.get("/API/V1/Orders/iSmileOrder/stlReader?orderID="+t+"&iSmileID="+n)}getClientEmail(t){let n=new jr.WM;return n=n.append("Access-Control-Allow-Origin","*"),n=n.append("Accept","application/json"),n=n.append("Content-Type","application/json"),n=n.append("token",this.cpToken),n=n.append("clientID",t),this.dataService.get("/API/V1/Orders/iSmileOrder/getClientEmail?clientID="+t)}sendAmendmentEmail(t,n,i,r,a){let l=new jr.WM;l=l.append("Access-Control-Allow-Origin","*"),l=l.append("Accept","application/x-www-form-urlencoded");let c=`<div style="font-family: sans-serif; color:#000">\n              <p> <strong style="color:#000">Dear, Ortho planning team.</strong></p>\n              <p style="color:#000">\n                Please find the Doctor's request below on order\n                <a href='${window.location.protocol}//${window.location.host}/newcp/?task=iSmileOrder&subID=${n.iSmileID}&id=${n.orderID}&actionType=edit'>#${n.orderID}</a>\n              </p>\n              <p style="color:#000">Amendments:"</p>\n              <p style="color:#000">"${n.note.replace(/\n/g,"<br/>")}"</p>\n              <p> <strong style="color:#000">Thanks</strong></p>\n            </div>`,u=new FormData;u.append("to","ismile-request-amendment@3ddx.com"),u.append("from","orders@3ddx.com");const h=`iSmile: Amendment Request ID ${n.orderID} ${r}Pt. (${i})`;return u.append("cc",An.N.ismileSupervisorMail),u.append("subject",h),u.append("content",c),u.append("path",""),u.append("bcc",""),u.append("fileName",""),u.append("forceToSend",""),this.http.post(An.N.RootURL+"/connect/cp/CPMailer.php",u,{headers:l})}addInternalHistory(t){return this.dataService.post("/API/V1/Orders/iSmileOrder/updateClientComment",{IsmileID:t.iSmileID,Note:`\n Amendment : \n ${t.note}`})}submitAmendment(t){return this.dataService.post("/API/V1/Orders/iSmileOrder/changeiSmileStatus",{ismileOrderID:t.iSmileID,statusCode:5,orderType:2})}submitFT(t,n,i,r){let a=new FormData;a.append("to",i?"ismile-request-ft-session@3ddx.com,"+i:"ismile-request-amendment@3ddx.com");const l=`iSmile: FT Session Request ID ${t.orderID} ${r}Pt. (${t.patientName})`;if(a.append("from","orders@3ddx.com"),a.append("subject",l),"schedualFT"==n){var c=`Dears,\n        <br/>\n        <br/>\n         Please follow up on the following request :\n        <br/>\n        <b>FT Session schedule request on Order <a href='${window.location.protocol}//${window.location.host}/newcp/?task=iSmileOrder&subID=${t.iSmileID}&id=${t.orderID}&actionType=edit'>#${t.orderID}</a> </b>\n        <br/>\n        <b> Preferred time:</b>\n        <br/>\n         ${t.dueDate.toString().substring(0,15)} ${t.dueTime}\n        <br/>\n        <b>Considering the client's note:</b>\n        <br/>\n        ${t.note.replace(/\n/g,"<br/>")}\n        <br/>\n        <br/>\n        Thanks\n        `;a.append("content",c)}const u=("0"+(t.dueDate.getMonth()+1)).slice(-2)+":"+("0"+t.dueDate.getDate()).slice(-2)+":"+t.dueDate.getFullYear();return this.http.post(An.N.cpRootURL+An.N.cpRootPort+"/API/V1/Orders"+An.N.productionRoute+"/assignCsTaskAuto",{docID:t.docID,scanID:t.scanID,note:`Schedule an iSmileOn FT Session, Preferred time: ${u} ${t.dueTime}, Considering the client\u2019s note: ${t.note.replace(/\n/g,"<br/>")}`,iSmileID:t.iSmileID,orderID:t.orderID,dueDate:t.dueDate}).subscribe(),this.http.post(An.N.RootURL+"/connect/cp/CPMailer.php",a).subscribe(),this.dataService.post("/API/V1/Orders/iSmileOrder/changeiSmileStatus",{ismileOrderID:t.iSmileID,statusCode:5,orderType:2})}confirmCase(t){return this.dataService.post("/API/V1/Orders/iSmileOrder/changeiSmileStatus",{orderID:t.orderID,ismileOrderID:t.iSmileID,statusCode:7,orderType:2,docId:t.docId,scanId:t.scanId,patientName:t.patientName})}}return s.\u0275fac=function(t){return new(t||s)(o.LFG(jr.eN),o.LFG(El.N),o.LFG(Al.D))},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var Cl=ge(8659),En=ge(92);function yv(s,e){1&s&&(o.TgZ(0,"mat-error")(1,"small"),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&s&&(o.xp6(2),o.Oqu(o.lcZ(3,1,"Required Field")))}function xv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"form",6,7)(2,"p"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"p",8),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.TgZ(8,"textarea",9,10),o._uU(10," "),o.qZA(),o.YNc(11,yv,4,3,"mat-error",11),o.TgZ(12,"div",12)(13,"button",13),o.NdJ("click",function(){o.CHM(t);const i=o.MAs(9),r=o.oxw();return o.KtG(r.onSend(i.value))}),o._uU(14),o.ALo(15,"translate"),o.qZA()()()}if(2&s){const t=o.MAs(1),n=o.MAs(9),i=o.oxw();o.Q6J("id",i.htmlID.Form+"ngForm"),o.xp6(3),o.Oqu(o.lcZ(4,8,"Enter Your Amendments regarding this case below")),o.xp6(3),o.Oqu(o.lcZ(7,10,"Please add comprehensive notes")),o.xp6(2),o.Q6J("id",i.htmlID.TextArea+"amendments"),o.xp6(3),o.Q6J("ngIf",!n.valid),o.xp6(2),o.Q6J("id",i.htmlID.Button+"onsend")("disabled",!t.valid),o.xp6(1),o.Oqu(o.lcZ(15,12,"Send"))}}function wv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",14),o._UZ(1,"i",15),o.TgZ(2,"p"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"button",16),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.onClose())}),o._uU(6),o.ALo(7,"translate"),o.qZA()()}if(2&s){const t=o.oxw();o.xp6(3),o.Oqu(o.lcZ(4,3,"Request has been submitted")),o.xp6(2),o.Q6J("id",t.htmlID.Button+"success"),o.xp6(1),o.Oqu(o.lcZ(7,5,"close"))}}function bv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",14),o._UZ(1,"i",17),o.TgZ(2,"p"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"button",16),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.onClose())}),o._uU(6),o.ALo(7,"translate"),o.qZA()()}if(2&s){const t=o.oxw();o.xp6(3),o.Oqu(o.lcZ(4,3,"Something went wrong please try again later ")),o.xp6(2),o.Q6J("id",t.htmlID.Button+"onclose"),o.xp6(1),o.Oqu(o.lcZ(7,5,"close"))}}let Mv=(()=>{class s{constructor(t,n,i,r){this.cookiesSrvc=t,this.fetchStlService=n,this.dialogRef=i,this.data=r,this.htmlID=ti.Q,this.showForm=!0,this.success=!1}onSend(t){var n=this;return T(function*(){try{yield n.fetchStlService.submitAmendment({iSmileID:n.data.iSmileID}).toPromise();const i=n.cookiesSrvc.get("userCNId"),r=yield n.fetchStlService.getClientEmail(i).toPromise(),a=/[#.:@]/;let l=r.response.Email;l=l.search(a)>-1?l.slice(0,l.search(a)):l;let c=r.response.RepAgentEmail;c=c.search(a)>-1?c.slice(0,c.search(a)):c,yield n.fetchStlService.sendAmendmentEmail(l,{iSmileID:n.data.iSmileID,orderID:n.data.OrderID,note:t},n.data.patientName,n.data.clientNameString,c).toPromise(),yield n.fetchStlService.addInternalHistory({iSmileID:n.data.iSmileID,note:t}).toPromise(),n.success=!0}catch{n.success=!1}n.showForm=!1})()}onClose(){this.dialogRef.close(String(this.success))}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(El.N),o.Y36(Sh),o.Y36(dn.so),o.Y36(dn.WI))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-request-amendments"]],decls:10,vars:6,consts:[[1,"d-flex","justify-content-between","title"],["mat-dialog-title",""],["mat-dialog-close","",1,"fas","fa-solid","fa-times"],[1,"body"],[3,"id",4,"ngIf"],["class","success",4,"ngIf"],[3,"id"],["form","ngForm"],[1,"par-2"],["placeholder","Enter your amendments","name","amendments","ngModel","","required","",1,"textarea",3,"id"],["text","ngModel"],[4,"ngIf"],[1,"row","justify-content-end"],[1,"btn",3,"id","disabled","click"],[1,"success"],[1,"fas","fa-solid","fa-check"],[1,"btn",3,"id","click"],[1,"fas","fa-solid","fa-times"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"div"),o.TgZ(2,"h2",1),o._uU(3),o.ALo(4,"translate"),o.qZA(),o._UZ(5,"i",2),o.qZA(),o.TgZ(6,"div",3),o.YNc(7,xv,16,14,"form",4),o.YNc(8,wv,8,7,"div",5),o.YNc(9,bv,8,7,"div",5),o.qZA()),2&t&&(o.xp6(3),o.Oqu(o.lcZ(4,4,"Request Amendments")),o.xp6(4),o.Q6J("ngIf",n.showForm),o.xp6(1),o.Q6J("ngIf",!n.showForm&&n.success),o.xp6(1),o.Q6J("ngIf",!n.showForm&&!n.success))},dependencies:[j.O5,Cl.TO,dn.ZT,dn.uh,En._Y,En.Fj,En.JJ,En.JL,En.Q7,En.On,En.F,kn.X$],styles:["[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{padding:24px;align-items:center;background-color:#f0f7f9}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.7rem;font-weight:600}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]{padding:40px}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-transform:capitalize;font-size:1.2rem;margin-bottom:24px}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .par-2[_ngcontent-%COMP%]{color:#869ea5}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .textarea[_ngcontent-%COMP%]{width:100%;height:15rem;padding:19px;font-size:1.2rem;background-color:#f0f7f9;border:none}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;margin:20px;background-color:#2eb2db;color:#fff;padding-right:28px;padding-left:28px}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:24px;font-size:1.2rem}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem}[_nghost-%COMP%]   .body[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:0}"]}),s})();var zn=(()=>{return(s=zn||(zn={})).SMART="SMART",s.FLEXIBLE="FLEXIBLE",s.UNLIMITED="UNLIMITED",zn;var s})();let Th=(()=>{class s{constructor(t,n){this.dataService=t,this.httpClient=n,this.confirmPromoCodeOBJ={},this.confirmSubmittedOBJ={uid:{}}}getPricingTiers(t,n){let i=new jr.LE;return i=i.append("uID",t),i=i.append("iSmileID",n),this.dataService.getWithParams("/API/V1/Orders"+An.N.productionRoute+"/getclientpricing/",i)}confirmingPromoCode(){return this.dataService.post("/API/V1/Orders"+An.N.productionRoute+"/validatepromocode",this.confirmPromoCodeOBJ)}submitConfirmition(){return this.dataService.post("/API/V1/Orders"+An.N.productionRoute+"/confirmplanning",this.confirmSubmittedOBJ)}}return s.\u0275fac=function(t){return new(t||s)(o.LFG(Al.D),o.LFG(jr.eN))},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var Sv=ge(9665),Ah=ge(9638),Rs=ge(1997),Tv=ge(3331),Ko=ge(707);const Av=["stepper2"];function Ev(s,e){1&s&&(o._uU(0),o.ALo(1,"translate")),2&s&&o.Oqu(o.lcZ(1,1,"Confirming The Plan"))}function Cv(s,e){1&s&&(o._uU(0),o.ALo(1,"translate")),2&s&&o.Oqu(o.lcZ(1,1,"Choose Your Tier"))}function Pv(s,e){1&s&&o._UZ(0,"br")}function Lv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",27)(1,"div",8),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"div",28)(5,"form",29,30),o.NdJ("submit",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.onSubmitPromoCode())}),o.TgZ(7,"div",12)(8,"div",31)(9,"mat-form-field",32)(10,"mat-label"),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"input",33),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.confirmationService.confirmPromoCodeOBJ.code=i)}),o.ALo(14,"translate"),o.qZA()()(),o.TgZ(15,"div",34)(16,"button",35)(17,"mat-icon"),o._uU(18,"done"),o.qZA()()()()()()()}if(2&s){const t=o.MAs(6),n=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,5,"Promo Code For FLEXIBLE Tier")," "),o.xp6(9),o.Oqu(o.lcZ(12,7,"Promo Code")),o.xp6(2),o.s9C("placeholder",o.lcZ(14,9,"Promo Code")),o.Q6J("ngModel",n.confirmationService.confirmPromoCodeOBJ.code),o.xp6(3),o.Q6J("disabled",!t.valid)}}function Iv(s,e){1&s&&o._UZ(0,"br")}function Rv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",27)(1,"div",8),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"div",28)(5,"form",29,36),o.NdJ("submit",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.onSubmitPromoCode())}),o.TgZ(7,"div",12)(8,"div",31)(9,"mat-form-field",32)(10,"mat-label"),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"input",37),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.confirmationService.confirmPromoCodeOBJ.code=i)}),o.ALo(14,"translate"),o.qZA()()(),o.TgZ(15,"div",34)(16,"button",38)(17,"mat-icon"),o._uU(18,"done"),o.qZA()()()()()()()}if(2&s){const t=o.MAs(6),n=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,5,"Promo Code For SMART Tier")," "),o.xp6(9),o.Oqu(o.lcZ(12,7,"Promo Code")),o.xp6(2),o.s9C("placeholder",o.lcZ(14,9,"Promo Code")),o.Q6J("ngModel",n.confirmationService.confirmPromoCodeOBJ.code),o.xp6(3),o.Q6J("disabled",!t.valid)}}function Ov(s,e){1&s&&o._UZ(0,"br")}function Dv(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",27)(1,"div",8),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"div",28)(5,"form",29,39),o.NdJ("submit",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.onSubmitPromoCode())}),o.TgZ(7,"div",12)(8,"div",31)(9,"mat-form-field",32)(10,"mat-label"),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"input",40),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.confirmationService.confirmPromoCodeOBJ.code=i)}),o.ALo(14,"translate"),o.qZA()()(),o.TgZ(15,"div",34)(16,"button",41)(17,"mat-icon"),o._uU(18,"done"),o.qZA()()()()()()()}if(2&s){const t=o.MAs(6),n=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,5,"Promo Code For UNLIMITED Tier")," "),o.xp6(9),o.Oqu(o.lcZ(12,7,"Promo Code")),o.xp6(2),o.s9C("placeholder",o.lcZ(14,9,"Promo Code")),o.Q6J("ngModel",n.confirmationService.confirmPromoCodeOBJ.code),o.xp6(3),o.Q6J("disabled",!t.valid)}}function Fv(s,e){1&s&&(o._uU(0),o.ALo(1,"translate")),2&s&&o.Oqu(o.lcZ(1,1,"Order Summary"))}function kv(s,e){if(1&s&&(o.TgZ(0,"tr")(1,"th"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"td"),o._uU(5),o.qZA()()),2&s){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"Extra Cost")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.SMART.extras)}}function zv(s,e){if(1&s&&(o.TgZ(0,"tr",44)(1,"th"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"td"),o._uU(5),o.qZA()()),2&s){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"Promo Code Value")),o.xp6(3),o.Oqu(t.selectedTear.amount)}}function Bv(s,e){if(1&s&&(o.TgZ(0,"table",42)(1,"thead")(2,"tr")(3,"th"),o._uU(4),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"th"),o._uU(7),o.ALo(8,"translate"),o.qZA()()(),o.TgZ(9,"tbody")(10,"tr")(11,"th"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.TgZ(14,"td"),o._uU(15),o.qZA()(),o.TgZ(16,"tr")(17,"th"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.TgZ(20,"td"),o._uU(21),o.qZA()(),o.YNc(22,kv,6,4,"tr",17),o.TgZ(23,"tr")(24,"th"),o._uU(25),o.ALo(26,"translate"),o.qZA(),o.TgZ(27,"td"),o._uU(28),o.qZA()(),o.YNc(29,zv,6,4,"tr",43),o.TgZ(30,"tr")(31,"th"),o._uU(32),o.ALo(33,"translate"),o.qZA(),o.TgZ(34,"td"),o._uU(35),o.qZA()()()()),2&s){const t=o.oxw();o.xp6(4),o.Oqu(o.lcZ(5,12,"Feature For SMART Tiers")),o.xp6(3),o.Oqu(o.lcZ(8,14,"Details")),o.xp6(5),o.Oqu(o.lcZ(13,16,"Planning fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.SMART.planning),o.xp6(3),o.Oqu(o.lcZ(19,18,"Production fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.SMART.production),o.xp6(1),o.Q6J("ngIf",t.pricingConfirmation.calculated.SMART.extras>0),o.xp6(3),o.Oqu(o.lcZ(26,20,"Shipping and handling")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.SMART.shipping),o.xp6(1),o.Q6J("ngIf",null==t.selectedTear?null:t.selectedTear.valid),o.xp6(3),o.Oqu(o.lcZ(33,22,"Total Cost")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.SMART.total)}}function Nv(s,e){if(1&s&&(o.TgZ(0,"tr",44)(1,"th"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"td"),o._uU(5),o.qZA()()),2&s){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"Promo Code Value")),o.xp6(3),o.Oqu(t.selectedTear.amount)}}function Uv(s,e){if(1&s&&(o.TgZ(0,"table",42)(1,"thead")(2,"tr")(3,"th"),o._uU(4),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"th"),o._uU(7),o.ALo(8,"translate"),o.qZA()()(),o.TgZ(9,"tbody")(10,"tr")(11,"th"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.TgZ(14,"td"),o._uU(15),o.qZA()(),o.TgZ(16,"tr")(17,"th"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.TgZ(20,"td"),o._uU(21),o.qZA()(),o.TgZ(22,"tr")(23,"th"),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.TgZ(26,"td"),o._uU(27),o.qZA()(),o.YNc(28,Nv,6,4,"tr",43),o.TgZ(29,"tr")(30,"th"),o._uU(31),o.ALo(32,"translate"),o.qZA(),o.TgZ(33,"td"),o._uU(34),o.qZA()()()()),2&s){const t=o.oxw();o.xp6(4),o.Oqu(o.lcZ(5,11,"Feature For FLEXIBLE Tiers")),o.xp6(3),o.Oqu(o.lcZ(8,13,"Details")),o.xp6(5),o.Oqu(o.lcZ(13,15,"Planning fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.FLEXIBLE.planning),o.xp6(3),o.Oqu(o.lcZ(19,17,"Production fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.FLEXIBLE.production),o.xp6(3),o.Oqu(o.lcZ(25,19,"Shipping and handling")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.FLEXIBLE.shipping),o.xp6(1),o.Q6J("ngIf",null==t.selectedTear?null:t.selectedTear.valid),o.xp6(3),o.Oqu(o.lcZ(32,21,"Total Cost")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.FLEXIBLE.total)}}function Hv(s,e){if(1&s&&(o.TgZ(0,"tr",44)(1,"th"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"td"),o._uU(5),o.qZA()()),2&s){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"Promo Code Value")),o.xp6(3),o.Oqu(t.selectedTear.amount)}}function Gv(s,e){if(1&s&&(o.TgZ(0,"table",42)(1,"thead")(2,"tr")(3,"th"),o._uU(4),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"th"),o._uU(7),o.ALo(8,"translate"),o.qZA()()(),o.TgZ(9,"tbody")(10,"tr")(11,"th"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.TgZ(14,"td"),o._uU(15),o.qZA()(),o.TgZ(16,"tr")(17,"th"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.TgZ(20,"td"),o._uU(21),o.qZA()(),o.TgZ(22,"tr")(23,"th"),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.TgZ(26,"td"),o._uU(27),o.qZA()(),o.YNc(28,Hv,6,4,"tr",43),o.TgZ(29,"tr")(30,"th"),o._uU(31),o.ALo(32,"translate"),o.qZA(),o.TgZ(33,"td"),o._uU(34),o.qZA()()()()),2&s){const t=o.oxw();o.xp6(4),o.Oqu(o.lcZ(5,11,"Feature For UNLIMITED Tiers")),o.xp6(3),o.Oqu(o.lcZ(8,13,"Details")),o.xp6(5),o.Oqu(o.lcZ(13,15,"Planning fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.UNLIMITED.planning),o.xp6(3),o.Oqu(o.lcZ(19,17,"Production fee")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.UNLIMITED.production),o.xp6(3),o.Oqu(o.lcZ(25,19,"Shipping and handling")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.UNLIMITED.shipping),o.xp6(1),o.Q6J("ngIf",null==t.selectedTear?null:t.selectedTear.valid),o.xp6(3),o.Oqu(o.lcZ(32,21,"Total Cost")),o.xp6(3),o.Oqu(t.pricingConfirmation.calculated.UNLIMITED.total)}}const Pl=function(s,e){return{"tier-card-active":s,"tier-card":e}};let Vv=(()=>{class s{constructor(t,n,i,r,a){this.dialogRef=t,this.data=n,this.toasterService=i,this.confirmationService=r,this.translateService=a,this.isLinear=!1,this.tier="",this.pricingConfirmation={},this.smartPromoCode=!1,this.flexiblePromoCode=!1,this.unlimitedPromoCode=!1,this.selectedTear={}}ngOnInit(){this.getPricingTiers()}getPricingTiers(){this.confirmationService.getPricingTiers(this.data.clientId,this.data.iSmileId).subscribe(t=>{this.pricingConfirmation=t})}onChoosingTier(t){this.data.tier=t,this.showPromoCode(t)}isActiveTier(t){return this.data.tier===t}onNoClick(){this.dialogRef.close()}showPromoCode(t){this.smartPromoCode=this.pricingConfirmation.promo?.SMART?.tier===zn.SMART&&t===zn.SMART,this.flexiblePromoCode=this.pricingConfirmation.promo?.FLEXIBLE?.tier===zn.FLEXIBLE&&t===zn.FLEXIBLE,this.unlimitedPromoCode=this.pricingConfirmation.promo?.UNLIMITED?.tier===zn.UNLIMITED&&t===zn.UNLIMITED,this.confirmationService.confirmPromoCodeOBJ.tier=t}onSubmitPromoCode(){this.confirmationService.confirmPromoCodeOBJ.uID=this.data.clientId,this.confirmationService.confirmingPromoCode().subscribe(t=>{"Promo code is valid"===t.message&&this.toasterService.showSuccess(this.translateService.instant("Promo Code"),this.translateService.instant("Thanks Form Applying Your Promo Code"))},t=>{"Invalid promo code"===t.error.message&&this.toasterService.showError(this.translateService.instant("Promo Code"),this.translateService.instant("Your Promo Code Is Not Valid"))},()=>{this.calculatedPricing(),this.data.promoCode=this.confirmationService.confirmPromoCodeOBJ.code,this.onChoosingTierPromoCode()})}onChoosingTierPromoCode(){switch(this.data.tier){case zn.FLEXIBLE:this.selectedTear=this.pricingConfirmation.promo.FLEXIBLE;break;case zn.SMART:case zn.UNLIMITED:this.selectedTear=this.pricingConfirmation.promo.SMART;break;default:this.selectedTear={}}}calculatedPricing(){switch(this.data.tier){case zn.FLEXIBLE:this.pricingConfirmation.calculated.FLEXIBLE.total=this.pricingConfirmation.calculated.FLEXIBLE.total-this.pricingConfirmation.promo.FLEXIBLE.amount;break;case zn.SMART:this.pricingConfirmation.calculated.SMART.total=this.pricingConfirmation.calculated.SMART.total-this.pricingConfirmation.promo.SMART.amount;break;case zn.UNLIMITED:this.pricingConfirmation.calculated.UNLIMITED.total=this.pricingConfirmation.calculated.UNLIMITED.total-this.pricingConfirmation.promo.UNLIMITED.amount}}goForwardStep(){this.stepper.next()}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(dn.so),o.Y36(dn.WI),o.Y36(Tl._),o.Y36(Th),o.Y36(kn.sK))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-order-confirmation"]],viewQuery:function(t,n){if(1&t&&o.Gf(Av,5),2&t){let i;o.iGM(i=o.CRH())&&(n.stepper=i.first)}},decls:131,vars:119,consts:[[1,"d-flex","justify-content-between","title"],["mat-dialog-title",""],["mat-dialog-close","",1,"fas","fa-solid","fa-times"],[1,"p-2"],["labelPosition","bottom",3,"linear"],["stepper2",""],["matStepLabel",""],[1,"card","text-center"],[1,"card-header"],[1,"card-footer","text-muted"],["mat-button","","type","submit","id","submit-1",1,"btn-material","btn","shift-submit","float-end",3,"click"],[1,"container"],[1,"row"],[1,"col-md-4"],["id","FLEXIBLE-TIER",1,"w-100",3,"ngClass","click"],[1,"list-group","list-group-flush","text-center"],[1,"list-group-item"],[4,"ngIf"],["class","card text-center animate__animated animate__flipInX",4,"ngIf"],["id","SMART-TIER",1,"w-100",3,"ngClass","click"],["class","card text-center  animate__animated animate__flipInX",4,"ngIf"],["id","UNLIMITED-TIER",1,"w-100",3,"ngClass","click"],["mat-button","","matStepperPrevious","","id","back2",1,"bg-secondary"],["mat-button","","type","submit","id","submit-2",1,"btn-material","btn","shift-submit","float-end",3,"disabled","click"],["class","table table-hover",4,"ngIf"],["mat-button","","matStepperPrevious","","id","back3",1,"bg-secondary"],["mat-button","","type","submit","id","submit3",1,"btn-material","btn","shift-submit","float-end",3,"mat-dialog-close"],[1,"card","text-center","animate__animated","animate__flipInX"],[1,"card-body"],[3,"submit"],["flexibleForm","ngForm"],[1,"col-md-9"],["appearance","outline",1,"w-100"],["name","code","required","","matInput","","id","FLEXIBLE-CODE",3,"ngModel","placeholder","ngModelChange"],[1,"col-md-3"],["mat-mini-fab","","type","submit","color","warn","id","FLEXIBLE-CODE-BTN",1,"mt-4",3,"disabled"],["smartForm","ngForm"],["name","code","required","","matInput","","id","SMART-CODE",3,"ngModel","placeholder","ngModelChange"],["mat-mini-fab","","type","submit","color","warn","id","SMART-CODE-BTN",1,"mt-4",3,"disabled"],["unlimitedForm","ngForm"],["name","code","required","","matInput","","id","UNLIMITED-CODE",3,"ngModel","placeholder","ngModelChange"],["mat-mini-fab","","type","submit","color","warn","id","UNLIMITED-CODE-BTN",1,"mt-4",3,"disabled"],[1,"table","table-hover"],["class","table-secondary",4,"ngIf"],[1,"table-secondary"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"div"),o.TgZ(2,"h2",1),o._uU(3),o.qZA(),o._UZ(4,"i",2),o.qZA(),o.TgZ(5,"div",3)(6,"mat-horizontal-stepper",4,5)(8,"mat-step"),o.YNc(9,Ev,2,3,"ng-template",6),o.TgZ(10,"div",7)(11,"div",8),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.TgZ(14,"div",9),o._uU(15),o.ALo(16,"translate"),o.qZA()(),o._UZ(17,"br"),o.TgZ(18,"div")(19,"button",10),o.NdJ("click",function(){return n.goForwardStep()}),o._uU(20),o.ALo(21,"translate"),o.qZA()()(),o.TgZ(22,"mat-step")(23,"form"),o.YNc(24,Cv,2,3,"ng-template",6),o.TgZ(25,"div",11)(26,"div",12)(27,"div",13)(28,"mat-card",14),o.NdJ("click",function(){return n.onChoosingTier("FLEXIBLE")}),o.TgZ(29,"mat-card-header")(30,"mat-card-title"),o._uU(31),o.ALo(32,"translate"),o.qZA(),o.TgZ(33,"mat-card-subtitle"),o._uU(34),o.ALo(35,"translate"),o.qZA()(),o.TgZ(36,"mat-card-content")(37,"ul",15)(38,"li",16),o._uU(39),o.ALo(40,"translate"),o.qZA(),o.TgZ(41,"li",16),o._uU(42),o.ALo(43,"translate"),o.qZA(),o.TgZ(44,"li",16),o._uU(45),o.ALo(46,"translate"),o.qZA()()()(),o.YNc(47,Pv,1,0,"br",17),o.YNc(48,Lv,19,11,"div",18),o.qZA(),o.TgZ(49,"div",13)(50,"mat-card",19),o.NdJ("click",function(){return n.onChoosingTier("SMART")}),o.TgZ(51,"mat-card-header")(52,"mat-card-title"),o._uU(53),o.ALo(54,"translate"),o.qZA(),o.TgZ(55,"mat-card-subtitle"),o._uU(56),o.ALo(57,"translate"),o.qZA()(),o.TgZ(58,"mat-card-content")(59,"ul",15)(60,"li",16),o._uU(61),o.ALo(62,"translate"),o.qZA(),o.TgZ(63,"li",16),o._uU(64),o.ALo(65,"translate"),o.qZA(),o.TgZ(66,"li",16),o._uU(67),o.ALo(68,"translate"),o.qZA(),o.TgZ(69,"li",16),o._uU(70),o.ALo(71,"translate"),o.qZA()()()(),o.YNc(72,Iv,1,0,"br",17),o.YNc(73,Rv,19,11,"div",20),o.qZA(),o.TgZ(74,"div",13)(75,"mat-card",21),o.NdJ("click",function(){return n.onChoosingTier("UNLIMITED")}),o.TgZ(76,"mat-card-header")(77,"mat-card-title"),o._uU(78),o.ALo(79,"translate"),o.qZA(),o.TgZ(80,"mat-card-subtitle"),o._uU(81),o.ALo(82,"translate"),o.qZA()(),o.TgZ(83,"mat-card-content")(84,"ul",15)(85,"li",16),o._uU(86),o.ALo(87,"translate"),o.qZA(),o.TgZ(88,"li",16),o._uU(89),o.ALo(90,"translate"),o.qZA(),o.TgZ(91,"li",16),o._uU(92),o.ALo(93,"translate"),o.qZA(),o.TgZ(94,"li",16),o._uU(95),o.ALo(96,"translate"),o.qZA(),o.TgZ(97,"li",16),o._uU(98),o.ALo(99,"translate"),o.qZA(),o.TgZ(100,"li",16),o._uU(101),o.ALo(102,"translate"),o.qZA()()()(),o.YNc(103,Ov,1,0,"br",17),o.YNc(104,Dv,19,11,"div",20),o.qZA()(),o.TgZ(105,"div",9),o._uU(106),o.ALo(107,"translate"),o.qZA()(),o._UZ(108,"br"),o.TgZ(109,"div")(110,"button",22),o._uU(111),o.ALo(112,"translate"),o.qZA(),o.TgZ(113,"button",23),o.NdJ("click",function(){return n.goForwardStep()}),o._uU(114),o.ALo(115,"translate"),o.qZA()()()(),o.TgZ(116,"mat-step")(117,"form"),o.YNc(118,Fv,2,3,"ng-template",6),o.TgZ(119,"div",11),o.YNc(120,Bv,36,24,"table",24),o.YNc(121,Uv,35,23,"table",24),o.YNc(122,Gv,35,23,"table",24),o._UZ(123,"br"),o.qZA(),o.TgZ(124,"div")(125,"button",25),o._uU(126),o.ALo(127,"translate"),o.qZA(),o.TgZ(128,"button",26),o._uU(129),o.ALo(130,"translate"),o.qZA()()()()()()),2&t&&(o.xp6(3),o.Oqu(n.data.header),o.xp6(3),o.Q6J("linear",n.isLinear),o.xp6(6),o.AsE(" ",o.lcZ(13,56,"Client Name")," : ",n.data.clientNameString," "),o.xp6(3),o.AsE(" ",o.lcZ(16,58,"Order Id"),": ",n.data.orderId," "),o.xp6(5),o.hij(" ",o.lcZ(21,60,"Next")," "),o.xp6(8),o.Q6J("ngClass",o.WLB(110,Pl,n.isActiveTier("FLEXIBLE"),!n.isActiveTier("FLEXIBLE"))),o.xp6(3),o.lnq(" ",n.pricingConfirmation.currency,"",null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.FLEXIBLE.aligner," ",o.lcZ(32,62,"per aligner"),""),o.xp6(3),o.Oqu(o.lcZ(35,64,"FLEXIBLE")),o.xp6(5),o.hij(" ",o.lcZ(40,66,"Pay only for the stages you need")," "),o.xp6(3),o.hij(" ",o.lcZ(43,68,"Designed by Orthodontists")," "),o.xp6(3),o.lnq(" ",o.lcZ(46,70,"Ortho Planning fee")," ",n.pricingConfirmation.currency,"",null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.FLEXIBLE.planning," "),o.xp6(2),o.Q6J("ngIf",n.flexiblePromoCode),o.xp6(1),o.Q6J("ngIf",n.flexiblePromoCode),o.xp6(2),o.Q6J("ngClass",o.WLB(113,Pl,n.isActiveTier("SMART"),!n.isActiveTier("SMART"))),o.xp6(3),o.lnq(" ",n.pricingConfirmation.currency,"",(null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.SMART.aligner)+(null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.SMART.planning)," ",o.lcZ(54,72,"per case")," "),o.xp6(3),o.Oqu(o.lcZ(57,74,"SMART")),o.xp6(5),o.hij(" ",o.lcZ(62,76,"Save on cases up to 25 aligners")," "),o.xp6(3),o.hij(" ",o.lcZ(65,78,"Designed by Orthodontists")," "),o.xp6(3),o.hij(" ",o.lcZ(68,80,"Ortho Planning fee included")," "),o.xp6(3),o.lnq(" ",n.pricingConfirmation.currency,"",null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.SMART.extra,"/ ",o.lcZ(71,82,"Extra stage")," "),o.xp6(2),o.Q6J("ngIf",n.smartPromoCode),o.xp6(1),o.Q6J("ngIf",n.smartPromoCode),o.xp6(2),o.Q6J("ngClass",o.WLB(116,Pl,n.isActiveTier("UNLIMITED"),!n.isActiveTier("UNLIMITED"))),o.xp6(3),o.lnq(" ",n.pricingConfirmation.currency,"",(null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.UNLIMITED.aligner)+(null==n.pricingConfirmation.template?null:n.pricingConfirmation.template.UNLIMITED.planning)," ",o.lcZ(79,84,"per case")," "),o.xp6(3),o.Oqu(o.lcZ(82,86,"UNLIMITED")),o.xp6(5),o.hij(" ",o.lcZ(87,88,"Ultimate savings plan")," "),o.xp6(3),o.hij(" ",o.lcZ(90,90,"Designed by Orthodontists")," "),o.xp6(3),o.hij(" ",o.lcZ(93,92,"Ortho Planning fee included")," "),o.xp6(3),o.hij(" ",o.lcZ(96,94,"Unlimited aligners for 3 years")," "),o.xp6(3),o.hij(" ",o.lcZ(99,96,"Predictable cost for complex cases")," "),o.xp6(3),o.hij(" ",o.lcZ(102,98,"Valid for 1 patient and 1 plan")," "),o.xp6(2),o.Q6J("ngIf",n.unlimitedPromoCode),o.xp6(1),o.Q6J("ngIf",n.unlimitedPromoCode),o.xp6(2),o.AsE(" ",o.lcZ(107,100,"Order Id"),": ",n.data.orderId," "),o.xp6(5),o.Oqu(o.lcZ(112,102,"Back")),o.xp6(2),o.Q6J("disabled",!n.data.tier),o.xp6(1),o.hij(" ",o.lcZ(115,104,"Next")," "),o.xp6(6),o.Q6J("ngIf","SMART"===n.data.tier),o.xp6(1),o.Q6J("ngIf","FLEXIBLE"===n.data.tier),o.xp6(1),o.Q6J("ngIf","UNLIMITED"===n.data.tier),o.xp6(4),o.Oqu(o.lcZ(127,106,"Back")),o.xp6(2),o.Q6J("mat-dialog-close",n.data),o.xp6(1),o.hij(" ",o.lcZ(130,108,"Confirm")," "))},dependencies:[j.mk,j.O5,Cl.KE,Cl.hX,Sv.Nt,Ah.lW,Rs.a8,Rs.dk,Rs.dn,Rs.n5,Rs.$j,Tv.Hw,dn.ZT,dn.uh,Ko.C0,Ko.VY,Ko.Vq,Ko.fd,En._Y,En.Fj,En.JJ,En.JL,En.Q7,En.On,En.F,kn.X$],styles:["mat-card-title[_ngcontent-%COMP%]{color:#68cdec;font-weight:700}.title[_ngcontent-%COMP%]{padding:24px;align-items:center;background-color:#f0f7f9}.title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.7rem;font-weight:600}.mat-flat-button.mat-warn[_ngcontent-%COMP%], .mat-raised-button.mat-warn[_ngcontent-%COMP%], .mat-fab.mat-warn[_ngcontent-%COMP%], .mat-mini-fab.mat-warn[_ngcontent-%COMP%]{background-color:#68cdec}mat-card[_ngcontent-%COMP%]{cursor:pointer}.mat-form-field[_ngcontent-%COMP%]{margin-top:16px}  .mat-horizontal-stepper-header{pointer-events:none!important}.tier-card-active[_ngcontent-%COMP%]{background-color:#68cdec;transition:all .8s linear;color:#fff}.tier-card-active[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{color:#fff;font-weight:700}.tier-card-active[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{color:#fff}.tier-card-active[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{color:#68cdec;border:1px solid rgba(104,205,236,.125)}"]}),s})();function Wv(s,e){1&s&&(o.ynx(0),o.TgZ(1,"p",8),o._uU(2," Please contact our support team: "),o.qZA(),o.TgZ(3,"a",9),o._uU(4,"cs@3ddx.com"),o.qZA(),o.BQk())}let Zv=(()=>{class s{constructor(t,n){this.dialogRef=t,this.data=n}ngOnInit(){}onClose(){}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(dn.so),o.Y36(dn.WI))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-handling-error-popup"]],decls:12,vars:2,consts:[[1,"handleing-error-wrapper"],[1,"header","d-flex","justify-content-between","align-items-center"],["mat-button","","mat-dialog-close","",1,"float-end","text-white","mx-2",3,"click"],[1,"content","d-flex","align-items-start","gap-4"],[1,"fas","fa-exclamation-triangle","fa-5x","animate__animated","animate__infinite","animate__pulse"],[1,"text-warapper","flex-grow-1"],[1,"text"],[4,"ngIf"],[1,"text","mt-4","d-inline-block","me-1"],["href","https://www.3ddx.com/assist","target","_blank",1,"text","d-inline-block"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"p"),o._uU(3,"Oops !"),o.qZA(),o.TgZ(4,"button",2),o.NdJ("click",function(){return n.onClose()}),o._uU(5,"X"),o.qZA()(),o.TgZ(6,"div",3),o._UZ(7,"i",4),o.TgZ(8,"div",5)(9,"p",6),o._uU(10),o.qZA(),o.YNc(11,Wv,5,0,"ng-container",7),o.qZA()()()),2&t&&(o.xp6(10),o.Oqu(n.data.text),o.xp6(1),o.Q6J("ngIf",n.data.link))},dependencies:[j.O5,Ah.lW,dn.ZT],styles:[".handleing-error-wrapper[_ngcontent-%COMP%]{font-family:Inter,sans-serif}.handleing-error-wrapper[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.handleing-error-wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background:#68cdec;padding:15px 0}.handleing-error-wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:0;font-weight:600;font-size:22px;color:#212529}.handleing-error-wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:6vh 2vw}.handleing-error-wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .whiteSpace-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.handleing-error-wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#666}.handleing-error-wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 auto}.handleing-error-wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;display:block}"]}),s})();var qv=ge(6857),Jv=ge(7586),Xv=ge(8295),Yv=ge.n(Xv),jv=ge(882);let Eh=(()=>{class s{extractUrlsFromZip(t){const n="Gingiva/",i="Teeth/",r=a=>(a=(a=a.replace(/\..+$/,"")).replace(i,"")).replace(n,"");return new jv.y(a=>{const l=[];try{const c=new Jv;Yv().getBinaryContent(t,(u,h)=>{u?a.error(u):c.loadAsync(h).then(()=>{let d=0;Object.values(c.files).some(f=>f.name===n)&&(delete c.files["version.json"],delete c.files[n],delete c.files[i]),c.forEach((f,p)=>{p.async("uint8array").then(m=>{let v=new Blob([m],{type:"application/cad"});const y=URL.createObjectURL(v);l.push({teeth:f.startsWith(i),filename:r(f),url:y}),d++,d===Object.keys(c.files).length&&(a.next(l),a.complete())})})})})}finally{l.forEach(({url:c})=>URL.revokeObjectURL(c))}})}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac}),s})();const Ll=new WeakMap;class Qv extends wi{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new Jn(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{this.decodeGeometry(a,{attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1}).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){this.decodeGeometry(e,{attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n}).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const u=t.attributeTypes[c];void 0!==u.BYTES_PER_ELEMENT&&(t.attributeTypes[c]=u.name)}const n=JSON.stringify(t);if(Ll.has(e)){const c=Ll.get(e);if(c.key===n)return c.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,l=this._getWorker(r,e.byteLength).then(c=>(i=c,new Promise((u,h)=>{i._callbacks[r]={resolve:u,reject:h},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return l.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),Ll.set(e,{key:n,promise:l}),l}_createGeometry(e){const t=new xt;e.index&&t.setIndex(new Vt(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];t.setAttribute(i.name,new Vt(i.array,i.itemSize))}return t}_loadLibrary(e,t){const n=new Jn(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,r)=>{n.load(e,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=$v.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(r){const a=r.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function $v(){let s,e;function i(a,l,c,u,h,d){const f=d.num_components(),m=c.num_points()*f,v=m*h.BYTES_PER_ELEMENT,y=function r(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}(a,h),_=a._malloc(v);l.GetAttributeDataArrayForAllPoints(c,d,y,v,_);const g=new h(a.HEAPF32.buffer,_,m).slice();return a._free(_),{name:u,array:g,itemSize:f}}onmessage=function(a){const l=a.data;switch(l.type){case"init":s=l.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(s)});break;case"decode":const c=l.buffer,u=l.taskConfig;e.then(h=>{const d=h.draco,f=new d.Decoder,p=new d.DecoderBuffer;p.Init(new Int8Array(c),c.byteLength);try{const m=function t(a,l,c,u){const h=u.attributeIDs,d=u.attributeTypes;let f,p;const m=l.GetEncodedGeometryType(c);if(m===a.TRIANGULAR_MESH)f=new a.Mesh,p=l.DecodeBufferToMesh(c,f);else{if(m!==a.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");f=new a.PointCloud,p=l.DecodeBufferToPointCloud(c,f)}if(!p.ok()||0===f.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const y in h){const _=self[d[y]];let g,b;if(u.useUniqueIDs)b=h[y],g=l.GetAttributeByUniqueId(f,b);else{if(b=l.GetAttributeId(f,a[h[y]]),-1===b)continue;g=l.GetAttribute(f,b)}v.attributes.push(i(a,l,f,y,_,g))}return m===a.TRIANGULAR_MESH&&(v.index=function n(a,l,c){const h=3*c.num_faces(),d=4*h,f=a._malloc(d);l.GetTrianglesUInt32Array(c,d,f);const p=new Uint32Array(a.HEAPF32.buffer,f,h).slice();return a._free(f),{array:p,itemSize:1}}(a,l,f)),a.destroy(f),v}(d,f,p,u),v=m.attributes.map(y=>y.array.buffer);m.index&&v.push(m.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:m},v)}catch(m){console.error(m),self.postMessage({type:"error",id:l.id,error:m.message})}finally{d.destroy(p),d.destroy(f)}})}}}let Ch=(()=>{class s{constructor(){this.dracoLoader=new Qv,this.dracoLoader.setDecoderPath("assets/draco/"),this.dracoLoader.preload()}loadGeometry(t){return new Promise((n,i)=>{this.dracoLoader.load(t,r=>{n(r)},void 0,r=>{i(r)})})}loadGeometries(t){return Promise.all(t.map(({url:n,filename:i,teeth:r})=>this.loadGeometry(n).then(a=>({geometry:a,filename:i,teeth:r}))))}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac}),s})();var Ph=ge(4189),Kv=ge(9666);function ey(s,e){if(1&s&&(o.TgZ(0,"div",3)(1,"span",4),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"span",5),o._uU(5),o.ALo(6,"translate"),o.qZA()()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("id",t.htmlID.Span+"patientName"),o.xp6(1),o.hij(" ",o.lcZ(3,4,t.patientName)," "),o.xp6(2),o.Q6J("id",t.htmlID.Span+"case"),o.xp6(1),o.hij("Case ",o.lcZ(6,6,t.caseNumber),"")}}function ty(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",6),o._UZ(1,"p-menu",7,8),o.TgZ(3,"button",9),o.NdJ("click",function(i){o.CHM(t);const r=o.MAs(2);return o.KtG(r.toggle(i))}),o.qZA()()}if(2&s){const t=o.oxw();o.xp6(1),o.Q6J("popup",!0)("model",t.listItems)("id",t.htmlID.Menu+"Vesrions"),o.xp6(2),o.Q6J("label",null==t.listItems[t.latestVersion]?null:t.listItems[t.latestVersion].label)("disabled",t.versionsNumber<2)("id",t.htmlID.Button+"Vesrions")}}let ny=(()=>{class s{constructor(){this.patientName="",this.caseNumber="",this.versionsNumber=0,this.versionChange=new o.vpe,this.listItems=[],this.htmlID=ti.Q}ngOnChanges(t){t.versionsNumber&&(this.listItems=this.BuildItems(this.versionsNumber))}BuildItems(t){const n=[];for(let i=1;i<=t;i++)n.push({label:`Viewing version ${i.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}`,command:()=>{this.onChangeVersion(i)}});return n}onChangeVersion(t){this.choosed=""+this.listItems[t-1].label,this.versionChange.emit(t)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-preview-header"]],inputs:{patientName:"patientName",caseNumber:"caseNumber",versionsNumber:"versionsNumber",latestVersion:"latestVersion"},outputs:{versionChange:"versionChange"},features:[o.TTD],decls:3,vars:3,consts:[["class","header-info",4,"ngIf"],["src","assets/ismilelogo.png","routerLink","/orders/orders-list",3,"id"],["class","btn-list-wrapper",4,"ngIf"],[1,"header-info"],[1,"text-primary","text-capitalize","d-block",3,"id"],[1,"d-block",3,"id"],[1,"btn-list-wrapper"],[3,"popup","model","id"],["menu",""],["type","button","pButton","","icon","fa fa-sort-down","iconPos","right",1,"p-button-secondary","custom-btn",3,"label","disabled","id","click"]],template:function(t,n){1&t&&(o.YNc(0,ey,7,8,"div",0),o._UZ(1,"img",1),o.YNc(2,ty,4,6,"div",2)),2&t&&(o.Q6J("ngIf",n.patientName),o.xp6(1),o.Q6J("id",n.htmlID.Image+"logo"),o.xp6(1),o.Q6J("ngIf",n.versionsNumber>0))},dependencies:[j.O5,k.rH,Ph.Hq,Kv.v2,kn.X$],styles:['[_nghost-%COMP%]{display:grid;grid:"info img list";grid-template-columns:30% 1fr 30%;align-items:center;width:100%;height:-moz-fit-content;height:fit-content;padding:.5rem 1rem}[_nghost-%COMP%]   .header-info[_ngcontent-%COMP%]{grid:info;justify-self:start}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{grid-area:img;justify-self:center;display:block;width:150px;cursor:pointer}[_nghost-%COMP%]   .btn-list-wrapper[_ngcontent-%COMP%]{grid-area:list;justify-self:end;padding-right:84px}[_nghost-%COMP%]   .btn-list-wrapper[_ngcontent-%COMP%]   button.custom-btn[_ngcontent-%COMP%]{min-width:8rem;padding:10px 15px;border-radius:10px!important}[_nghost-%COMP%]   .btn-list-wrapper[_ngcontent-%COMP%]   button.custom-btn[_ngcontent-%COMP%]:disabled{cursor:not-allowed}']}),s})(),iy=(()=>{class s{constructor(){this.enableProceed=!1,this.consultation=new o.vpe,this.amendmentsRequest=new o.vpe,this.proceed=new o.vpe,this.htmlID=ti.Q}emitConsultation(){this.consultation.emit()}emitAmendment(){this.amendmentsRequest.emit()}emitProceed(){this.proceed.emit()}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-preview-footer"]],inputs:{enableProceed:"enableProceed"},outputs:{consultation:"consultation",amendmentsRequest:"amendmentsRequest",proceed:"proceed"},decls:10,vars:13,consts:[[1,"btn-wrapper"],["pButton","","type","button","id","openFt",1,"btn1","mx-2","p-button-raised",3,"id","click"],["pButton","","type","button","id","openRequest",1,"btn2","mx-2","p-button-raised",3,"id","click"],["pButton","","type","button","id","openConfirmDialogue",1,"btn3","mx-2","p-button-raised","px-4",3,"disabled","id","click"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"button",1),o.NdJ("click",function(){return n.emitConsultation()}),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"button",2),o.NdJ("click",function(){return n.emitAmendment()}),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.TgZ(7,"button",3),o.NdJ("click",function(){return n.emitProceed()}),o._uU(8),o.ALo(9,"translate"),o.qZA()()),2&t&&(o.xp6(1),o.Q6J("id",n.htmlID.Button+"Consultation"),o.xp6(1),o.hij(" ",o.lcZ(3,7,"Online Consultation")," "),o.xp6(2),o.Q6J("id",n.htmlID.Button+"openRequest"),o.xp6(1),o.hij(" ",o.lcZ(6,9,"Request Amendments")," "),o.xp6(2),o.Q6J("disabled",!n.enableProceed)("id",n.htmlID.Button+"openConfirmDialogue"),o.xp6(1),o.hij(" ",o.lcZ(9,11,"Proceed")," "))},dependencies:[Ph.Hq,kn.X$],styles:["[_nghost-%COMP%]{display:block;padding-right:94px;height:-moz-fit-content;height:fit-content;background-color:#565454}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding-top:.5rem;padding-bottom:.5rem}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:10px;cursor:pointer}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{filter:brightness(80%);border-color:transparent}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{filter:brightness(80%);opacity:.3;cursor:not-allowed}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   .btn1[_ngcontent-%COMP%]{background:none;border-color:#fff}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   .btn2[_ngcontent-%COMP%]{background-color:#2eb2db;border-color:#2eb2db}[_nghost-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   .btn3[_ngcontent-%COMP%]{background-color:#38ba5c;border-color:#38ba5c}"]}),s})();const ry=function(s){return{"step-active":s}},sy=function(){return{minimumIntegerDigits:2,useGrouping:!1}};function oy(s,e){if(1&s){const t=o.EpF();o.ynx(0),o.TgZ(1,"li",12),o.NdJ("click",function(){const r=o.CHM(t).index,a=o.oxw(2);return o.KtG(a.onclick(r))}),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.BQk()}if(2&s){const t=e.index,n=o.oxw(2);o.xp6(1),o.Q6J("id",n.htmlID.List+"step"+t)("ngClass",o.VKq(5,ry,t===n.choosedFileIndex)),o.xp6(1),o.hij(" ",o.lcZ(3,3,(t+1).toLocaleString("en-US",o.DdM(7,sy)))," ")}}function ay(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",1)(1,"section",2)(2,"button",3),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.prev())}),o._UZ(3,"i",4),o.qZA(),o.TgZ(4,"button",5),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.togglePlay())}),o._UZ(5,"i",6),o.qZA(),o.TgZ(6,"button",7),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.next())}),o._UZ(7,"i",8),o.qZA()(),o.TgZ(8,"section",9)(9,"ul",10),o.YNc(10,oy,4,8,"ng-container",11),o.qZA()()()}if(2&s){const t=o.oxw();o.xp6(2),o.Q6J("id",t.htmlID.Button+"player"),o.xp6(2),o.Q6J("id",t.htmlID.Button+"togglePlay"),o.xp6(1),o.Tol(t.isplaying?"fa-pause":"fa-play"),o.xp6(1),o.Q6J("id",t.htmlID.Button+"next"),o.xp6(4),o.Q6J("ngForOf",t.getLonger())}}let ly=(()=>{class s{constructor(){this.htmlID=ti.Q,this.time=500,this.isplaying=!1,this.change=new o.vpe,this.choosedFileIndex=0,this.files={}}ngOnInit(){setTimeout(()=>{this.choose(0)})}getLength(){const t=this.files.upper?this.files.upper.length:0,n=this.files.lower?this.files.lower.length:0;return t>=n?t:n}getLonger(){return this.files.upper&&this.files.lower?this.files.upper.length>=this.files.lower.length?this.files.upper:this.files.lower:this.files.upper?this.files.upper:this.files.lower?this.files.lower:[]}choose(t){this.choosedFileIndex=t;const n={};if(this.files.lower){const i=this.files.lower.length;n.lower=i>t?this.files.lower[t]:this.files.lower[i-1]}if(this.files.upper){const i=this.files.upper.length;n.upper=i>t?this.files.upper[t]:this.files.upper[i-1]}this.change.emit(n)}chooseNext(){this.choosedFileIndex<this.getLength()-1?this.choose(this.choosedFileIndex+1):this.choose(0)}choosePrev(){this.choose(this.choosedFileIndex>0?this.choosedFileIndex-1:this.getLength()-1)}onclick(t){t!==this.choosedFileIndex&&this.choose(t),this.stop()}next(){this.chooseNext(),this.stop()}prev(){this.choosePrev(),this.stop()}start(){this.isplaying=!0,setTimeout(()=>{this.chooseNext(),this.playInterval=setInterval(()=>{this.choosedFileIndex===this.getLength()-1?this.stop():this.chooseNext()},this.time)},.5*this.time)}stop(){clearInterval(this.playInterval),this.isplaying=!1}togglePlay(){this.isplaying?this.stop():this.start()}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-preview-player"]],inputs:{isplaying:"isplaying",files:"files"},outputs:{change:"change"},decls:1,vars:1,consts:[["class","player",4,"ngIf"],[1,"player"],[1,"buttons"],[1,"back","player-btn",3,"id","click"],[1,"fas","fa-sharp","fa-solid","fa-forward","fa-flip-horizontal"],[1,"play","player-btn",3,"id","click"],[1,"fas","fa-solid"],[1,"forward","player-btn",3,"id","click"],[1,"fas","fa-sharp","fa-solid","fa-forward"],[1,"stepper"],[1,"stepper-list"],[4,"ngFor","ngForOf"],[1,"stepper-step",3,"id","ngClass","click"]],template:function(t,n){1&t&&o.YNc(0,ay,11,6,"div",0),2&t&&o.Q6J("ngIf",n.getLength()>0)},dependencies:[j.mk,j.sg,j.O5,kn.X$],styles:['.player[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;width:100%;padding:.5rem 0;padding-right:0}.player[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.player[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .player-btn[_ngcontent-%COMP%]{display:block;background:#2eb2db;color:#fff;margin:0 .5rem;width:26px;height:26px;font-size:14px;border:none;border-radius:50%}.player[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .player-btn.play[_ngcontent-%COMP%]{width:40px;height:40px;margin:0;font-size:16px}.player[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .player-btn[_ngcontent-%COMP%]:hover{filter:brightness(.9)}.player[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .player-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.player[_ngcontent-%COMP%]   .stepper-list[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;display:flex;margin:0;padding:0 1rem;list-style:none;align-items:center}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]{display:block;padding-top:1.5rem;position:relative;padding-right:12px;font-family:Inter;font-style:normal;font-weight:400;font-size:8px;line-height:152.02%;cursor:pointer}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]:hover{color:#999}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]:before{content:"";position:absolute;background:#8c8c8c;display:block;width:100%;height:2px;top:14px;left:.3rem}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]:last-child:before{width:.3rem;padding-right:0}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]:after{content:"";position:absolute;background:#565454;display:block;width:4px;height:12px;top:.5rem;left:.3rem;border-radius:3px}.player[_ngcontent-%COMP%]   .stepper-step[_ngcontent-%COMP%]:hover:after{background-color:#999}.player[_ngcontent-%COMP%]   .stepper-step.step-active[_ngcontent-%COMP%]{color:#2eb2db}.player[_ngcontent-%COMP%]   .stepper-step.step-active[_ngcontent-%COMP%]:after{content:"|||";color:#fff;line-height:6px;padding-left:2px;padding-top:3px;font-size:5px;font-weight:800;background:#2eb2db!important;width:10px;height:12px;left:0;transition:color .3s}']}),s})();const Lh={type:"change"},Il={type:"start"},Rl={type:"end"};class cy extends Si{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ie){ie.addEventListener("keydown",gt),this._domElementKeyEvents=ie},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Lh),n.update(),r=i.NONE},this.update=function(){const ie=new P,ot=(new vn).setFromUnitVectors(e.up,new P(0,1,0)),Jt=ot.clone().invert(),Dt=new P,ln=new vn,Rn=2*Math.PI;return function(){const ta=n.object.position;ie.copy(ta).sub(n.target),ie.applyQuaternion(ot),l.setFromVector3(ie),n.autoRotate&&r===i.NONE&&ae(function S(){return 2*Math.PI/60/60*n.autoRotateSpeed}()),n.enableDamping?(l.theta+=c.theta*n.dampingFactor,l.phi+=c.phi*n.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let Xn=n.minAzimuthAngle,Yn=n.maxAzimuthAngle;return isFinite(Xn)&&isFinite(Yn)&&(Xn<-Math.PI?Xn+=Rn:Xn>Math.PI&&(Xn-=Rn),Yn<-Math.PI?Yn+=Rn:Yn>Math.PI&&(Yn-=Rn),l.theta=Xn<=Yn?Math.max(Xn,Math.min(Yn,l.theta)):l.theta>(Xn+Yn)/2?Math.max(Xn,l.theta):Math.min(Yn,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),ie.setFromSpherical(l),ie.applyQuaternion(Jt),ta.copy(n.target).add(ie),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),u=1,!!(d||Dt.distanceToSquared(n.object.position)>a||8*(1-ln.dot(n.object.quaternion))>a)&&(n.dispatchEvent(Lh),Dt.copy(n.object.position),ln.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Qe),n.domElement.removeEventListener("pointerdown",Ye),n.domElement.removeEventListener("pointercancel",be),n.domElement.removeEventListener("wheel",bt),n.domElement.removeEventListener("pointermove",N),n.domElement.removeEventListener("pointerup",R),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",gt)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const a=1e-6,l=new dh,c=new dh;let u=1;const h=new P;let d=!1;const f=new Ie,p=new Ie,m=new Ie,v=new Ie,y=new Ie,_=new Ie,g=new Ie,b=new Ie,M=new Ie,A=[],B={};function V(){return Math.pow(.95,n.zoomSpeed)}function ae(ie){c.theta-=ie}function K(ie){c.phi-=ie}const J=function(){const ie=new P;return function(Jt,Dt){ie.setFromMatrixColumn(Dt,0),ie.multiplyScalar(-Jt),h.add(ie)}}(),Ae=function(){const ie=new P;return function(Jt,Dt){!0===n.screenSpacePanning?ie.setFromMatrixColumn(Dt,1):(ie.setFromMatrixColumn(Dt,0),ie.crossVectors(n.object.up,ie)),ie.multiplyScalar(Jt),h.add(ie)}}(),le=function(){const ie=new P;return function(Jt,Dt){const ln=n.domElement;if(n.object.isPerspectiveCamera){ie.copy(n.object.position).sub(n.target);let Hi=ie.length();Hi*=Math.tan(n.object.fov/2*Math.PI/180),J(2*Jt*Hi/ln.clientHeight,n.object.matrix),Ae(2*Dt*Hi/ln.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(J(Jt*(n.object.right-n.object.left)/n.object.zoom/ln.clientWidth,n.object.matrix),Ae(Dt*(n.object.top-n.object.bottom)/n.object.zoom/ln.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function ce(ie){n.object.isPerspectiveCamera?u/=ie:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*ie)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function _e(ie){n.object.isPerspectiveCamera?u*=ie:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/ie)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function fe(ie){f.set(ie.clientX,ie.clientY)}function Ve(ie){v.set(ie.clientX,ie.clientY)}function Xe(){1===A.length?f.set(A[0].pageX,A[0].pageY):f.set(.5*(A[0].pageX+A[1].pageX),.5*(A[0].pageY+A[1].pageY))}function ue(){1===A.length?v.set(A[0].pageX,A[0].pageY):v.set(.5*(A[0].pageX+A[1].pageX),.5*(A[0].pageY+A[1].pageY))}function lt(){const ie=A[0].pageX-A[1].pageX,ot=A[0].pageY-A[1].pageY,Jt=Math.sqrt(ie*ie+ot*ot);g.set(0,Jt)}function it(ie){if(1==A.length)p.set(ie.pageX,ie.pageY);else{const Jt=Ot(ie);p.set(.5*(ie.pageX+Jt.x),.5*(ie.pageY+Jt.y))}m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const ot=n.domElement;ae(2*Math.PI*m.x/ot.clientHeight),K(2*Math.PI*m.y/ot.clientHeight),f.copy(p)}function At(ie){if(1===A.length)y.set(ie.pageX,ie.pageY);else{const ot=Ot(ie);y.set(.5*(ie.pageX+ot.x),.5*(ie.pageY+ot.y))}_.subVectors(y,v).multiplyScalar(n.panSpeed),le(_.x,_.y),v.copy(y)}function xe(ie){const ot=Ot(ie),Jt=ie.pageX-ot.x,Dt=ie.pageY-ot.y,ln=Math.sqrt(Jt*Jt+Dt*Dt);b.set(0,ln),M.set(0,Math.pow(b.y/g.y,n.zoomSpeed)),ce(M.y),g.copy(b)}function Ye(ie){!1!==n.enabled&&(0===A.length&&(n.domElement.setPointerCapture(ie.pointerId),n.domElement.addEventListener("pointermove",N),n.domElement.addEventListener("pointerup",R)),function Re(ie){A.push(ie)}(ie),"touch"===ie.pointerType?function Et(ie){switch(ht(ie),A.length){case 1:switch(n.touches.ONE){case 0:if(!1===n.enableRotate)return;Xe(),r=i.TOUCH_ROTATE;break;case 1:if(!1===n.enablePan)return;ue(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;(function ft(){n.enableZoom&&lt(),n.enablePan&&ue()})(),r=i.TOUCH_DOLLY_PAN;break;case 3:if(!1===n.enableZoom&&!1===n.enableRotate)return;(function nt(){n.enableZoom&&lt(),n.enableRotate&&Xe()})(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(Il)}(ie):function De(ie){let ot;switch(ie.button){case 0:ot=n.mouseButtons.LEFT;break;case 1:ot=n.mouseButtons.MIDDLE;break;case 2:ot=n.mouseButtons.RIGHT;break;default:ot=-1}switch(ot){case 1:if(!1===n.enableZoom)return;(function we(ie){g.set(ie.clientX,ie.clientY)})(ie),r=i.DOLLY;break;case 0:if(ie.ctrlKey||ie.metaKey||ie.shiftKey){if(!1===n.enablePan)return;Ve(ie),r=i.PAN}else{if(!1===n.enableRotate)return;fe(ie),r=i.ROTATE}break;case 2:if(ie.ctrlKey||ie.metaKey||ie.shiftKey){if(!1===n.enableRotate)return;fe(ie),r=i.ROTATE}else{if(!1===n.enablePan)return;Ve(ie),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(Il)}(ie))}function N(ie){!1!==n.enabled&&("touch"===ie.pointerType?function pt(ie){switch(ht(ie),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;it(ie),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;At(ie),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;(function ke(ie){n.enableZoom&&xe(ie),n.enablePan&&At(ie)})(ie),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;(function We(ie){n.enableZoom&&xe(ie),n.enableRotate&&it(ie)})(ie),n.update();break;default:r=i.NONE}}(ie):function je(ie){if(!1!==n.enabled)switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function at(ie){p.set(ie.clientX,ie.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const ot=n.domElement;ae(2*Math.PI*m.x/ot.clientHeight),K(2*Math.PI*m.y/ot.clientHeight),f.copy(p),n.update()}(ie);break;case i.DOLLY:if(!1===n.enableZoom)return;!function ut(ie){b.set(ie.clientX,ie.clientY),M.subVectors(b,g),M.y>0?ce(V()):M.y<0&&_e(V()),g.copy(b),n.update()}(ie);break;case i.PAN:if(!1===n.enablePan)return;!function $e(ie){y.set(ie.clientX,ie.clientY),_.subVectors(y,v).multiplyScalar(n.panSpeed),le(_.x,_.y),v.copy(y),n.update()}(ie)}}(ie))}function R(ie){!1!==n.enabled&&("touch"===ie.pointerType?function te(ie){n.dispatchEvent(Rl),r=i.NONE}():function st(ie){n.dispatchEvent(Rl),r=i.NONE}(),rt(ie),0===A.length&&(n.domElement.releasePointerCapture(ie.pointerId),n.domElement.removeEventListener("pointermove",N),n.domElement.removeEventListener("pointerup",R)))}function be(ie){rt(ie)}function bt(ie){!1===n.enabled||!1===n.enableZoom||r!==i.NONE&&r!==i.ROTATE||(ie.preventDefault(),n.dispatchEvent(Il),function Oe(ie){ie.deltaY<0?_e(V()):ie.deltaY>0&&ce(V()),n.update()}(ie),n.dispatchEvent(Rl))}function gt(ie){!1===n.enabled||!1===n.enablePan||function Je(ie){let ot=!1;switch(ie.code){case n.keys.UP:le(0,n.keyPanSpeed),ot=!0;break;case n.keys.BOTTOM:le(0,-n.keyPanSpeed),ot=!0;break;case n.keys.LEFT:le(n.keyPanSpeed,0),ot=!0;break;case n.keys.RIGHT:le(-n.keyPanSpeed,0),ot=!0}ot&&(ie.preventDefault(),n.update())}(ie)}function Qe(ie){!1!==n.enabled&&ie.preventDefault()}function rt(ie){delete B[ie.pointerId];for(let ot=0;ot<A.length;ot++)if(A[ot].pointerId==ie.pointerId)return void A.splice(ot,1)}function ht(ie){let ot=B[ie.pointerId];void 0===ot&&(ot=new Ie,B[ie.pointerId]=ot),ot.set(ie.pageX,ie.pageY)}function Ot(ie){return B[(ie.pointerId===A[0].pointerId?A[1]:A[0]).pointerId]}n.domElement.addEventListener("contextmenu",Qe),n.domElement.addEventListener("pointerdown",Ye),n.domElement.addEventListener("pointercancel",be),n.domElement.addEventListener("wheel",bt,{passive:!1}),this.update()}}let ea=(()=>{class s{init(t,n,i,r,a){this.resize(t,r,n,a);const l=new Ke(16777215);i.background=l,r.position.set(0,0,150)}getControls(t,n,i,r){const a=new cy(t,n.domElement);return a.enablePan=!1,a.enableZoom=!0,a.minZoom=r,a.maxZoom=i,a.zoomSpeed=.5,a.dampingFactor=.51,a.enableDamping=!0,a.enableRotate=!0,a}getMaterial(t){let n;return n=new Cs("teeth"===t?{vertexColors:!0,emissive:4473924,flatShading:!1}:"gingiva"===t?{color:12087151,emissive:7745070,flatShading:!0}:{vertexColors:!0,emissive:4473924,flatShading:!0}),n}getMeshHeight(t){return(new Pn).setFromObject(t).getSize(new P).y}addLight(t,n){const i=new gl(2236962,.5);t.add(i);const r=new ml(16777215,.7);n.add(r),t.add(n)}reset(t,n,i){const r=t.object.zoom;t.reset(),t.object.zoom=r,n.updateProjectionMatrix(),i.rotation.set(0,0,0)}resize(t,n,i,r){const a=t.nativeElement,l=a.clientWidth-5,c=a.clientHeight-5,u=l/c;n.left=-r*u,n.right=r*u,n.top=r,n.bottom=-r,n.updateProjectionMatrix(),i.setSize(l,c)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac}),s})();const uy=["container"];let Ih=(()=>{class s{constructor(t){this.ViewerHelperService=t,this.frustum=50,this.zoomOutLimit=.1,this.zoomInLimit=5,this.isResizable=!0}ngAfterViewInit(){this.initScene(),this.render()}initScene(){this.renderer=new qt({canvas:this.containerRef.nativeElement.children[0],antialias:!0}),this.renderer.setPixelRatio(1.5*window.devicePixelRatio),this.scene=new uo,this.camera=new ds,this.ViewerHelperService.init(this.containerRef,this.renderer,this.scene,this.camera,this.frustum),this.ViewerHelperService.addLight(this.scene,this.camera),this.afterSceneInit(),this.controls=this.ViewerHelperService.getControls(this.camera,this.renderer,this.zoomInLimit,this.zoomOutLimit)}render(){requestAnimationFrame(()=>this.render()),this.controls.update(),this.renderer.render(this.scene,this.camera)}onWindowResize(){this.ViewerHelperService.resize(this.containerRef,this.camera,this.renderer,this.frustum)}resizable(){let t;for(let r of this.scene.children)(r instanceof $t||r instanceof vi)&&(t=r);if(!t)return!1;const n=(new Pn).setFromObject(t),i=new us;return i.setFromProjectionMatrix(this.camera.projectionMatrix),this.isResizable=i.containsPoint(n.min),this.isResizable}onZoomIn(){this.camera.zoom<this.zoomInLimit&&(this.camera.zoom+=.05,this.camera.updateProjectionMatrix())}onZoomOut(){this.camera.zoom>this.zoomOutLimit&&(this.camera.zoom-=.05,this.camera.updateProjectionMatrix())}ngOnDestroy(){this.renderer.dispose(),this.renderer.forceContextLoss()}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(ea))},s.\u0275cmp=o.Xpm({type:s,selectors:[["ng-component"]],viewQuery:function(t,n){if(1&t&&o.Gf(uy,7),2&t){let i;o.iGM(i=o.CRH())&&(n.containerRef=i.first)}},hostBindings:function(t,n){1&t&&o.NdJ("resize",function(){return n.onWindowResize()},!1,o.Jf7)},decls:0,vars:0,template:function(t,n){},encapsulation:2}),s})(),Rh=(()=>{class s{constructor(){this.htmlID=ti.Q,this.zoomIn=new o.vpe,this.zoomOut=new o.vpe,this.rotateRight=new o.vpe,this.rotateLeft=new o.vpe,this.reset=new o.vpe}onMouseDown(t,n){const i=setInterval(()=>t.emit(),200);n.addEventListener("mouseup",()=>{clearInterval(i)}),n.addEventListener("mouseleave",()=>{clearInterval(i)})}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-viewer-control"]],outputs:{zoomIn:"zoomIn",zoomOut:"zoomOut",rotateRight:"rotateRight",rotateLeft:"rotateLeft",reset:"reset"},decls:15,vars:5,consts:[[1,"ViewerControl"],["title","zoom in",1,"ViewerControl-btn",3,"id","mousedown","click"],["zoomInBtn",""],[1,"fas","fa-regular","fa-plus"],["title","zoom out",1,"ViewerControl-btn",3,"id","mousedown","click"],["zoomOutBtn",""],[1,"fas","fa-regular","fa-minus"],["title","rotate right",1,"ViewerControl-btn",3,"id","mousedown","click"],["rotateRightBtn",""],[1,"fas","fa-regular","fa-redo"],["title","rotate left",1,"ViewerControl-btn",3,"id","mousedown","click"],["rotateLeftBtn",""],[1,"fas","fa-regular","fa-redo","fa-rotate-180"],["title","reset",1,"ViewerControl-btn","ViewerControl-btn-sync",3,"id","click"],[1,"fas","fa-regular","fa-sync"]],template:function(t,n){if(1&t){const i=o.EpF();o.TgZ(0,"div",0)(1,"button",1,2),o.NdJ("mousedown",function(){o.CHM(i);const a=o.MAs(2);return o.KtG(n.onMouseDown(n.zoomIn,a))})("click",function(){return n.zoomIn.emit()}),o._UZ(3,"i",3),o.qZA(),o.TgZ(4,"button",4,5),o.NdJ("mousedown",function(){o.CHM(i);const a=o.MAs(5);return o.KtG(n.onMouseDown(n.zoomOut,a))})("click",function(){return n.zoomOut.emit()}),o._UZ(6,"i",6),o.qZA(),o.TgZ(7,"button",7,8),o.NdJ("mousedown",function(){o.CHM(i);const a=o.MAs(8);return o.KtG(n.onMouseDown(n.rotateRight,a))})("click",function(){return n.rotateRight.emit()}),o._UZ(9,"i",9),o.qZA(),o.TgZ(10,"button",10,11),o.NdJ("mousedown",function(){o.CHM(i);const a=o.MAs(11);return o.KtG(n.onMouseDown(n.rotateLeft,a))})("click",function(){return n.rotateLeft.emit()}),o._UZ(12,"i",12),o.qZA(),o.TgZ(13,"button",13),o.NdJ("click",function(){return n.reset.emit()}),o._UZ(14,"i",14),o.qZA()()}2&t&&(o.xp6(1),o.Q6J("id",n.htmlID.Button+"zoomingin"),o.xp6(3),o.Q6J("id",n.htmlID.Button+"zoomingout"),o.xp6(3),o.Q6J("id",n.htmlID.Button+"rotatingR"),o.xp6(3),o.Q6J("id",n.htmlID.Button+"rotatingL"),o.xp6(3),o.Q6J("id",n.htmlID.Button+"resetting"))},styles:["[_nghost-%COMP%]{position:absolute;right:2%;top:2%}[_nghost-%COMP%]   .ViewerControl[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .ViewerControl-btn[_ngcontent-%COMP%]{border:none;background-color:#2eb2db;color:#fff;box-sizing:border-box;font-size:12px;padding:4px 8px;width:37px;font-weight:100}[_nghost-%COMP%]   .ViewerControl-btn-sync[_ngcontent-%COMP%]{background-color:#ffaa45}[_nghost-%COMP%]   .ViewerControl-btn[_ngcontent-%COMP%]:hover{filter:brightness(.9)}"]}),s})();var Os=(()=>{return(s=Os||(Os={})).gridBack="Grid Back",s.gridFront="Grid Front",Os;var s})(),hy=ge(4782);let dy=(()=>{class s{constructor(){this.gridToggled=new o.vpe,this.gridValue=Os.gridBack,this.gridValues=Os,this.htmlID=ti.Q}ngOnInit(){}onToggleChange(t){this.gridToggled.emit(t)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-grid-toggle"]],outputs:{gridToggled:"gridToggled"},decls:5,vars:8,consts:[[1,"grid-toggle"],[3,"ngModel","trueValue","falseValue","id","ngModelChange"],[1,"grid-label",3,"id"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"p-inputSwitch",1),o.NdJ("ngModelChange",function(r){return n.gridValue=r})("ngModelChange",function(r){return n.onToggleChange(r)}),o.qZA(),o.TgZ(2,"p",2),o._uU(3),o.ALo(4,"translate"),o.qZA()()),2&t&&(o.xp6(1),o.Q6J("ngModel",n.gridValue)("trueValue",n.gridValues.gridBack)("falseValue",n.gridValues.gridFront)("id",n.htmlID.Input+"gridValue"),o.xp6(1),o.Q6J("id",n.htmlID.Paragraph+"gridValue"),o.xp6(1),o.Oqu(o.lcZ(4,6,n.gridValue)))},dependencies:[hy.Ql,En.JJ,En.On,kn.X$],styles:[".grid-toggle{min-width:158px;position:absolute;top:5px;left:2%;background:#565454;border-radius:10px;padding:10px 15px 4px;display:flex;justify-content:center;align-items:center;gap:8px}.grid-toggle .grid-label{color:#fff;font-weight:600;margin-bottom:4px;font-size:15px}.grid-toggle .p-inputswitch.p-inputswitch-checked .p-inputswitch-slider,.grid-toggle .p-inputswitch.p-inputswitch-checked:hover .p-inputswitch-slider{background:#38ba5c;padding-top:4px}.grid-toggle .p-inputswitch.p-focus .p-inputswitch-slider{box-shadow:none}\n"],encapsulation:2}),s})();function fy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"app-grid-toggle",6),o.NdJ("gridToggled",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.onGridChanged(i))}),o.qZA()}}let py=(()=>{class s extends Ih{constructor(t){super(t),this.ViewerHelperService=t,this.gridPostion=-50,this.viewMode="single",this.showGrid=!1}ngOnChanges(t){(t.geometries||t.viewMode||t.isActiveMaxMand)&&this.group&&this.updateGroup(),t.showGrid&&(this.showGrid?(this.controls.enableRotate=!1,this.addGridGroup()):this.gridGroup&&!this.showGrid&&(this.scene.remove(this.gridGroup),this.controls.enableRotate=!0))}afterSceneInit(){this.addGeometries(),this.containerRef.nativeElement.addEventListener("mousedown",t=>{if(this.showGrid){let n=t.clientX,i=t.clientY;const r=a=>{const l=a.clientX-n,c=a.clientY-i;n=a.clientX,i=a.clientY,this.group.rotation.x+=c/250,this.group.rotation.y+=l/250};this.containerRef.nativeElement.addEventListener("mousemove",r),this.containerRef.nativeElement.addEventListener("mouseup",()=>{this.containerRef.nativeElement.removeEventListener("mousemove",r)})}})}addGeometryToGroup(t,n,i){n.computeVertexNormals(),n.computeBoundingBox();const r=n.boundingBox?.max.z+0;n.center();const a=n.boundingBox?.max.z+0;let l;"upper"===i?(this.upperX=n.boundingBox?.max.x+0,n.translate(0,0,r-a)):n.translate(this.upperX?this.upperX-(n.boundingBox?.max.x+0):0,0,r-a),l=new $t(n,n.groups.length>0?[this.ViewerHelperService.getMaterial("gingiva"),this.ViewerHelperService.getMaterial("teeth")]:this.ViewerHelperService.getMaterial("both")),l.name=i,t.add(l)}fixMeshesRotation(t){const n=t.children.filter(i=>i instanceof $t);for(const i of n)i.rotation.x-=.5*Math.PI,i.rotation.z+=.5*Math.PI}addGeometries(){this.group=new vi;const t=this.geometries.upper?.geometry,n=this.geometries.lower?.geometry;t&&("multiple"===this.viewMode||"single"===this.viewMode&&this.isActiveMaxMand[0])&&this.addGeometryToGroup(this.group,t,"upper"),n&&("multiple"===this.viewMode||"single"===this.viewMode&&this.isActiveMaxMand[1])&&this.addGeometryToGroup(this.group,n,"lower"),this.fixMeshesRotation(this.group);const i=(new Pn).setFromObject(this.group);this.group.position.y-=(i.max.y+i.min.y)/2,this.scene.add(this.group)}updateGroup(){const t=this.group.rotation.y;this.scene.remove(this.group),this.addGeometries(),this.group.rotation.y=t}rotate(t){this.ViewerHelperService.reset(this.controls,this.camera,this.group);let n=0;"left"===t?n=-.5:"right"===t?n=.5:"inner"===t&&(n=1),this.group.rotation.y=n*Math.PI}onRotateRight(){this.group.rotation.y+=.125}onRotateLeft(){this.group.rotation.y-=.125}onReset(){this.controls.reset(),this.group.rotation.y=0,this.group.rotation.x=0}addGridGroup(){this.gridGroup=new vi;const t=new Ml(1e3,600,14932955,14932955);t.rotation.x=.5*Math.PI,t.position.z=-50;const n=new Ml(1e3,150,13683916,13683916);n.renderOrder=100,n.rotation.x=Math.PI/2,n.position.z=-50,this.gridGroup.add(n),this.gridGroup.add(t),this.scene.add(this.gridGroup)}onGridChanged(t){this.gridGroup.position.z="Grid Front"===t?99:-50}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(ea))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-main-viewer"]],inputs:{viewMode:"viewMode",isActiveMaxMand:"isActiveMaxMand",showGrid:"showGrid",geometries:"geometries"},features:[o.qOj,o.TTD],decls:6,vars:1,consts:[[1,"render"],["container",""],[1,"render-canvas"],["canvas",""],[3,"zoomIn","zoomOut","rotateRight","rotateLeft","reset"],[3,"gridToggled",4,"ngIf"],[3,"gridToggled"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0,1),o._UZ(2,"canvas",2,3),o.TgZ(4,"app-viewer-control",4),o.NdJ("zoomIn",function(){return n.onZoomIn()})("zoomOut",function(){return n.onZoomOut()})("rotateRight",function(){return n.onRotateRight()})("rotateLeft",function(){return n.onRotateLeft()})("reset",function(){return n.onReset()}),o.qZA(),o.YNc(5,fy,1,0,"app-grid-toggle",5),o.qZA()),2&t&&(o.xp6(5),o.Q6J("ngIf",n.showGrid))},dependencies:[j.O5,Rh,dy],styles:[".render[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;position:relative}.render[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;top:0;right:0}"]}),s})(),my=(()=>{class s extends Ih{constructor(t){super(t),this.ViewerHelperService=t,this.type="Maxilla",this.initialized=!1}ngOnChanges(t){t.isOtherActive&&this.initialized&&setTimeout(()=>{this.camera.zoom+=!1===t.isOtherActive.currentValue?-.5:.5},10),t.arch&&this.mesh&&this.updateGeometry()}afterSceneInit(){this.addGeometry(),this.fixRotation(),this.isOtherActive&&(this.camera.zoom=1.5),this.camera.updateProjectionMatrix(),this.initialized=!0}addGeometry(){this.arch=this.arch.clone(),this.arch.computeBoundingBox(),this.arch.center(),this.arch.computeVertexNormals(),this.mesh=new $t(this.arch,this.arch.groups.length>0?[this.ViewerHelperService.getMaterial("gingiva"),this.ViewerHelperService.getMaterial("teeth")]:this.ViewerHelperService.getMaterial("both"));const t=(new Pn).setFromObject(this.mesh);this.mesh.position.y-=(t.max.z+t.min.z)/2,this.scene.add(this.mesh)}updateGeometry(){const t=this.mesh.rotation.clone();this.scene.remove(this.mesh),this.addGeometry(),this.mesh.rotation.copy(t)}fixRotation(){"Maxilla"===this.type?(this.mesh.rotation.z=-.5*Math.PI,this.mesh.rotation.y=Math.PI):this.mesh.rotation.z=.5*Math.PI}rotate(t){this.ViewerHelperService.reset(this.controls,this.camera,this.mesh),"left"===t?this.mesh.rotation.x=-.5*Math.PI:"right"===t?(this.mesh.rotation.y=Math.PI,this.mesh.rotation.x=.5*Math.PI):"inner"===t?(this.mesh.rotation.x=-.5*Math.PI,this.mesh.rotation.z=-.5*Math.PI):(this.mesh.rotation.x=-.5*Math.PI,this.mesh.rotation.z=.5*Math.PI)}onRotateRight(){0===this.mesh.rotation.x?this.mesh.rotation.y+=.125:this.mesh.rotation.z+=.125}onRotateLeft(){0===this.mesh.rotation.x?this.mesh.rotation.y+=-.125:this.mesh.rotation.z+=-.125}onRest(){this.controls.reset(),this.camera.zoom=this.isOtherActive?1.5:1,this.camera.updateProjectionMatrix(),this.mesh.rotation.set(0,0,0),this.fixRotation()}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(ea))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-secondary-viewer"]],inputs:{type:"type",isOtherActive:"isOtherActive",arch:"arch"},features:[o.qOj,o.TTD],decls:5,vars:0,consts:[[1,"render"],["container",""],[1,"render-canvas"],["canvas",""],[3,"zoomIn","zoomOut","rotateRight","rotateLeft","reset"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0,1),o._UZ(2,"canvas",2,3),o.TgZ(4,"app-viewer-control",4),o.NdJ("zoomIn",function(){return n.onZoomIn()})("zoomOut",function(){return n.onZoomOut()})("rotateRight",function(){return n.onRotateRight()})("rotateLeft",function(){return n.onRotateLeft()})("reset",function(){return n.onRest()}),o.qZA()())},dependencies:[Rh],styles:["[_nghost-%COMP%]{width:100%;height:100%}.render[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;position:relative}.render[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;top:0;right:0}"]}),s})();var Ol=ge(9765),gy=ge(8002);const _y=function(s,e){return{zoom:s,transform:e}};let vy=(()=>{class s{constructor(){}ngOnInit(){this.zoom.subscribe(t=>t?this.zoomIn():this.zoomOut()),this.rotate.subscribe(t=>t?this.rotateRight():this.rotateLeft()),this.changeImage.subscribe(t=>t?this.loadNext():this.loadPrev()),void 0===this.current&&(this.current=0),this.setSrc()}setSrc(){this.src=this.images[this.current],this.resetState()}resetState(){this.config={zoomValue:1,rotationValue:0}}zoomIn(){this.config.zoomValue+.5<=4&&(this.config.zoomValue+=.5)}zoomOut(){this.config.zoomValue-.5>=.5&&(this.config.zoomValue-=.5)}rotateRight(){this.config.rotationValue+=90}rotateLeft(){this.config.rotationValue-=90}loadNext(){this.current+1<this.images.length?this.current+=1:this.current=0,this.setSrc()}loadPrev(){this.current-1>=0?this.current-=1:this.current=this.images.length-1,this.setSrc()}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-images-viewer"]],inputs:{images:"images",current:"current",zoom:"zoom",rotate:"rotate",changeImage:"changeImage"},decls:1,vars:5,consts:[[1,"viewed-image",3,"src","ngStyle"]],template:function(t,n){1&t&&o._UZ(0,"img",0),2&t&&o.Q6J("src",n.src,o.LSH)("ngStyle",o.WLB(2,_y,n.config.zoomValue,"rotate("+n.config.rotationValue+"deg)"))},dependencies:[j.PC],styles:[".viewed-image[_ngcontent-%COMP%]{max-width:78vw;max-height:75vh}"]}),s})();var yy=ge(7369);let xy=(()=>{class s{constructor(){}ngOnInit(){this.zoom.subscribe(t=>t?this.zoomIn():this.zoomOut()),this.zoomValue=1,this.zoomScale=.25}zoomIn(){this.zoomValue+=this.zoomScale}zoomOut(){this.zoomValue-this.zoomScale>=.5&&(this.zoomValue-=this.zoomScale)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-pdf-viewer"]],inputs:{link:"link",zoom:"zoom"},decls:1,vars:13,consts:[[1,"pdf-viewer",3,"src","original-size","render-text","rotation","show-all","fit-to-page","zoom","zoom-scale","stick-to-page","external-link-target","autoresize","show-borders","page"]],template:function(t,n){1&t&&o._UZ(0,"pdf-viewer",0),2&t&&o.Q6J("src",n.link)("original-size",!0)("render-text",!0)("rotation",0)("show-all",!0)("fit-to-page",!1)("zoom",n.zoomValue)("zoom-scale",n.zoomScale)("stick-to-page",!1)("external-link-target","blank")("autoresize",!0)("show-borders",!1)("page",1)},dependencies:[yy.rQ],styles:["[_nghost-%COMP%]   .pdf-viewer[_ngcontent-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]     .pdfViewer{margin-right:30px}"]}),s})();function wy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",19)(1,"img",20),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.loadNext())}),o.qZA()()}}function by(s,e){if(1&s&&o._UZ(0,"app-images-viewer",21),2&s){const t=o.oxw();o.Q6J("images",t.images)("current",t.current)("zoom",t.zoom)("rotate",t.rotate)("changeImage",t.changeImage)("ngClass","viewer-content-main--child")}}function My(s,e){if(1&s&&o._UZ(0,"app-pdf-viewer",22),2&s){const t=o.oxw();o.Q6J("link",t.pdf)("zoom",t.zoom)("rotate",t.rotate)("changePage",t.changeImage)("ngClass","viewer-content-main--child viewer-content-main--child-pdf")}}function Sy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",23)(1,"img",20),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.loadPrev())}),o.qZA()()}}function Ty(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",24)(1,"div",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.download())}),o._UZ(2,"i",26),o.qZA()()}}function Ay(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",27)(1,"img",28),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.rotateLeft())}),o.qZA(),o.TgZ(2,"img",29),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.rotateRight())}),o.qZA()()}}function Ey(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"img",30),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(),r=o.MAs(1);return o.KtG(i.fullscreenOn(r))}),o.qZA()}}function Cy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"img",31),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.fullscreenOff())}),o.qZA()}}let Oh=(()=>{class s{constructor(t,n,i){this.dialogRef=t,this.data=n,this.http=i,this.zoom=new Ol.xQ,this.rotate=new Ol.xQ,this.changeImage=new Ol.xQ,this.images=[]}ngOnInit(){this.data.images&&this.data.images.length>0?(this.images=[...this.data.images.map(t=>An.N.RootURL+t)],this.current=this.data.current,this.pdf=void 0):this.data.pdf&&this.loadPDF()}loadPDF(){this.http.get(An.N.RootURL+this.data.pdf.downloadPath,{responseType:"blob"}).pipe((0,gy.U)(t=>URL.createObjectURL(new Blob([t],{type:"application/pdf"})))).subscribe(t=>{this.pdf=t})}rotateRight(){this.rotate.next(!0)}rotateLeft(){this.rotate.next(!1)}zoomIn(){this.zoom.next(!0)}zoomOut(){this.zoom.next(!1)}fullscreenOn(t){this.isFullscreen=!0,t.requestFullscreen()}fullscreenOff(){this.isFullscreen=!1,document.exitFullscreen()}loadNext(){this.changeImage.next(!0)}loadPrev(){this.changeImage.next(!1)}close(){this.dialogRef.close()}pdfMode(){return!(this.images&&this.images.length>0||!this.pdf)}download(){if(!this.pdfMode())throw new Error("download only available in pdf mode");document.location.href=this.pdf,window.open(An.N.cpRootURL+"/API/V1/Downloader/download?link="+this.data.pdf.downloadPath,"_self")}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(dn.so),o.Y36(dn.WI),o.Y36(jr.eN))},s.\u0275cmp=o.Xpm({type:s,selectors:[["ng-component"]],decls:19,vars:8,consts:[[1,"viewer"],["viewer",""],[1,"viewer-close"],["src","assets/icons/viewer-cross.svg",1,"viewer-close-icon",3,"click"],[1,"viewer-content"],["class","viewer-content-slider viewer-content-slider--left",4,"ngIf"],[1,"viewer-content-main"],[3,"images","current","zoom","rotate","changeImage","ngClass",4,"ngIf"],[3,"link","zoom","rotate","changePage","ngClass",4,"ngIf"],["class","viewer-content-slider viewer-content-slider--right",4,"ngIf"],[1,"viewer-footer"],["class","viewer-footer-download",4,"ngIf"],["class","viewer-footer-rotate viewer-footer-rotate--left",4,"ngIf"],[1,"viewer-footer-zoom"],["src","assets/icons/viewer-zoom-in.svg",1,"viewer-footer-zoom--in","viewer-footer-icon",3,"click"],["src","assets/icons/viewer-zoom-out.svg",1,"viewer-footer-zoom--out","viewer-footer-icon",3,"click"],[1,"viewer-footer-full"],["class","viewer-footer-full--on viewer-footer-icon","src","assets/icons/viewer-full-in.svg",3,"click",4,"ngIf"],["class","viewer-footer-full--off viewer-footer-icon","src","assets/icons/viewer-full-out.svg",3,"click",4,"ngIf"],[1,"viewer-content-slider","viewer-content-slider--left"],["src","assets/icons/viewer-angle-circle.svg",1,"viewer-content-slider-icon",3,"click"],[3,"images","current","zoom","rotate","changeImage","ngClass"],[3,"link","zoom","rotate","changePage","ngClass"],[1,"viewer-content-slider","viewer-content-slider--right"],[1,"viewer-footer-download"],[1,"viewer-footer-icon",3,"click"],["aria-hidden","true",1,"fa","fa-download"],[1,"viewer-footer-rotate","viewer-footer-rotate--left"],["src","assets/icons/viewer-rotate.svg",1,"viewer-footer-rotate--left","viewer-footer-icon","active",3,"click"],["src","assets/icons/viewer-rotate.svg",1,"viewer-footer-rotate--right","viewer-footer-icon",3,"click"],["src","assets/icons/viewer-full-in.svg",1,"viewer-footer-full--on","viewer-footer-icon",3,"click"],["src","assets/icons/viewer-full-out.svg",1,"viewer-footer-full--off","viewer-footer-icon",3,"click"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0,1)(2,"div",2)(3,"img",3),o.NdJ("click",function(){return n.close()}),o.qZA()(),o.TgZ(4,"main",4),o.YNc(5,wy,2,0,"div",5),o.TgZ(6,"div",6),o.YNc(7,by,1,6,"app-images-viewer",7),o.YNc(8,My,1,5,"app-pdf-viewer",8),o.qZA(),o.YNc(9,Sy,2,0,"div",9),o.qZA(),o.TgZ(10,"footer",10),o.YNc(11,Ty,3,0,"div",11),o.YNc(12,Ay,3,0,"div",12),o.TgZ(13,"div",13)(14,"img",14),o.NdJ("click",function(){return n.zoomIn()}),o.qZA(),o.TgZ(15,"img",15),o.NdJ("click",function(){return n.zoomOut()}),o.qZA()(),o.TgZ(16,"div",16),o.YNc(17,Ey,1,0,"img",17),o.YNc(18,Cy,1,0,"img",18),o.qZA()()()),2&t&&(o.xp6(5),o.Q6J("ngIf",!n.pdfMode()),o.xp6(2),o.Q6J("ngIf",!n.pdfMode()),o.xp6(1),o.Q6J("ngIf",n.pdfMode()),o.xp6(1),o.Q6J("ngIf",!n.pdfMode()),o.xp6(2),o.Q6J("ngIf",n.pdfMode()),o.xp6(1),o.Q6J("ngIf",!n.pdfMode()),o.xp6(5),o.Q6J("ngIf",!n.isFullscreen),o.xp6(1),o.Q6J("ngIf",n.isFullscreen))},dependencies:[j.mk,j.O5,vy,xy],styles:["[_nghost-%COMP%]{box-sizing:border-box;scroll-behavior:smooth;width:100%;height:100%}[_nghost-%COMP%]   .viewer[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;width:100%;height:90vh;background-color:#fff}[_nghost-%COMP%]   .viewer-close[_ngcontent-%COMP%]{z-index:100;position:absolute;top:1.5rem;right:1.5rem;display:flex;flex-direction:row-reverse;align-items:flex-start;width:8rem;height:5rem}[_nghost-%COMP%]   .viewer-close-icon[_ngcontent-%COMP%]{width:1.6rem;cursor:pointer}[_nghost-%COMP%]   .viewer-close-icon[_ngcontent-%COMP%]:hover{filter:drop-shadow(16px 16px 20px red) invert(75%)}[_nghost-%COMP%]   .viewer-content[_ngcontent-%COMP%]{overflow:auto;flex:1;width:100%;height:100%;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .viewer-content-main[_ngcontent-%COMP%]{width:100%;height:100%;display:flex}[_nghost-%COMP%]   .viewer-content-main--child[_ngcontent-%COMP%]{margin:auto;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content}[_nghost-%COMP%]   .viewer-content-main--child-pdf[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .viewer-content-slider[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;width:-moz-fit-content;width:fit-content;z-index:90;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;padding:1.5rem}[_nghost-%COMP%]   .viewer-content-slider-icon[_ngcontent-%COMP%]{width:3rem}[_nghost-%COMP%]   .viewer-content-slider-icon[_ngcontent-%COMP%]:hover{cursor:pointer;filter:drop-shadow(16px 16px 20px red) invert(75%)}[_nghost-%COMP%]   .viewer-content-slider--left[_ngcontent-%COMP%]{left:0;transform:scaleX(-1)}[_nghost-%COMP%]   .viewer-content-slider--right[_ngcontent-%COMP%]{right:0}[_nghost-%COMP%]   .viewer-footer[_ngcontent-%COMP%]{z-index:100;bottom:0;width:100%;height:-moz-fit-content;height:fit-content;padding:0;background-color:#666;display:flex;justify-content:space-between;align-items:center}[_nghost-%COMP%]   .viewer-footer-icon[_ngcontent-%COMP%]{padding:1.5rem;width:5rem;cursor:pointer}[_nghost-%COMP%]   .viewer-footer-icon[_ngcontent-%COMP%]:hover{background-color:#2eb2db}[_nghost-%COMP%]   .viewer-footer-rotate--right[_ngcontent-%COMP%]{transform:scaleX(-1)}[_nghost-%COMP%]   .viewer-footer-download[_ngcontent-%COMP%]{width:10rem}[_nghost-%COMP%]   .viewer-footer-download[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#fff}[_nghost-%COMP%]   .viewer-footer-full[_ngcontent-%COMP%]{width:10rem;display:flex;justify-content:end}"]}),s})(),Dh=(()=>{class s{constructor(t){this.matDialog=t,window.pdfWorkerSrc=An.N.production?"/iSmileOn/assets/pdf.worker.min.js":"/assets/pdf.worker.min.js"}viewImages(t,n=0){if(0===t.length)throw new Error("FileViewerService: viewImages \n images array can't be empty");if(n<0)throw new Error("FileViewerService: viewImages \n current must be >= 0");if(n>=t.length)throw new Error("FileViewerService: viewImages \n current must be less than image.length");this.matDialog.open(Oh,{panelClass:"app-full-bleed-dialog",data:{images:t,current:n},minWidth:"90vw"})}viewPDF(t){if(0===t.downloadPath.length)throw new Error("link can not be an empty string");this.matDialog.open(Oh,{panelClass:"app-full-bleed-dialog",data:{pdf:t},minWidth:"90vw"})}}return s.\u0275fac=function(t){return new(t||s)(o.LFG(dn.uw))},s.\u0275prov=o.Yz7({token:s,factory:s.\u0275fac}),s})();function Py(s,e){if(1&s){const t=o.EpF();o.ynx(0),o.TgZ(1,"div",14),o.NdJ("click",function(){const r=o.CHM(t).index,a=o.oxw(2);return o.KtG(a.onViewImages("PIC",r))}),o.TgZ(2,"div",15),o._UZ(3,"img",16),o.qZA(),o.TgZ(4,"div",17)(5,"p",18),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.TgZ(8,"p",19),o._uU(9),o.ALo(10,"date"),o.qZA()()(),o.BQk()}if(2&s){const t=e.$implicit,n=e.index,i=o.oxw(2);o.xp6(3),o.Q6J("id",i.htmlID.Image+"icon"+n),o.xp6(2),o.Q6J("id",i.htmlID.Paragraph+"label"+n),o.xp6(1),o.Oqu(o.lcZ(7,5,t.label)),o.xp6(2),o.Q6J("id",i.htmlID.Paragraph+"CreatedAt"+n),o.xp6(1),o.hij(" ",o.xi3(10,7,t.CreatedAt,"EE MMM M d y h:mm a")," EST ")}}function Ly(s,e){if(1&s&&(o.TgZ(0,"div",12),o.YNc(1,Py,11,10,"ng-container",13),o.qZA()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.attachedData.PIC)}}function Iy(s,e){if(1&s){const t=o.EpF();o.ynx(0),o.TgZ(1,"div",14),o.NdJ("click",function(){const r=o.CHM(t).$implicit,a=o.oxw(2);return o.KtG(a.onViewFile(r))}),o.TgZ(2,"div",15),o._UZ(3,"img",20),o.qZA(),o.TgZ(4,"div",17)(5,"p",18),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.TgZ(8,"p",19),o._uU(9),o.ALo(10,"date"),o.qZA()()(),o.BQk()}if(2&s){const t=e.$implicit,n=e.index,i=o.oxw(2);o.xp6(3),o.Q6J("id",i.htmlID.Image+"docicon"+n),o.xp6(2),o.Q6J("id",i.htmlID.Paragraph+"label"+n),o.xp6(1),o.Oqu(o.lcZ(7,5,t.label)),o.xp6(2),o.Q6J("id",i.htmlID.Paragraph+"CreatedAt"+n),o.xp6(1),o.hij(" ",o.xi3(10,7,t.CreatedAt,"EE MMM M d y h:mm a")," EST ")}}function Ry(s,e){if(1&s&&(o.TgZ(0,"div",12),o.YNc(1,Iy,11,10,"ng-container",13),o.qZA()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.attachedData.PDF)}}let Oy=(()=>{class s{constructor(t){this.fileViwer=t,this.htmlID=ti.Q}ngOnChanges(t){this.onCreateDataObject(t.attachedData.currentValue)}onCreateDataObject(t){this.attachedData=t?.reduce((n,i)=>{const{actualType:r}=i;return n[r]=n[r]??[],n[r].push(i),n},{STL:[],PIC:[],UPPER:[],LOWER:[]}),this.attachedData.STL=[...this.attachedData.UPPER,...this.attachedData.LOWER,...this.attachedData.STL],this.attachedData.PIC||(this.attachedData.PIC=[]),delete this.attachedData.UPPER,delete this.attachedData.LOWER,this.onCreateFilesStatus()}onCreateFilesStatus(){const t={};Object.keys(this.attachedData).forEach(n=>{t[n]=this.attachedData[n].length>0}),this.filesStatus=t}onToggle(t){this.attachedData[t].length>0&&(this.filesStatus[t]=!this.filesStatus[t])}onViewImages(t,n){let i=[];this.attachedData[t].map(r=>{r.files?.forEach(a=>{i.push(a.path)})}),this.fileViwer.viewImages(i,n)}onViewFile(t){this.fileViwer.viewPDF(t)}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(Dh))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-attached-files"]],inputs:{attachedData:"attachedData"},features:[o._Bn([Dh]),o.TTD],decls:25,vars:23,consts:[[1,"attached-files-warraper"],[1,"header","py-2"],["src","assets/icons/closed-folder.svg","alt","",1,"px-3",3,"id"],[1,"text-capitalize",3,"id"],[1,"files-wrapper","mx-3"],[1,"file-wrapper"],[3,"ngClass"],[1,"d-flex","align-items-center"],[1,"icon-wrapper","text-capitalize","text-primary",3,"ngClass","id","click"],[1,"icon",3,"ngClass"],[1,"text-capitalize","text-primary","mx-2",3,"id"],["class","attached-files-wrapper mx-3",4,"ngIf"],[1,"attached-files-wrapper","mx-3"],[4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","my-2","curoser-pointer",3,"click"],[1,"img-wrapper"],["src","assets/icons/img-icon.svg","alt","",3,"id"],[1,"info-wrapper","mx-2"],[1,"text-capitalize","mb-0","py-1",3,"id"],[1,"sub-info","text-capitalize","mb-0",3,"id"],["src","assets/icons/doc-icon.svg",3,"id"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"p",1),o._UZ(2,"img",2),o.TgZ(3,"span",3),o._uU(4),o.ALo(5,"translate"),o.qZA()(),o.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"p",7)(10,"span",8),o.NdJ("click",function(){return(null==n.attachedData.PIC?null:n.attachedData.PIC.length)>0?n.onToggle("PIC"):""}),o._UZ(11,"i",9),o.qZA(),o.TgZ(12,"span",10),o._uU(13),o.ALo(14,"translate"),o.qZA()(),o.YNc(15,Ly,2,1,"div",11),o.qZA()(),o.TgZ(16,"div",5)(17,"div",6)(18,"p",7)(19,"span",8),o.NdJ("click",function(){return(null==n.attachedData.PDF?null:n.attachedData.PDF.length)>0?n.onToggle("PDF"):""}),o._UZ(20,"i",9),o.qZA(),o.TgZ(21,"span",10),o._uU(22),o.ALo(23,"translate"),o.qZA()(),o.YNc(24,Ry,2,1,"div",11),o.qZA()()()()),2&t&&(o.xp6(2),o.Q6J("id",n.htmlID.Image+"closed-folder"),o.xp6(1),o.Q6J("id",n.htmlID.Span+"attached"),o.xp6(1),o.Oqu(o.lcZ(5,17,"attached files")),o.xp6(4),o.Q6J("ngClass",n.filesStatus.PIC?"line":""),o.xp6(2),o.Q6J("ngClass",(null==n.attachedData.PIC?null:n.attachedData.PIC.length)>0?"curoser-pointer ":"")("id",n.htmlID.Span+"attachedPic"),o.xp6(1),o.Q6J("ngClass",n.filesStatus.PIC?"fa fa-minus":"fa fa-plus "),o.xp6(1),o.Q6J("id",n.htmlID.Span+"imgs"),o.xp6(1),o.Oqu(o.lcZ(14,19,"images")),o.xp6(2),o.Q6J("ngIf",n.filesStatus.PIC),o.xp6(2),o.Q6J("ngClass",n.filesStatus.PDF?"line":""),o.xp6(2),o.Q6J("ngClass",(null==n.attachedData.PDF?null:n.attachedData.PDF.length)>0?"curoser-pointer ":"")("id",n.htmlID.Span+"Data"),o.xp6(1),o.Q6J("ngClass",n.filesStatus.PDF?"fa fa-minus":"fa fa-plus "),o.xp6(1),o.Q6J("id",n.htmlID.Span+"document"),o.xp6(1),o.Oqu(o.lcZ(23,21,"documents")),o.xp6(2),o.Q6J("ngIf",n.filesStatus.PDF))},dependencies:[j.mk,j.sg,j.O5,j.uU,kn.X$],styles:['.attached-files-warraper{height:100%;display:flex;flex-direction:column}.attached-files-warraper ::-webkit-scrollbar{width:5px}.attached-files-warraper ::-webkit-scrollbar-track{background:#ffffff}.attached-files-warraper ::-webkit-scrollbar-thumb{background:#2eb2db}.attached-files-warraper ::-webkit-scrollbar-thumb:hover{background:#2eb2db}.attached-files-warraper .curoser-pointer{cursor:pointer}.attached-files-warraper .header span{color:#666}.attached-files-warraper .files-wrapper{overflow:hidden;flex:1}.attached-files-warraper .files-wrapper .icon-wrapper{border:2px solid #68cdec;padding:5px;height:1px;width:2px;display:block;position:relative}.attached-files-warraper .files-wrapper .icon-wrapper .icon{position:absolute;top:2px;left:2px;font-size:7px;margin-right:10px}.attached-files-warraper .files-wrapper .file-wrapper{position:relative}.attached-files-warraper .files-wrapper .file-wrapper .line:before{content:"";display:inline-block;background-color:#daeaef;width:2px;height:85%;position:absolute;top:25px;left:6px}.attached-files-warraper .attached-files-wrapper .img-wrapper img{height:55px}.attached-files-warraper .attached-files-wrapper .info-wrapper .sub-info{color:#7ea0aa;font-size:13px}\n'],encapsulation:2}),s})();const Dy=function(s){return{brdr:s}};function Fy(s,e){if(1&s&&(o.ynx(0),o.TgZ(1,"div",4)(2,"p",5),o._UZ(3,"img",6),o.TgZ(4,"span",7),o._uU(5),o.ALo(6,"translate"),o.qZA()(),o.TgZ(7,"p",8,9),o._uU(9),o.ALo(10,"translate"),o.qZA()(),o.BQk()),2&s){const t=o.MAs(8),n=o.oxw();o.xp6(3),o.Q6J("id",n.htmlID.Image+"remarks"),o.xp6(1),o.Q6J("id",n.htmlID.Span+"remarks"),o.xp6(1),o.Oqu(o.lcZ(6,6,"Remarks")),o.xp6(2),o.Q6J("id",n.htmlID.Paragraph+"remarks")("ngClass",o.VKq(10,Dy,t.clientHeight<t.scrollHeight)),o.xp6(2),o.hij(" ",o.lcZ(10,8,n.caseInfo.remarks)," ")}}function ky(s,e){if(1&s&&(o.TgZ(0,"div",10)(1,"p",11),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"div")(5,"p")(6,"span",12),o._uU(7),o.ALo(8,"translate"),o.qZA(),o._uU(9,": "),o.TgZ(10,"span",13),o._uU(11),o.ALo(12,"translate"),o.qZA()(),o.TgZ(13,"p")(14,"span",12),o._uU(15),o.ALo(16,"translate"),o.qZA(),o._uU(17,": "),o.TgZ(18,"span",13),o._uU(19),o.ALo(20,"translate"),o.qZA()(),o.TgZ(21,"p")(22,"span",12),o._uU(23),o.ALo(24,"translate"),o.qZA(),o._uU(25,": "),o.TgZ(26,"span",13),o._uU(27),o.ALo(28,"translate"),o.ALo(29,"translate"),o.qZA()(),o.TgZ(30,"p")(31,"span",12),o._uU(32),o.ALo(33,"translate"),o.qZA(),o._uU(34,": "),o.TgZ(35,"span",14),o._uU(36),o.ALo(37,"translate"),o.ALo(38,"translate"),o.ALo(39,"translate"),o.qZA()()()()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("id",t.htmlID.Paragraph+"caseInfo"),o.xp6(1),o.hij(" ",o.lcZ(3,14,"Case Info")," "),o.xp6(5),o.Oqu(o.lcZ(8,16,"Upper Steps")),o.xp6(4),o.Oqu(o.lcZ(12,18,null==t.caseInfo?null:t.caseInfo.upperStages)),o.xp6(4),o.Oqu(o.lcZ(16,20,"Lower Steps")),o.xp6(4),o.Oqu(o.lcZ(20,22,null==t.caseInfo?null:t.caseInfo.lowerStages)),o.xp6(4),o.Oqu(o.lcZ(24,24,"Duration")),o.xp6(4),o.AsE("",o.lcZ(28,26,null==t.caseInfo?null:t.caseInfo.totalDurationPerMonth)," ",o.lcZ(29,28,"Month"),""),o.xp6(5),o.Oqu(o.lcZ(33,30,"Start")),o.xp6(3),o.Q6J("id",t.htmlID.Span+"caseInfo"),o.xp6(1),o.lnq(" ",o.lcZ(37,32,"Wear schedule")," : ",o.lcZ(38,34,null==t.caseInfo?null:t.caseInfo.wearSchedule)," ",o.lcZ(39,36,"Weeks"),"")}}const zy=["*"];let By=(()=>{class s{constructor(){this.htmlID=ti.Q}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-case-info-panel"]],inputs:{caseInfo:"caseInfo",infoStatus:"infoStatus"},ngContentSelectors:zy,decls:5,vars:2,consts:[[1,"case-info-panel"],[4,"ngIf"],["class","case-info-wrapper mx-3",4,"ngIf"],[1,"content-wrapper"],[1,"remarks-wrapper","mx-3","mt-3"],[1,"d-flex","align-items-center"],["src","assets/icons/remarks-icon.svg",1,"d-block",3,"id"],[1,"text-capitalize","fw-bold","fs-5",3,"id"],[1,"remarks-paragraph",3,"id","ngClass"],["remarks",""],[1,"case-info-wrapper","mx-3"],[1,"case-info-header","text-capitalize","text-primary","fs-5",3,"id"],[1,"text-capitalize","text-secondary"],[1,"fw-bold"],[1,"fw-bold",3,"id"]],template:function(t,n){1&t&&(o.F$t(),o.TgZ(0,"div",0),o.YNc(1,Fy,11,12,"ng-container",1),o.YNc(2,ky,40,38,"div",2),o.TgZ(3,"div",3),o.Hsn(4),o.qZA()()),2&t&&(o.xp6(1),o.Q6J("ngIf",(null==n.caseInfo?null:n.caseInfo.remarks)&&!n.infoStatus),o.xp6(1),o.Q6J("ngIf",n.caseInfo))},dependencies:[j.mk,j.O5,kn.X$],styles:[".case-info-panel[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:flex-start;gap:0;overflow-y:auto}.case-info-panel[_ngcontent-%COMP%]   .remarks-wrapper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:10px}.case-info-panel[_ngcontent-%COMP%]   .case-info-wrapper[_ngcontent-%COMP%]{padding-top:10px}.case-info-panel[_ngcontent-%COMP%]   .case-info-wrapper[_ngcontent-%COMP%]   .case-info-header[_ngcontent-%COMP%]{font-weight:700}.case-info-panel[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{flex:1;margin-top:10px;height:-moz-fit-content;height:fit-content}.case-info-panel[_ngcontent-%COMP%]   .remarks-paragraph[_ngcontent-%COMP%]{max-height:20vh;overflow-y:auto}.case-info-panel[_ngcontent-%COMP%]   .brdr[_ngcontent-%COMP%]{border:1px solid #ccc}[_nghost-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}[_nghost-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff}[_nghost-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#2eb2db}[_nghost-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2eb2db}"]}),s})();function Ny(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",3)(1,"button",4),o.NdJ("click",function(){const r=o.CHM(t).$implicit;return o.KtG(r.fourViews())}),o.TgZ(2,"div"),o._UZ(3,"img",5),o.qZA(),o.TgZ(4,"span",6),o._uU(5),o.ALo(6,"translate"),o.qZA()()()}if(2&s){const t=e.$implicit,n=o.oxw();o.xp6(1),o.Q6J("id",n.htmlID.Button+t),o.xp6(2),o.Q6J("src",t.iconSrc,o.LSH)("id",n.htmlID.Image+t),o.xp6(1),o.Q6J("id",n.htmlID.Span+t),o.xp6(1),o.hij(" ",o.lcZ(6,5,t.iconName)," ")}}const Uy=function(s){return{classStyleActive:s}};function Hy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"div",7)(1,"button",8),o.NdJ("click",function(){const i=o.CHM(t);return o.KtG(i.$implicit.maxillaVSMandible(i.index))}),o.TgZ(2,"div"),o._UZ(3,"img",5),o.qZA(),o.TgZ(4,"span",6),o._uU(5),o.ALo(6,"translate"),o.qZA()()()}if(2&s){const t=e.$implicit,n=e.index,i=o.oxw();o.xp6(1),o.Q6J("ngClass",o.VKq(9,Uy,1==i.isActiveMaxMand[n]))("disabled",!i.availableArches[n])("id",i.htmlID.Button+t),o.xp6(2),o.Q6J("src",t.iconSrc,o.LSH)("id",i.htmlID.Image+t),o.xp6(1),o.Q6J("id",i.htmlID.Span+t),o.xp6(1),o.hij(" ",o.lcZ(6,7,t.iconName)," ")}}let Gy=(()=>{class s{constructor(){this.htmlID=ti.Q,this.frontBtn=new o.vpe,this.innerBtn=new o.vpe,this.leftBtn=new o.vpe,this.rightBtn=new o.vpe,this.viewerPosition=new o.vpe,this.showMandible=new o.vpe,this.showMaxilla=new o.vpe,this.multiViews=[],this.archViews=[],this.isActiveMaxMand=[!1,!1],this.availableArches=[!1,!1]}ngOnInit(){this.multiViews=[{iconSrc:"assets/icons/Front(MV).svg",iconName:"Front",fourViews:()=>{this.frontBtn.emit(),this.viewerPosition.emit("front")}},{iconSrc:"assets/icons/Inner(MV).svg",iconName:"Inner",fourViews:()=>{this.innerBtn.emit(),this.viewerPosition.emit("inner")}},{iconSrc:"assets/icons/Left(MV).svg",iconName:"Left",fourViews:()=>{this.leftBtn.emit(),this.viewerPosition.emit("left")}},{iconSrc:"assets/icons/Right(MV).svg",iconName:"Right",fourViews:()=>{this.rightBtn.emit(),this.viewerPosition.emit("right")}}],this.archViews=[{iconSrc:"assets/icons/Maxilla(MV).svg",iconName:"Maxilla",maxillaVSMandible:()=>{this.onClickMaxilla()}},{iconSrc:"assets/icons/Mandible(MV).svg",iconName:"Mandible",maxillaVSMandible:()=>{this.onClickMandible()}}]}onClickMaxilla(){this.showMaxilla.emit(!this.isActiveMaxMand[0])}onClickMandible(){this.showMandible.emit(!this.isActiveMaxMand[1])}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-multiviews-bar"]],inputs:{isActiveMaxMand:"isActiveMaxMand",availableArches:"availableArches"},outputs:{frontBtn:"frontBtn",innerBtn:"innerBtn",leftBtn:"leftBtn",rightBtn:"rightBtn",viewerPosition:"viewerPosition",showMandible:"showMandible",showMaxilla:"showMaxilla"},decls:3,vars:2,consts:[[1,"Multiview-bar","d-flex","justify-content-center"],["class","d-flex flex-row h-100 align-items-center",4,"ngFor","ngForOf"],["class","h-100 d-flex align-items-center",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","h-100","align-items-center"],[1,"h-100",3,"id","click"],[1,"Multiview-bar--icon",3,"src","id"],[3,"id"],[1,"h-100","d-flex","align-items-center"],[1,"h-100",3,"ngClass","disabled","id","click"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0),o.YNc(1,Ny,7,7,"div",1),o.YNc(2,Hy,7,11,"div",2),o.qZA()),2&t&&(o.xp6(1),o.Q6J("ngForOf",n.multiViews),o.xp6(1),o.Q6J("ngForOf",n.archViews))},dependencies:[j.mk,j.sg,kn.X$],styles:[".Multiview-bar[_ngcontent-%COMP%]{overflow:hidden}.Multiview-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;border:none;padding:.3rem 18px;color:#fff;height:100%;font-size:.625rem;font-family:Inter}.Multiview-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active:not(.classStyleActive):not(:disabled), .Multiview-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.classStyleActive):not(:disabled){background-color:#393939!important}.Multiview-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.3}.Multiview-bar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:.3rem}.Multiview-bar[_ngcontent-%COMP%]{background-color:#666}.Multiview-bar--icon[_ngcontent-%COMP%]{width:2rem;height:2rem}.Multiview-bar[_ngcontent-%COMP%]   .classStyleActive[_ngcontent-%COMP%]{background-color:#2eb2db!important}.Multiview-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(2px)}"]}),s})();const Vy=function(s,e,t){return{"bg-primary":s,"active-item":e,dimmed:t}};function Wy(s,e){if(1&s){const t=o.EpF();o.ynx(0),o.TgZ(1,"div",3),o.NdJ("click",function(){const i=o.CHM(t);return o.KtG(i.$implicit.callData(i.index))}),o.TgZ(2,"div",4),o._UZ(3,"img",5),o.qZA(),o.TgZ(4,"p",6),o._uU(5),o.ALo(6,"translate"),o.qZA()(),o.BQk()}if(2&s){const t=e.$implicit,n=e.index,i=o.oxw();o.xp6(1),o.Q6J("ngClass",o.kEZ(7,Vy,i.activeItem===n&&-1===i.activeItem_panel||i.activeItem_panel===n,i.activeItem===n&&-1===i.activeItem_panel||i.activeItem_panel===n,"Tutorial"===t.label)),o.xp6(2),o.Q6J("src",t.icon,o.LSH)("id",i.htmlID.Image+"icon"+n),o.xp6(1),o.Q6J("id",i.htmlID.Paragraph+"label"+n),o.xp6(1),o.hij(" ",o.lcZ(6,5,t.label)," ")}}let Zy=(()=>{class s{constructor(){this.htmlID=ti.Q,this.sideMenuItems=[],this.activeItem=-1,this.activeItem_panel=-1,this.option=new o.vpe}ngOnInit(){this.sideMenuItems=[{label:"info",id:"info",icon:"assets/icons/info-icon.svg",callData:t=>{this.setActiveItem(t)}},{label:"home",id:"home",icon:"assets/icons/home-icon.svg",callData:t=>{this.setActiveItem(t)}},{label:"tx overview",id:"tx",icon:"assets/icons/overview.svg",callData:t=>{this.setActiveItem(t)}},{label:"Multiview",id:"multi",icon:"assets/icons/multiviews.svg",callData:t=>{this.setActiveItem(t)}},{label:"Grid",id:"grid",icon:"assets/icons/grid.svg",callData:t=>{this.setActiveItem(t)}},{label:"Tutorial",id:"tut",icon:"assets/icons/tutorial.svg",callData:t=>{}}]}setActiveItem(t){const n=this.sideMenuItems[t].id;"info"===n||"tx"===n?(this.activeItem_panel=this.activeItem_panel===t?-1:t,this.option.emit(this.activeItem_panel>=0?this.sideMenuItems[this.activeItem_panel].id:"close")):"home"===n||"multi"===n||"grid"===n?(this.activeItem=t,this.activeItem_panel=-1,this.option.emit(this.sideMenuItems[this.activeItem].id)):this.option.emit(this.sideMenuItems[t].id)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-side-bar-viewer"]],inputs:{activeItem:"activeItem"},outputs:{option:"option"},decls:3,vars:1,consts:[[1,"side-bar"],[1,"items-wrapper","d-flex","flex-column","justify-content-between"],[4,"ngFor","ngForOf"],[1,"side-bar-item","mx-auto","my-0","py-3",3,"ngClass","click"],[1,"img-wrapper","text-center","m-auto"],[3,"src","id"],[1,"text-white","text-center","text-uppercase","side-item","mt-1",3,"id"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"div",1),o.YNc(2,Wy,7,11,"ng-container",2),o.qZA()()),2&t&&(o.xp6(2),o.Q6J("ngForOf",n.sideMenuItems))},dependencies:[j.mk,j.sg,kn.X$],styles:['@charset "UTF-8";.side-bar[_ngcontent-%COMP%]{width:100px;background:#565454;height:100vh}.side-bar[_ngcontent-%COMP%]   .items-wrapper[_ngcontent-%COMP%]{height:92%}.side-bar[_ngcontent-%COMP%]   .side-bar-item[_ngcontent-%COMP%]{cursor:pointer;width:100%}.side-bar[_ngcontent-%COMP%]   .side-bar-item[_ngcontent-%COMP%]   .side-item[_ngcontent-%COMP%]{max-width:61px;margin:auto}.side-bar[_ngcontent-%COMP%]   .side-bar-item[_ngcontent-%COMP%]:active{-webkit-backdrop-filter:brightness(.7);backdrop-filter:brightness(.7);transform:translateY(3px)}.side-bar[_ngcontent-%COMP%]   .active-item[_ngcontent-%COMP%]{position:relative}.side-bar[_ngcontent-%COMP%]   .active-item[_ngcontent-%COMP%]:after{position:absolute;content:"\\25b6";color:#68cdec;display:inline-block;right:0;top:50%;transform:translate(85%,-50%);z-index:251;font-size:20px}.side-bar[_ngcontent-%COMP%]   .dimmed[_ngcontent-%COMP%]{filter:brightness(.5);transform:translateY(0)!important;-webkit-backdrop-filter:none!important;backdrop-filter:none!important;cursor:default!important}']}),s})();const qy=["mainViewer"],Jy=["upperSecViewer"],Xy=["lowerSecViewer"];function Yy(s,e){if(1&s&&o._UZ(0,"app-attached-files",17),2&s){const t=o.oxw();o.Q6J("attachedData",t.attachedFiles)}}function jy(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"button",22),o.NdJ("mousedown",function(i){o.CHM(t);const r=o.oxw(2);return o.KtG(r.resizeDivVertical(i))}),o._UZ(1,"i",23),o.qZA()}}function Qy(s,e){if(1&s&&(o.TgZ(0,"div",18),o._UZ(1,"app-main-viewer",19,20),o.YNc(3,jy,2,0,"button",21),o.qZA()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("geometries",t.SelectedGeometeries)("viewMode",t.viewMode)("showGrid",t.showGrid)("isActiveMaxMand",t.isActiveMaxMand),o.xp6(2),o.Q6J("ngIf","multiple"===t.viewMode&&(t.isActiveMaxMand[0]||t.isActiveMaxMand[1]))}}function $y(s,e){if(1&s&&(o.TgZ(0,"div",26),o._UZ(1,"app-secondary-viewer",27,28),o.qZA()),2&s){const t=o.oxw(2);o.xp6(1),o.Q6J("arch",t.SelectedGeometeries.upper.geometry)("isOtherActive",t.isActiveMaxMand[1])}}function Ky(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"button",32),o.NdJ("mousedown",function(i){o.CHM(t);const r=o.oxw(3);return o.KtG(r.resizeDivHorozintal(i))}),o._UZ(1,"i",23),o.qZA()}if(2&s){const t=o.oxw(3);o.Q6J("id",t.htmlID.Button+"resizer")}}function ex(s,e){if(1&s&&(o.TgZ(0,"div",26),o.YNc(1,Ky,2,1,"button",29),o._UZ(2,"app-secondary-viewer",30,31),o.qZA()),2&s){const t=o.oxw(2);o.xp6(1),o.Q6J("ngIf",t.isActiveMaxMand[0]&&t.isActiveMaxMand[1]),o.xp6(1),o.Q6J("isOtherActive",t.isActiveMaxMand[0])("arch",t.SelectedGeometeries.lower.geometry)}}function tx(s,e){if(1&s&&(o.TgZ(0,"div",24),o.YNc(1,$y,3,2,"div",25),o.YNc(2,ex,4,3,"div",25),o.qZA()),2&s){const t=o.oxw();o.xp6(1),o.Q6J("ngIf",t.SelectedGeometeries.upper&&t.isActiveMaxMand[0]),o.xp6(1),o.Q6J("ngIf",t.SelectedGeometeries.lower&&t.isActiveMaxMand[1])}}function nx(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"app-preview-player",33),o.NdJ("change",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.changeGeometry(i))}),o.qZA()}if(2&s){const t=o.oxw();o.Q6J("files",t.geometries)}}function ix(s,e){if(1&s){const t=o.EpF();o.TgZ(0,"app-preview-footer",34),o.NdJ("consultation",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.requestConsultation())})("amendmentsRequest",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.requestAmendments())})("proceed",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.proceed())}),o.qZA()}if(2&s){const t=o.oxw();o.Q6J("enableProceed",t.selectedVersion==t.latestUpdatedVersion||t.latestUpdatedVersion<1)}}const rx=function(s){return{"panel-active":s}},sx=[{path:"",component:(()=>{class s{constructor(t,n,i,r,a,l,c,u,h,d,f){this.activatedRoute=t,this.fetchSTLService=n,this.orderService=i,this.unzipService=r,this.dracoLoaderService=a,this.dialog=l,this.router=c,this.translateService=u,this.cookiesSrvc=h,this.confirmationService=d,this.toastrService=f,this.htmlID=ti.Q,this.isActiveMaxMand=[!1,!1],this.availableArches=[!1,!1],this.patientName="patient name",this.caseNumber="",this.versionsCount=1,this.panelMode="none",this.filesReady=!1,this.viewMode="single",this.showGrid=!1,this.attachedFiles=[],this.planningStatus=1e3,this.geometries={}}ngOnInit(){var t=this;return T(function*(){if(t.parameters={...t.activatedRoute.snapshot.params},t.activatedRoute.snapshot.data.caseInfoList.data.caseInfo&&(t.caseInfo={...t.activatedRoute.snapshot.data.caseInfoList.data.caseInfo[0]}),t.activatedRoute.snapshot.data.caseInfoList.data.attachedFiles)if(t.attachedFiles=[...t.activatedRoute.snapshot.data.caseInfoList.data.attachedFiles],0!==t.attachedFiles.length)try{t.filesData=yield t.get3DFiles(),t.initVersions(t.filesData),t.geometries={...yield t.loadGeometriesFromUrls(t.filesData,+t.selectedVersion)},yield t.getOrderData()}catch(n){t.raiseError(n)}else t.raiseError("");else t.raiseError("")})()}getOrderData(){var t=this;return T(function*(){let[{IsmileOrder:n,OrderTable_Doc:i,OrderTable_Scan:r,versionNum:a,id:l}]=yield t.orderService.getOrderById(t.parameters.orderID,t.parameters.iSmileID).toPromise();if(t.caseNumber=l,i=`${i.FName} ${i.LName}`,r=`${r.FName} ${r.LName}`,t.planningStatus=n.subOrdersObject.planning.statusCode,t.clientNameString=("none"!==i.trim().toLowerCase()?`Dr. ${i} `:"")+("none"!==r.trim().toLowerCase()?`Dr. ${r} `:""),t.latestUpdatedVersion=a,t.latestUpdatedVersion!==t.parameters.versionNum){t.parameters.versionNum=t.latestUpdatedVersion;const c=t.parameters;t.router.navigate([`/preview/${c.orderID}/${c.scanID}/${c.docID}/${c.iSmileID}/${c.planningId}/${c.patientName}/${c.versionNum}`]),t.initVersions(t.filesData)}t.iSmileOrder=n})()}updateAvailableArches(){this.availableArches=[Boolean(this.SelectedGeometeries.upper),Boolean(this.SelectedGeometeries.lower)],!this.isActiveMaxMand[0]&&!this.isActiveMaxMand[1]&&"single"===this.viewMode&&(this.isActiveMaxMand=[...this.availableArches])}onOpenHandleErrorDialog(){this.dialog.open(Zv,{width:"40vw",data:{text:"\n       Looks like you are experiencing\n       a minor inconveneince\n       ",link:!0},panelClass:"preview"}).afterClosed().subscribe(n=>{this.router.navigate(["/orders/orders-list"])})}initVersions(t){const n=this.parameters.versionNum;let i=1;const r=a=>{a.sort((l,c)=>{const u=l.pathUrl.toUpperCase(),h=c.pathUrl.toUpperCase();return u<h?-1:u>h?1:0})};this.patientName=t.patientName,""+n!="0"?(t.upper&&t.upper.length>0&&(r(t.upper),"1"!==t.upper[0].pathUrl.slice(t.upper[0].pathUrl.length-1)&&(t.upper=[...t.upper.slice(1)]),i=t.upper.length>i?t.upper.length:i),t.lower&&t.lower.length>0&&(r(t.lower),"1"!==t.lower[0].pathUrl.slice(t.lower[0].pathUrl.length-1)&&(t.lower=[...t.lower.slice(1)]),i=t.lower.length>i?t.lower.length:i),this.versionsCount=i,this.selectedVersion=n<=this.versionsCount?n:this.versionsCount):(this.selectedVersion=0,this.versionsCount=1)}loadGeometriesFromUrls(t,n){var i=this;return T(function*(){try{const r=yield i.unzipFiles(t,n);return{...yield i.loadGeometries(r)}}catch(r){return i.raiseError(r),{}}})()}mergeGeometries(t){t.sort((i,r)=>{const a=i.filename.toUpperCase(),l=r.filename.toUpperCase();return a<l?-1:a>l?1:0});let n=[];for(let i=0;i<t.length-1;i+=2){const r=t[i],a=t[i+1];if(r.filename===a.filename){const l=0==r.teeth?[r.geometry,a.geometry]:[a.geometry,r.geometry];n=[...n,{filename:r.filename,geometry:gv(l,!0)}]}}return n.length?n:t}updateVersion(t){var n=this;return T(function*(){try{const{data:i}=yield n.orderService.getOrderByIdForSTL(n.parameters.iSmileID,t).toPromise();n.selectedVersion=t??1,i&&i.caseInfo&&(n.caseInfo={...i.caseInfo[0]}),i&&i.attachedFiles&&(n.attachedFiles=[...i.attachedFiles])}catch(i){n.raiseError(i)}})()}get3DFiles(){var t=this;return T(function*(){try{const{message:n,data:i}=yield t.fetchSTLService.getPatientSTL(t.parameters.orderID,t.parameters.iSmileID).toPromise();if(n&&n.includes("successfully"))return i;throw new Error("Failed to load 3D files.")}catch(n){return t.raiseError(n),new Promise((i,r)=>{i(!1)})}})()}unzipFiles(t,n){var i=this;return T(function*(){let r=[],a=[];try{if(t.upper&&t.upper.length>0){const l=t.upper[n-1]?t.upper[n-1].pathUrl:t.upper[0].pathUrl;a=yield i.unzipService.extractUrlsFromZip(An.N.RootURL+l).toPromise()}if(t.lower&&t.lower.length>0){const l=t.lower[n-1]?t.lower[n-1].pathUrl:t.lower[0].pathUrl;r=yield i.unzipService.extractUrlsFromZip(An.N.RootURL+l).toPromise()}}catch(l){console.log(l),i.raiseError(l)}return{lower:r,upper:a}})()}loadGeometries(t){var n=this;return T(function*(){try{return{lower:n.mergeGeometries(yield n.dracoLoaderService.loadGeometries(t.lower)),upper:n.mergeGeometries(yield n.dracoLoaderService.loadGeometries(t.upper))}}catch(i){return n.raiseError(i),{}}})()}raiseError(t){this.onOpenHandleErrorDialog()}setMain3DViewerPosition(t){this.mainViewer?.rotate(t),this.upperSecViewer?.rotate(t),this.lowerSecViewer?.rotate(t)}toggleArches(t){"Max"===t?this.isActiveMaxMand[0]="single"===this.viewMode&&!this.isActiveMaxMand[1]||!this.isActiveMaxMand[0]:"Man"===t&&(this.isActiveMaxMand[1]="single"===this.viewMode&&!this.isActiveMaxMand[0]||!this.isActiveMaxMand[1]),this.mainViewer.updateGroup(),this.resize3DViewers()}showVersion(t){var n=this;return T(function*(){try{n.updateVersion(t),n.geometries={},n.SelectedGeometeries={},n.geometries={...yield n.loadGeometriesFromUrls(n.filesData,t)}}catch(i){n.raiseError(i)}})()}sideMenuOption(t){this.filesReady=!1;const n=r=>{const a=l=>{this.panelMode=l,setTimeout(()=>{this.filesReady="files"===this.panelMode},300)};"none"!==this.panelMode?(this.panelMode="none",setTimeout(()=>{a(r)},500)):a(r)},i=()=>{this.viewMode="single",setImmediate(()=>{this.mainViewer.updateGroup()})};"info"===t?n("files"):"tx"===t?n("empty"):"multi"===t?(this.viewMode="multiple",this.showGrid=!1,this.mainViewer.updateGroup(),this.panelMode="none"):"home"===t?(this.showGrid=!1,i(),this.panelMode="none"):"grid"===t?(this.showGrid=!0,this.mainViewer.onReset(),i(),this.panelMode="none"):"close"===t&&(this.panelMode="none"),this.updateAvailableArches(),this.resize3DViewers()}resize3DViewers(){const t=setInterval(()=>{this.upperSecViewer?.onWindowResize(),this.lowerSecViewer?.onWindowResize(),this.mainViewer?.onWindowResize()},100);setTimeout(()=>{clearInterval(t)},1300)}changeGeometry(t){this.SelectedGeometeries={...t},this.updateAvailableArches(),this.resize3DViewers()}requestConsultation(){this.dialog.open(vv,{data:{ismileOrderID:this.parameters.iSmileID},minWidth:"80vw",maxHeight:"95vh",panelClass:"preview"})}requestAmendments(){this.dialog.open(Mv,{minWidth:"70vw",maxHeight:"95vh",panelClass:"preview",data:{iSmileID:this.parameters.iSmileID,OrderID:this.parameters.orderID,patientName:this.patientName,clientNameString:this.clientNameString}}).afterClosed().subscribe(n=>{"true"===n&&this.router.navigate(["/"])})}proceed(){this.dialog.open(Vv,{minWidth:"80vw",maxHeight:"95vh",panelClass:"preview",data:{header:`${this.translateService.instant("Confirm iSmile Order ID")} ${this.parameters.orderID} ${this.clientNameString} Pt. ${this.patientName}`,iSmileId:this.parameters.iSmileID,orderId:this.parameters.orderID,clientId:+this.cookiesSrvc.get("userCNId"),patientName:this.patientName,clientNameString:this.clientNameString,planningRemarks:this.iSmileOrder.planningRemarks}}).afterClosed().subscribe(n=>{n&&(this.confirmationService.confirmSubmittedOBJ={uid:{toBeBilledModel:this.iSmileOrder.model?.toBeBilled?this.iSmileOrder.model?.toBeBilled:null,toBeBilledPlanning:this.iSmileOrder.planning?.toBeBilled?this.iSmileOrder.planning?.toBeBilled:null,toBeBilledProduction:this.iSmileOrder.production?.toBeBilled?this.iSmileOrder.production?.toBeBilled:null,loggedIn:+this.cookiesSrvc.get("userCNId")},tier:n.tier,orderID:n.orderId,iSmileID:n.iSmileId,code:n.promoCode?n.promoCode:null},this.onSubmitConfirmation())})}onSubmitConfirmation(){this.confirmationService.submitConfirmition().subscribe(t=>{},t=>{this.toastrService.showError(this.translateService.instant("Confirmation"),this.translateService.instant("Error Happened"))},()=>{this.router.navigate(["/orders/orders-list"]),this.confirmationService.confirmSubmittedOBJ={},this.toastrService.showSuccess(this.translateService.instant("Confirmation"),this.translateService.instant("Confirmed Successfully"))})}resizeDivVertical(t){const n=document.querySelector("body > app-root > ng-component > main"),i=parseInt(getComputedStyle(n).getPropertyValue("width")),l=window.innerWidth-i,c=t.pageX-l;let u;const h=d=>{const f=c-(d.pageX-l),p=(i-c+f)/i*100,m=Math.min(75,Math.max(20,p));this.mainViewer.resizable(),(!(f<0&&p<45)||this.mainViewer.isResizable)&&(n.style.gridTemplateColumns=`1fr ${m}%`,u&&cancelAnimationFrame(u),u=requestAnimationFrame(()=>{this.resize3DViewers()}))};document.addEventListener("mousemove",h),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",h),u&&cancelAnimationFrame(u)})}resizeDivHorozintal(t){const n=document.querySelector("body > app-root > ng-component > main"),i=document.querySelector("body > app-root > ng-component > main > div.viewer-secondary.ng-star-inserted > div:nth-child(2)"),r=parseInt(getComputedStyle(n).getPropertyValue("height")),a=i.style.height?i.style.height.slice(0,i.style.height.length-1):"50%",l=t.pageY;let c;const u=h=>{const f=(l-h.pageY)/r*100,p=parseInt(a)+f;i.style.height=`${p>20?p<80?p:80:20}%`,c&&cancelAnimationFrame(c),c=requestAnimationFrame(()=>{this.resize3DViewers()})};document.addEventListener("mousemove",u),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",u),c&&cancelAnimationFrame(c)})}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(k.gz),o.Y36(Sh),o.Y36(qv.p),o.Y36(Eh),o.Y36(Ch),o.Y36(dn.uw),o.Y36(k.F0),o.Y36(kn.sK),o.Y36(El.N),o.Y36(Th),o.Y36(Tl._))},s.\u0275cmp=o.Xpm({type:s,selectors:[["ng-component"]],viewQuery:function(t,n){if(1&t&&(o.Gf(qy,5),o.Gf(Jy,5),o.Gf(Xy,5)),2&t){let i;o.iGM(i=o.CRH())&&(n.mainViewer=i.first),o.iGM(i=o.CRH())&&(n.upperSecViewer=i.first),o.iGM(i=o.CRH())&&(n.lowerSecViewer=i.first)}},decls:17,vars:17,consts:[[1,"side"],[3,"activeItem","option"],[1,"panel",3,"ngClass"],[3,"caseInfo"],[3,"attachedData",4,"ngIf"],[1,"header"],[3,"versionsNumber","latestVersion","patientName","caseNumber","versionChange"],[1,"nav"],[3,"isActiveMaxMand","availableArches","viewerPosition","showMandible","showMaxilla"],[1,"main",3,"ngClass"],["main",""],["class","viewer-main",4,"ngIf"],["class","viewer-secondary",4,"ngIf"],[1,"player"],[3,"files","change",4,"ngIf"],[1,"footer"],[3,"enableProceed","consultation","amendmentsRequest","proceed",4,"ngIf"],[3,"attachedData"],[1,"viewer-main"],[1,"viewer-main--viewer",3,"geometries","viewMode","showGrid","isActiveMaxMand"],["mainViewer",""],["class","resizer",3,"mousedown",4,"ngIf"],[1,"resizer",3,"mousedown"],[1,"fas","fa-solid","fa-bars","fa-rotate-90"],[1,"viewer-secondary"],["class","viewer-secondary-sub",4,"ngIf"],[1,"viewer-secondary-sub"],["type","Maxilla",3,"arch","isOtherActive"],["upperSecViewer",""],["class","resizer",3,"id","mousedown",4,"ngIf"],["type","Mandible",3,"isOtherActive","arch"],["lowerSecViewer",""],[1,"resizer",3,"id","mousedown"],[3,"files","change"],[3,"enableProceed","consultation","amendmentsRequest","proceed"]],template:function(t,n){1&t&&(o.TgZ(0,"aside",0)(1,"app-side-bar-viewer",1),o.NdJ("option",function(r){return n.sideMenuOption(r)}),o.qZA()(),o.TgZ(2,"section",2)(3,"app-case-info-panel",3),o.YNc(4,Yy,1,1,"app-attached-files",4),o.qZA()(),o.TgZ(5,"header",5)(6,"app-preview-header",6),o.NdJ("versionChange",function(r){return n.showVersion(r)}),o.qZA()(),o.TgZ(7,"nav",7)(8,"app-multiviews-bar",8),o.NdJ("viewerPosition",function(r){return n.setMain3DViewerPosition(r)})("showMandible",function(){return n.toggleArches("Man")})("showMaxilla",function(){return n.toggleArches("Max")}),o.qZA()(),o.TgZ(9,"main",9,10),o.YNc(11,Qy,4,5,"div",11),o.YNc(12,tx,3,2,"div",12),o.qZA(),o.TgZ(13,"section",13),o.YNc(14,nx,1,1,"app-preview-player",14),o.qZA(),o.TgZ(15,"footer",15),o.YNc(16,ix,1,1,"app-preview-footer",16),o.qZA()),2&t&&(o.xp6(1),o.Q6J("activeItem",1),o.xp6(1),o.Q6J("ngClass",o.VKq(15,rx,"none"!==n.panelMode)),o.xp6(1),o.Q6J("caseInfo",n.caseInfo),o.xp6(1),o.Q6J("ngIf","files"===n.panelMode&&n.filesReady),o.xp6(2),o.Q6J("versionsNumber",n.versionsCount)("latestVersion",n.selectedVersion>0?n.selectedVersion-1:0)("patientName",n.patientName)("caseNumber",n.caseNumber),o.xp6(2),o.Q6J("isActiveMaxMand",n.isActiveMaxMand)("availableArches",n.availableArches),o.xp6(1),o.Q6J("ngClass","multiple"===n.viewMode&&(n.isActiveMaxMand[0]||n.isActiveMaxMand[1])?"mian-multi":"main-single"),o.xp6(2),o.Q6J("ngIf",n.SelectedGeometeries),o.xp6(1),o.Q6J("ngIf",n.SelectedGeometeries&&"multiple"===n.viewMode&&(n.isActiveMaxMand[0]||n.isActiveMaxMand[1])),o.xp6(2),o.Q6J("ngIf",n.geometries&&(n.geometries.upper||n.geometries.lower)),o.xp6(2),o.Q6J("ngIf",n.planningStatus<=6))},dependencies:[j.mk,j.O5,ny,iy,ly,py,my,Oy,By,Gy,Zy],styles:['[_nghost-%COMP%]{display:grid;grid-template-areas:"aside header header" "aside panel nav" "aside panel main" "aside player player" "aside footer footer";grid-template-rows:auto auto 1fr auto;grid-template-columns:auto auto 1fr;padding:0;margin:0;overflow:hidden;width:100vw;height:100vh;box-sizing:border-box}[_nghost-%COMP%]     *:not(.fa):not(.fas){font-family:Inter,sans-serif}[_nghost-%COMP%]   .side[_ngcontent-%COMP%]{grid-area:aside;width:-moz-fit-content;width:fit-content;z-index:251}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{grid-area:panel;box-sizing:border-box;background-color:#fff;width:0;padding:0;z-index:-100;border-right-color:#e1e7ec;transition:all .5s ease-in-out;overflow-y:auto}[_nghost-%COMP%]   .panel-active[_ngcontent-%COMP%]{padding-right:0;padding-left:0;width:20rem;z-index:250;border-right:2px solid #dbe2e9}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{grid-area:header;background-color:#dbe2e9}[_nghost-%COMP%]   .nav[_ngcontent-%COMP%]{grid-area:nav;display:flex;justify-content:center;background-color:#666;height:-moz-fit-content;height:fit-content}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]{grid-area:main;box-sizing:border-box;padding:0;margin:0;height:100%;background-color:#fff;display:grid;grid-template:"sec main"}[_nghost-%COMP%]   .main.main-single[_ngcontent-%COMP%]{grid-template-columns:1fr 100%!important}[_nghost-%COMP%]   .main.main-single[_ngcontent-%COMP%]   .viewer-main[_ngcontent-%COMP%]{border-left:none}[_nghost-%COMP%]   .main.mian-multi[_ngcontent-%COMP%]{grid-template-columns:1fr 60%}[_nghost-%COMP%]   .main.mian-multi[_ngcontent-%COMP%]   .viewer-main[_ngcontent-%COMP%]{border-left:6px solid #dbe2e9}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .resizer[_ngcontent-%COMP%]{position:absolute;display:flex;justify-content:center;align-items:center;border:none;border-radius:5px;z-index:100;background:#b9dce3;color:#7ea0aa;padding:0;width:44px;height:13px;font-size:8px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-main[_ngcontent-%COMP%]{grid-area:main;display:block;position:relative;width:100%}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-main[_ngcontent-%COMP%]   .resizer[_ngcontent-%COMP%]{top:calc(50% - 5px);transform:rotate(90deg);left:-25px;cursor:col-resize}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-secondary[_ngcontent-%COMP%]{grid-area:sec;display:flex;flex-direction:column;height:100%;position:relative}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-secondary-sub[_ngcontent-%COMP%]{flex-grow:1;height:50%;display:flex;justify-content:center;align-items:center;position:relative}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-secondary-sub[_ngcontent-%COMP%]   .resizer[_ngcontent-%COMP%]{top:-10px;left:50%;transform:translate(-50%);cursor:row-resize}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .viewer-secondary-sub[_ngcontent-%COMP%]:nth-child(2){border-top:6px solid #dbe2e9}[_nghost-%COMP%]   .player[_ngcontent-%COMP%]{grid-area:player;height:-moz-fit-content;height:fit-content;background-color:#dbe2e9;z-index:100}[_nghost-%COMP%]   .footer[_ngcontent-%COMP%]{grid-area:footer;background-color:#565454;height:-moz-fit-content;height:fit-content;z-index:100;min-height:20px}']}),s})()}];let ox=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=o.oAB({type:s}),s.\u0275inj=o.cJS({imports:[k.Bz.forChild(sx),k.Bz]}),s})();var ax=ge(6473),lx=ge(7135);let cx=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=o.oAB({type:s}),s.\u0275inj=o.cJS({providers:[Eh,Ch,ea],imports:[j.ez,ox,ax.h,lx.g,kn.aw,En.u5]}),s})()}}]);